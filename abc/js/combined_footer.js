function onYouTubePlayerReady(n){for(var t=0;t<aston.plugins.youtubeplayer.players.length;t++)aston.plugins.youtubeplayer.players[t].atts.id==n&&aston.plugins.youtubeplayer.players[t].onYouTubePlayerReady()}var aston=aston||{};aston.lang={en:{forms:{firstname:"First Name",lastname:"Last Name",address:"Address",address2:"Address 2",town:"Town / City",county:"County / State",postcode:"Postcode / Zipcode",email:"Email address",telephone:"Telephone",comments:"Comments",model:"Model",titleOption:"Title",stateOption:"State",countryOption:"Country",manufacturerOption:"Manufacturer",preferredDealerCountryOption:"Preferred Country",preferredDealerLocationOption:"Dealer Location",selectYourDealerText:"Select your Dealer...",franchiseOption:"Country of Interest",requiredFields:"Please enter all of the required fields",guestName:"Guest Name",guestEmail:"Guest Email",bookingSuccess:"Thank you, you are now registered for this event",bookingNoMore:"Sorry there are currently no more dates available for this event",bookingThanks:"Thanks for taking the time to update your details",bookingConfirm:"Thank you, you are now registered for this event on the ",bookingError:"Sorry an error has occured while making your booking",sorryError:"Sorry, an error has occured",sorryCopy:"It's not possible to reach this page",availableDatesOption:"Available Dates",submit:"Submit",submitting:"Submitting...",mobile:"Mobile",fax:"Fax",jobTitle:"Job Title",other:"(Other) please specify",url:"Url",nameOfMedia:"Name of media publications / channels / organisations (maximum of nine])",companyname:"Company Name",vin:"VIN",username:"Email address (Username)",confirmEmail:"Confirm email address",password:"Choose Password (at least 7 characters)",retypePassword:"Retype Password",nickname:"Nickname",code:"Authorisation Code",pleaseWait:"Please wait..."},videoplayer:{playAnchorText:"Play",closeAnchorText:"Close",twitterAnchorText:"Twitter",twitterTitleText:"Post to Twitter",facebookAnchorText:"Facebook",facebookTitleText:"Post to Facebook",linkAnchorText:"Link",embedAnchorText:"Embed",galleryAnchorText:"Gallery",fullscreenOffAnchorText:"Fullscreen",fullscreenOnAnchorText:"Fullscreen",fullscreenOffTitleText:"Play video fullscreen",fullscreenOnTitleText:"Play video normal size",sharePopupCloseText:"Close",soundsTitleAnchorText:"Engine Sounds"},carousel:{prevAnchorText:"Prev",nextAnchorText:"Next",downloadAnchorText:"Download image"},news:{first:"First",previous:"Previous",next:"Next",last:"Last",back:"Back",download:"Download",share:"Share",latestnews:"Latest News"},configurator:{exterior:"Exterior",interior:"Interior",optionsAndAccessories:"Options & Accessories",summary:"Summary",shareAndSubmit:"Share & Submit",add:"Add",save:"Save",saving:"Saving...",edit:"Edit",remove:"Remove",emailToAFriend:"Email to a friend",downloadPdf:"Download PDF",generating:"Generating...",findYourNearestDealer:"Find your nearest dealer",facebook:"Share on Facebook",twitter:"Share on Twitter",linkedIn:"Share on LinkedIn",google:"Share on Google+",options:"Options",accessories:"Accessories",noOptions:"No options currently available",loading:"Loading...",modelFeatures:"Model Features",primaryColour:"Select First Colour",secondaryColour:"Select Second Colour",primaryColourPalette:"First Colour Palette",secondaryColourPalette:"Second Colour Palette",primaryColourPaletteText:"Select a first interior colour from our primary, contemporary or special collections.",secondaryColourPaletteText:"Select a second interior colour, note your choices may be restricted by your first selection.",startupHeading:"Choose your configuration",startupText:"You've previously chosen to save a ##VehicleName## configuration. Please select whether you would like to load this configuration or start from the default specification.",start:"Start new",load:"Load previous",termsAndConditions:"Please note our Car Configurator Terms and Conditions",configureFullRange:"Configure full model range",formSubmitted:"Thank you for completing your configuration. If you would like to submit the specification to one of our dealer partners please complete your details below. Submittal of this form does not guarantee the availability of the specification and does not constitute a contract of sale. Our configurator is for guidance only and should not be relied upon for accuracy or availability of materials, colours and finishes. Contact an aston martin dealer for further information.",roofup:"View roof",roofdown:"Hide roof",caveat:"The configurator application is intended only as a guide and designs, specifications or colours are subject to change. Please contact your dealer or Aston Martin Sales Representative."},dealers:{useLocation:"Use my location",enterLocation:"Enter a location",dealer:"Dealers",service:"Service Centres",search:"Search",clear:"Clear / New Search",nearestDealers:"Nearest Dealers",info:"Info"}},de:{forms:{firstname:"Vorname",lastname:"Nachname",address:"Adresse",town:"Ort / Stadt",county:"Landkreis / Staat",postcode:"Postleitzahl",email:"E-Mail",telephone:"Telefon",comments:"Kommentare",model:"Modell",titleOption:"Titel",stateOption:"Zustand",countryOption:"Land",manufacturerOption:"Hersteller",preferredDealerCountryOption:"Bevorzugte Händler",preferredDealerLocationOption:"Händler Standort",selectYourDealerText:"Wählen Sie Ihren Händler...",franchiseOption:"Land of Interest",requiredFields:"Bitte geben Sie alle erforderlichen Felder",submit:"Absenden",vin:"VIN",username:"Email address (Username)",confirmEmail:"Confirm email address",password:"Choose Password (at least 7 characters)",retypePassword:"Retype Password",nickname:"Nickname"},videoplayer:{playAnchorText:"Abspielen",closeAnchorText:"Schließen",twitterAnchorText:"Twitter",twitterTitleText:"Post to Twitter",facebookAnchorText:"Facebook",facebookTitleText:"Post to Facebook",linkAnchorText:"Link",embedAnchorText:"Einfügen",galleryAnchorText:"Galerie",fullscreenOffAnchorText:"Vollbild",fullscreenOnAnchorText:"Vollbild",fullscreenOffTitleText:"Video in Vollbildansicht abspielen",fullscreenOnTitleText:"Video im Videofenster abspielen",sharePopupCloseText:"Schließen",soundsTitleAnchorText:"Motoren-Sounds"},carousel:{prevAnchorText:"Zur�ck",nextAnchorText:"Weiter",downloadAnchorText:"Bild-Download"},news:{first:"Erste Seite",previous:"Zur�ck",next:"Weiter",last:"Letzte Seite",back:"Zur�ck",download:"Download",share:"Share",latestnews:"Aktuellste Nachrichten"},dealers:{useLocation:"Meinen Standort verwenden",enterLocation:"Standort eingeben",dealer:"Händler",service:"Werkstatt",search:"Suche",clear:"Neue Suche",nearestDealers:"Nächster Händler",info:"Information"},configurator:{exterior:"Exterieur",interior:"Interieur",optionsAndAccessories:"Optionen & Zubehör",summary:"Zusammenfassung",shareAndSubmit:"Abschicken & teilen",add:"Hinzufügen",save:"Speichern",saving:"Saving...",edit:"Editieren",remove:"Entfall",emailToAFriend:"Email an Freund",downloadPdf:"PDF herunterladen",generating:"Erstellt...",findYourNearestDealer:"Finden Sie Ihren nächstgelegenen Händler",facebook:"Auf Facebook teilen",twitter:"Auf Twitter teilen",linkedIn:"Auf LinkedIn teilen",google:"Auf Google+ teilen",options:"Optionen",accessories:"Zubehör",noOptions:"No options currently available",loading:"Lädt...",modelFeatures:"Modell Eigenschaften",primaryColour:"Grundfarben",secondaryColour:"Zweite Farbe",primaryColourPalette:"Grundfarben",secondaryColourPalette:"Zweite Farbe",primaryColourPaletteText:"Wählen Sie eine Grundfarbe für das Interieur aus unserer Fast Track- oder.",secondaryColourPaletteText:"Wählen Sie eine zweite Interieurfarbe, die Auswahl kann durch die Grundfarbe eingeschränkt sein.",startupHeading:"Wählen Sie Ihre Konfiguration",startupText:"Sie hatten bereits eine Konfiguration gespeichert. Bitte wählen Sie, ob Sie diese Konfiguration laden möchten oder mit der Standatdkonfiguration beginnen möchten.",start:"Neu starten",load:"Vorherge laden",termsAndConditions:"Bitte nehmen Sie die Geschäftsbedingungen des Konfigurators zur Kenntnis",configureFullRange:"Gesamte Modellpalette konfigurieren",formSubmitted:"Danke für Ihre Auswahl. Tragen Sie bitte Ihre Kontaktdaten ein, falls Sie die Spezifikation an einen unserer Händler senden möchten. Das Einsenden Ihrer Auswahl garantiert nicht die Verfügbarkeit des Fahrzeuges und bildet keinen",caveat:"Der Konfigurator dient lediglich zur Unterstützung. Design, Spezifikationen oder Farben können abweichen. Für weiter Informationen wenden Sie sich bitte an Ihren Aston Martin Händler.\n"}},zh:{forms:{firstname:"名",lastname:"姓",address:"地址",town:"市/镇",county:"国家/省",postcode:"邮编",email:"电子邮箱地址",telephone:"电话号码",comments:"評論",model:"Model",titleOption:"标题",stateOption:"州",countryOption:"国家",manufacturerOption:"厂家",preferredDealerCountryOption:"选择的经销商",preferredDealerLocationOption:"经销商地点",selectYourDealerText:"選擇您的經銷商...",franchiseOption:"利益国家",requiredFields:"请输入所需的所有领域",submit:"提交",vin:"VIN",username:"Email address (Username)",confirmEmail:"Confirm email address",password:"Choose Password (at least 7 characters)",retypePassword:"Retype Password",nickname:"Nickname"},carousel:{prevAnchorText:"前",nextAnchorText:"未来",downloadAnchorText:"下载图片"},news:{first:"第一",previous:"前",next:"未来",last:"最后",back:"背面",download:"下载",share:"Share",latestnews:"最新新闻"},configurator:{exterior:"外部",interior:"内部",optionsAndAccessories:"选项&配件",summary:"总结",shareAndSubmit:"分享和提交",add:"添加",save:"保存",saving:"保存中…",edit:"编辑",remove:"移除",emailToAFriend:"发邮件给朋友",downloadPdf:"下载 PDF",generating:"等待中...",findYourNearestDealer:"查找最近的经销商",facebook:"分享至Facebook",twitter:"分享至Twitter",linkedIn:"分享至LinkedIn",google:"分享至Google+",options:"选项",accessories:"配件",noOptions:"No options currently available",loading:"等待中...",modelFeatures:"细节特征",primaryColour:"原色",secondaryColour:"配色",primaryColourPalette:"原色色板",secondaryColourPalette:"配色色板",primaryColourPaletteText:"从我们的快速通道或现代色系列中选择一个内饰原色。",secondaryColourPaletteText:"选择一个内饰配色，请注意您的选择可能会受到原色选择的限制。",startupHeading:"选择您的配置",startupText:"您已经保存了一个配置.请选择是否加载这个配置或者重新开始",start:"重新开始始",load:"加载前一个配置",termsAndConditions:"请注意我们的车辆配置程序条款和条件",formSubmitted:"谢谢您完成配置。 如果您想将规格要求提交给我们的经销商，请填写下面的详细说明。提交本表格不保证能满足您的规格要求，并且不构成销售合同。",caveat:"配置器的应用仅是一个在一定范围内作为一个在设计，规格或者颜色上的指导。\n请联系您的经销商或阿斯顿马丁的销售代表"},dealers:{useLocation:"使用我的位置",enterLocation:"输入位置",dealer:"经销商",service:"服务中心",search:"搜寻",clear:"清除/重新搜寻",nearestDealers:"最近的经销商",info:"信息"}},ja:{forms:{firstname:"姓",lastname:"名",address:"都道府県",town:"市区町",county:"住所",postcode:"郵便番号/郵便番号",email:"メールアドレス",telephone:"電話",comments:"コメント",model:"Model",titleOption:"肩書",stateOption:"State",countryOption:"国",manufacturerOption:"メーカー",preferredDealerCountryOption:"首选经销商",preferredDealerLocationOption:"经销商的位置",selectYourDealerText:"ディーラー...",franchiseOption:"Country of Interest",requiredFields:"请输入所需的所有领域",guestName:"ゲスト様のお名前",guestEmail:"ゲスト様のemail",bookingSuccess:"谢谢你，你现在注册此事件",bookingNoMore:"很抱歉，目前有没有更多的日期可用此事件",bookingThanks:"感谢您抽出宝贵时间来更新您的详细资料",bookingConfirm:"谢谢你，你现在注册此事件 ",bookingError:"很抱歉，发生了一个错误",sorryError:"很抱歉，发生了一个错误",sorryCopy:"这是不可能达到此页",availableDatesOption:"出席可能な日時",submit:"送信",vin:"VIN",username:"Email address (Username)",confirmEmail:"Confirm email address",password:"Choose Password (at least 7 characters)",retypePassword:"Retype Password",nickname:"Nickname"},configurator:{exterior:"エクステリア",interior:"インテリア",optionsAndAccessories:"オプション&アクセサリー",summary:"サマリー",shareAndSubmit:"シェア＆送信",add:"追加",save:"保存",saving:"保存中",edit:"編集",remove:"削除",emailToAFriend:"友人にEメールする",downloadPdf:"PDFをダウンロード",generating:"生成中",findYourNearestDealer:"最寄のディーラーを探す",facebook:"Facebookでシェアする",twitter:"Twitterでシェアする",linkedIn:"LinkedInでシェアする",google:"Google+でシェアする",options:"オプション",accessories:"アクセサリー",noOptions:"現在利用できるオプションはありません",loading:"読み込み中",modelFeatures:"モデル機能",primaryColour:"プライマリーカラー",secondaryColour:"セカンダリーカラー",primaryColourPalette:"プライマリーカラー・パレット",secondaryColourPalette:"セカンダリーカラー・パレット",primaryColourPaletteText:"ファーストトラックまたはコンテンポラリー・コレクションから、プライマリー・インテリアカラーを1つお選びください。",secondaryColourPaletteText:"セカンダリー・インテリアカラーを1つお選びください。選択したプライマリーカラーによって、選択肢が限られている場合があります。",startupHeading:"ご希望の設定をお選びください",startupText:"以前に保存された設定があります。この設定を読み込むか、デフォルトの仕様から始めるかを選択してください。",start:"新しい設定を始める",load:"前の設定を読み込む",termsAndConditions:"カーコンフィギュレーターの使用条件にご留意ください",configureFullRange:"すべてのモデルのコンフィグレーション",formSubmitted:"カーコンフィギュレーターの使用条件にご留意ください",caveat:"コンフィギュレータアプリケーションはガイドやデザインを目的として作られているため、仕様や色が変更される場合がございます。詳しくは正規販売店またはアストンマーティンの営業担当者までお問い合わせください"}},it:{forms:{firstname:"Nome",lastname:"Cognome",address:"Indirizzo",town:"Località",county:"Provincia",postcode:"Codice postale",email:"Indirizzo email",comments:"Commenti",telephone:"Telefono",titleOption:"Titolo",stateOption:"Stato",countryOption:"Paese",manufacturerOption:"Costruttore",preferredDealerCountryOption:"Paese preferito",preferredDealerLocationOption:"Posizione concessionario",selectYourDealerText:"Scelga il Suo concessionario...",requiredFields:"La preghiamo di compilare tutti i campi richiesti",submit:"Invia Dati"}}},aston=aston||{},aston.generic=function(){var n={bitly:{login:"o_58beie1q12",apiKey:"R_aab2b8474edc0bc88efc35e9b1510cdf"}},c=function(n,t,i){var r=aston.lang[n]&&aston.lang[n][t]&&aston.lang[n][t][i];return r||(r=aston.lang.en[t][i]),typeof r!="undefined"?r:""},h=function(n){var n=n,i=n.parent().children("span").text(),r=n.children("option"),t;return n.attr("id")=="cmbPurchaseTimeframe"&&(i=i.replace("<","&lt;")),r.each(function(){if($(this).html()==i)return t=$(this),!1}),typeof t!="undefined"?t.attr("value"):0},s=function(n){var n=n,i=n.parent().children("span").text(),r=n.children("option"),t;return n.attr("id")=="cmbPurchaseTimeframe"&&(i=i.replace("<","&lt;")),r.each(function(){if($(this).html()==i)return t=$(this),!1}),typeof t!="undefined"?t.text():""},v=function(n,t){t==null&&(t=""),n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+n+"=([^&#]*)"),i=r.exec(window.location.href);return i==null?t:i[1]},a=function(n){var i=$.trim(n),t=new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);return t.test(i)},l=function(n){return n===undefined||n==null||n.length<=0||n==""?!0:!1},o=function(t){return $.Deferred(function(i){$.getJSON("http://api.bitly.com/v3/shorten?apiKey="+n.bitly.apiKey+"&login="+n.bitly.login+"&longUrl="+t+"&format=json&callback=?").always(function(n){n&&n.status_code==200?i.resolve(n.data.url):i.resolve(t)})}).promise()},r=function(n){Modernizr.backgroundsize?$("html").css({"background-image":"url("+n+")","background-attachment":"fixed","background-repeat":"no-repeat","background-size":"cover"}):$("html").css({"background-image":"url("+n+")","background-position-x":"top","background-position-y":"left","background-color":"#000","background-attachment":"fixed","background-repeat":"no-repeat"})},i=function(n,t){var r=n.parent(),i=r.outerWidth();return{width:i,height:i/t}},t=function(n,t){var i=e();i.load(function(){window.location.href=t}),i.attr("src",n)},e=function(){var t=_.uniqueId("iframe_"),n='<iframe id="'+t+'" name="'+t+'" style="position:absolute; top:-9999px; left:-9999px;"';return window.ActiveXObject&&(n+=' src="javascript:false"'),n+="></iframe>",$(n).appendTo(document.body),$("#"+t)},f=function(n){var t=t||[];try{t.push(["_trackPageview",n])}catch(i){}},u=function(){var i=_.uniqueId("login-"),r={Id:i,LoginUrl:"/login?ReturnUrl="+window.location.href},u=$("#loginTemplate").tmpl(r),t;$("body").append(u),t=$("#"+i),$.fancybox.open(t,{padding:0,autoSize:!0,afterClose:function(){t.remove()}})};return{getTranslatedText:c,getValueForSelect:h,getTextForSelect:s,getQueryStringValue:v,isValidEmailAddress:a,isStringNullOrEmpty:l,getBitlyUrl:o,addBackgroundImage:r,getContentSize:i,loginAndRedirect:t,logPageView:f,showLoginPopup:u}}(),function(n,t){function f(){i.live("focus",function(){aston.w.trigger("am.forms.inputs.focus",[n(this)])}),i.live("blur",function(){aston.w.trigger("am.forms.inputs.blur",[n(this)])})}function e(){aston.w.bind("am.forms.inputs.focus",function(t,i){var u,f=i.parent(),input,r;if((i.attr("value")===i.attr("placeholder")||i.attr("value")===i.attr("title"))&&(i.attr("value",""),i.hasClass("password-field"))){input=i[0],r=document.createElement("input");with(r)id=input.id,name=input.name,value="",size=input.size,title=input.title,className=input.className,type="password";input.parentNode.replaceChild(r,input),setTimeout(function(){n("input[id="+r.id+"]").focus()})}}),aston.w.bind("am.forms.inputs.blur",function(n,t){var r,u=t.parent(),input,i;if(t.attr("value").length===0){if(t.attr("value",t.attr("placeholder")),t.hasClass("password-field")){input=t[0],i=document.createElement("input");with(i)id=input.id,name=input.name,value=input.title,size=input.size,title=input.title,className=input.className,type="text";input.parentNode.replaceChild(i,input)}}else t.addClass("edited")})}var u=this,r={__id:t},o=u.w,i;u.register(r),i=n("input, textarea"),r.init=function(){n("#login-header").length>0||(!Modernizr.input.placeholder&&i.length>0?(i.each(function(){var $input=n(this),i;if($input.attr("type")==="password"){var input=$input[0],className=input.className,t=document.createElement("input");className.indexOf("password-field")==-1&&(className+=" password-field");with(t)id=input.id,name=input.name,value=$input.attr("placeholder"),size=input.size,title=input.title,className=input.className,type="text";input.parentNode.replaceChild(t,input)}else $input.attr("value",$input.val()==""?$input.attr("placeholder"):$input.val())}),e(),f()):(n("html").addClass("placeholder"),i.filter(":password").addClass("password-field")))}}.apply(aston,[jQuery,"inputhint"]),function(n,t){function v(){n("div#pages aside.pbs a").click(function(){return i=e.hasClass("pbs")?s.pbs:s.event,n(this).parent().hasClass("a-"+i[1])&&this.id==="a-"+i[1]?!1:(aston.w.trigger("am.nav.pbs.click",[n(this)]),!1)})}function y(){aston.w.bind("am.nav.pbs.click",function(t,e){function v(){var t=s*80;u.height(""),e.removeClass("ajax"),l.each(function(a){var v=function(){a+1===l.length&&u.animate({left:t},400,function(){e.parent().removeClass("a-"+i[0]+" a-"+i[1]+" a-"+i[2]).addClass(c),n("#pages").find("section").removeClass("a-"+i[0]+" a-"+i[1]+" a-"+i[2]).addClass(c),n("#articleContent").data("type")!="soul"?(aston.plugins.carousel.init(r),aston.plugins.videoplayer.buildVideo({containerId:"video"}),setTimeout(function(){aston.plugins.videoplayer.buildSoundOverlay()},aston.ie?3e3:1)):(aston.plugins.videoplayer.unsetCurrent(),aston.plugins.soul.init()),aston.w.trigger("am.theme",[aston.theme]),f.animate({opacity:0},800,function(){aston.ie?c==="a-"+i[2]?e.siblings().show():l.show():c==="a-"+i[2]?e.siblings().animate({opacity:1},400):l.animate({opacity:1},400),f.remove(),h[s]=1,s=null,o=!1})})};aston.ie?(n(this).hide(),v()):n(this).animate({opacity:0},400,v)})}var y=e.attr("href"),l=e.siblings().andSelf(),c=e.attr("id"),s,p;if(!o){o=!0;switch(c){case"a-"+i[0]:s=0;break;case"a-"+i[1]:s=1;break;case"a-"+i[2]:s=2}e.addClass("ajax").siblings().removeClass("on"),f=n('<div class="articleMask" />').appendTo(u),f.animate({opacity:1},800,function(){aston.plugins.carousel.stop(r,0),aston.plugins.videoplayer.stop(),n("#articleContent").data("type")==="soul"&&(aston.plugins.soul.unload(),aston.plugins.videoplayer.unload(),aston.plugins.overlays.overlayExists("soul-video")&&aston.overlay({name:"soul-video"})),u.height(r.height()),r.hide(),r=a.eq(s),n("#articleContent").addClass("articleContent").removeAttr("id"),h[s]?(r.find(".articleContent").attr("id","articleContent").end().css("display","block"),v(!0)):r.load(y+" #articleContent",v)})}})}var l=this,c={__id:t},p=l.w,o,i,h,r,a,u,f,s,e;l.register(c),o=!1,s={pbs:["power","beauty","soul"],event:["video","experience","track"]},c.init=function(){(e=n("#pages"),e.hasClass("pbs")||e.hasClass("event-type"))&&(h=[0,1,0],r=n(".contentWrapper").addClass("content1"),r.parent().prepend('<div class="contentWrapper content0"></div>').append('<div class="contentWrapper content2"></div>'),a=r.siblings(".contentWrapper").andSelf(),u=n("#pages section.page"),y(),v())}}.apply(aston,[jQuery,"pbsnav"]),function(n,t){function e(){r.find("a.download").live("click",function(){return aston.w.trigger("am.brochures.click",[n(this)]),!1}),r.find("a.btn-close").click(function(){return aston.w.trigger("am.brochures.close",[n(this)]),!1})}function o(){aston.w.bind("am.brochures.click",function(t,r){var u=n(r.attr("href"));r.hasClass("disabled")||(u.hasClass("open")?u.animate({height:0},200,function(){u.removeClass("open"),r.removeClass("on"),r.parent().siblings().find("a").removeClass("disabled"),aston.ie?(i.find("div.overlay").hide(),n("#articleContent").removeClass("hasOverlay"),i.find("div.overlay").remove()):i.find("div.overlay").animate({opacity:0},200,function(){n("#articleContent").removeClass("hasOverlay"),n(this).remove()})}):(i.prepend('<div class="overlay transparent" />'),aston.ie?(i.find("div.overlay").show(),n("#articleContent").addClass("hasOverlay"),u.animate({height:53},400,function(){u.addClass("open"),r.addClass("on"),r.parent().siblings().find("a").addClass("disabled")})):i.find("div.overlay").animate({opacity:1},300,function(){n("#articleContent").addClass("hasOverlay"),u.animate({height:53},400,function(){u.addClass("open"),r.addClass("on"),r.parent().siblings().find("a").addClass("disabled")})})))}),aston.w.bind("am.brochures.close",function(){var f=r.find("div.pane.open");f.animate({height:0},200,function(){f.removeClass("open"),r.find("a.on").removeClass("on"),r.find("a.disabled").removeClass("disabled"),aston.ie?(i.find("div.overlay").hide(),n("#articleContent").removeClass("hasOverlay"),i.find("div.overlay").remove()):i.find("div.overlay").animate({opacity:0},200,function(){n("#articleContent").removeClass("hasOverlay"),n(this).remove()})})})}var f=this,u={__id:t},s=f.w,r,i;f.register(u),i=n("#articleContent"),u.init=function(){(r=n("#brochure-downloads"),r.length<1)||(e(),o())}}.apply(aston,[jQuery,"brochures"]),function(n,t){function u(n){return n.hasClass("carousel-built")?n:n.find(".carousel-built")}function i(n,t){this.carouselIndex=n,this.$container=t.data("carousel",this),this.init()}function s(n){var t=n.parent().data("newwindow");return typeof t!="undefined"&&t}var o=this,r={__id:t},a=o.w;o.register(r);var h=500,c={interval:7e3,playButtons:!0,autoplay:!0,autostart:!0,downloadLink:!1,slideMenu:!1,menuControlsSlides:!1,oneItemPerSlide:!0,clickAdvancesSlide:!1},l={car:{downloadLink:!0,clickAdvancesSlide:!0},media:{downloadLink:!0,clickAdvancesSlide:!0},relatedVideos:{interval:1e4,oneItemPerSlide:!1,playButtons:!1,autostart:!1},eventLanding:{slideMenu:!0},racingSeries:{downloadLink:!0,playButtons:!1,clickAdvancesSlide:!0,autoplay:!1,autostart:!1},racingHistory:{downloadLink:!0,playButtons:!1,clickAdvancesSlide:!0,autoplay:!1,autostart:!1},home:{oneItemPerSlide:!1},simple:{playButtons:!0,clickAdvancesSlide:!0},half:{clickAdvancesSlide:!0,playButtons:!0,autostart:!0},"":{}},f=[],e=0;r.init=function(t,r){if(!(n(".configurator-wrap").length>0)||r){var u=n("#carousel, div.simpleCarousel, div.menuCarousel, div.mediaCarousel, div.halfCarousel",t);u.length&&(u.hasClass("carousel-built")?u.data("carousel").reInit():n.each(u,function(t,r){f.push(new i(e,n(r))),e++}))}},r.refresh=function(t){u(t).each(function(){n(this).data("carousel")&&n(this).data("carousel").refresh()})},r.stop=function(t){u(t).each(function(){n(this).data("carousel")&&n(this).data("carousel").stop()})},r.destroy=function(t){u(t).each(function(){var t=n(this).data("carousel");t.destroy(),delete t})},r.start=function(t){t?u(t).each(function(){n(this).data("carousel").start()}):f[0]&&f[0].start()},r.play=function(t){t?u(t).each(function(){n(this).data("carousel").advance()}):f[0]&&f[0].advance()},r.loadImage=function(n,t){var i=new Image;i.onload=function(){typeof t=="function"&&t.call(this)},i.className="resize",i.src=n},i.prototype.timer=null,i.prototype.init=function(){var t;window.clearTimeout(this.themeChangebuffer),this.standardiseHtml(),n(".generic-carousel").length?this.carouselType="":n("article.store").length?this.carouselType="simple":n("#main").find("div.simpleCarousel.brochure").length?this.carouselType="simple":n("#main").find("div.series").length?this.carouselType="racingSeries":n("#main").find("div.history").length?this.carouselType="racingHistory":n("#main").find("div.car").length?this.$container.is("#carousel")?this.carouselType="car":this.$container.is(".simpleCarousel")&&(this.carouselType="relatedVideos"):this.carouselType=n("#main").find("div.events-landing").length?"eventLanding":n("#main").find("div.simpleCarousel").length?"simple":n("#main").find("section.home").length?"home":n("#main").find("div.mediaCarousel").length?"media":n("#main").find("div.halfCarousel").length?"half":"",this.options=n.extend({},c,l[this.carouselType]),this.page=0,this.$list=this.processSlides(this.$container.find("ul.slides")),this.$slides=this.$list.children("li"),imgWidth=this.$container.width(),imgHeight=this.$container.height(),imgRatio=imgWidth/imgHeight,this.$bookmarks=this.$list.find("div.bookmarks").remove(),this.$bookmarks.length&&this.$container.append(this.$bookmarks),this.options.slideMenu&&(this.$menu=this.$container.findClosest(".carousel-menu li")),t=this.$slides.first().find("div.slideItem"),t.attr("data-image")?this.buildSlides(t,0,function(){this.$slides.length>1&&(this.buildPagination(),this.$container.append('<div class="track"><div class="progress"></div></div>'),this.$progress=this.$container.find("div.progress")),this.listeners(),this.triggers(),aston.w.trigger("am.theme",[aston.theme]),this.$slides.find("img.resize").fadeIn(),this.autoStart(),this.$list.css("left","0"),this.$slides.not(":eq(0)").find("div.slideItem").addClass("off"),t.addClass("on"),this.$container.addClass("carousel-built"),this.buildSlides(this.$slides.slice(1).find("div.slideItem"),1,function(){aston.w.trigger("am.theme",[aston.theme]),this.$slides.find("img.resize").css({display:"block"})})}):(this.refresh(),this.buildPagination(),this.triggers(),this.listeners(),this.$slides.length>1&&(this.$container.append('<div class="track"><div class="progress"></div></div>'),this.$progress=this.$container.find("div.progress")),this.autoStart(),this.$list.css("left","0"),this.$slides.not(":eq(0)").find("div.slideItem").addClass("off"),t.addClass("on"),this.$container.addClass("carousel-built"))},i.prototype.processSlides=function(t){if(this.options&&this.options.oneItemPerSlide)return t.children("li").filter(":has(.slidebreak)").remove(),t;var i=n('<ul class="slides" />'),r=0,u=!0,f=t.children("li");return f.each(function(t){var o=n(this),e;o.find("div.slidebreak").length<1?(u?(e=n("<li />"),i.append(e),u=!1):e=i.children("li").last(),e.append(o.find("div.slideItem")),r+=1):(u=!0,i.children("li").last().addClass("slides-"+r),r=0),t+1===f.length&&i.children("li").last().addClass("slides-"+r)}),t.html(i.html())},i.prototype.destroy=function(){window.clearTimeout(this.themeChangebuffer),aston.w.unbind("am.carousel"+e),this.stop(),this.$container.remove()},i.prototype.getPage=function(){return this.page},i.prototype.standardiseHtml=function(){this.$container.find("ul:not([class])").filter(function(){return n(this).parents(".slideInner").length?!1:!0}).addClass("slides")},i.prototype.refreshImages=function(){var i=this;window.clearTimeout(this.themeChangeBuffer),this.themeChangeBuffer=window.setTimeout(function(){i.$container.find("img.resize").each(function(t,u){var f=n(u),e=aston.themeFilename(f.parents("div.slideItem").attr("data-image"),i.$container);r.loadImage(e,function(){f.replaceWith(n(this))})})},h)},i.prototype.refresh=function(){var n=this.$container.width(),t=n*this.$slides.length;this.$slides.width(n),this.$list.width(t).css("left","-"+n*this.page+"px")},i.prototype.unload=function(){clearTimeout(this.themeChangeBuffer),aston.w.unbind("am.carousel")},i.prototype.triggers=function(){var t=this;this.$container.delegate(".slideInner","click",function(){n(this).siblings("a.slide-link, a.slide-nav").trigger("click")}).delegate(".slideInner a","click",function(n){n.stopPropagation()}).delegate("div.carousel-pagination a, a.slide-nav","click",function(){return aston.w.trigger("am.carousel"+t.carouselIndex+".pagination.click",[n(this)]),!1}).delegate("a.slide-link","click",function(t){return s(n(this))?window.open(t.currentTarget.href,"",""):window.location=t.currentTarget.href,!1}),this.$container.touchwipe({wipeLeft:function(){t.pause(),t.goToSlide(t.page+1)},wipeRight:function(){t.pause(),t.goToSlide(t.page-1)},min_move_x:20,min_move_y:20,preventDefaultEvents:!1}),this.options.playButtons&&this.$container.delegate("a.stop","click",function(){var r=n(this);return r.hasClass("play")?aston.w.trigger("am.carousel"+t.carouselIndex+".play.click",[r]):aston.w.trigger("am.carousel"+t.carouselIndex+".stop.click",[r]),!1})},i.prototype.listeners=function(){var n=this;aston.w.bind("am.theme",function(t,i){aston.w.trigger("am.carousel"+n.carouselIndex+".retheme",[i])}),aston.w.bind("am.carousel"+n.carouselIndex+".retheme",function(t,i){n.refresh(),n.refreshImages(i)}),aston.w.bind("am.carousel"+n.carouselIndex+".pagination.click",function(t,i){n.goToSlide(i.attr("data-page"))}),this.options.playButtons&&(aston.w.bind("am.carousel"+n.carouselIndex+".stop.click",function(){n.pause()}),aston.w.bind("am.carousel"+n.carouselIndex+".play.click",function(){n.advance()}))},i.prototype.buildPagination=function(){var t,i;for(this.$pagination=n('<div class="carousel-pagination"><div class="paginationInner"></div></div>'),t=this.$slides.length,i=this.$slides.length;t;)this.$pagination.find("div.paginationInner").append('<a href="#" data-page="'+(i-t)+'">'+(i-t)+"</a>"),t--;this.$pagination.appendTo(this.$container).find("div.paginationInner").width(i*29),this.options.playButtons&&this.$slides.length>1&&(this.playButton=n('<a href="#" class="stop"/>').text("Stop").appendTo(this.$container)),this.$container.find("div.carousel-pagination").find("a:eq("+this.page+")").addClass("on"),this.indicateBookmark(this.$container.find("div.carousel-pagination.bookmarks"))},i.prototype.buildSlides=function(t,i,u){var f=this;t.each(function(e){var o=n(this),h=o.find("img.resize"),s,c,l;e+=i,f.options.clickAdvancesSlide&&!o.attr("data-link")?(c=e<t.length?e+1:0,s=n('<a href="#" data-page="'+c+'" class="slide-nav"></a>')):o.attr("data-link")&&(s=n('<a href="'+o.attr("data-link")+'" class="slide-link"></a>')),r.loadImage(aston.themeFilename(o.attr("data-image"),f.$container),function(){var r=n(this);h.length?(!h.parent("a").length&&s&&h.wrap(s),h.replaceWith(r)):o.prepend(s?s.append(this):this),f.options.downloadLink&&o.append('<a href="'+o.attr("data-image")+'" class="download" target="_blank">'+aston.lang[aston.language].carousel.downloadAnchorText+"</a>"),e-i+1===t.length&&typeof u=="function"&&u.apply(f)})})},i.prototype.indicateBookmark=function(){var t=this.$bookmarks.find("a").removeClass("on"),i=this;t.each(function(r){var u=n(this),f=u.attr("data-page");if(f===i.page)return u.addClass("on"),!1;if(f>i.page)return r>0&&u.prev().addClass("on"),!1;r===t.length-1&&t.last().addClass("on")})},i.prototype.stop=function(){this.pause(),this.goToSlide(0,!0)},i.prototype.pause=function(){clearTimeout(this.timer),this.playButton&&this.playButton.addClass("play")},i.prototype.start=function(){this.$container.length&&this.$slides.length>1&&this.advance()},i.prototype.advance=function(){var n=this;this.options.playButtons&&this.playButton.removeClass("play"),this.timer=setTimeout(function(){n.goToSlide((n.page+1)%n.$slides.length)},this.options.interval)},i.prototype.goToSlide=function(n,t){var i=this,r=parseInt(n,10),u;return r<0?n=0:r>i.$slides.length-1&&(n=i.$slides.length-1),r=n,this.page!==n&&(clearTimeout(this.timer),this.page=r,this.$slides.find("div.slideItem").removeClass("off").addClass("on"),this.$pagination.find("a[data-page="+this.page+"]").addClass("on").siblings().removeClass("on"),this.$bookmarks.length>0&&this.indicateBookmark(this.$bookmarks),this.options.slideMenu&&(u=this.$menu.children("a").removeClass("on"),this.page>0&&u.eq(this.page-1).addClass("on")),this.$list.animate({left:0-this.$container.width()*this.page},t?0:600,function(){i.$slides.find("div.slideItem").not(i.$slides.eq(i.page).find("div.slideItem").get(0)).removeClass("on").addClass("off"),i.options.playButtons?i.playButton.hasClass("play")||i.advance():i.options.autoplay&&i.advance()})),i},i.prototype.autoStart=function(){this.options.autostart&&(aston.windowLoaded?this.start():n(window).load(n.proxy(this,"start")))},i.prototype.reInit=function(){this.autoStart()}}.apply(aston,[jQuery,"carousel"]);
/*!
 * jQuery UI 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 * 
 *
 * MODIFIED: Ben Barnett @ R/GA 2011
 * - Check if existing UI is loaded pre-init
 */
if(typeof $.ui!="object"){(function(n,t){function i(t){return!n(t).parents().andSelf().filter(function(){return n.curCSS(this,"visibility")==="hidden"||n.expr.filters.hidden(this)}).length}n.ui=n.ui||{},n.ui.version||(n.extend(n.ui,{version:"1.8.11",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),n.fn.extend({_focus:n.fn.focus,focus:function(t,i){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){n(r).focus(),i&&i.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=n.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(n.curCSS(this,"position",1))&&/(auto|scroll)/.test(n.curCSS(this,"overflow",1)+n.curCSS(this,"overflow-y",1)+n.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(n.curCSS(this,"overflow",1)+n.curCSS(this,"overflow-y",1)+n.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!t.length?n(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length){i=n(this[0]);for(var r;i.length&&i[0]!==document;){if(r=i.css("position"),(r==="absolute"||r==="relative"||r==="fixed")&&(r=parseInt(i.css("zIndex"),10),!isNaN(r)&&r!==0))return r;i=i.parent()}}return 0},disableSelection:function(){return this.bind((n.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(n){n.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),n.each(["Width","Height"],function(i,r){function e(t,i,r,u){return n.each(o,function(){i-=parseFloat(n.curCSS(t,"padding"+this,!0))||0,r&&(i-=parseFloat(n.curCSS(t,"border"+this+"Width",!0))||0),u&&(i-=parseFloat(n.curCSS(t,"margin"+this,!0))||0)}),i}var o=r==="Width"?["Left","Right"]:["Top","Bottom"],u=r.toLowerCase(),f={innerWidth:n.fn.innerWidth,innerHeight:n.fn.innerHeight,outerWidth:n.fn.outerWidth,outerHeight:n.fn.outerHeight};n.fn["inner"+r]=function(i){return i===t?f["inner"+r].call(this):this.each(function(){n(this).css(u,e(this,i)+"px")})},n.fn["outer"+r]=function(t,i){return typeof t!="number"?f["outer"+r].call(this,t):this.each(function(){n(this).css(u,e(this,t,!0,i)+"px")})}}),n.extend(n.expr[":"],{data:function(t,i,r){return!!n.data(t,r[3])},focusable:function(t){var r=t.nodeName.toLowerCase(),u=n.attr(t,"tabindex");return"area"===r?(r=t.parentNode,u=r.name,!t.href||!u||r.nodeName.toLowerCase()!=="map")?!1:(t=n("img[usemap=#"+u+"]")[0],!!t&&i(t)):(/input|select|textarea|button|object/.test(r)?!t.disabled:"a"==r?t.href||!isNaN(u):!isNaN(u))&&i(t)},tabbable:function(t){var i=n.attr(t,"tabindex");return(isNaN(i)||i>=0)&&n(t).is(":focusable")}}),n(function(){var i=document.body,t=i.appendChild(t=document.createElement("div"));n.extend(t.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),n.support.minHeight=t.offsetHeight===100,n.support.selectstart="onselectstart"in t,i.removeChild(t).style.display="none"}),n.extend(n.ui,{plugin:{add:function(t,i,r){t=n.ui[t].prototype;for(var u in r)t.plugins[u]=t.plugins[u]||[],t.plugins[u].push([i,r[u]])},call:function(n,t,i){if((t=n.plugins[t])&&n.element[0].parentNode)for(var r=0;r<t.length;r++)n.options[t[r][0]]&&t[r][1].apply(n.element,i)}},contains:function(n,t){return document.compareDocumentPosition?n.compareDocumentPosition(t)&16:n!==t&&n.contains(t)},hasScroll:function(t,i){if(n(t).css("overflow")==="hidden")return!1;i=i&&i==="left"?"scrollLeft":"scrollTop";var r=!1;return t[i]>0?!0:(t[i]=1,r=t[i]>0,t[i]=0,r)},isOverAxis:function(n,t,i){return n>t&&n<t+i},isOver:function(t,i,r,u,f,e){return n.ui.isOverAxis(t,r,f)&&n.ui.isOverAxis(i,u,e)}}))})(jQuery);
/*!
	 * jQuery UI Widget 1.8.11
	 *
	 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
	 * Dual licensed under the MIT or GPL Version 2 licenses.
	 * http://jquery.org/license
	 *
	 * http://docs.jquery.com/UI/Widget
	 */
(function(n,t){var r,i;n.cleanData?(r=n.cleanData,n.cleanData=function(t){for(var u=0,i;(i=t[u])!=null;u++)n(i).triggerHandler("remove");r(t)}):(i=n.fn.remove,n.fn.remove=function(t,r){return this.each(function(){return r||(!t||n.filter(t,[this]).length)&&n("*",this).add([this]).each(function(){n(this).triggerHandler("remove")}),i.call(n(this),t,r)})}),n.widget=function(t,i,r){var u=t.split(".")[0],f;t=t.split(".")[1],f=u+"-"+t,r||(r=i,i=n.Widget),n.expr[":"][f]=function(i){return!!n.data(i,t)},n[u]=n[u]||{},n[u][t]=function(n,t){arguments.length&&this._createWidget(n,t)},i=new i,i.options=n.extend(!0,{},i.options),n[u][t].prototype=n.extend(!0,i,{namespace:u,widgetName:t,widgetEventPrefix:n[u][t].prototype.widgetEventPrefix||t,widgetBaseClass:f},r),n.widget.bridge(t,n[u][t])},n.widget.bridge=function(i,r){n.fn[i]=function(u){var o=typeof u=="string",e=Array.prototype.slice.call(arguments,1),f=this;return(u=!o&&e.length?n.extend.apply(null,[!0,u].concat(e)):u,o&&u.charAt(0)==="_")?f:(o?this.each(function(){var r=n.data(this,i),o=r&&n.isFunction(r[u])?r[u].apply(r,e):r;if(o!==r&&o!==t)return f=o,!1}):this.each(function(){var t=n.data(this,i);t?t.option(u||{})._init():n.data(this,i,new r(u,this))}),f)}},n.Widget=function(n,t){arguments.length&&this._createWidget(n,t)},n.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,i){n.data(i,this.widgetName,this),this.element=n(i),this.options=n.extend(!0,{},this.options,this._getCreateOptions(),t);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return n.metadata&&n.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(i,r){var u=i;if(arguments.length===0)return n.extend({},this.options);if(typeof i=="string"){if(r===t)return this.options[i];u={},u[i]=r}return this._setOptions(u),this},_setOptions:function(t){var i=this;return n.each(t,function(n,t){i._setOption(n,t)}),this},_setOption:function(n,t){return this.options[n]=t,n==="disabled"&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,i,r){var f=this.options[t],u;if(i=n.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),r=r||{},i.originalEvent)for(t=n.event.props.length;t;)u=n.event.props[--t],i[u]=i.originalEvent[u];return this.element.trigger(i,r),!(n.isFunction(f)&&f.call(this.element[0],i,r)===!1||i.isDefaultPrevented())}}})(jQuery);
/*!
	 * jQuery UI Mouse 1.8.11
	 *
	 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
	 * Dual licensed under the MIT or GPL Version 2 licenses.
	 * http://jquery.org/license
	 *
	 * http://docs.jquery.com/UI/Mouse
	 *
	 * Depends:
	 *	jquery.ui.widget.js
	 */
(function(n){n.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(n){return t._mouseDown(n)}).bind("click."+this.widgetName,function(i){if(!0===n.data(i.target,t.widgetName+".preventClickEvent"))return n.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(t){if(t.originalEvent=t.originalEvent||{},!t.originalEvent.mouseHandled){this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,u=t.which==1,r=typeof this.options.cancel=="string"?n(t.target).parents().add(t.target).filter(this.options.cancel).length:!1;return!u||r||!this._mouseCapture(t)?!0:(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted))?(t.preventDefault(),!0):(!0===n.data(t.target,this.widgetName+".preventClickEvent")&&n.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(n){return i._mouseMove(n)},this._mouseUpDelegate=function(n){return i._mouseUp(n)},n(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),t.originalEvent.mouseHandled=!0)}},_mouseMove:function(t){return n.browser.msie&&!(document.documentMode>=9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&((this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1)?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return n(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target==this._mouseDownEvent.target&&n.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(n){return Math.max(Math.abs(this._mouseDownEvent.pageX-n.pageX),Math.abs(this._mouseDownEvent.pageY-n.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery),function(n){n.widget("ui.draggable",n.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper!="original"||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(this.element.data("draggable"))return this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||n(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),!this.handle)?!1:!0},_mouseStart:function(t){var i=this.options;return(this.helper=this._createHelper(t),this._cacheHelperProportions(),n.ui.ddmanager&&(n.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},n.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",t)===!1)?(this._clear(),!1):(this._cacheHelperProportions(),n.ui.ddmanager&&!i.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,t),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(t,!0),!0)},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){if(i=this._uiHash(),this._trigger("drag",t,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&this.options.axis=="y"||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&this.options.axis=="x"||(this.helper[0].style.top=this.position.top+"px"),n.ui.ddmanager&&n.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=!1,r;return(n.ui.ddmanager&&!this.options.dropBehaviour&&(i=n.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1),(!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")?!1:(this.options.revert=="invalid"&&!i||this.options.revert=="valid"&&i||this.options.revert===!0||n.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?(r=this,n(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()})):this._trigger("stop",t)!==!1&&this._clear(),!1)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var i=!this.options.handle||!n(this.options.handle,this.element).length?!0:!1;return n(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(i=!0)}),i},_createHelper:function(t){var i=this.options;return t=n.isFunction(i.helper)?n(i.helper.apply(this.element[0],[t])):i.helper=="clone"?this.element.clone():this.element,t.parents("body").length||t.appendTo(i.appendTo=="parent"?this.element[0].parentNode:i.appendTo),t[0]!=this.element[0]&&!/(fixed|absolute)/.test(t.css("position"))&&t.css("position","absolute"),t},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),n.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&n.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&n.browser.msie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var n=this.element.position();return{top:n.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:n.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options,i,r;t.containment=="parent"&&(t.containment=this.helper[0].parentNode),(t.containment=="document"||t.containment=="window")&&(this.containment=[(t.containment=="document"?0:n(window).scrollLeft())-this.offset.relative.left-this.offset.parent.left,(t.containment=="document"?0:n(window).scrollTop())-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:n(window).scrollLeft())+n(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:n(window).scrollTop())+(n(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array?t.containment.constructor==Array&&(this.containment=t.containment):(i=n(t.containment)[0],i&&(t=n(t.containment).offset(),r=n(i).css("overflow")!="hidden",this.containment=[t.left+(parseInt(n(i).css("borderLeftWidth"),10)||0)+(parseInt(n(i).css("paddingLeft"),10)||0),t.top+(parseInt(n(i).css("borderTopWidth"),10)||0)+(parseInt(n(i).css("paddingTop"),10)||0),t.left+(r?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(n(i).css("borderLeftWidth"),10)||0)-(parseInt(n(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,t.top+(r?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(n(i).css("borderTopWidth"),10)||0)-(parseInt(n(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom]))},_convertPositionTo:function(t,i){i||(i=this.position),t=t=="absolute"?1:-1;var r=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&n.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,u=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*t+this.offset.parent.top*t-(n.browser.safari&&n.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():u?0:r.scrollTop())*t),left:i.left+this.offset.relative.left*t+this.offset.parent.left*t-(n.browser.safari&&n.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():u?0:r.scrollLeft())*t)}},_generatePosition:function(t){var u=this.options,f=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&n.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(f[0].tagName),i=t.pageX,r=t.pageY;return this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(i=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(i=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),u.grid&&(r=this.originalPageY+Math.round((r-this.originalPageY)/u.grid[1])*u.grid[1],r=this.containment?r-this.offset.click.top<this.containment[1]||r-this.offset.click.top>this.containment[3]?r-this.offset.click.top<this.containment[1]?r+u.grid[1]:r-u.grid[1]:r:r,i=this.originalPageX+Math.round((i-this.originalPageX)/u.grid[0])*u.grid[0],i=this.containment?i-this.offset.click.left<this.containment[0]||i-this.offset.click.left>this.containment[2]?i-this.offset.click.left<this.containment[0]?i+u.grid[0]:i-u.grid[0]:i:i)),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(n.browser.safari&&n.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:f.scrollTop()),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(n.browser.safari&&n.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:f.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,r){return r=r||this._uiHash(),n.ui.plugin.call(this,t,[i,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),n.Widget.prototype._trigger.call(this,t,i,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),n.extend(n.ui.draggable,{version:"1.8.11"}),n.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var r=n(this).data("draggable"),f=r.options,u=n.extend({},i,{item:r.element});r.sortables=[],n(f.connectToSortable).each(function(){var i=n.data(this,"sortable");i&&!i.options.disabled&&(r.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,u))})},stop:function(t,i){var r=n(this).data("draggable"),u=n.extend({},i,{item:r.element});n.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,u))})},drag:function(t,i){var r=n(this).data("draggable"),u=this;n.each(r.sortables,function(){this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=n(u).clone().appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),n.ui.plugin.add("draggable","cursor",{start:function(){var t=n("body"),i=n(this).data("draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=n(this).data("draggable").options;t._cursor&&n("body").css("cursor",t._cursor)}}),n.ui.plugin.add("draggable","iframeFix",{start:function(){var t=n(this).data("draggable").options;n(t.iframeFix===!0?"iframe":t.iframeFix).each(function(){n('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(n(this).offset()).appendTo("body")})},stop:function(){n("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)})}}),n.ui.plugin.add("draggable","opacity",{start:function(t,i){t=n(i.helper),i=n(this).data("draggable").options,t.css("opacity")&&(i._opacity=t.css("opacity")),t.css("opacity",i.opacity)},stop:function(t,i){t=n(this).data("draggable").options,t._opacity&&n(i.helper).css("opacity",t._opacity)}}),n.ui.plugin.add("draggable","scroll",{start:function(){var t=n(this).data("draggable");t.scrollParent[0]!=document&&t.scrollParent[0].tagName!="HTML"&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var r=n(this).data("draggable"),i=r.options,u=!1;r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"?(i.axis&&i.axis=="x"||(r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=u=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=u=r.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&i.axis=="y"||(r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=u=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=u=r.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&i.axis=="x"||(t.pageY-n(document).scrollTop()<i.scrollSensitivity?u=n(document).scrollTop(n(document).scrollTop()-i.scrollSpeed):n(window).height()-(t.pageY-n(document).scrollTop())<i.scrollSensitivity&&(u=n(document).scrollTop(n(document).scrollTop()+i.scrollSpeed))),i.axis&&i.axis=="y"||(t.pageX-n(document).scrollLeft()<i.scrollSensitivity?u=n(document).scrollLeft(n(document).scrollLeft()-i.scrollSpeed):n(window).width()-(t.pageX-n(document).scrollLeft())<i.scrollSensitivity&&(u=n(document).scrollLeft(n(document).scrollLeft()+i.scrollSpeed)))),u!==!1&&n.ui.ddmanager&&!i.dropBehaviour&&n.ui.ddmanager.prepareOffsets(r,t)}}),n.ui.plugin.add("draggable","snap",{start:function(){var t=n(this).data("draggable"),i=t.options;t.snapElements=[],n(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=n(this),r=i.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:r.top,left:r.left})})},drag:function(t,i){for(var k,r=n(this).data("draggable"),d=r.options,u=d.snapTolerance,c=i.offset.left,b=c+r.helperProportions.width,l=i.offset.top,p=l+r.helperProportions.height,f=r.snapElements.length-1;f>=0;f--){var e=r.snapElements[f].left,s=e+r.snapElements[f].width,o=r.snapElements[f].top,h=o+r.snapElements[f].height;if(e-u<c&&c<s+u&&o-u<l&&l<h+u||e-u<c&&c<s+u&&o-u<p&&p<h+u||e-u<b&&b<s+u&&o-u<l&&l<h+u||e-u<b&&b<s+u&&o-u<p&&p<h+u){if(d.snapMode!="inner"){var w=Math.abs(o-p)<=u,a=Math.abs(h-l)<=u,y=Math.abs(e-b)<=u,v=Math.abs(s-c)<=u;w&&(i.position.top=r._convertPositionTo("relative",{top:o-r.helperProportions.height,left:0}).top-r.margins.top),a&&(i.position.top=r._convertPositionTo("relative",{top:h,left:0}).top-r.margins.top),y&&(i.position.left=r._convertPositionTo("relative",{top:0,left:e-r.helperProportions.width}).left-r.margins.left),v&&(i.position.left=r._convertPositionTo("relative",{top:0,left:s}).left-r.margins.left)}k=w||a||y||v,d.snapMode!="outer"&&(w=Math.abs(o-l)<=u,a=Math.abs(h-p)<=u,y=Math.abs(e-c)<=u,v=Math.abs(s-b)<=u,w&&(i.position.top=r._convertPositionTo("relative",{top:o,left:0}).top-r.margins.top),a&&(i.position.top=r._convertPositionTo("relative",{top:h-r.helperProportions.height,left:0}).top-r.margins.top),y&&(i.position.left=r._convertPositionTo("relative",{top:0,left:e}).left-r.margins.left),v&&(i.position.left=r._convertPositionTo("relative",{top:0,left:s-r.helperProportions.width}).left-r.margins.left)),!r.snapElements[f].snapping&&(w||a||y||v||k)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,n.extend(r._uiHash(),{snapItem:r.snapElements[f].item})),r.snapElements[f].snapping=w||a||y||v||k}else r.snapElements[f].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,n.extend(r._uiHash(),{snapItem:r.snapElements[f].item})),r.snapElements[f].snapping=!1}}}),n.ui.plugin.add("draggable","stack",{start:function(){var t=n(this).data("draggable").options,i;t=n.makeArray(n(t.stack)).sort(function(t,i){return(parseInt(n(t).css("zIndex"),10)||0)-(parseInt(n(i).css("zIndex"),10)||0)}),t.length&&(i=parseInt(t[0].style.zIndex)||0,n(t).each(function(n){this.style.zIndex=i+n}),this[0].style.zIndex=i+t.length)}}),n.ui.plugin.add("draggable","zIndex",{start:function(t,i){t=n(i.helper),i=n(this).data("draggable").options,t.css("zIndex")&&(i._zIndex=t.css("zIndex")),t.css("zIndex",i.zIndex)},stop:function(t,i){t=n(this).data("draggable").options,t._zIndex&&n(i.helper).css("zIndex",t._zIndex)}})}(jQuery)}(function(n,t){function e(){r.bind("am.faq.question.click",function(t,i){i.parents("div.questions").find("li").removeClass("on"),i.parents("li").addClass("on"),n("div.answer").stop().hide(),n("div.answers, div.answer"+i.attr("href")).slideDown()})}function f(){n("div.questions a").click(function(){r.trigger("am.faq.question.click",[n(this)])})}var u=this,i={__id:t},r=u.w,o;u.register(i),i.variable=!0,o=!1,i.init=function(){n("div.questions").length&&n("div.answers").length&&(e(),f())}}).apply(aston,[jQuery,"faq"]),$f.addPlugin("amControls",function(){function t(n){return n.offset().left}function i(n,t){return Math.min(100,100*n/t)}function f(n){function l(t){f=!0,t.preventDefault(),aston.w.bind("mousemove.videoplayer.progressbar",$.throttle(200,a)).bind("mouseup.videoplayer.progressbar",h),n.handle.addClass("dragging"),n.startDrag(r)}function a(i){f&&(n.handle.ondragstart=function(){return!1},e(i.pageX-t(n.container)),u(),n.midDrag(r))}function h(i){aston.w.unbind("mousemove.videoplayer.progressbar mouseup.videoplayer.progressbar"),e(i.pageX-t(n.container)),u(),n.handle.removeClass("dragging"),n.endDrag(r),f=!1}function e(t){r=Math.max(0,Math.min(o,i(t-c/2,n.container.width())))}function u(){n.handle.css("left",r+"%"),n.tail.css("width",r+"%")}function s(n){r=n,u()}n=$.extend({startDrag:$.noop,endDrag:$.noop,midDrag:$.noop},n);var c=n.handle.width(),r,f=!1,o=0;return n.handle.mousedown(l).click($.noop),n.container.click(function(i){if(n.startDrag(),i.target==n.handle[0])return!1;e(i.pageX-t(n.container)),u(),n.endDrag(r)}),{update:s,isDragging:function(){return f},setBuffer:function(n){o=n},getPercent:function(){return r}}}var n=aston.lang.en.videoplayer,u="video-gallery",r=new aston.Template('<div class="video-controls" id="controlbar"><a href="#" class="play">'+n.playAnchorText+'<span class="icon"></span></a><div class="video-info"><div class="status"><div class="bar"></div><div class="loaded"></div><div class="playHead"></div></div></div><div class="links"><a class="twitter" href="#" title="'+n.twitterTitleText+'" target="_blank">'+n.twitterAnchorText+'<span class="icon"></span></a><a class="facebook" href="#" title="'+n.facebookTitleText+'" target="_blank">'+n.facebookAnchorText+'<span class="icon"></span></a><a class="link" href="#">'+n.linkAnchorText+'</a><a class="embed" href="#">'+n.embedAnchorText+'</a><a class="fullscreen" href="#" title="Play video fullscreen">'+n.fullscreenOffAnchorText+'<span class="icon"></span></a><a class="gallery" href="/'+u+'" title="Aston Martin Video Gallery">'+n.galleryAnchorText+"</a></div></div>");return function(n,t){function v(n){u.isLoaded()&&u.seek(n*l/100)}function a(n){c.update(i(n,l))}function p(n){setTimeout(function(){y&&n||e.stop().animate({height:0})},n||1)}function k(){s.removeClass("playing"),a(0)}function nt(n){setTimeout(function(){a(0),n&&(u.pause(),u.play())},1)}function g(n){var t=!0;u.isPlaying()&&s.addClass("playing"),l=n.duration||0,clearInterval(h),h=setInterval(function(){var r=u.getStatus(),n;if(r.time===undefined){clearInterval(h);return}t&&(n=i(r.bufferEnd,l),tt.css("width",n+"%"),c.setBuffer(n),n==100&&(t=!1)),u.isPaused()||c.isDragging()||a(r.time)},100)}var u=this,o,h,y=!1,l,c;if(o=typeof n=="string"?$("#"+n):n,o){o.append(r.apply(t));var e=$(".video-controls",o),s=$(".play",e),tt=$(".bar",e),d=$(".loaded",o),w=$(".status",o),b=$(".playHead",o);e.data("height",e.height()),p(1e3),o.mouseover(function(){y=!0,e.stop().animate({height:e.data("height")})}).mouseout(function(){y=!1,p(250)}),c=f({handle:b,container:w,tail:d,endDrag:v,midDrag:v}),e.delegate(".play","click",function(){return typeof u.isPlaying=="boolean"?u.isPlaying()?u.pause():u.isPaused()?u.resume():u.play():$(this).hasClass("playing")?u.pause():u.play(),!1}).delegate(".link","click",function(n){return aston.w.trigger("am.videoplayer.showlink",[$(n.target)]),!1}).delegate(".embed","click",function(n){return aston.w.trigger("am.videoplayer.showembed",[$(n.target)]),!1}).delegate(".twitter","click",function(n){return aston.w.trigger("am.videoplayer.shareTwitter",[$(n.target)]),!1}).delegate(".facebook","click",function(n){return aston.w.trigger("am.videoplayer.shareFacebook",[$(n.target)]),!1}).delegate(".fullscreen","click",function(){return aston.w.trigger("am.videoplayer.fullscreen"),!1});u.onStart(g);u.onPause(function(){s.removeClass("playing")});u.onResume(function(){s.addClass("playing")});u.onFinish(function(){s.removeClass("playing"),clearInterval(h),aston.w.trigger("am.videoplayer.finished")});u.onStop(function(){s.removeClass("playing"),clearInterval(h)});return u.onBeforeClose=function(){},u.amControlsMethods={moveToTime:function(n,t){setTimeout(function(){a(n),v(c.getPercent()),t&&(u.pause(),u.play())},1)},hideControls:p,restart:k,refresh:nt},u}}}()),function(n,t){function s(){var t;for(t in o)i.setupOverlay(o[t]);aston.plugins.overlays.setupOverlay({handler:function(){aston.w.bind("am.soul.video.play",function(t,i){var f,u=i.parents("div.soulItem").find("div.videoContent"),r;aston.overlay({name:"soul-video",target:n("div#pages .page"),openAnimation:{top:-1},duration:600,onInit:function(){var i=this,f=!1,t=u.children(".video");aston.ie==7?r=n('<div class="videoContent"><div class="video"><p>Loading...</p></div></div>').children(".video").data({title:t.data("title"),player:t.data("player"),video:t.data("video")}).attr("id","soulVideo").end().append(u.children(".simpleCarousel").clone()):(r=u.clone(),r.children(".video").attr("id","soulVideo")),r.css({top:-this.height()}).appendTo(i)},onOpen:function(){var i=n(this),u=!1,t;aston.plugins.videoplayer.buildVideo({containerId:"soulVideo",autoPlay:!0}),t=n('<a id="closeButton">'+aston.lang.en.videoplayer.closeAnchorText+"</a>"),r.append(t),aston.plugins.carousel.init(r),aston.plugins.carousel.refresh(r.find("div.simpleCarousel")),t.click(function(){return u||(u=!0,r.animate({top:-i.height()},300,function(){aston.ie?aston.overlay({name:"soul-video"}):i.animate({opacity:0},300,function(){aston.overlay({name:"soul-video"})}),u=!1})),!1}),i.mouseover(function(){t.stop().animate({"margin-top":0})}).mouseout(function(){t.stop().animate({"margin-top":-60})}),i.find("div.videoContent").animate({top:0},600,function(){})},onClose:function(){var t=this,n=t.find("div.videoContent");aston.plugins.carousel.destroy(n),aston.plugins.videoplayer.unload(),n.animate({top:-n.height()},300,function(){aston.ie||t.animate({opacity:0},300),i.parents("div.soulItem").append(f)})},removeFunction:function(){aston.ie?(this.css("display","none").find(".video").siblings().remove().end().find(":not(object)").andSelf().attr("id",""),this.find("object").css({height:0,width:0})):n(document).has(this).length&&this.remove()}})})}})}var u=this,i={__id:t},e=u.w;u.register(i);var r={},h={},f,c=n("body").hasClass("timeline"),o={cars:{trigger:function(){n("#carsMenu").live("click",function(){return aston.w.trigger("am.nav.cars.click",[n(this),"car"]),!1})},handler:function(){aston.w.bind("am.nav.cars.click",function(t,i,r){var u,o,e,l,f,s,c,h=!1;aston.overlay({name:"cars",openAnimation:{top:0},duration:600,onInit:function(){var t=this;u=n("#"+r+"-menu").clone().appendTo(this).show().css({top:-this.height()}),o=n(".tab",u),e=n(".tab-wrapper-inner",u),c=n(".tab-link",u),l=c.filter(".on").parent().prevAll().length,f=o.eq(l).prependTo(e),s=c.filter(".on").data("tabname"),u.removeClass("current").addClass(s),$current=u.find(".current"),u.find("img.lazyvehicle").lazyload({skip_invisible:!1,container:u}),t.find("a.btn-close").click(function(){return n("#carsMenu").click(),!1}),o.find("a.filter").click(function(t){var u,f;if(t.preventDefault(),!n(this).hasClass("on")){var r=n(this).parents(".tab"),e=n(this).data("category"),i=r.find(".range").find("li"),o=r.find("a.filter");e=="all"?i.animate({opacity:1},600):(u=i.filter(function(){var t=n(this),i=t.data("category").split(/\s+/);if(n.inArray(e,i)>-1)return t}),i.stop().animate({opacity:.3},300,function(){u.stop().animate({opacity:1},150)})),o.removeClass("on"),n(this).addClass("on"),f=n(this).position().left+n(this).width()/2+30-3,r.find(".range").addClass("filter-image-on").css("background-position",f+"px 0")}})},onOpen:function(){n(this).find("#"+r+"-menu").animate({top:0},600),i.addClass("open"),u.delegate(".tab-link","click",function(){if(h||this.className.indexOf("on")>-1)return!1;h=!0;var l=n(this),i=l.data("tabname"),t=o.filter("."+i),r=f.outerWidth(),c=f.add(t).css("display","block");return l.addClass("on").parent().siblings().children("a").removeClass("on"),n("h1",u).html(l.html()),u.removeClass(s).addClass(i),c.css("width",r),e.width(r*2),i=="current"?(t.insertAfter(f),e.animate({"margin-left":-r},500,function(){e.css({"margin-left":"",width:""}),f.insertAfter(t),c.css("width",""),o.not(t).css("display","none"),f=t,s=i,h=!1})):(e.css({"margin-left":-r}),t.insertBefore(f),e.animate({"margin-left":0},500,function(){e.css({"margin-left":"",width:""}),c.css("width",""),o.not(t).css("display","none"),f=t,s=i,h=!1})),!1})},onClose:function(){var t=this,n=t.find("#"+r+"-menu");n.animate({top:-n.height()},300,function(){aston.ie||t.animate({opacity:0},300),i.removeClass("open")})}})})}},racing:{trigger:function(){n("#racingSeriesMenu").live("click",function(){return aston.w.trigger("am.nav.racing.click",[n(this),"racing"]),!1})},handler:function(){aston.w.bind("am.nav.racing.click",function(t,i,r){aston.overlay({name:"racing",openAnimation:{top:0},duration:600,onInit:function(){var i=this,t=n("#"+r+"-menu").clone().appendTo(this).show();t.find("img.lazyracing").lazyload({skip_invisible:!1,container:t}),t.css({top:-this.height()}),i.find("a.btn-close").click(function(){return n("#racingSeriesMenu").click(),!1})},onOpen:function(){n(this).find("#"+r+"-menu").animate({top:0},600),i.addClass("open")},onClose:function(){var t=this,n=t.find("#"+r+"-menu");n.animate({top:-n.height()},300,function(){aston.ie||t.animate({opacity:0},300),i.removeClass("open")})}})})}},add:{trigger:function(){n("#add").click(function(){var t=aston.timeline.isAuthenticated();return t.done(function(t){t.d?aston.w.trigger("am.nav.add.click",[n(this),"add"]):n("#AccountHyperLink").click()}),!1})},handler:function(){aston.w.bind("am.nav.add.click",function(t,i,r){aston.overlay({name:"add",openAnimation:{top:0},duration:600,onInit:function(){var i=this,t=n("#"+r+"-menu").appendTo(this).show();t.css({top:-this.height()})},onOpen:function(){var t=n(".header-wrap").outerHeight();n(this).find("#"+r+"-menu").animate({top:t},600,function(){var t=n(this);i.addClass("open"),aston.timeline.initialiseVehicleForm(t)});n(this).find("#btnCancel").on("click",function(){return n("#add").click(),!1});n(this).find("a.btn-close").on("click",function(){return n("#add").click(),!1})},onClose:function(){var t=this,n=t.find("#"+r+"-menu");n.animate({top:-n.height()},300,function(){aston.ie||t.animate({opacity:0},300),i.removeClass("open")}),n.find("#btnCancel").unbind("click"),n.find("#btnAddOk").unbind("click"),n.find("a.btn-close").unbind("click"),aston.timeline.resetForms(n)},removeFunction:function(){var r=this,u=n("#timeline"),t;r.animate({top:-u.outerHeight()},300,function(){aston.ie||r.animate({opacity:0},300),i.removeClass("open")}),t=n(".overlay.add.transparent"),n.each(t,function(t,i){var r=n(i);r.children().length==0&&r.remove()})}})})}},filter:{trigger:function(){n("#filter").click(function(){return aston.w.trigger("am.nav.filter.click",[n(this),"filter"]),!1})},handler:function(){aston.w.bind("am.nav.filter.click",function(t,i,r){aston.overlay({name:"filter",openAnimation:{top:0},duration:600,onInit:function(){var i=this,t=n("#"+r+"-menu").clone().appendTo(this).show();t.css({top:-this.height()}),i.find("a.btn-close").click(function(){return n("#filter").click(),!1}),aston.timeline.showCurrentFilters()},onOpen:function(){var t=n(".header-wrap").outerHeight();n(this).find("#"+r+"-menu").animate({top:t},600,function(){i.addClass("open")}),n(this).find("#btnFilterSubmit").live("click",function(t){t.preventDefault(),n(this).attr("value","Filtering..."),aston.timeline.updateFilters(!0);var i=aston.timeline.performFilter(!0);i.done(function(){return n("#filter").click(),!1})}),n(this).find("#btnFilterClear").live("click",function(t){t.preventDefault(),n(this).attr("value","Clearing..."),aston.timeline.empty();var i=aston.timeline.performFilter(!1);i.done(function(){return n("#filter").click(),!1})})},onClose:function(){var t=this,n=t.find("#"+r+"-menu");n.animate({top:-n.height()},300,function(){aston.ie||t.animate({opacity:0},300),i.removeClass("open")})}})})}},news:{trigger:function(){n("#newsMenu").click(function(){return aston.w.trigger("am.nav.news.click",[n(this),"news"]),!1})},handler:function(){aston.w.bind("am.nav.news.click",function(t,i,r){aston.overlay({name:"news",openAnimation:{bottom:0},duration:600,onInit:function(){var i=this,t=n("#"+r+"-menu").clone().appendTo(this).show();t.find("img.lazynews").lazyload({skip_invisible:!0,container:t}),t.css({bottom:-this.height()}),i.find("a.btn-close").click(function(){return n("#newsMenu").click(),!1})},onOpen:function(){n(this).find("#"+r+"-menu").animate({bottom:0},600),i.addClass("open")},onClose:function(){var t=this,n=t.find("#"+r+"-menu");n.animate({bottom:-n.height()},300,function(){aston.ie||t.animate({opacity:0},300),i.removeClass("open")})}})})}},more:{trigger:function(){n("header nav a.explore").click(function(){return aston.w.trigger("am.nav.more.click",[n(this)]),!1})},handler:function(){aston.w.bind("am.nav.more.click",function(){aston.overlay({name:"more",openAnimation:{top:0},duration:600,onInit:function(){var i=this,t=n("div#more-menu").clone().appendTo(this).show();t.find("img.lazymenu").lazyload({skip_invisible:!1,container:t}),t.css({top:-this.height()}),i.find("a.btn-close").click(function(){return t.animate({top:-t.height()},300,function(){aston.ie?aston.overlay({name:"more"}):i.animate({opacity:0},300,function(){aston.overlay({name:"more"})})}),!1})},onOpen:function(){n(this).find("#more-menu").animate({top:0},600)},onClose:function(){var t=this,n=t.find("#more-menu");n.animate({top:-n.height()},300,function(){aston.ie||t.animate({opacity:0},300)})}})})}},search:{trigger:function(){n("header nav a.search").click(function(){return aston.w.trigger("am.nav.search.click",[n(this)]),!1})},handler:function(){var t=n("body").hasClass("timeline");aston.w.bind("am.nav.search.click",function(){aston.overlay({name:"search",openAnimation:{top:0},duration:400,onInit:function(){var i=this,t=n("#search").appendTo(this).show();t.css({top:-this.height()}),i.find("a.btn-close").click(function(){return n("a.search").click(),!1})},onOpen:function(){if(t){var f=n("#main").offset().left,e=n("#main").outerWidth(),u=n("#search").outerWidth(),i=f+e-u,r=n(".header-wrap").outerHeight();n(this).find("#search").css({position:"fixed",left:i}).animate({top:r},400).find("input:text").get(0).focus()}else n(this).find("#search").animate({top:0},400).find("input:text").get(0).focus()},onClose:function(){var r=this,i=r.find("#search");i.animate({top:-r.height()},300,function(){aston.ie||r.animate({opacity:0},300)}),t?i.appendTo(n("body")).hide():i.appendTo(n("footer")).hide(),n("#searchTextBox").val("")}})})}},region:{trigger:function(){n("header nav a.region").click(function(){return aston.w.trigger("am.nav.region.click",[n(this)]),!1})},handler:function(){aston.w.bind("am.nav.region.click",function(t,i){var r=n("body").hasClass("timeline");aston.overlay({name:"region",openAnimation:{top:0},duration:600,onInit:function(){var i=this,t=n("#region-menu").clone().appendTo(this).show();t.css({top:-this.height()})},onOpen:function(){var t=n(this);if(r){var o=n("#main").offset().left,s=n("#main").outerWidth(),e=n("#region-menu").outerWidth(),u=o+s-e,f=n(".header-wrap").outerHeight();$content=t.find("#region-menu").css({position:"fixed",left:u}).animate({top:f},400)}else $content=t.find("#region-menu").animate({top:0},400);i.addClass("on"),t.find("a.btn-close").click(function(){return $content.animate({top:-t.height()},300,function(){aston.ie?aston.overlay({name:"region"}):t.animate({opacity:0},300,function(){aston.overlay({name:"region"})})}),!1})},onClose:function(){var n=this,t=n.find("#region-menu");t.animate({top:-n.height()},300,function(){aston.ie||n.animate({opacity:0},300),i.removeClass("on")})}})})}},variation:{trigger:function(){n("div.variation a.openMore").live("click",function(){return aston.w.trigger("am.nav.variation.click",[n(this)]),!1})},handler:function(){aston.w.bind("am.nav.variation.click",function(t,i){var r=i.attr("href").replace("#","");aston.overlay({name:r,target:n("div#pages .page"),openAnimation:{top:0},duration:600,onInit:function(){var i=this,t=n("#"+r).clone().appendTo(this).show();t.css({top:-this.height()}),t.find("div.variation li a").each(function(t,i){n(i).text()==""&&n(i).parent().hide()}),i.find("a.back").click(function(){return t.animate({top:-i.height()},300,function(){aston.ie?aston.overlay({name:r}):i.animate({opacity:0},300,function(){aston.overlay({name:r})})}),!1})},onOpen:function(){n(this).find("#"+r).animate({top:0},600)},onClose:function(){var i=this,t=n("#"+r);t.animate({top:-t.height()},300,function(){aston.ie||i.animate({opacity:0},300)})}})})}}};i.init=function(){if(!aston.isLoggedIn&&s(),n("#themeholder").hasClass("specs")){var t=n("#themeholder").find("div.variation ul").eq(0);t.find("li").length<=1&&t.hide()}},i.overlayExists=function(n){return!!r[n]},i.setupOverlay=function(t){aston.isLoggedIn||(this.addHandler(t.handler||n.noop),this.addTrigger(t.trigger||n.noop))},i.addHandler=function(n){n()},i.addTrigger=function(n){n()},u.overlaysCache=h,u.overlay=function(t){function c(){var t=u.data("settings");t.onClose.call(u),u.animate(t.closeAnimation,t.duration/2,function(){t.removeFunction?t.removeFunction.call(u):n(document).has(u).length&&u.remove(),delete r[t.name],setTimeout(function(){e.trigger("am.overlays.onClose",[t.name])},1)});return}function s(){u=n('<div class="overlay '+i.name+'"/>').appendTo(i.target).addClass(i.transparent?"transparent":"").data("settings",i),i.fillViewport&&(u.css({position:"fixed","padding-left":i.target.offset().left}),aston.w.bind("am.resize",function(){u.css({"padding-left":i.target.offset().left}),i.onResize()})),i.onInit.call(u),u.animate(i.openAnimation,i.duration,function(){i.onOpen.call(this)}),r[i.name]=u}var o={name:"default",target:n("div#pages"),transparent:!0,duration:0,onInit:function(){},onOpen:function(){},onClose:function(){},onResize:function(){},openAnimation:{opacity:1},closeAnimation:{opacity:0},fillViewport:!1},i=n.extend(!0,{},o,t),u=r[i.name]||null,h=!1;if(aston.ie&&(o.openAnimation={},o.closeAnimation={}),u)return c();for(f in r){h=!0;break}if(h){e.bind("am.overlays.onClose",function(){e.unbind("am.overlays.onClose"),s()});for(f in r)aston.overlay({name:f})}else s()}}.apply(aston,[jQuery,"overlays"]),function(n,t){function w(){s.click(function(){return aston.w.trigger("am.soul.panel.click",[n(this)]),!1}).hover(function(){aston.w.trigger("am.soul.panel.mouseenter",[n(this)])},function(){aston.w.trigger("am.soul.panel.mouseleave",[n(this)])}),n("p.play a:not(.listenerAttached)",i).click(function(){return aston.w.trigger("am.soul.video.play",[n(this)]),!1}).addClass("listenerAttached")}function v(){aston.w.bind("am.soul.panel.close",function(){f&&($open=s.filter(".on"),u.closePanel($open,$open.siblings(".column")))}).bind("am.soul.panel.click",p).bind("am.soul.panel.mouseenter",function(n,t){t.addClass("over")}).bind("am.soul.panel.mouseleave",function(n,t){t.removeClass("over")}).bind("am.theme",y)}function h(n){n=n||aston.theme,o=n==="medium"||n==="xlarge"?3:5}function y(n,t){i.length>0&&(h(),e=i.width(),u.resizePanels(t))}function p(n,t){var r=t.siblings(".column");h(),t.hasClass("on")?(u.closePanel(t,r),f=!1):f?u.switchPanel(t,r):(i.find("p.tagline").fadeOut(),u.openPanel(t,r),f=!0)}var a=this,c={__id:t},b=a.w;a.register(c);var k=!1,i,s,l=!1,r={small:{min:114,normal:152,max:304},medium:{min:133,normal:178,max:356},large:{min:174,normal:232,max:464},xlarge:{min:223,normal:298,max:596}},f=!1,o,e,u=function(){return Modernizr.opacity&&Modernizr["display-table"]?{resizePanels:function(n){f?(i.find(".column.on .inner").width(r[n].max),i.find(".column:not(.on) .inner").width(r[n].min)):i.find(".column .inner").width(r[n].normal)},closePanel:function(n){n.find("div.soulItem").stop().animate({opacity:0},300,function(){i.find("div.next").removeClass("next"),i.find("div.inner").animate({width:Math.floor(e*.2)},600,function(){n.removeClass("on"),i.find("p.tagline").fadeIn()})})},switchPanel:function(n,t){i.find("div.column.on div.soulItem").stop().animate({opacity:0},300,function(){i.find(".next").removeClass("next"),u.openPanel(n,t)})},openPanel:function(n,t){t.find(".inner").stop().animate({width:Math.floor(e*.15)},600),n.find(".inner").stop().animate({width:Math.floor(e*.4)},600,function(){t.removeClass("on"),n.addClass("on"),n.find(".inner").width(n.find(".inner").width()+1),n.next().find(".inner").addClass("next"),n.find("div.soulItem").animate({opacity:1},300)})}}:{resizePanels:function(n){f?(i.find(".column:not(.on)").width(r[n].min).last().width(r[n].min-o).end().find(".inner").width(r[n].min).last().width(r[n].min-o),i.find(".column.on").width(r[n].max).find(".inner").width(r[n].max)):i.find(".column").width(r[n].normal).last().width(r[n].normal-5).end().find(".inner").width(r[n].normal).last().width(r[n].normal-5)},closePanel:function(n){n.removeClass("on").find(".soulItem").hide(),i.find(".inner, .column").width(r[aston.theme].normal-1),i.find("p.tagline").fadeIn()},switchPanel:function(n,t){i.find("div.column.on div.soulItem").hide(),u.openPanel(n,t)},openPanel:function(n,t){t.width(r[aston.theme].min),n.find("div.inner").width(r[aston.theme].max-o),n.width(r[aston.theme].max-o),t.removeClass("on"),n.addClass("on"),n.find("div.soulItem").show()}}}();c.init=function(){i=n("#soul"),h(),e=i.width(),s=i.find("div.column"),i.find("div.column:first").addClass("first"),i.length>0&&!l&&(v(),w(),l=!0)},c.unload=function(){aston.w.trigger("am.soul.panel.close")}}.apply(aston,[jQuery,"soul"]),function(n,t){function b(){var t=n("#video-gallery-filter");if(t.length){var u=n(".current-filter em",t),f=n(".current-filter a",t),i=n(".filters",t),r=n("section.page");t.delegate(".current-filter a","click",function(){return i.toggleClass("shown").hasClass("shown")?i.stop().slideDown():i.stop().slideUp(),!1}).delegate(".filters a","click",function(){var t=n(this);return i.stop().slideUp().removeClass("shown"),u.html(t.html()),n.when(n.ajax({url:t[0].href}),r.animate({opacity:0})).done(function(t){r.html(n(t[0]).find("section.page").children()),aston.stickyDashFix(r[0]),r.animate({opacity:1})}),!1})}}function d(){n("a.video-link").live("click.video.launch",function(t){var r=n(this);i?i.loadVideo(r.data("video"),r.data("title")||r.text(),r.data("player")||r.attr("href")||window.location.href):u.trigger("am.overlays.video.launch",[r]),t.preventDefault()}),n(".more-videos a").live("click",function(){var t=n(this),i=t.closest("ul"),r=t.closest(".video-player").find(".discover-more");src=t[0].href,aston.overlaysCache[src]=aston.overlaysCache[src]||n.ajax(src),n.when(aston.overlaysCache[src],i.children().has(this).siblings().animate({opacity:0})).done(function(t){var u=n(t[0]);i.replaceWith(u.find(".more-videos ul")),e(),r.replaceWith(u.find(".discover-more"))})})}function s(){var i=n("embed"),t={xlarge:[1490,730],large:[1160,568],medium:[890,436],small:[760,372]};i.removeAttr("width").removeAttr("height").attr("width",t[aston.theme][0]).attr("height",t[aston.theme][1])}function e(){switch(aston.theme){case"medium":case"small":n(".more-videos ul").each(function(){n(this).children("li").slice(3).addClass("hidden")});break;default:n(".more-videos ul li").removeClass("hidden")}}function k(){h||(u.bind("am.videoplayer.showlink",function(n,t){i.showSharePopup("link"),t.addClass("active").siblings().removeClass("active")}).bind("am.videoplayer.showembed",function(n,t){i.showSharePopup("embed"),t.addClass("active").siblings().removeClass("active")}).bind("am.videoplayer.shareTwitter",function(){window.open(i.twitterLink())}).bind("am.videoplayer.shareFacebook",function(){window.open(i.facebookLink())}).bind("am.videoplayer.newvideo",function(){i.closeSharePopup()}).bind("am.videoplayer.finished",function(){u.trigger("am.videoplayer.carousel.open")}).bind("am.videoplayer.carousel.open",y).bind("am.videoplayer.carousel.close",l).bind("am.videoplayer.sound.click",a).bind("am.videoplayer.fullscreen",v),h=!0)}function y(){i.showCarousel()}function l(){i.hideCarousel()}function v(){i.toggleFullScreen()}function o(t,i){var r=i.find(t);return r.length?r:i.parent().length?o(t,i.parent()):n(0)}function r(n,t){this.$container=t,this.params=n,this.init()}function a(){var t=n("#sound");t.hasClass("open")?t.animate({height:45},200,function(){t.removeClass("open")}):t.animate({height:103},400,function(){t.addClass("open")})}var c=this,f={__id:t},u=c.w;c.register(f);var w={src:"/flash/flowplayer"+(aston.flowplayerLicence?".commercial":"")+"-3.2.7.swf",wmode:"transparent",allowScriptAccess:"always"},p={clip:{autoPlay:!1,autoBuffering:!0,scaling:"fit",provider:"http"},onError:n.noop,plugins:{controls:null},canvas:{background:"#000000",backgroundGradient:"none"},key:aston.flowplayerLicence,play:{url:aston.cdn+"/icons/video-play.png",width:98,height:98,opacity:1}},h=!1,i;f.init=function(){n("#pages.video-player")&&(f.buildVideo({containerId:"video"}),e(),u.bind("am.theme",e)),aston.plugins.overlays.setupOverlay({handler:function(){u.bind("am.overlays.video.launch",function(t,i){var r,u,f=new n.Deferred;aston.overlay({name:"video",target:n("#main"),openAnimation:{top:-1},duration:600,fillViewport:!0,onResize:e,onInit:function(){u=this;var t=i[0].href;aston.overlaysCache[t]=n.ajax(t),n.when(aston.overlaysCache[t]).then(function(t){r=n(t).filter(".video-player"),r.length||(r=n(t).find(".video-player")),f.resolve(),r.removeAttr("id").css("visibility","hidden").appendTo(u).css({top:-Math.max(n("footer").offset().top-1,r.height()),visibility:"visible"}),e(),r.find("div.variation li a").each(function(t,i){n(i).text()==""&&n(i).parent().hide()}),u.find("a.btn-close").click(function(){return r.animate({top:-u.height()},300,function(){aston.ie?aston.overlay({name:"video"}):u.animate({opacity:0},300,function(){aston.overlay({name:"video"})})}),!1})})},onOpen:function(){n.when(f).then(function(){var n=i.data("title")||i.attr("title")||i.text();r.animate({top:0},600,function(){aston.plugins.videoplayer.buildVideo({containerId:"video",videoUrl:i.data("video"),videoTitle:n})})})},onClose:function(){aston.plugins.videoplayer.unload(),r.animate({top:-r.height()},300,function(){aston.ie||u.animate({opacity:0},300)})},removeFunction:function(){aston.ie?this.css("display","none").find("#video").siblings().remove().end().find(":not(object)").andSelf().attr("id",""):n(document).has(this).length&&this.remove()}})})}}),d(),b()},f.buildVideo=function(t){var f=n("#"+t.containerId);if(!f.length)return!1;f.data("playerObject")?i=f.data("playerObject"):f.data("player")=="youku"?(f.hide(),s(),u.bind("am.theme",s)):(i=new r(t,f),f.data("playerObject",i))},f.loadVideo=function(n,t,r){i&&i.loadVideo(n,t,r)},f.unload=function(){i&&i.unload(),i=null},f.unsetCurrent=function(){i=null},f.stop=function(){i&&i.stop()},r.prototype.init=function(){this.config=n.extend(!0,{},p,{clip:{url:this.params.videoUrl||this.$container.data("video"),subTitle:this.params.videoTitle||this.$container.data("title"),autoPlay:this.params.autoPlay}}),this.playerUrl=this.params.playerUrl||this.$container.data("player")||window.location.href,this.$titleEl=(this.params.titleElement||o(".video-title",this.$container)).html(this.config.clip.subTitle),this.loadPlayer(),this.listeners()},r.prototype.loadPlayer=function(){this.$container.empty().show(),this.$screen=n('<div style="height:100%;width:100%;background:black;overflow:hidden;" class="screen">'),this.$container.append(this.$screen),this.$screen.flowplayer(w,this.config),this.player=$f(this.$screen[0]).amControls(this.$container,{title:this.config.clip.subTitle,url:this.config.clip.url,encodedUrl:encodeURI(this.config.clip.url)}).ipad(),k()},r.prototype.loadVideo=function(t,i,r){return this.$titleEl.html(i),this.playerUrl=r,n.extend(this.config.clip,{autoplay:!0,url:t,subTitle:i}),this.player.play(this.config.clip),u.trigger("am.videoplayer.newvideo"),!1},r.prototype.unload=function(){aston.ie?(this.$container.css("display","none").attr("id",""),this.stop()):(this.player.unload(),this.$container.empty())},r.prototype.stop=function(){this.player.mute().stop().stopBuffering().amControlsMethods.restart(),this.hideCarousel()},r.prototype.listeners=function(){(this.getCarousel(),this.$carousel&&!this.$carousel.hasClass("connectedToVideo"))&&this.$carousel.delegate("ul.slides a","click",function(){var i=n(this);f.loadVideo(i.data("video"),i.data("title")||i.text(),i.data("player")||i.attr("href")||window.location.href)}).delegate("a.btn-close, ul.slides a","click.video.closecarousel",function(t){u.trigger("am.videoplayer.carousel.close",[n(this)]),t.preventDefault()}).addClass("connectedToVideo")},r.prototype.getCarousel=function(){this.$carousel||(this.$carousel=o(".simpleCarousel, #carousel",this.$container))},r.prototype.twitterLink=function(){return"http://twitter.com/home?status="+this.config.clip.subTitle+" : "+this.playerUrl},r.prototype.facebookLink=function(){return"http://www.facebook.com/sharer.php?u="+encodeURIComponent(this.playerUrl)+"&t="+encodeURIComponent(this.config.clip.subTitle)},r.prototype.hideCarousel=function(){var i=this,t;this.$carousel&&(t=this.$carousel,aston.ie?(t.hide(),aston.plugins.carousel.stop(t),i.$container.removeClass("hasOverlay")):t.animate({opacity:0},200,function(){n(this).hide(),aston.plugins.carousel.stop(t),i.$container.removeClass("hasOverlay")}))},r.prototype.showCarousel=function(){var t=this,n;this.$carousel&&(n=this.$carousel,this.player.amControlsMethods.hideControls(),aston.ie?(this.$carousel.show(),aston.plugins.carousel.start(n),t.$container.addClass("hasOverlay")):n.show().animate({opacity:1},function(){aston.plugins.carousel.start(n),t.$container.addClass("hasOverlay")}))},r.prototype.toggleFullScreen=function(){var r=this,t,i;if(window.player=this,this.$container.hasClass("fullScreen")?(n(document).unbind("keyup.videoplayer.leavefullscreen"),n("#sound").css("display","block")):(n(document).bind("keyup.videoplayer.leavefullscreen",function(n){n.keyCode==27&&u.trigger("am.videoplayer.fullscreen")}),n("#sound").css("display","none")),n.browser.mozilla){t=function(){this.player.amControlsMethods.refresh(i),t=n.noop},i=this.player.isPlaying();this.player.onStart(function(){t.apply(r)})}this.$container.toggleClass("fullScreen").parents().toggleClass("force-overflow"),n("#subnav h1 a").toggleClass("no-z-index")},r.prototype.showSharePopup=function(t){this.$sharePopup||(this.$sharePopup=n('<div class="sharePopup"><input name="shareContent" id="shareContent"><a href="#" class="btn-close-white btn-close">'+aston.lang.en.videoplayer.sharePopupCloseText+'</a><div class="arrow"></div></div>').delegate("input","focus",function(){this.select()}).delegate("a.btn-close","click",n.proxy(this,"closeSharePopup")).appendTo(n(".video-controls",this.$container))),this.$sharePopup.css("display","block").find("input").val(t=="link"?this.playerUrl:this.embedVideo()),this.$container[0].className=this.$container[0].className.replace(/(embed|link)-popup/,""),this.$container.addClass(t+"-popup").addClass("withSharePopup")},r.prototype.closeSharePopup=function(){return this.$sharePopup&&(this.$sharePopup.css("display","none"),n(".video-controls .links a.active",this.$container).removeClass("active"),this.$container.removeClass("withSharePopup")),!1},r.prototype.embedVideo=function(){return this.embedCode||(this.embedCode=this.player.embed({width:640,height:360}).getEmbedCode().replace(/(&lt;|&gt;)/g,function(n){return n.charAt(1)=="l"?"<":">"}))},f.buildSoundOverlay=function(){var t=n("#sound");if(!n("#sound").hasClass("built")){var r=t.find("h2"),i=t.find("li a.audio"),f=n('<a href="#" class="trigger">'+r.text()+"</a>").click(function(){return u.trigger("am.videoplayer.sound.click",[n(this)]),!1});if(t.length!==0){i.length>0&&t.css("height","45"),r.html(f),i.click(function(n){n.preventDefault()}),t.find("a.btn-close").click(function(){return u.trigger("am.videoplayer.sound.click",[n(this)]),!1}),i.each(function(){var r=n(this),e=r.text(),o=r.get(0).href,f=r.attr("id");r.text(""),r.parent().append('<div class="sound-controls" id="'+(f+"-controls")+'"></div>'),flowplayer(f,"/flash/flowplayer-3.2.7.swf",{plugins:{controls:null},clip:{autoPlay:!1,url:o},onLoad:function(){r.parent().append('<span class="clipTitle">'+e+"</span>")},onBegin:function(){n("div.video-controls a.play").hasClass("playing")&&u.trigger("am.videoplayer.play.click",[n("div.video-controls a.play")]),t.find("li a.audio").not(r).flowplayer().each(function(){this.isPlaying()&&(this.pause(),this.stop())})},onPause:function(){n("div.video-controls a.play").hasClass("playing")&&u.trigger("am.videoplayer.play.click",[n("div.video-controls a.play")])},onFinish:function(){n("div.sound-controls").find("a.pause").removeClass("pause").addClass("play")}}).controls(f+"-controls")}),t.fadeIn(300).addClass("built");return}}}}.apply(aston,[jQuery,"videoplayer"]),function(n,t){function s(){aston.w.bind("am.theme",function(){})}function h(){if(i=aston.images,i.length>0){var n=i[Math.floor(Math.random()*i.length)];Modernizr.backgroundsize?r.css({"background-image":"url("+n+")","background-attachment":"fixed","background-repeat":"no-repeat","background-size":"cover"}):r.css({"background-image":"url("+n+")","background-position-x":"top","background-position-y":"left","background-color":"#000","background-attachment":"fixed","background-repeat":"no-repeat"})}}var o=this,e={__id:t},c=o.w,f,i,u,r;o.register(e),e.init=function(){(f=n("body"),f.hasClass("bg"))&&(u=n("#legalfooter"),r=n("html"),s(),h())}}.apply(aston,[jQuery,"backgroundimages"]),function(n,t){var u=this,f={__id:t},e=u.w,i,r;u.register(f),i=n(".new-primary-navigation, .new-secondary-navigation"),r=n("#pages"),f.init=function(){i.length!=0&&(i.length>1&&(i=i.toArray().reverse()),n.each(i,function(t,i){n(i).find(".rtsLevel").addClass("center").end().prependTo(r)}))}}.apply(aston,[jQuery,"menu"]),function(n,t){function f(){i.click(function(t){if(!t.srcElement||t.srcElement.nodeName!="A")return aston.w.trigger("am.jobs.click",[n(this)]),!1}),i.find(".view").click(function(){return aston.w.trigger("am.jobs.view",[n(this)]),!1})}function e(){aston.w.bind("am.jobs.click",function(n,t){var i=t.find(".job-summary");t.hasClass("on")?i.slideUp("fast",function(){t.removeClass("on")}):i.slideDown("fast",function(){t.addClass("on")})}),aston.w.bind("am.jobs.view",function(t,i){n("body").addClass("gallery-controls");var r=i.attr("href");n.fancybox.open({type:"iframe",href:r,openEffect:"none",padding:0,width:"80%",height:"80%",helpers:{title:null}})})}var u=this,r={__id:t},o=u.w,i;u.register(r),r.init=function(){(i=n(".job-wrapper"),i.length<1)||(f(),e())}}.apply(aston,[jQuery,"jobs"]),function(n,t){function f(){aston.w.bind("am.theme",function(){setTimeout(function(){if(aston.windowLoaded){var t=n(".cycle-slideshow"),i=t.attr("style");t.attr("style",i.replace(/width:/g,"")).find(".cycle-wrap").cycle("reinit")}},1)})}var u=this,r={__id:t},e=u.w,i;u.register(r),r.init=function(){(i=n(".cycle-wrap"),i.length<1)||f()}}.apply(aston,[jQuery,"ribbons"]),function(n,t){function i(n){this.element=n,this.init()}function r(n,t,i){window.clearTimeout(n.timer),n.slider.find("ul").animate({top:t},i,function(){n.autoStart()})}var f=this,e={__id:t},s=f.w,o,u;f.register(e),u={autoplay:!1,interval:5e3,animateSpeed:600},e.init=function(){o=n(".vertical-carousel"),n.each(o,function(t,r){new i(n(r))})},i.prototype.timer=null,i.prototype.init=function(){var t=this;t.options=n.extend(!0,{},u,t.element.data()),t.height=t.element.height(),t.currentSlide=1,t.slider=t.element.find(".half.slides"),t.numberOfSlides=t.slider.find("li").length,t.listeners(),t.triggers(),t.autoStart()},i.prototype.listeners=function(){var n=this;aston.w.bind("am.theme",function(){n.height=n.element.height();var t=n.currentSlide==1?0:n.height*(n.currentSlide-1);r(n,-t,n.options.animateSpeed/2)})},i.prototype.triggers=function(){var n=this;n.slider.on("click",function(){n.nextSlide()})},i.prototype.autoStart=function(){var n=this;n.options.autoplay&&(n.timer=setTimeout(function(){n.nextSlide()},n.options.interval))},i.prototype.nextSlide=function(){var n=this;n.currentSlide+1<=n.numberOfSlides?(r(n,-(n.height*n.currentSlide),n.options.animateSpeed),n.currentSlide=n.currentSlide+1):(r(n,0,n.options.animateSpeed),n.currentSlide=1)}}.apply(aston,[jQuery,"vertical"]),function(n,t){function l(t,i,r,u){this.menu=t,w(i||n.noop),tt(u||n.noop),p(r||n.noop)}function ut(){aston.w.bind("am.navigation.search.keyup",function(n,t,i){window.clearTimeout(g),g=window.setTimeout(function(){st(t,i)},ft)}),e.find(".four-col").find("li").mouseenter(function(){var i=n(this).find("a"),t=i.data("img"),r=i.parents(".category").find("img");t!=""&&r.attr("src",t)}).mouseleave(function(){var t=n(this).parents(".category").find("img");t.attr("src",t.data("original"))})}function et(){u.find("#txtSearch").live("keyup",function(t){var r=n(this),i=r.val();i.length>2&&/[a-z0-9]/i.test(String.fromCharCode(t.which))?aston.w.trigger("am.navigation.search.keyup",[r,i]):i.length==0&&u.find(".results").empty()}).keydown(function(n){n.which==13&&n.preventDefault()})}function st(t,i){var f=u.find(".results"),r=t.parent().find(".loading").show();ot(i),n.ajax({type:"POST",url:"/Webservices/SearchWS.asmx/PerformSearch",contentType:"application/json; charset=utf-8",data:JSON.stringify({searchValue:i}),dataType:"json",success:function(t){if(t.d){var i=n("#searchResultsTemplate").tmpl(t.d);f.empty().append(i),r.hide()}}})}function ot(n){try{_gaq.push(["_trackPageview",aston.language+"/search?searchQuery="+n])}catch(t){}}function v(n){for(var i=0,r=n.length,t=0;t<r;t++)i+=n[t].clientHeight;return i}function rt(t){w(t.init||n.noop),tt(t.handler||n.noop),p(t.trigger||n.noop)}function w(n){n()}function p(n){n()}function tt(n){n()}var b=this,k={__id:t},r=b.w;b.register(k);n("#more-menu").on("shown",function(){n("#hover").focus()});n("#HeaderContentBlock_TA148E0A8014_NavigationRepeater_linkNavigation_0").removeAttr("title"),n("#HeaderContentBlock_TA148E0A8014_NavigationRepeater_linkNavigation_1").removeAttr("title"),n("#HeaderContentBlock_TA148E0A8014_NavigationRepeater_linkNavigation_2").removeAttr("title"),n("#HeaderContentBlock_TA148E0A8014_NavigationRepeater_linkNavigation_3").removeAttr("title"),n("#HeaderContentBlock_TA148E0A8014_NavigationRepeater_linkNavigation_4").removeAttr("title"),n("#HeaderContentBlock_TA148E0A8014_NavigationRepeater_linkNavigation_5").removeAttr("title"),n("#HeaderContentBlock_TA148E0A8014_NavigationRepeater_linkNavigation_6").removeAttr("title"),n("#HeaderContentBlock_TA148E0A8014_NavigationRepeater_linkNavigation_7").removeAttr("title");var y=!1,a,f,d,e,u,o,g,ft=400,it=30,nt={cars:{init:function(){a=n("header").find(".show-car-menu"),f=n(".car-menu"),d=f.find(".center"),e=f.find(".category"),f.hide().insertAfter(n("header"))},trigger:function(){n(".show-car-menu").on("click",function(){return aston.w.trigger("am.navigation.vehicles.click",[n(this)]),!1});n(".car-menu .btn-close").on("click",function(){return aston.w.trigger("am.navigation.vehicles.close"),!1})},handler:function(){function n(n){if(n.hasClass("content"))return 0;var t=n.find("ul").first().children(),u=t.first().outerWidth()+15,r=d.outerWidth(),i=t.length*u;return(r-i)/2}r.bind("am.navigation.vehicles.click",function(t,i){var u=i.data("category"),r;i.hasClass("on")?aston.w.trigger("am.navigation.vehicles.close"):(e.hide().removeClass("on"),r=e.filter(function(n,t){return t.id==u}),r&&(f.show().animate({height:r.outerHeight()+it},300,function(){r.css("left",n(r)).addClass("on"),r.fadeIn("fast"),y=!0}),a.removeClass("on"),i.addClass("on")))}),r.bind("am.navigation.vehicles.close",function(){f.animate({height:0},175,function(){e.hide(),f.hide(),a.removeClass("on"),e.removeClass("on"),y=!1})}),r.bind("am.theme",function(){if(y){var t=e.filter(".on");t.css("left",n(t))}})}},footer:{init:function(){o=n("footer").find(".primary")},trigger:function(){o.find(".arrow").on("click",function(){var t=n(this);return t.hasClass("on")?aston.w.trigger("am.navigation.footer.hide",function(){t.removeClass("on")}):aston.w.trigger("am.navigation.footer.show",function(){n("html,body").animate({scrollTop:o.offset().top},500),t.addClass("on")}),!1});n("#main").hasClass("home")&&(r.trigger("am.footer.hide"),o.find(".arrow").show())},handler:function(){r.bind("am.navigation.footer.show",function(n,t){var i=o.find(".column").first().outerHeight()+20;o.animate({height:i},100,function(){typeof t=="function"&&t.call(this)})}),r.bind("am.navigation.footer.hide",function(n,t){o.animate({height:50},100,function(){typeof t=="function"&&t.call(this)})})}},side:{init:function(){u=n(".side-menu"),u.hide().insertAfter(n("header"))},trigger:function(){n("#side-menu").on("click",function(){return aston.w.trigger("am.navigation.sidemenu.show",[n(this)]),!1});u.find(".btn-close").on("click",function(){return aston.w.trigger("am.navigation.sidemenu.hide"),!1})},handler:function(){r.bind("am.navigation.sidemenu.show",function(){n("#side-menu").transition({rotate:"-=180",complete:function(t){if(typeof t=="undefined"){var i=u.outerWidth();u.css("right",i*-1).show().animate({right:0},300,function(){n("body").prepend('<div class="fixed-overlay" />').show(),u.find("#txtSearch").focus()})}}})}),r.bind("am.navigation.sidemenu.hide",function(){var t=u.outerWidth();u.animate({right:t*-1},175,function(){n("body").find(".fixed-overlay").remove(),u.find("#txtSearch").val(""),u.find(".results").empty(),n("#side-menu").transition({rotate:"+=180"})})})}}},c=function(){var o="more",t=n("#overlay"),u=t.find(".wrap"),i=t.find("#more-menu"),s=n.noop,f=function(){n("#more-text").on("click",function(){return n("a").focus(),r.trigger("am.navigation.moremenu.open"),n("#stik").hide(),!1})},e=function(){r.bind("am.navigation.moremenu.open",function(){t.show(),i.show(),n("html").addClass("has-overlay"),u.css("marginTop",-i.outerHeight()).delay(500).show().animate({marginTop:0},450)}),r.bind("am.navigation.moremenu.close",function(){u.animate({marginTop:-v(i)},300,function(){n("#txtSearch").val(""),n("#search-results").empty(),setTimeout(function(){i.hide(),t.hide(),n("html").removeClass("has-overlay")},300)})})};return{name:o,init:s,trigger:f,handler:e}}(),h=function(){var h="search",t=n("#overlay"),i=n("#search-menu, #more-menu"),u=t.find(".wrap"),f=null,c=400,s=function(){var i=n("#txtSearch"),r=n("#search-results"),t=n("#search-menu .loading");i.on("keyup",function(u){var e=i.val();e.length>2&&/[a-z0-9]/i.test(String.fromCharCode(u.which))?(window.clearTimeout(f),f=window.setTimeout(function(){t.show(),aston.generic.logPageView(aston.language+"/search/"+e),n.ajax({type:"POST",url:"/Webservices/SearchWS.asmx/PerformSearch",contentType:"application/json; charset=utf-8",data:JSON.stringify({searchValue:e}),dataType:"json",success:function(i){i.d&&(t.hide(),r.empty().append(n("#newSearchResultsTemplate").tmpl(i.d)))}})},c)):e.length==0&&(r.empty(),t.hide())}).keydown(function(n){n.which==13&&n.preventDefault()})},e=function(){n("#search-text").on("click",function(){return r.trigger("am.navigation.searchmenu.open"),!1});t.find(".btn-close").on("click",function(){return n("#stik").show(),r.trigger("am.navigation.searchmenu.close"),!1})},o=function(){r.bind("am.navigation.searchmenu.open",function(){t.show(),i.show(),n("html").addClass("has-overlay"),u.css("marginTop",-v(i)).delay(500).show().animate({marginTop:0},450)}),r.bind("am.navigation.searchmenu.close",function(){u.animate({marginTop:-v(i)},300,function(){n("#txtSearch").val(""),n("#search-results").empty(),setTimeout(function(){i.hide(),t.hide(),n("html").removeClass("has-overlay")},300)})})};return{name:h,init:s,trigger:e,handler:o}}(),s=function(){var e="country",t=n("#country-menu"),i=t.find(".container"),o=function(){t.insertBefore(n("header"));n("#cmbFindADealer").on("change",function(){var r=n(this).val().trim(),u=n("#btnDealerLocator"),t=u.attr("href"),i=t.indexOf("?");i>-1&&(t=t.substring(0,i)),r&&(t+="?country="+r),u.attr("href",t)})},u=function(){n("#chooseCountry").on("click",function(){var t=n(this);return t.hasClass("on")?r.trigger("am.navigation.countrymenu.close",[t]):r.trigger("am.navigation.countrymenu.open",[t]),!1});t.find(".btn-close").on("click",function(){return r.trigger("am.navigation.countrymenu.close",[n("#chooseCountry")]),!1})},f=function(){r.bind("am.navigation.countrymenu.open",function(n,r){t.slideDown(300,function(){i.addClass("on")}),r.addClass("on")}),r.bind("am.navigation.countrymenu.close",function(n,r){i.removeClass("on"),t.slideUp(175),r.removeClass("on")})};return{name:e,init:o,trigger:u,handler:f}}();k.init=function(){if(!n("body").hasClass("racing")){for(i in nt)rt(nt[i]);new l(s.name,s.init,s.trigger,s.handler),new l(h.name,h.init,h.trigger,h.handler),new l(c.name,c.init,c.trigger,c.handler),ut(),et()}}}.apply(aston,[jQuery,"menus"]),function(n,t){function l(){u.parent().on("click",function(){f.hide(),e.hide(),h(n(this))})}function h(t){var r=t.find("input").val();u.parent().css("background-position","50% 0px"),t.children(".checkbox").css("background-position","50% -50px");switch(r){case"Drive":i.hide(),n("#driveForm").show().drive();break;case"Events":i.hide(),n("#eventsForm").show().eventsForm({campaignId:3534});break;case"Sales":case"CustomerService":i.hide(),n("#contactForm").show().contactForm({mode:{Sales:!0}});break;case"Heritage":i.hide(),n("#contactForm").show().contactForm({mode:{Heritage:!0}});break;case"Franchising":i.hide(),n("#contactForm").show().contactForm({mode:{Franchising:!0}});break;case"Parts":i.hide(),n("#contactForm").show().contactForm({mode:{Parts:!0}});break;case"Investors":i.hide(),n("#contactForm").show().contactForm({mode:{Investors:!0}});break;case"WorksService":i.hide(),n("#contactForm").show().contactForm({mode:{WorksService:!0}});break;case"PublicAffairs":i.hide(),n("#contactForm").show().contactForm({mode:{PublicAffairs:!0}});break;case"WebsiteFeedback":i.hide(),n("#contactForm").show().contactForm({mode:{WebsiteFeedback:!0}});break;case"Newsletter":i.hide(),n("#contactForm").show().contactForm({mode:{Newsletter:!0}});break;case"Licencees":i.hide(),n("#contactForm").show().contactForm({mode:{Licencees:!0}})}}function c(){r.find(":radio").wrap('<div class="radio"/>'),r.find(".radio").dgStyle(),r.find(":checkbox").wrap('<div class="checkbox"/>'),r.find(".checkbox").dgStyle()}var s=this,o={__id:t},a=s.w,r,i,f,u,e;s.register(o),i=n("#driveForm, #eventsForm, #contactForm"),e=n('div[id$="Complete"]'),o.init=function(){(r=n("#enquireForm"),r.length)&&(f=n("#altLinks"),u=n("#options").find("input"),i.hide(),l(),c())}}.apply(aston,[jQuery,"enquire"]),function(n,t){function tt(n,t){var u=1024,r=u*1024,i=r*1024,f=i*1024;return n>=0&&n<u?n+" B":n>=u&&n<r?(n/u).toFixed(t)+" KB":n>=r&&n<i?(n/r).toFixed(t)+" MB":n>=i&&n<f?(n/i).toFixed(t)+" GB":n>=f?(n/f).toFixed(t)+" TB":n+" B"}function nt(){n.ajax({type:"POST",url:"/WebServices/DownloadOrderService.asmx/GetCurrentBasket",data:{},contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d.length>0){var t=y.tmpl(n.d,{bytesToSize:function(n){return tt(n,1)}});t.appendTo(i),$clearAll.show(),r.show()}else c.show(),$clearAll.hide(),r.hide()}})}function rt(){return parseInt(f.text().match(/\d+/g).toString())}function it(n){var t=rt();n?t++:(t--,t<0&&(t=0)),h(t)}function h(n){f.fadeOut("fast",function(){f.text("Media Basket ("+n+")").show()})}function w(){aston.w.bind("am.basket.clear.click",function(){n.ajax({type:"POST",url:"/WebServices/DownloadOrderService.asmx/ClearDownloadItemBasket",data:{},contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){t.d&&(i.find("tr").not(".empty").fadeOut("fast",function(){n(this).remove(),c.show()}),h(0))}})}),aston.w.bind("am.basket.remove.click",function(t,i){var f,u,r;t.preventDefault(),f=i.data("id"),u=i.parents("tr"),i.attr("disabled",!0).text("Removing..."),r=JSON.stringify({downloadItemId:f}),n.ajax({type:"POST",url:"/WebServices/DownloadOrderService.asmx/RemoveDownloadItemFromBasket",data:r,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){t.d&&u.fadeOut("slow",function(){n(this).remove(),it(!1)})},error:function(){i.removeAttr("disabled").text("Remove")}})}),aston.w.bind("am.basket.checkout.click",function(t,i,r){t.preventDefault(),i.attr("disabled",!0).text("Processing...");var u=JSON.stringify({notificationEmail:r});n.ajax({type:"POST",url:"/WebServices/DownloadOrderService.asmx/CreateOrderForCurrentUser",data:u,contentType:"application/json; charset=utf-8",dataType:"json",success:function(){s.fadeOut("slow",function(){l.show(),h(0)})},error:function(t){if(t.responseText){var r="Sorry an error has occured, "+JSON.parse(t.responseText).Message;o.find("h2").text(r)}o.show(),n("html,body").animate({scrollTop:o.offset().top},500),i.attr("disabled",!1).text("Order now")}})})}function k(){p.live("click",function(){return aston.w.trigger("am.basket.remove.click",[n(this)]),!1});$clearAll.on("click",function(){var n=confirm("Are you sure you want to empty your portfolio?");return n&&aston.w.trigger("am.basket.clear.click"),!1});r.on("click",function(){return n.fancybox.open(u,{padding:0,beforeLoad:function(){b(u),d(u),g(u)},afterClose:function(){n("#txtEmailAddress").val("")}}),!1})}function g(t){n.ajax({type:"POST",url:"/WebServices/UserService.asmx/GetDefaultEmail",data:{},contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){t.find("#txtEmailAddress").val(n.d)}})}function b(t){t.find("#btnSubmit").on("click",function(){var i=t.find("#txtEmailAddress"),u=i.val();i.isValid()?(i.removeClass("invalid"),n.fancybox.close(!0),aston.w.trigger("am.basket.checkout.click",[r,u])):i.addClass("invalid")})}function d(t){if(!Modernizr.input.placeholder){var i=t.find("input[type=text]");n.each(i,function(t,i){var r=n(i);r.attr("value",r.attr("placeholder"))})}}var v=this,a={__id:t},ut=v.w,s,e,i,p,c,r,y,f,l,o,u,ft;v.register(a),a.init=function(){(s=n("#basket-summary"),s.length!=0)&&(e=s.find("#basketTable"),i=e.find("tbody"),c=i.find(".empty"),p=i.find(".update"),$clearAll=e.find(".btn-clear"),r=e.find("#btn-checkout"),y=n("#itemTemplate"),f=n("a.basket"),l=n("#basket-complete"),o=i.find(".error"),u=n("#checkout-form"),w(),k(),nt())}}.apply(aston,[jQuery,"basket"]),function(n,t){var u=this,r={__id:t},o=u.w;u.register(r);var i=n("#tabs"),f=n(".tabItem"),e=i.find(".tabheader");r.init=function(){i.length!=0&&(n.each(e,function(t){var e=n(this),u=n(f.get(t));e.attr("href","#"+u.attr("id")),u.appendTo(i)}),i.tabs({active:0}))}}.apply(aston,[jQuery,"tabs"]),function(n,t){function p(){s.click(function(t){s.data("authenticated")==!1&&(t.preventDefault(),n.fancybox.open(i,{wrapCSS:"login-wrapper",padding:0,beforeShow:function(){y()},afterClose:function(){o.hide(),i.find("#registrationComplete").hide(),i.find(".panel, .submit-panel").show(),Modernizr.input.placeholder&&i.find("input[type=text], input[type=password]").val("").removeClass("invalid"),i.find("input[type=checkbox]").removeAttr("checked").parent(".checkbox").css("background-position","50% 0px")}}))}),u.click(function(t){if(u.attr("disabled","disabled"),t.preventDefault(),r.isValid(!0)){r.removeClass("invalid"),u.attr("value","Please Wait...");var f={email:r.val()},i=JSON.stringify(f);n.ajax({type:"POST",url:"/WebServices/UserService.asmx/Register",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(){n(".panel, .submit-panel").fadeOut("slow",function(){n("#registrationComplete").show()}),u.attr("disabled",!1),u.attr("value","Register")}})}else r.addClass("invalid"),u.attr("disabled",!1)}),h.click(function(t){if(t.preventDefault(),o.hide(),f=n("#txtLoginEmail"),e=n("#txtLoginPassword"),f.isValid(!0)?f.removeClass("invalid"):f.addClass("invalid"),e.isValid()?e.removeClass("invalid"):e.addClass("invalid"),f.isValid(!0)&&e.isValid()){h.attr("value","Please Wait...");var r={username:f.val(),password:e.val()},i=JSON.stringify(r);n.ajax({type:"POST",url:"/WebServices/UserService.asmx/Authenticate",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){n.d!=""?a(n.d,"/my-aston-martin"):(o.show(),h.attr("value","Login"))}})}})}function a(n,t){var i=v("iFrame");i.load(function(){window.location.href=t}),i.attr("src",n)}function v(t){var i='<iframe id="'+t+'" name="'+t+'" style="position:absolute; top:-9999px; left:-9999px"';return window.ActiveXObject&&(i+=' src="javascript:false"'),i+=" />",n(i).appendTo(document.body),n("#"+t)}function y(){i.find("#txtLoginEmail").attr("placeholder","Email Address"),i.find("#txtLoginPassword").attr("placeholder","Password"),r.attr("placeholder","Email Address"),Modernizr.input.placeholder||(i.find("#txtLoginEmail").attr("value","Email Address"),i.find("#txtLoginPassword").attr("value","Password"),r.attr("value","Email Address"))}var c=this,l={__id:t},w=c.w,s,i,h,u,f,e,r,o;c.register(l),l.init=function(){(s=n("#AccountHyperLink"),s.length==0||n("#main").hasClass("store"))||(i=n("#LoginOrRegisterPanel"),h=i.find("#btnLogin"),u=i.find("#btnRegister"),r=i.find("#txtRegisterEmail"),o=i.find("#invalid-message"),p())}}.apply(aston,[jQuery,"login"]),function(n,t){function v(){e.live("click",function(){return aston.w.trigger("am.notification.close",[n(this)]),!1}),o.live("click",function(){return aston.w.trigger("am.notification.click",[n(this)]),!1});i.find(".btn-close").on("click",function(){return aston.w.trigger("am.cookies.click"),!1});n("a.delete-cookie").live("click",function(){var i=n(this),t=i.data("cookie");return l(t),!0})}function a(){aston.w.bind("am.cookies.click",function(){i.fadeOut("fast",function(){f("AmlCookiePolicy","true",30)})}),aston.w.bind("am.notification.get",function(){var t,u,i;r.hasClass("home")&&(t=n("#logo, .logo"),t.length!=0)&&(u=t.data("culture"),i=JSON.stringify({uiCulture:u}),n.ajax({type:"POST",url:"/Webservices/UserService.asmx/GetTranlsationHtmlForUserLocation",contentType:"application/json; charset=utf-8",data:i,dataType:"json",success:function(n){n.d&&n.d.length>1&&r.first().before(n.d)}}))}),aston.w.bind("am.notification.close",function(){n(".translation-notification").fadeOut("fast")}),aston.w.bind("am.notification.click",function(t,i){var f=i.attr("href"),u=i.data("countrycode"),r=JSON.stringify({cultureCode:u});n.ajax({type:"POST",url:"/Webservices/UserService.asmx/WriteUserPreferencesCookie",contentType:"application/json; charset=utf-8",data:r,dataType:"json"}).done(function(){window.location.href=f})})}function f(n,t,i){var u,r;i?(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString()):u="",document.cookie=n+"="+t+u+"; path=/"}function c(n){for(var u=n+"=",r=document.cookie.split(";"),t,i=0;i<r.length;i++){for(t=r[i];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(u)==0)return t.substring(u.length,t.length)}return null}function l(n){document.cookie=n+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}var s=this,h={__id:t},y=s.w,r,u,o,e,i;s.register(h),h.init=function(){r=n("#main, #tiles"),u=n(".translation-notification"),o=u.find(".visit"),e=u.find(".btn-close"),i=n("#cookieheader"),v(),a(),c("AmlCookiePolicy")||i.fadeIn("fast",function(){f("AmlCookiePolicy","true",30)}),aston.w.trigger("am.notification.get")}}.apply(aston,[jQuery,"notifications"]),function(n,t){function h(){this.init()}function e(){this.triggers()}function i(){n(".feed").length>0||this.triggers()}function r(){this.triggers()}function c(t){var u={youtube:{matcher:/(youtube\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed)?([\w-]{11}|\?listType=(.*)&list=(.*)).*/i,params:{autoplay:1,autohide:1,fs:1,rel:0,hd:1,wmode:"opaque",enablejsapi:1},url:"//www.youtube.com/embed/$3"},vimeo:{matcher:/(?:vimeo(?:pro)?.com)\/(?:[^\d]+)?(\d+)(?:.*)/,params:{autoplay:1,hd:1,show_title:1,show_byline:1,show_portrait:0,color:"",fullscreen:1},url:"//player.vimeo.com/video/$1"}},f,i,r,e=function(t,i,r){return r=r||"",n.type(r)==="object"&&(r=n.param(r,!0)),n.each(i,function(n,i){t=t.replace("$"+n,i||"")}),r.length&&(t+=(t.indexOf("?")>0?"&":"?")+r),t};for(f in u)if(i=u[f],r=t.match(i.matcher),r){t=e(i.url,r,i.params);break}return t}function u(){this.triggers()}function f(){n(".news-page").length>0||this.triggers()}var o=this,s={__id:t},l=o.w;o.register(s),s.init=function(){new f,new u,new i,new e,new r,new h},h.prototype.init=function(){n(".fancybox").fancybox({padding:0,openMethod:"changeIn",openSpeed:"slow"})},e.prototype.triggers=function(){var t=this;n(".view-magazine").live("click",function(){var o=n(this),e=o.data("content"),r=_.uniqueId("full-screen_"),h={Id:r},s=n("#fullScreenTemplate").tmpl(h);n("body").append(s);var i=n("#"+r),t=i.find("iframe"),f=aston.w.height(),u=aston.w.width();return n.fancybox.open(i,{padding:[38,0,0,20],wrapCSS:"full-screen-content",openMethod:"changeIn",openSpeed:"slow",autoSize:!1,beforeLoad:function(){this.width=u,this.height=f},afterShow:function(){t.load(function(){setTimeout(function(){i.find("#loader").fadeOut("fast",function(){t.fadeIn("slow")})},1e3)}),t.attr({width:aston.w.width()-85,height:aston.w.height()-80,src:e})},afterClose:function(){i.remove()},onUpdate:function(){var i=aston.w.width(),n=aston.w.height();setTimeout(function(){this.width=i,this.height=n},1),t.attr({width:i-85,height:n-80})}}),!1})},i.prototype.triggers=function(){var t=this;n("a.external-content-link").live("click",function(){var s=n(this),u=s.data("content"),r=u.indexOf("http")!==-1;if(r&&aston.ie&&aston.ie<10){window.open(u,"","");return}var f=_.uniqueId("full-screen_"),h={Id:f},c=n("#fullScreenTemplate").tmpl(h);n("body").append(c);var i=n("#"+f),o=aston.w.height(),e=aston.w.width();return n.fancybox.open(i,{padding:[38,0,0,20],wrapCSS:"full-screen-content",openMethod:"changeIn",openSpeed:"slow",autoSize:!1,beforeLoad:function(){this.width=e,this.height=o},afterShow:function(){n.ajax({type:"POST",url:"/Webservices/SocialFeedWS.asmx/GetMagazineContent",contentType:"application/json; charset=utf-8",data:JSON.stringify({url:u}),dataType:"json",success:function(n){var f=i.find("iframe"),u=i.find("#container"),e=t.displayContent(n,r,f,u);e.done(function(){i.find("#loader").fadeOut("fast",function(){r?f.fadeIn("slow"):u.fadeTo(1,"slow")})})}})},afterClose:function(){i.remove()}}),!1})},i.prototype.displayContent=function(t,i,r,u){var f=this;return n.Deferred(function(n){var o,e,h,s;i?(r.attr({width:aston.w.width()-85,height:aston.w.height()-80}),o=r[0],e=o.document,o.contentDocument?e=o.contentDocument:o.contentWindow&&(e=o.contentWindow.document),e.open(),e.writeln(t.d),e.close(),n.resolve()):(u.append(t.d),u.css({height:aston.w.height()-80,width:aston.w.width()-85}),h=u.find("figure").find("img").attr("src"),s=f.loadImages([h]),s.done(function(){f.centerElement(u.find("img"),!0,!0),f.centerElement(u.find("article"),!0,!1),setTimeout(function(){n.resolve()},500)}))}).promise()},i.prototype.loadImages=function(t){var f=n.Deferred(),r,u,i;for(t.length===0&&f.resolve(),u=t.length,i=0;i<t.length;i++)r=new Image,r.onload=function(){--u,u===0&&f.resolve()},r.src=t[i];return f.promise()},i.prototype.centerElement=function(n,t,i){var u=n.height(),f=n.width(),r={};t&&(r.marginTop=Math.abs(u/2)*-1),i&&(r.marginLeft=Math.abs(f/2)*-1),n.css(r)},r.prototype.triggers=function(){var t=this;n("a.view-video").live("click",function(){var e=n(this),f=e.data("video"),i,r;if(f){var u=_.uniqueId("video-popup-"),o={Id:u,VideoUrl:f},s=n("#videoIframeTemplate").tmpl(o);n("body").append(s),i=n("#"+u),r=t.getPopupSize(),n.fancybox.open(i,{padding:0,wrapCSS:"video-popup",openMethod:"changeIn",openSpeed:"slow",autoSize:!1,beforeLoad:function(){this.width=parseInt(r.width),this.height=parseInt(r.height)},afterShow:function(){var r=i.find("iframe"),u,n;r.attr("src")===""&&(u=r.data("url"),n=t.getPopupSize(),r.attr({src:c(u),width:n.width,height:n.height}))},afterClose:function(){setTimeout(function(){i.remove()},300)}})}return!1})},r.prototype.getPopupSize=function(){var r=n("body").find(".container").last(),t=r.width(),i=t/2;return{width:t,height:t<=450?t/1.5:i}},u.prototype.triggers=function(){var t=this;n("a.view-video-gallery").live("click",function(){var u=n(this),o=u.data("video"),e=u.data("title"),f=_.uniqueId("video-popup-"),s={Id:f,VideoUrl:o,Title:e,Type:"normal"},h=n("#videoPopupTemplate").tmpl(s),r,i;return n("body").append(h),r=n("#"+f),i=t.getPopupSize(),n.fancybox.open(r,{padding:0,wrapCSS:"video-popup",openMethod:"changeIn",openSpeed:"slow",autoSize:!1,beforeLoad:function(){this.width=parseInt(i[0]),this.height=parseInt(i[1])},afterShow:function(){aston.plugins.youtubeplayer.createPlayer(r)},afterClose:function(){aston.plugins.youtubeplayer.unload(r),setTimeout(function(){r.remove()},500)},onUpdate:function(){i=t.getPopupSize(),this.width=parseInt(i[0]),this.height=parseInt(i[1])}}),!1})},u.prototype.getPopupSize=function(){var n={xlarge:[1490,570],large:[1163,445],medium:[1053,403],small:[922,360]};return n[aston.theme]},f.prototype.triggers=function(){n("a.view-gallery").live("click",function(){var r,t,i;if(n("body").addClass("gallery-controls"),r=n(this),t=r.data("category"),t!=""&&t.length!=0)return i=JSON.stringify({categoryItem:t}),n.ajax({type:"POST",url:"/WebServices/ImageService.asmx/GetImageUrlsForCategory",contentType:"application/json; charset=utf-8",data:i,dataType:"json",success:function(t){if(t.d){var i=n.map(t.d,function(n){return{href:n}});n.fancybox.open(i,{openEffect:"none",padding:0,helpers:{title:null}})}}}),!1})}}.apply(aston,[jQuery,"cta"]),function(n,t){function u(n){this.$el=n,this.init()}function f(n){this.$el=n,this.interval=8e3,this.init()}function h(n){this.$el=n,this.$slider=null,this.init()}function e(n){this.$el=n,this.init()}var s=this,c={__id:t},o=s.w,i,r;s.register(c),i=n("header"),r=n("#panelNotification"),c.init=function(){var t=n(".royalSlider");n.each(t,function(t,i){var r=n(i),o=r.data("type");switch(o){case"full":new e(r);break;case"generic":new f(r);break;case"content":new h(r);break;default:new u(r)}})},u.prototype.init=function(){var n=this;n.$el.addClass("default");var t=n.$el.data(),i=!0,r=!0;t&&t.calculate&&(i=!1,n.heightBasedOn=t.calculate,t.padding&&(n.padding=t.padding)),t&&t.hideArrows&&(r=!1),n.$el.royalSlider({autoScaleSlider:i,imageScalePadding:0,slidesSpacing:0,loop:!0,usePreloader:!0,imageScaleMode:"fill",arrowsNav:r,controlNavigation:"bullets"}),n.$slider=n.$el.data("royalSlider"),i||(o.bind("am.theme",function(){setTimeout(function(){n.updateSize()},300)}),setTimeout(function(){n.updateSize()},300))},u.prototype.updateSize=function(){var i=this,r;if(i.heightBasedOn){var e=i.$el.find(i.heightBasedOn),t=0,u,f,o=i.padding||0;for(r=0;r<e.length;r++)f=e[r],f&&(u=n(f).outerHeight(),u>t&&(t=u));t=t+o,i.$el.css("height",t),i.$el.find(".rsOverflow").css("height",t)}},f.prototype.init=function(){var t=this,i=!1;t.$el.addClass("generic"),t.$el.royalSlider({autoScaleSlider:!0,imageScalePadding:0,slidesSpacing:0,loop:!0,usePreloader:!0,imageScaleMode:"fill"}),t.$slider=t.$el.data("royalSlider"),t.$el.append('<div class="track"><div class="progress"></div></div><div class="stop"></div>'),t.$progress=t.$el.find(".progress");t.$slider.ev.on("rsBeforeAnimStart",function(){i||(t.updateProgress(),window.clearTimeout(t.timer),t.timer=window.setTimeout(function(){t.$slider.next()},t.interval))});t.$slider.ev.on("rsSlideClick",function(){window.clearTimeout(t.timer),t.$progress.stop()});t.$el.find(".stop").live("click",function(){var r=n(this);r.hasClass("play")?(r.removeClass("play"),i=!1,window.clearTimeout(t.timer),t.updateProgress(),t.timer=window.setTimeout(function(){t.$slider.next()},t.interval)):(r.addClass("play"),i=!0,window.clearTimeout(t.timer),t.$progress.stop().hide())}),t.$el.parent().find(".loader").hide(),t.timer=window.setTimeout(function(){t.$slider.next()},t.interval),t.updateProgress()},f.prototype.updateProgress=function(){var n=this;n.$progress.show().css("width",0).stop().animate({width:n.$el.width()},n.interval,"linear")},h.prototype.init=function(){var n=this,t;if(n.$el.royalSlider({autoHeight:!0,arrowsNav:!1,fadeinLoadedSlide:!1,controlNavigationSpacing:0,controlNavigation:"tabs",imageScaleMode:"none",imageAlignCenter:!1,loop:!1,loopRewind:!0,numImagesToPreload:6,keyboardNavEnabled:!0,usePreloader:!1}).show(),n.$el.prepend(n.$el.find(".rsNav")),t=n.$el.data("royalSlider").numSlides,t)switch(t){case 4:n.$el.addClass("four-cols");break;case 3:n.$el.addClass("three-cols");break;case 2:n.$el.addClass("two-cols")}},e.prototype.init=function(){var t=this;t.updateSize(),t.$el.royalSlider({autoScaleSlider:!1,autoHeight:!1,imageScalePadding:0,slidesSpacing:0,loop:!0,usePreloader:!0,imageScaleMode:"fill",autoPlay:{enabled:!0,pauseOnHover:!1,delay:7e3}}).show(),o.bind("resize",function(){t.updateSize()}),n(".loader").hide()},e.prototype.updateSize=function(){var f=o.height(),e=i&&i.length?i.height():0,t=r&&r.length?r.height():0,u=f-e-t;n("#main").css("height",u)}}.apply(aston,[jQuery,"sliders"]),function(n,t){function a(){u.on("click",function(){var i=n(this),o=i.data("id"),f,t;return i.hasClass("on")?r():(u.removeClass("on"),t=v.filter("[data-id="+o+"]").clone(),f=i.parents(".row").find(".stage"),f.children().length?(f.empty().append(t),t.fadeIn("fast",function(){e(t,i)})):(r(),t.appendTo(f).slideDown("fast",function(){e(t,i)})),i.addClass("on")),!1});i.find(".close").live("click",function(){return r(),!1});o.on("click",function(t){var i,u,e;if(t.preventDefault(),i=n(this),u=i.data("category"),!i.hasClass("on"))return u=="all"?f.find("a").animate({opacity:1},600,function(){r()}):(e=f.find("a").filter(function(){var t=n(this),i=t.data("category").split(/\s+/);if(n.inArray(u,i)>-1)return t}),f.find("a").stop().animate({opacity:.3},200,function(){e.stop().animate({opacity:1},100,function(){r()})})),o.removeClass("on"),i.addClass("on"),!1})}function e(n,t){y(n),c(n,t),l(n)}function l(t){var i=t.find(".accordion");n.each(i,function(t,i){var u=n(i),r=u.find(".item-header"),f=u.find(".item-content");r.on("click",function(){var t=n(this),i=t.parents(".item").find(".item-content");return t.hasClass("on")?i.slideUp("fast",function(){t.removeClass("on")}):n.when(f.slideUp("fast")).then(function(){r.removeClass("on"),i.slideDown("fast",function(){t.addClass("on")})}),!1})})}function c(t,i){var u=n(".cars").position().left,r=i.position().left;r=r+i.parent().width()/2+4.5-u,t.find(".arrow").css("margin-left",r).fadeIn("fast")}function r(){i.find(".vehicle-content").slideUp("fast",function(){n(this).remove()}),u.removeClass("on")}function y(t){t.find("#tabContent").tabs({active:1,beforeActivate:function(t,i){var r=n(i.newPanel),f;if(r.hasClass("carousel")){if(r.find(".halfCarousel").length==0){var e=r.parents("#tabContent").data("images"),u=r.find(".carousel-wrap"),o=JSON.stringify({itemId:e});n.ajax({type:"POST",url:"/Webservices/CarouselService.asmx/GetCarouselHtml",contentType:"application/json; charset=utf-8",data:o,dataType:"json",success:function(n){n.d&&(u.hide().empty().html(n.d),aston.plugins.carousel.init(u),u.fadeIn("fast"))}})}}else r.hasClass("video")&&r.find(".video-wrapper").length==0&&(f={Id:_.uniqueId("video-popup-"),VideoUrl:r.parents("#tabContent").data("video"),Title:r.parents("#tabContent").data("title"),Type:"half"},n("#videoPopupTemplate").tmpl(f).appendTo(r),aston.plugins.youtubeplayer.createPlayer(r.find(".video-wrapper")))}}),t.find("#tabContent").tabs({active:0})}var s=this,h={__id:t},p=s.w;s.register(h);var i=n(".cars"),f=i.find(".row").find("li"),u=i.find(".row").find("a"),v=n(".vehicle-content"),o=n(".filters").find("a");h.init=function(){i.length&&a()}}.apply(aston,[jQuery,"cars"]),aston=aston||{},aston.news=function(){function a(){n=$("#main.news"),n.find(".tags").show(),n.find(".featured").hide(),n.find(".sfnewsList").css("visibility","visible").hide().fadeIn("slow"),n.find(".tags").find("ul").prepend('<li class="sftaxonItem"><a class="sftaxonLink" href="'+window.location.origin+window.location.pathname+'">All</a></li>')}function p(){n=$("#main.news"),l=$(".sfnewsTitle"),f=n.find(".sf_2cols_1_25"),o=n.find(".side-navigation"),s=f.find(".tags"),h=n.find(".featured"),u=$(".sfnewsContent").find(".download"),t=$(".side-navigation").find(".downloads"),f.prepend(o.show()),h.show(),s.hide(),u.length?t.append(u):t.find("ul").length==0&&t.hide(),n.find(".sfnewsDetails").css("visibility","visible").hide().fadeIn("slow",function(){e()}),y(),c()}function y(){$("#facebook").on("click",function(){return aston.w.trigger("am.news.share",["facebook",i(),r()]),!1});$("#twitter").on("click",function(){return aston.w.trigger("am.news.share",["twitter",i(),r()]),!1});$("#linkedin").on("click",function(){return aston.w.trigger("am.news.share",["linkedin",i(),r()]),!1});$("#googleplus").on("click",function(){return aston.w.trigger("am.news.share",["googleplus",i(),r()]),!1})}function c(){aston.w.bind("am.theme",function(){e()}),aston.w.bind("am.news.share",function(n,t,i,r){var f,u,o=encodeURIComponent("//az9255.vo.msecnd.net/icons/2d-wings.jpg"),e;switch(t){case"facebook":f=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=548,height=325");break;case"twitter":f=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=575,height=440");break;case"linkedin":f=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=520,height=570");break;case"googleplus":f=window.open("about:blank",aston.ie?"":"Aston Martin","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")}e=aston.generic.getBitlyUrl(i),e.done(function(n){switch(t){case"facebook":u="http://www.facebook.com/sharer.php?s=100&p[title]="+r+"&p[url]="+n+"&p[images][0]="+o+"&p[summary]="+r,f.location.replace(u);break;case"twitter":u="http://twitter.com/?status="+n+" via @astonmartin",f.location.replace(u);break;case"linkedin":u="http://www.linkedin.com/shareArticle?mini=true&url="+n+"&title="+r+"&summary="+r+"&source=Aston%20Martin",f.location.replace(u);break;case"googleplus":u="https://plus.google.com/share?url="+n,f.location.replace(u)}})})}function e(){var r=n.find("iframe").filter(function(){return/youtube/.test(this.src)}),i,t;r&&$.each(r,function(n,r){i=$(r),t=aston.generic.getContentSize(i,v.contentRatio),i.attr({width:t.width,height:t.height})})}function i(){return encodeURIComponent(window.location.href)}function r(){return $(".sfnewsTitle").text().trim()}var n,l,f,o,s,h,u,t,v={contentRatio:1.87};return{initListView:a,initSingleView:p}}(),aston=aston||{},aston.blog=function(){function h(){n=$("#main.blog"),n.find(".sftaxonHorizontalList").prepend('<li class="sftaxonItem"><a class="sftaxonLink" href="'+f()+'">All</a></li>'),n.find(".sfpostsList").css("visibility","visible").hide().fadeIn("slow",function(){$('<div class="clearfix" />').insertAfter($(".sfpostsList").find(".sfpostListItem:nth-child(3n)")),aston.subnavFix()})}function f(){var r=window.location.pathname.split("/"),i=r.splice(0,r.length-3),n,t;if(i.length>2)for(n=window.location.origin,t=0;t<i.length;t++)n+=i[t]+"/";else n=window.location.origin+window.location.pathname;return n}function l(){n=$("#main.blog"),o=n.find(".tags"),t=n.find(".sfpostTitle"),n.find(".page-title").hide(),n.find(".sftaxonHorizontalList").hide(),t.append(n.find(".sfpostAuthorAndDate")),t.append(n.find(".share").clone()),t.append(n.find(".sfpostLinksWrp")),t.append(n.find(".tags")),n.find(".sfpostDetails").css("visibility","visible").hide().fadeIn("slow",function(){$(window).trigger("resize"),u(),aston.subnavFix()}),c(),e()}function c(){$("#facebook").on("click",function(){return aston.w.trigger("am.news.share",["facebook",r(),i()]),!1});$("#twitter").on("click",function(){return aston.w.trigger("am.news.share",["twitter",r(),i()]),!1});$("#linkedin").on("click",function(){return aston.w.trigger("am.news.share",["linkedin",r(),i()]),!1});$("#googleplus").on("click",function(){return aston.w.trigger("am.news.share",["googleplus",r(),i()]),!1})}function u(){var r=n.find("iframe").filter(function(){return/youtube/.test(this.src)}),i,t;r&&$.each(r,function(n,r){i=$(r),t=aston.generic.getContentSize(i,s.contentRatio),i.attr({width:t.width,height:t.height})})}function e(){aston.w.bind("am.theme",function(){u()}),aston.w.bind("am.news.share",function(n,t,i,r){var f,u,o=encodeURIComponent("//az9255.vo.msecnd.net/icons/2d-wings.jpg"),e;switch(t){case"facebook":f=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=548,height=325");break;case"twitter":f=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=575,height=440");break;case"linkedin":f=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=520,height=570");break;case"googleplus":f=window.open("about:blank",aston.ie?"":"Aston Martin","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")}e=aston.generic.getBitlyUrl(i),e.done(function(n){switch(t){case"facebook":u="http://www.facebook.com/sharer.php?s=100&p[title]="+r+"&p[url]="+n+"&p[images][0]="+o+"&p[summary]="+r,f.location.replace(u);break;case"twitter":u="http://twitter.com/?status="+n+" via @astonmartin",f.location.replace(u);break;case"linkedin":u="http://www.linkedin.com/shareArticle?mini=true&url="+n+"&title="+r+"&summary="+r+"&source=Aston%20Martin",f.location.replace(u);break;case"googleplus":u="https://plus.google.com/share?url="+n,f.location.replace(u)}})})}function r(){return encodeURIComponent(window.location.href)}function i(){return $(".sfnewsTitle").text().trim()}var n,t,o,s={contentRatio:1.87};return{initListView:h,initSingleView:l}}(),function(n,t){function u(t){var r=n(t),i=r.find(".item-header"),u=r.find(".item-content");i.on("click",function(){var t=n(this),r=t.parents(".item").find(".item-content");return t.hasClass("on")?r.slideUp("fast",function(){t.removeClass("on")}):n.when(u.slideUp("fast")).then(function(){i.removeClass("on"),r.slideDown("fast",function(){t.addClass("on")})}),!1})}var r=this,i={__id:t},f=r.w;r.register(i),i.init=function(){var t=n(".accordion");n.each(t,function(n,t){new u(t)})}}.apply(aston,[jQuery,"accordion"]),function(n,t){function f(){this.$nav=e,this.init()}function i(){this.$sideNav=r,this.$topNav=e,this.$links=r.find("a"),this.$start=u.filter(".start"),this.$end=u.filter(".end"),this.init(),this.triggers(),this.updateNavigationPosition()}var s=this,o={__id:t},h=s.w;s.register(o);var u=n(".waypoint"),e=n("#page-nav"),r=n("#side-nav");o.init=function(){u.length&&new f,r.length&&new i,n.waypoints.settings.scrollThrottle=30},f.prototype.init=function(){var n=this;u.filter(".start").first().waypoint({handler:function(t){t=="down"?(n.$nav.addClass("navbar-fixed-top").find("img").addClass("on"),r.addClass("on")):(n.$nav.removeClass("navbar-fixed-top").find("img").removeClass("on"),r.removeClass("on"))},offset:0})},i.prototype.init=function(){this.$sideNav.css("right",-this.$sideNav.outerWidth()),n("body").addClass("sticky-navigation"),n(".waypoint.end").prev().find(".apl-hr-right, .apl-hr-left").remove()},i.prototype.triggers=function(){var t=this;t.$links.on("click",function(){var r=n(this),i=t.getScrollToPosition(r);return i&&n("html,body").animate({scrollTop:i},500),!1});t.$start.waypoint(function(i){i=="down"&&t.updateMenuPosition(n(this).data("section"))}),t.$end.waypoint(function(i){i=="up"&&t.updateMenuPosition(n(this).data("section"))}),n(window).resize(function(){t.updateNavigationPosition()})},i.prototype.updateMenuPosition=function(t){var i=this,r=i.$links.filter(function(){return n(this).attr("href")==t});r.length?(i.$links.removeClass("on"),r.addClass("on")):i.$links.removeClass("on")},i.prototype.updateNavigationPosition=function(){this.$sideNav.css("margin-top",-(this.$sideNav.outerHeight()/2))},i.prototype.getScrollToPosition=function(t){var u=this,e=t.attr("href"),i=n(e),o=u.$topNav.outerHeight(),r,f=15;return i.length?(r=i.offset().top,r+o+f):!1}}.apply(aston,[jQuery,"navigation"]),function(n,t){function r(t,i,r){this.elements={$container:t,$video:t.find("#video")},this.type=typeof t.attr("data-type")!="undefined"?t.attr("data-type"):"normal",this.videoURL=t.data("video"),this.videoTitle=t.data("title"),this.currentTime=0,this.updateInfoInterval=0,this.chromeless=!0,this.atts={id:"player"+f},this.onPlay=typeof i=="function"?i:n.noop,this.onFinish=typeof r=="function"?r:n.noop,this.updateUI(),this.loadPlayer()}function l(t,i){var r=n('<div id="sharePopup"><input name="shareContent" id="shareContent"><a href="#" class="btn-close-white btn-close">'+aston.generic.getTranslatedText(aston.language,"videoplayer","sharePopupCloseText")+'</a><div class="arrow"></div></div>');return r.find("input").val(t).focus(function(){this.select()}),r.find("a.btn-close").click(function(){return i.find("#sharePopup").remove(),i.find("div.video-controls").removeClass("link-popup embed-popup"),i.removeClass("hasOverlay"),!1}),r}function o(n){var t=n.split("v=")[1].split("&")[0];return t.length>0?t:!1}function s(n){var t=_.filter(u.players,function(t){return t.atts.id==n});return t&&t.length>0?t[0]:null}var c=this,u={__id:t},e=c.w,f,a,h;c.register(u),u.players=[],f=0,a={allowScriptAccess:"always",wmode:"transparent"},u.init=function(){var t=n(".video-wrapper");n.each(t,function(t,i){u.players.push(new r(n(i))),f++})},r.prototype.loadPlayer=function(){var t=this,s=n('<div class="video-controls"><a href="#" class="play">'+aston.generic.getTranslatedText(aston.language,"videoplayer","playAnchorText")+'</a><div class="video-info"><div class="status"><div class="bar"><div class="loaded"></div><span class="playHead"></span></div></div></div></div>'),e=n('<a class="twitter" href="http://twitter.com/home?status='+t.videoTitle+": "+t.videoURL+'" title="'+aston.generic.getTranslatedText(aston.language,"videoplayer","twitterTitleText")+'" target="_blank">'+aston.generic.getTranslatedText(aston.language,"videoplayer","twitterAnchorText")+'</a><a class="facebook" href="http://www.facebook.com/sharer.php?u='+encodeURI(t.videoURL)+"&t="+t.videoTitle+'" title="'+aston.generic.getTranslatedText(aston.language,"videoplayer","facebookTitleText")+'" target="_blank">'+aston.generic.getTranslatedText(aston.language,"videoplayer","facebookTitleText")+"</a>"),u=n('<a class="link" href="#">'+aston.generic.getTranslatedText(aston.language,"videoplayer","linkAnchorText")+'</a><a class="embed" href="#">'+aston.generic.getTranslatedText(aston.language,"videoplayer","embedAnchorText")+"</a>"),f=n('<a class="fullscreen" href="#" title="Play video fullscreen">'+aston.generic.getTranslatedText(aston.language,"videoplayer","fullscreenOffAnchorText")+"</a>"),r=n('<a class="playButton">'+aston.generic.getTranslatedText(aston.language,"videoplayer","playAnchorText")+"</a>"),h=n('<a href="#" class="btn-close">'+aston.generic.getTranslatedText(aston.language,"videoplayer","closeAnchorText")+"</a>"),i=t.getVideoSize();s.append(e).append(u).append(f),t.elements.$container.append(r),aston.mobileWebkit||swfobject.getFlashPlayerVersion().major!==0?(t.elements.$container.html('<iframe id="'+t.atts.id+'" type="text/html" width="'+i[0]+'" height="'+i[1]+'" src="//www.youtube.com/embed/'+o(t.videoURL)+'?enablejsapi=1&origin=http://www.astonmartin.com" frameborder="0"></iframe>'),t.chromeless=!1):t.elements.$container.html('<br><br><br><br><br><h1>Please install <a href="http://get.adobe.com/flashplayer/">Adobe Flash Player</a> to view videos on the Aston Martin website.</h1>'),t.elements.$container.html('<iframe id="'+t.atts.id+'" type="text/html" width="'+i[0]+'" height="'+i[1]+'" src="//www.youtube.com/embed/'+o(t.videoURL)+'?enablejsapi=1&origin=http://www.astonmartin.com" frameborder="0"></iframe>'),t.listeners(),t.triggers()},r.prototype.updateUI=function(){var n=this;n.type=="half"&&n.elements.$container.addClass("half"),n.type=="home"&&n.elements.$container.addClass("home"),this.contentWidth=n.elements.$container.width(),this.contentHeight=n.elements.$container.height()},r.prototype.listeners=function(){var t=this,i=t.ytPlayer;aston.w.bind("am.videoplayer.play.click."+t.atts.id,function(n,i){t.elements.$container.find(".playButton").hide(),i.hasClass("playing")?(i.removeClass("playing").addClass("paused"),t.pauseVideo()):(i.removeClass("paused").addClass("playing"),t.playVideo())}),aston.w.bind("am.videoplayer.link.click."+t.atts.id,function(){var i=l(document.location.href,t.elements.$container);t.elements.$videoControls.find("#sharePopup").remove(),t.elements.$videoControls.append(i).addClass("popup-open link-popup"),t.elements.$container.addClass("hasOverlay")}),aston.w.bind("am.videoplayer.embed.click."+t.atts.id,function(){var i=l(t.ytPlayer.getVideoEmbedCode(),t.elements.$container);t.elements.$videoControls.find("#sharePopup").remove(),t.elements.$videoControls.append(i).addClass("embed-popup"),t.elements.$container.addClass("hasOverlay")}),aston.w.bind("am.videoplayer.mouseenter."+t.atts.id,function(){t.elements.$container.hasClass("hasOverlay")||t.elements.$videoControls.stop().animate({height:62,avoidTransforms:!0,queue:!1},250)}),aston.w.bind("am.videoplayer.mouseleave."+t.atts.id,function(){t.elements.$container.hasClass("hasOverlay")||t.elements.$videoControls.stop().animate({height:0,avoidTransforms:!0,queue:!1},400)}),aston.w.bind("am.videoplayer.status.click."+t.atts.id,function(n,i,r){var o=t.ytPlayer.getDuration(),s=r-i.offset().left,e=i.width(),u=s/e,f=o*u;t.seekToPosition(f)}),aston.w.bind("am.videoplayer.fullscreen.click."+t.atts.id,function(i,r){var f=t.elements.$video,u=t.elements.$container,s=t.elements.$videoControls,e=n(window).width(),o=n(window).height();r.hasClass("fullscreen-on")?(n(".video-wrapper").show(),r.removeClass("fullscreen-on"),r.text(aston.generic.getTranslatedText(aston.language,"videoplayer","fullscreenOffAnchorText")),r.attr("title",aston.generic.getTranslatedText(aston.language,"videoplayer","fullscreenOffTitleText")),u.removeAttr("style"),n("html").removeClass("fullscreen-video"),t.isFullScreen=!1,u.find(".btn-close").hide(),f.attr({width:t.contentWidth,height:t.contentHeight})):(n(".video-wrapper").not(t.elements.$container).hide(),u.find(".playButton").hide(),r.addClass("fullscreen-on"),r.text(aston.generic.getTranslatedText(aston.language,"videoplayer","fullscreenOnAnchorText")),r.attr("title",aston.generic.getTranslatedText(aston.language,"videoplayer","fullscreenOnTitleText")),n("html").addClass("fullscreen-video"),t.isFullScreen=!0,u.find(".btn-close").show(),f.attr({width:e,height:o}))}),aston.w.bind("am.theme",function(){aston.windowLoaded&&setTimeout(function(){t.update()},0)})},r.prototype.triggers=function(){var t=this,r=t.elements.$container,i=t.elements.$videoControls;t.chromeless&&(i.find("a.play").click(function(){return aston.w.trigger("am.videoplayer.play.click."+t.atts.id,[n(this)]),!1}),r.find(".playButton").click(function(){return aston.w.trigger("am.videoplayer.play.click."+t.atts.id,[i.find("a.play")]),!1}),i.find("a.link").live("click",function(){return aston.w.trigger("am.videoplayer.link.click."+t.atts.id),!1}),i.find("a.embed").live("click",function(){return aston.w.trigger("am.videoplayer.embed.click."+t.atts.id),!1}),i.find("div.status").live("click",function(i){aston.w.trigger("am.videoplayer.status.click."+t.atts.id,[n(this),i.pageX])}),i.find("a.fullscreen").live("click",function(){return aston.w.trigger("am.videoplayer.fullscreen.click."+t.atts.id,[n(this)]),!1}),r.find(".btn-close").live("click",function(){return aston.w.trigger("am.videoplayer.fullscreen.click."+t.atts.id,[i.find("a.fullscreen")]),!1}),r.hover(function(){aston.w.trigger("am.videoplayer.mouseenter."+t.atts.id,[i])},function(){aston.w.trigger("am.videoplayer.mouseleave."+t.atts.id,[i])}),aston.w.resize(function(){var t;return function(){t&&clearTimeout(t),t=setTimeout(function(){var t,r,i;n("html").hasClass("fullscreen-video")&&(t=_.filter(u.players,function(n){return n.isFullScreen==!0}),t&&t.length>0&&(t=t[0],r=n(window).width(),i=n(window).height(),t.elements.$video.attr({width:r,height:i})))},500)}()}))},r.prototype.playVideo=function(){var r=this,n=r.ytPlayer,t;for(i=0;i<u.players.length;i++)t=u.players[i],t&&t.atts.id!=r.atts.id&&(t.pauseVideo(),t.elements.$videoControls.find(".play").hasClass("playing")&&t.elements.$videoControls.find(".play").removeClass("playing").addClass("paused"));n&&(n.playVideo(),r.updateInfoInterval===0&&(r.updateInfoInterval=window.setInterval(function(){var t,i;typeof n.getVideoBytesLoaded!="undefined"&&n.getVideoBytesLoaded()>-1&&(t=n.getVideoBytesLoaded()/n.getVideoBytesTotal()*100,t<=100&&r.elements.$loaded.css("width",t+"%")),typeof n.getCurrentTime!="undefined"&&n.getCurrentTime()>0&&(i=n.getCurrentTime()/n.getDuration()*100,r.elements.$playHead.css("width",i+"%"))},250)))},r.prototype.pauseVideo=function(){var t=this,n=t.ytPlayer;typeof n!="undefined"&&typeof n.pauseVideo=="function"&&n.pauseVideo()},r.prototype.seekToPosition=function(n){var i=this,t=i.ytPlayer;t&&t.seekTo(n,!0)},r.prototype.skipToPosition=function(n){var r=this,t=r.ytPlayer,i;t&&(i=Math.round(t.getDuration()*n),t.seekTo(i,!1))},r.prototype.onPlayerStateChange=function(t){var i=this,r;i.playerState=t[0],i.playerState===0&&(window.clearInterval(i.updateInfoInterval),n("html").hasClass("fullscreen-video")&&i.elements.$container.find(".btn-close").click(),typeof i.onFinish=="function"&&i.onFinish.call(i)),i.playerState===1&&(typeof i.onPlay=="function"&&i.onPlay.call(i),!initQualitySet&&i.ytPlayer&&(r=i.ytPlayer.getAvailableQualityLevels(),aston.theme==="xlarge"&&n.inArray("hd1080",r)>-1&&(i.ytPlayer.setPlaybackQuality("hd1080"),i.initQualitySet=!0)),i.elements.$videoControls.hasClass("paused")&&(i.elements.$videoControls.removeClass("paused").addClass("playing"),i.updateInfoInterval===0&&(i.updateInfoInterval=window.setInterval(updateProgressBar,250)))),i.playerState===2&&(i.elements.$videoControls.hasClass("playing")||!i.elements.$videoControls.hasClass("paused"))&&($player.elements.videoControls.removeClass("playing").addClass("paused"),i.updateInfoInterval=0),i.playerState==-1},r.prototype.onYouTubePlayerReady=function(){var t=this;t.ytPlayer=document.getElementById(t.atts.id),t.elements.$video=n("#"+t.atts.id),t.ytPlayer.addEventListener("onStateChange",h(function(){t.onPlayerStateChange(arguments)})),t.loadVideo(!1)},r.prototype.update=function(){var n=this,i=n.getVideoSize()[0],t=n.getVideoSize()[1];n.contentWidth=i,n.contentHeight=t,n.chromeless?n.elements.$video.attr({width:i,height:t}):n.elements.$container.find("iframe").attr({width:i,height:t})},r.prototype.loadVideo=function(){var n=this;n.ytPlayer&&(n.ytPlayer.cueVideoById(o(n.videoURL)),n.updateInfoInterval=0),n.elements.$container.find(".playButton").show(),n.elements.$container.find("#video-loading").hide()},r.prototype.getVideoSize=function(){var n=this,t={fullscreen:{xlarge:[e.width(),730],large:[e.width(),568],medium:[e.width(),436],small:[e.width(),372]},normal:{xlarge:[1490,570],large:[1163,445],medium:[1053,403],small:[922,360]},half:{xlarge:[745,365],large:[581,285],medium:[526,258],small:[461,226]},home:{xlarge:[n.elements.$container.width(),n.elements.$container.height()],large:[n.elements.$container.width(),n.elements.$container.height()],medium:[n.elements.$container.width(),n.elements.$container.height()],small:[n.elements.$container.width(),n.elements.$container.height()]}};return t[n.type][aston.theme]},h=function(n,t){var i="closureFake_"+((1+Math.random())*268435456|0).toString(16);return window[i]=function(){n.apply(t||window,arguments)},i},u.loadVideo=function(n,t,i,r){var u=s(n);u&&(u.videoURL=t,u.videoTitle=i,u.loadVideo(r),r&&(u.playVideo(),u.elements.$videoControls.find(".play").removeClass("paused").addClass("playing"),u.elements.$container.find(".playButton").hide()))},u.unload=function(n){var r=n.find("object"),t,i;r.length>0&&(t=s(r.attr("id")),t&&(typeof swfobject!="undefined"&&swfobject.removeSWF(t.atts.id),window.clearInterval(t.playInterval),window.clearInterval(t.updateInfoInterval),i=u.players.indexOf(t),i>-1&&u.players.splice(i,1)))},u.createPlayer=function(t,i,e){u.players.push(new r(n(t),i,e)),f++}}.apply(aston,[jQuery,"youtubeplayer"]),function(n,t){function h(){n(".register").on("click",function(){return u.toggle(),e.toggle(),!1});n(".toggle").on("click",function(){var t=n(this),i=t.data("mode");return t.hasClass("on")?!1:(t.addClass("active"),u.toggle(),e.toggle(),!1)})}function r(n,t){this.$form=n,this.isInitialised=!1,this.isActive=!0,this.redirectTo=this.$form.data("redirect")||f.redirectUrl,t&&this.init()}function i(n,t){this.$form=n,this.isInitialised=!1,this.isActive=!1,this.redirectTo=this.$form.data("redirect")||f.redirectUrl,t&&this.init()}var s=this,o={__id:t},c=s.w,u,e,f;s.register(o),f={redirectUrl:"/my-aston-martin"},o.init=function(){n("#login-form").length!=0&&(h(),u=new r(n("#login-form"),!0),e=new i(n("#signup-form"),!1))},r.prototype.init=function(){var n=this;n.$submit=n.$form.find("#btnLogin"),n.$required=n.$form.find(".requiredFields"),n.triggers(),n.styleForm(),n.isInitialised=!0},r.prototype.toggle=function(){var n=this;n.isActive?(n.$form.hide(),n.isActive=!1):(n.$form.show(),n.isActive=!0),n.isInitialised||n.init()},r.prototype.styleForm=function(){var r=this,t,u,n,i;Modernizr.input.placeholder||(t=r.$form.find("#txtLoginEmail"),u=t.attr("title"),t.attr("value",u),n=r.$form.find("#txtLoginPassword"),i=n.attr("title"),n.attr("value",i))},r.prototype.triggers=function(){var t=this;t.$submit.on("click",function(){var u;t.$submit.attr("disabled","disabled");var r=t.$form.find("#txtLoginEmail"),i=t.$form.find("#txtLoginPassword"),f=r.val().strip(),e=i.val().strip();return r.isValid()&&i.isValid()?(t.$submit.attr("value",aston.generic.getTranslatedText(aston.language,"forms","pleaseWait")),u={username:f,password:e},n.ajax({type:"POST",url:"/WebServices/UserService.asmx/Authenticate",data:JSON.stringify(u),contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){n.d?aston.generic.loginAndRedirect(n.d,t.redirectTo):(t.$submit.attr("disabled",!1).attr("value","Login"),t.$required.empty().html("<p>Incorrect username or password</p>"))}})):(t.$submit.attr("disabled",!1),n("html,body").animate({scrollTop:t.$required.offset().top},500),t.$required.empty().html("<p>"+aston.generic.getTranslatedText(aston.language,"forms","requiredFields")+"</p>"),r.isValid()?r.removeClass("invalid"):r.addClass("invalid"),i.isValid()?i.removeClass("invalid"):i.addClass("invalid")),!1});n(document).keypress(function(n){n.which==13&&t.isActive&&t.$submit.click()})},i.prototype.init=function(){var n=this;n.$submit=n.$form.find("#btnSignup"),n.$required=n.$form.find(".requiredFields"),n.triggers(),n.populateForm(),n.styleForm(),n.isInitialised=!0},i.prototype.toggle=function(){var n=this;n.isActive?(n.$form.hide(),n.isActive=!1):(n.$form.show(),n.isActive=!0),n.isInitialised||n.init()},i.prototype.styleForm=function(){var n=this;n.$form.find(":radio").wrap('<div class="radio"/>'),n.$form.find(".radio").dgStyle(),n.$form.find(":checkbox").wrap('<div class="checkbox"/>'),n.$form.find(".checkbox").dgStyle(),n.$submit.attr("value",aston.generic.getTranslatedText(aston.language,"forms","submit")),n.$form.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(aston.language,"forms","firstname")),n.$form.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(aston.language,"forms","lastname")),n.$form.find(".username").attr("placeholder",aston.generic.getTranslatedText(aston.language,"forms","username")),n.$form.find(".password").attr("placeholder",aston.generic.getTranslatedText(aston.language,"forms","password")).attr("title",aston.generic.getTranslatedText(aston.language,"forms","password")),n.$form.find(".passwordConfirm").attr("placeholder",aston.generic.getTranslatedText(aston.language,"forms","retypePassword")).attr("title",aston.generic.getTranslatedText(aston.language,"forms","retypePassword")),Modernizr.input.placeholder||(n.$form.find(".firstname").attr("value",aston.generic.getTranslatedText(aston.language,"forms","firstname")),n.$form.find(".lastname").attr("value",aston.generic.getTranslatedText(aston.language,"forms","lastname")),n.$form.find(".username").attr("value",aston.generic.getTranslatedText(aston.language,"forms","username")),n.$form.find(".password").attr("value",aston.generic.getTranslatedText(aston.language,"forms","password")).attr("title",aston.generic.getTranslatedText(aston.language,"forms","password")),n.$form.find(".passwordConfirm").attr("value",aston.generic.getTranslatedText(aston.language,"forms","retypePassword")).attr("title",aston.generic.getTranslatedText(aston.language,"forms","retypePassword")))},i.prototype.populateForm=function(){var t=this;n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/GetTitles",contentType:"application/json; charset=utf-8",data:{},dataType:"json",success:function(i){if(i){var u=n('<option value="0">'+aston.generic.getTranslatedText(aston.language,"forms","titleOption")+"</option>"),r=n.merge(u,n("#titleTemplate").tmpl(i.d));t.$form.find("#cmbTitle").append(r)}}})},i.prototype.triggers=function(){var t=this;t.$submit.on("click",function(){var l;t.$submit.attr("disabled","disabled");var h=t.$form.find("#cmbTitle"),e=t.$form.find("#txtFirstName"),o=t.$form.find("#txtLastName"),s=t.$form.find("#txtEmail"),i=t.$form.find("#txtPassword"),r=t.$form.find("#txtConfirmPassword"),c=h.val(),v=e.val().strip(),p=o.val().strip(),y=s.val().strip(),u=i.val().strip(),f=r.val().strip(),a=function(){return u!=""&&u.length>6&&f!=""&&f.length>6&&u==f?!0:!1};return a()&&c!=0&&e.isValid()&&o.isValid()?(t.$submit.attr("value","Submitting..."),l={Title:c,FirstName:v,LastName:p,NickName:"",AgeRange:0,Email:y,Password:u,NewsletterSubscribe:!1,OnlineStoreRegistration:!1},n.ajax({type:"POST",url:"/WebServices/UserService.asmx/CreateUser",data:JSON.stringify({request:l}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){i=i.d,i.Result?aston.generic.loginAndRedirect(i.LoginUrl,t.redirectTo):(t.$submit.attr("disabled",!1).attr("value","Submit"),n("html,body").animate({scrollTop:t.$required.offset().top},500),t.$required.empty().html("<p>Email address is already in use. Please sign in</p>"))}})):(t.$submit.attr("disabled",!1),n("html,body").animate({scrollTop:t.$required.offset().top},500),t.$required.empty().html("<p>Please enter all of the required fields</p>"),c==0?h.addClass("invalid"):h.removeClass("invalid"),e.isValid()?e.removeClass("invalid"):e.addClass("invalid"),o.isValid()?o.removeClass("invalid"):o.addClass("invalid"),s.isValid(!0)?s.removeClass("invalid"):s.addClass("invalid"),!i.isValid()||u.length<7?i.addClass("invalid"):i.removeClass("invalid"),!r.isValid()||f.length<7?r.addClass("invalid"):r.removeClass("invalid"),u!=f?(i.addClass("invalid"),r.addClass("invalid")):i.isValid()&&u.length>6&&r.isValid()&&f.length>6&&(i.removeClass("invalid"),r.removeClass("invalid"))),!1})}}.apply(aston,[jQuery,"signup"]),function(n,t){function rt(){aston.w.bind("am.share",function(n,t,i,r){var f,u,o=encodeURIComponent("//az9255.vo.msecnd.net/icons/2d-wings.jpg"),e;switch(t){case"facebook":f=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=548,height=325");break;case"twitter":f=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=575,height=440");break;case"linkedin":f=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=520,height=570");break;case"googleplus":f=window.open("about:blank",aston.ie?"":"Aston Martin","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")}e=aston.generic.getBitlyUrl(i),e.done(function(n){switch(t){case"facebook":u="http://www.facebook.com/sharer.php?s=100&p[title]="+r+"&p[url]="+n+"&p[images][0]="+o+"&p[summary]="+r,f.location.replace(u);break;case"twitter":u="http://twitter.com/?status="+n+" "+r,f.location.replace(u);break;case"linkedin":u="http://www.linkedin.com/shareArticle?mini=true&url="+n+"&title="+r+"&summary="+r+"&source=Aston%20Martin",f.location.replace(u);break;case"googleplus":u="https://plus.google.com/share?url="+n,f.location.replace(u)}})}),aston.w.bind("hashchange",function(){var i=n.bbq.getState();i&&i.event?d(i.event):i.filters?y(i.filters):y()})}function it(){i.find("#go-to").live("click",function(){return n("html,body").animate({scrollTop:n("#register").offset().top-20},500),!1}),i.find(".facebook").live("click",function(){return aston.w.trigger("am.share",["facebook",r(),f(n(this))]),!1}),i.find(".twitter").live("click",function(){return aston.w.trigger("am.share",["twitter",r(),f(n(this))]),!1}),i.find(".linkedin").live("click",function(){return aston.w.trigger("am.share",["linkedin",r(),f(n(this))]),!1}),i.find(".googleplus").live("click",function(){return aston.w.trigger("am.share",["googleplus",r(),f(n(this))]),!1}),i.find(".view").live("click",function(){return n.bbq.pushState({event:n(this).data("title")}),!1}),i.find(".back").live("click",function(){return n.bbq.removeState("event"),!1});i.find("#btnSearch").on("click",function(){var t={country:s.val(),type:o.val(),month:c.val()};return n.bbq.pushState({filters:t}),!1})}function f(n){return n.data("title")||"Aston Martin Event"}function r(){return encodeURIComponent(window.location.href)}function p(){n("#driveForm-Copy").remove(),n("#driveFormComplete-Copy").remove()}function y(t){w.show(),u.hide(),p(),n(".slider-wrap").show(),n(".toggle").show(),b.children().not(l).remove(),l.show();var i=k(t);i.done(function(i){var r={events:i.events};setTimeout(function(){l.hide(),n("#eventsTemplate").tmpl(r).appendTo(b),e&&i.filters&&(h.tmpl(i.filters.Countries).appendTo(s),h.tmpl(i.filters.Types).appendTo(o),h.tmpl(i.filters.Months).appendTo(c),e=!1),t&&(s.val(t.country),o.val(t.type),c.val(t.month)),aston.subnavFix()},500)})}function k(t){var r={events:[]};return n.Deferred(function(u){var f={category:i.data("category"),language:aston.language,country:t&&t.country||"",type:t&&t.type||"",month:t&&t.month||"",getFilters:e,showUpcomingEvents:i.data("upcoming")};n.ajax({type:"get",url:"/json/EventsWidget/GetEvents",data:f,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t,i;if(n){for(e&&(r.filters=n.Filters),i=0;i<n.Events.length;i++)t=n.Events[i],r.events.push(new ft(t.ItemId,t.Title,t.Summary,t.ImageUrl,t.EventDate,t.EventType,t.Location,t.Recurring));u.resolve(r)}}})}).promise()}function d(t){w.hide(),u.empty().show(),p(),n(".slider-wrap").hide(),n(".toggle").hide();var r=g(t);r.done(function(r){if(aston.generic.logPageView(aston.language+"/events/"+t),ut.tmpl(r).appendTo(u),tt(),!r.pastEvent&&r.campaignId!=0){var f=n("#driveForm").clone().attr("id","driveForm-Copy").insertAfter(i).show(),e=n("#driveFormComplete").clone().attr("id","driveFormComplete-Copy").insertAfter(i);f.drive({language:aston.language,campaignId:r.campaignId,showCurrentVehicleDetails:!1,showDealerDetails:!1,showAgeAndProfession:!1,showVehiclesOfInterest:!1,showLegalFooter:!1,formType:"events"})}})}function tt(){var f=u.find("#map"),r=f.get(0),n=f.data(),t=nt(),i;document.URL.indexOf("#")==-1&&(url=document.URL+"#",location="#",location.reload(!0)),r&&(bingMap=new Microsoft.Maps.Map(r,{credentials:"At3NupJLnvXHzeer9oKb726CUH8_nwQcEnNAwPH46v7KqLawBhfgpRNeWLBv7kcn",zoom:3,showDashboard:!0,showMapTypeSelector:!1,mapTypeId:Microsoft.Maps.MapTypeId.road,width:t.width,height:t.height}),i=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(n.latitude,n.longitude),{icon:"//cdn.astonmartin.com/icons/Dealer-Pin.png",width:45,height:48}),bingMap.entities.push(i),bingMap.setView({center:new Microsoft.Maps.Location(n.latitude,n.longitude),zoom:10}))}function nt(){var n={xlarge:[407,407],large:[309,309],medium:[275,275],small:[236,236]};return n[aston.theme]}function g(t){var r={};return n.Deferred(function(u){n.ajax({type:"get",url:"/json/EventsWidget/GetEvent",data:{language:aston.language,title:t,showUpcomingEvents:i.data("upcoming")},contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){n&&(r.title=n.Title,r.content=n.Content,r.heroImage=n.HeroImage,r.registerText=n.RegisterText,r.campaignId=n.CampaignId,r.eventType=n.EventType,r.eventDate=n.EventDate,r.recurring=n.Recurring,r.street=n.Street,r.city=n.City,r.county=n.County,r.postcode=n.Postcode,r.country=n.Country,r.directions=n.Directions,r.latitude=n.Latitude,r.longitude=n.Longitude,r.contactName=n.ContactName,r.contactEmail=n.ContactEmail,r.contactPhone=n.ContactPhoneNumber,r.eventDetails=n.EventDetails,r.registrationDetails=n.RegistrationDetails,r.relatedEvents=n.RelatedEvents,r.relatedEventsList=n.RelatedEventsList,r.pastEvent=n.PastEvent,u.resolve(r))}})}).promise()}function ft(n,t,i,r,u,f,e,o){this.id=n,this.title=t,this.summary=i,this.image=r,this.eventDate=u,this.eventType=f,this.location=e,this.recurring=o}var a=this,v={__id:t},et=a.w;a.register(v);var i=n("#events"),w=i.find("#all-events"),u=i.find("#single-event"),ot=i.find("#btnsearch"),b=i.find("#stage"),l=i.find("#loading"),s=n("#cmbEventCountries"),o=n("#cmbEventTypes"),c=n("#cmbEventMonths"),h=n("#optionTemplate"),ut=n("#eventTemplate"),e=!0;v.init=function(){i.length!=0&&(rt(),it(),aston.w.trigger("hashchange"))}}.apply(aston,[jQuery,"events"]),function(n,t){function l(){i.find(".filter").live("click",function(){var t=n(this),i;return t.hasClass("on")?!1:(o(t.data("filter")),!1)})}function e(t){var u=i.find(".filter"),r=u.filter(function(){return n(this).data("filter")==t});r&&(u.removeClass("on"),r.addClass("on"))}function o(t){u.show(),f.children().not(u).remove();var o=c(t);o.done(function(o){setTimeout(function(){r&&o.filters&&o.filters.length&&(n("#filterTemplate").tmpl(o.filters).appendTo(i.find(".filters")),r=!1,e(t));var s={tiles:o.tiles};n("#tileTemplate").tmpl(s).appendTo(f),u.hide(),f.find(".item").each(function(t){n(this).stop(!0).delay(t++*150).fadeTo(350,1)})},500)}),e(t)}function c(t){var u={tiles:[]};return n.Deferred(function(f){var e={category:i.data("category"),language:aston.language,type:t,populateFilters:r};n.ajax({type:"get",url:"/json/Tiles/GetTiles",data:e,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t,i;if(n){for(r&&(u.filters=n.Filters),i=0;i<n.Tiles.length;i++)t=n.Tiles[i],u.tiles.push(new a(t.Url,t.ImageUrl,t.Content,t.Type,t.OpenInNewWindow));f.resolve(u)}}})}).promise()}function a(n,t,i,r,u){this.Url=n,this.ImageUrl=t,this.Content=i,this.Type=r,this.OpenInNewWindow=u}var s=this,h={__id:t},v=s.w;s.register(h);var i=n("#tiles"),f=i.find(".content"),u=i.find(".loader"),r=!0;h.init=function(){i.length!=0&&(l(),o(i.data("default")))}}.apply(aston,[jQuery,"tiles"]),function(n,t){function f(){n('#directory-tabs a[data-toggle="tab"]').on("shown.bs.tab",function(t){var f=n(this),i=n(t.target.hash),u=i.data("region"),r;u&&(i.children().not(".loading").remove(),i.find(".loading").show(),r=e(u),r.done(function(t){var r={sections:t};setTimeout(function(){i.find(".loading").hide(),n("#directoryTemplate").tmpl(r).appendTo(i)},1e3)}))})}function e(t){return n.Deferred(function(i){var r={salesRegion:t};n.ajax({type:"get",url:"/json/DealerDirectory/GetDealersForSalesRegion",data:r,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){n&&i.resolve(n)}})}).promise()}var u=this,r={__id:t},o=u.w,i;u.register(r),i=n("#directory-tabs"),r.init=function(){var t,n;i.length!=0&&(f(),t=i.data("default"),t?(n=i.find("a").filter(function(){return this.text==t}),n&&n.click()):i.find("a").first().click())}}.apply(aston,[jQuery,"dealerdirectory"]),function(n,t){function it(){i=n("#map");var k=i.get(0),p=y(),w=i.data("franchise"),v=i.data("service"),t=i.data("defaultCountry"),e=i.data("defaultLatitude"),l=i.data("defaultLongitude"),a=i.data("defaultZoom");r=new Microsoft.Maps.Map(k,{credentials:"At3NupJLnvXHzeer9oKb726CUH8_nwQcEnNAwPH46v7KqLawBhfgpRNeWLBv7kcn",zoom:3,showDashboard:!0,showMapTypeSelector:!1,mapTypeId:Microsoft.Maps.MapTypeId.road,width:p.width,height:p.height}),e&&l&&a&&r.setView({center:{latitude:e,longitude:l},zoom:a}),Microsoft.Maps.registerModule("ClientSideClusteringModule","/js/contrib/bing/V7ClientSideClustering.js"),Microsoft.Maps.loadModule("ClientSideClusteringModule",{callback:function(){v&&(u=new ClusteredEntityCollection(r,{singlePinCallback:c,clusteredPinCallback:h,gridSize:65}),u.SetData(v)),w&&(f=new ClusteredEntityCollection(r,{singlePinCallback:c,clusteredPinCallback:h,gridSize:65}),f.SetData(w))}}),Microsoft.Maps.loadModule("Microsoft.Maps.Search",{callback:function(){b=new Microsoft.Maps.Search.SearchManager(r),t&&t=="True"&&(o=!0,s=3,aston.w.trigger("am.dealers.search"))}}),Microsoft.Maps.Pushpin.prototype.title=null,Microsoft.Maps.Pushpin.prototype.busRelId=null,Microsoft.Maps.Pushpin.prototype.addressLine1=null,Microsoft.Maps.Pushpin.prototype.addressLine2=null,Microsoft.Maps.Pushpin.prototype.phoneNumber=null,Microsoft.Maps.Pushpin.prototype.emailAddress=null,Microsoft.Maps.Pushpin.prototype.websiteUrl=null,Microsoft.Maps.Pushpin.prototype.pinType=null,Modernizr.geolocation||n("#btnCurrent").hide()}function c(n){var t=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(n.Latitude,n.Longitude),{icon:rt(n.Type),anchor:new Microsoft.Maps.Point(46,46),width:75,height:46});return t.title=n.DealerName,t.busRelId=n.BusRelId,t.addressLine1=n.AddressLine1,t.addressLine2=n.AddressLine2,t.phoneNumber=n.PhoneNumber,t.emailAddress=n.EmailAddress,t.websiteUrl=n.WebsiteUrl,Microsoft.Maps.Events.addHandler(t,"click",a),t}function h(n,t){var i=new Microsoft.Maps.Pushpin(t,{icon:ut(n[0].Type),anchor:new Microsoft.Maps.Point(65,53),width:75,height:53});return i.pinType="clustered",Microsoft.Maps.Events.addHandler(i,"click",a),i}function a(n){var i,t;e(),n.targetType=="pushpin"&&(n.target&&n.target.pinType=="clustered"?(i=n.target.getLocation(),i&&(t=r.getZoom(),t&&(t=t*1.5),r.setView({center:{latitude:i.latitude,longitude:i.longitude},zoom:t}))):tt(n.target))}function e(){n(".Infobox").remove()}function tt(n){var i=new Microsoft.Maps.Infobox,u=n.getLocation(),t;i.setLocation(u),t='<div class="dealer-info"><h3 class="no-margin-top">'+n.title+"</h3><p>"+n.addressLine1+"<br>"+n.addressLine2+"</p>",n.phoneNumber&&(t+='<p class="no-margin-bottom">T: '+n.phoneNumber+"</p>"),n.emailAddress&&(t+='<a href="mailto:'+n.emailAddress+'" class="margin-bottom">E: '+n.emailAddress+"</a>"),t+=n.websiteUrl?'<a href="'+n.websiteUrl+'" target="blank" class="link-external">Dealer Website</a>':'<a href="http://www.astonmartin.com/dealers/dealership?d='+n.busRelId+'" target="blank" class="link-internal">Dealer Information</a>',t+="</div>",i.setOptions({description:t,visible:!0,height:290,width:300,offset:new Microsoft.Maps.Point(-5,30),zIndex:1}),r.entities.push(i)}function ut(n){var t;switch(n){case"service":t="http://cdn.astonmartin.com/icons/Service-Pin-Cluster.png";break;default:t="http://cdn.astonmartin.com/icons/Dealer-Pin-Cluster.png"}return t}function rt(n){var t;switch(n){case"service":t="http://cdn.astonmartin.com/icons/Service-Pin.png";break;default:t="http://cdn.astonmartin.com/icons/Dealer-Pin.png"}return t}function y(){var t=i.parent(),n=t.width();return{width:n,height:n/2}}function k(){aston.w.bind("am.dealers.get",function(t,r,u){if(r&&u){var f=n("#cmbType").val(),e={latitude:r,longitude:u,maxDistance:n("#cmbDistance").val(),includeDealers:f=="All"||f=="Sales"?!0:!1,includeService:f=="All"||f=="Service"?!0:!1};i.data("latitude",r),i.data("longitude",u),n.ajax({type:"get",url:"/json/Dealers/GetDealers",data:e,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(t){var i=n("#results"),r={Dealers:t};i.show().find(".results").empty(),n("#resultsTemplate").tmpl(r).appendTo(i.find(".results"))}}})}}),aston.w.bind("am.dealers.search",function(){var t=n("#txtLocation").val(),i;t&&t!=""&&(i={query:t,count:1,callback:g},b.search(i),l())}),aston.w.bind("am.theme",function(){var n=y();r!=null&&r.setOptions({width:n.width,height:n.height})})}function nt(){n("#btnCurrent").on("click",function(){return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){r.setView({center:{latitude:n.coords.latitude,longitude:n.coords.longitude},zoom:6}),aston.w.trigger("am.dealers.get",[n.coords.latitude,n.coords.longitude])}):typeof google=="object"&&google.loader&&google.loader.ClientLocation&&(r.setView({center:{latitude:google.loader.ClientLocation.latitude,longitude:google.loader.ClientLocation.longitude},zoom:6}),aston.w.trigger("am.dealers.get",[google.loader.ClientLocation.latitude,google.loader.ClientLocation.longitude])),!1});n("#cmbDistance").on("change",function(){var t=i.data("latitude"),n=i.data("longitude");t&&n&&aston.w.trigger("am.dealers.get",[t,n])});n("#btnSearch").on("click",function(){return aston.w.trigger("am.dealers.search"),!1});n("#cmbType").on("change",function(){l()});n(".move").live("click",function(){var t=n(this),f=t.data("latitude"),u=t.data("longitude"),o=t.data("id");return f&&u&&(e(),r.setView({center:{latitude:f,longitude:u},zoom:12}),n("html,body").animate({scrollTop:i.offset().top},300)),!1}),n(".match").live("click",function(){var u=n(this),i=u.data("latitude"),t=u.data("longitude");return i&&t&&(e(),n.fancybox.close(!0),r.setView({center:{latitude:i,longitude:t},zoom:9}),aston.w.trigger("am.dealers.get",[i,t])),!1}),n(document).keypress(function(t){t.which==13&&n("#btnSearch").click()}),n("#form1").submit(function(n){n.preventDefault()})}function l(){var t=n("#cmbType").val();switch(t){case"Sales":f.GetLayer().setOptions({visible:!0}),u.GetLayer().setOptions({visible:!1});break;case"Service":u.GetLayer().setOptions({visible:!0}),f.GetLayer().setOptions({visible:!1});break;default:u.GetLayer().setOptions({visible:!0}),f.GetLayer().setOptions({visible:!0})}}function g(t){var l,f,u,h,c;if(e(),t.parseResults)if(l=t.parseResults.length,l==1){var w=t.parseResults[0].location.location,p=w.latitude,a=w.longitude;r.setView({center:{latitude:p,longitude:a},zoom:s}),o&&(s=v,o=!1),aston.w.trigger("am.dealers.get",[p,a])}else{for(f=[],h=0;h<l;h++)u=t.parseResults[h].location,u&&u.name&&f.push(new d(u.name,u.location.latitude,u.location.longitude));if(f.length>0){var y=_.uniqueId("matches-"),b={id:y,title:'Multiple locations have been found for "'+n("#txtLocation").val()+'"',text:"Please select one of the following: -",matches:f},k=n("#matchesTemplate").tmpl(b);i.append(k),c=n("#"+y),n.fancybox.open(c,{padding:0,autoSize:!0,afterClose:function(){c.remove()}})}}}function d(n,t,i){this.Name=n,this.Latitude=t,this.Longitude=i}var p=this,w={__id:t},ft=p.w,r,i,v,s,o,f,u,b;p.register(w),v=9,o=!1,w.init=function(){n("#map").length!=0&&(it(),k(),nt())}}.apply(aston,[jQuery,"maps"]),function(n,t){function s(){u.on("click",function(){var n=r.val(),t;return r.isValid()&&n.length==17?(u.text("Searching..."),r.removeClass("invalid"),f.hide(),t=h(n),t.done(function(t){var r={Vin:n,Records:t&&t.length||0,Recalls:t},i=c.tmpl(r);a.empty().append(i),u.text("Search")})):(r.addClass("invalid"),f.show()),!1})}function h(t){var i=[];return n.Deferred(function(r){var u={vin:t};n.ajax({type:"get",url:"/json/Recalls/GetRecallsByVin",data:u,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t,u;if(n){for(u=0;u<n.length;u++)t=n[u],t&&i.push(new l(t.Vin,t.Sfa,t.Description));r.resolve(i)}}})}).promise()}function l(n,t,i){this.Vin=n,this.Sfa=t,this.Description=i}var e=this,o={__id:t},v=e.w;e.register(o);var i=n("#recall-form"),r=i.find("#txtVin"),f=i.find(".info-required"),u=i.find("#btnSearch"),a=i.find(".results"),c=n("#recallsTemplate");o.init=function(){i.length!=0&&s()}}.apply(aston,[jQuery,"recalls"]),function(n){n.fn.myastonmartindrive=function(t){function lt(){a.css("top",i.position().top+10).show(),i.css("opacity",.3),n.when(ut(),s("GetTitles",[],"titles"),s("GetAddressCountries",[],"countries"),s("GetStatesForCountry",["country","USA"],"states"),s("GetCountries",[],"dealerCountries"),s("GetDealersAndCountries",[],"dealers")).then(function(){ht(),at(),pt(),wt()}).then(function(){n.Deferred(function(n){n.pipe(function(){st()}).pipe(function(){rt(),a.hide(),i.css("opacity",1)})}).resolve()})}function ut(){return n.ajax({type:"POST",url:"/WebServices/UserService.asmx/GetCurrentUserDetails",data:{},contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d){var n=n.d;u={Title:n.Title,FirstName:n.FirstName,LastName:n.LastName,Email:n.Email,Street:n.Street,TownCity:n.TownCity,CountyState:n.CountyState,Country:n.Country,Postcode:n.Postcode,Telephone:n.Telephone,CanEmail:n.CanEmail,CanPhone:n.CanPhone,CanPost:n.CanPost,CanSMS:n.CanSMS,PreferredLanguage:n.PreferredLanguage,PreferredDealerCountry:n.PreferredDealerCountry,PreferredDealerId:n.PreferredDealerId}}}})}function st(){u.FirstName!==""&&typeof u.FirstName!="undefined"&&i.find("#txtFirstName").val(u.FirstName).attr("disabled",!0),u.LastName!==""&&typeof u.LastName!="undefined"&&i.find("#txtLastName").val(u.LastName).attr("disabled",!0),u.Street!==""&&typeof u.Street!="undefined"&&i.find("#txtAddress").val(u.Street).attr("disabled",!0),u.TownCity!==""&&typeof u.TownCity!="undefined"&&i.find("#txtTown").val(u.TownCity).attr("disabled",!0),u.CountyState!==""&&typeof u.CountyState!="undefined"&&i.find("#txtCounty").val(u.CountyState).attr("disabled",!0),u.Postcode!==""&&typeof u.Postcode!="undefined"&&i.find("#txtPostcode").val(u.Postcode).attr("disabled",!0),u.Email!==""&&typeof u.Email!="undefined"&&i.find("#txtEmail").val(u.Email).attr("disabled",!0),u.Telephone!==""&&typeof u.Telephone!="undefined"&&i.find("#txtTelephone").val(u.Telephone).attr("disabled",!0),u.CanEmail&&i.find("#chkEmail").attr("checked",!0).parent().css("background-position","50% -50px"),u.CanPhone&&i.find("#chkPhone").attr("checked",!0).parent().css("background-position","50% -50px"),u.CanPost&&i.find("#chkPost").attr("checked",!0).parent().css("background-position","50% -50px"),u.CanSMS&&i.find("#chkSMS").attr("checked",!0).parent().css("background-position","50% -50px");var c=_.filter(aston.cache.titles.d,function(n){return n.English==u.Title}),a=_.filter(aston.cache.countries.d,function(n){return n.Name==u.Country}),s=_.filter(aston.cache.states.d,function(n){return n.Name==u.State}),t=_.filter(aston.cache.dealerCountries.d,function(n){return n==u.PreferredDealerCountry});k.val(c.length>0?c[0].Id:0),l.val(a.length>0?a[0].Id:0),e.val(s.length>0?s[0].StateId:0),h.val(t.length>0?t[0]:0);var y=aston.generic.getTranslatedText(r.language,"forms","selectYourDealerText"),o='<option value="0">'+y+"</option>",v=_.filter(aston.cache.dealers.d,function(n){return n.Country==u.PreferredDealerCountry});n.each(v,function(n,t){o+='<option value="'+t.Id+'">'+t.Location+"</option>"}),f=null,f=n("<select />").attr({id:"cmbDealers"}).append(o),f.val(u.PreferredDealerId),w.empty().append(f),u.Country!="United States"&&e.hide()}function s(t,i,r){var u,f;if(aston.cache[r])return aston.cache[r];if(u="",i.length>0)for(f=0;f<i.length;f+=2)u.length>0&&(u+=","),u+='"'+i[f]+'":"'+i[f+1]+'"';return u="{"+u+"}",n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/"+t,contentType:"application/json; charset=utf-8",data:u,dataType:"json",success:function(n){aston.cache[r]=n},error:v})}function ht(){var i=aston.generic.getTranslatedText(r.language,"forms","titleOption"),t='<option value="0">'+i+"</option>";n.each(aston.cache.titles.d,function(n,i){t+='<option value="'+i.Id+'">'+i.English+"</option>"}),k.append(t)}function at(){var u=aston.generic.getTranslatedText(r.language,"forms","countryOption"),t='<option value="0">'+u+"</option>",i=n("#countryTemplate").tmpl(aston.cache.countries.d);t+=p().html(),l.append(t,i)}function pt(){var f=aston.generic.getTranslatedText(r.language,"forms","preferredDealerCountryOption"),i='<option value="0">'+f+"</option>",u=n("#dealerTemplate").tmpl(aston.cache.dealerCountries.d);i+=p(!0).html(),h.append(i,u)}function wt(){var i=aston.generic.getTranslatedText(r.language,"forms","stateOption"),t='<option value="0">'+i+"</option>";n.each(aston.cache.states.d,function(n,i){t+='<option value="'+i.StateId+'">'+i.Name+"</option>"}),e.append(t)}function p(t){var i,u;switch(r.langauge){case"de":i=[{value:"DEU",text:"Germany"},{value:"AUT",text:"Austria"},{value:"CHE",text:"Switzerland"}];break;default:i=[{value:"DEU",text:"Germany"},{value:"GBR",text:"United Kingdom"},{value:"USA",text:"United States"}]}return r.countryOptions!=!1&&Array.isArray(r.countryOptions)&&(i=r.countryOptions),u=t?n("#dealerGroupTemplate").tmpl(i):n("#countryGroupTemplate").tmpl(i),u.last().addClass("seperator"),n("<optgroup />").attr("label","").append(u)}function yt(){var u=aston.generic.getTranslatedText(r.language,"forms","selectYourDealerText"),i='<option value="0">'+u+"</option>",t=n(aston.cache.dealers.d).filter(function(){return this.Country==h.val()});t.length>1&&(t=_.sortBy(t,"Location")),n.each(t,function(n,t){i+='<option value="'+t.Id+'">'+t.Location+"</option>"}),vt(!1,i)}function vt(t,i){if(t)var u=aston.generic.getTranslatedText(r.language,"forms","preferredDealerLocationOption"),i='<option value="0">'+u+"</option>";f=null,f=n("<select />").attr({id:"cmbDealers"}).append(i),w.empty().append(f),f.hasClass("styled")||f.addClass("styled").selectbox()}function tt(){var n=h.val();n!=="0"&&yt()}function nt(){l.on("change",function(){n(this).val()==="US"||n(this).val()==="USA"?y(!0):y(!1)});h.on("change",function(){tt()});o.on("click",function(n){n.preventDefault();switch(r.formType){default:g()}});i.find("#txtEmail").bind("keyup",function(){c("input#chkEmail",n(this).val().length>0)}),i.find("#txtTelephone").bind("keyup",function(){c("input#chkPhone",n(this).val().length>0)}),i.find("#txtAddress").bind("keyup",function(){c("input#chkPost",n(this).val().length>0)})}function g(){var it;o.attr("disabled","disabled");var s=i.find("#txtFirstName"),e=i.find("#txtLastName"),h=i.find("#txtAddress"),t=i.find("#txtTown"),gt=i.find("#txtPostcode"),u=i.find("#txtEmail"),g=i.find("#txtCounty"),k=i.find("#txtTelephone"),fi=i.find("#txtComments"),hi=s.val().strip(),ei=e.val().strip(),oi=h.val().strip(),vi=t.val().strip(),yi=u.val().strip(),a=r.showCounty?g.val().strip():"",tt=k.val().strip(),p=aston.generic.getValueForSelect(i.find("#cmbTitle")),li=gt.val().strip(),f=aston.generic.getValueForSelect(i.find("#cmbCountry")),w=aston.generic.getValueForSelect(i.find("#cmbState")),ni=aston.generic.getValueForSelect(i.find("#ageSelect")),ti=aston.generic.getValueForSelect(i.find("#cmbProfession")),dt=aston.generic.getValueForSelect(i.find("#cmbPurchaseTimeframe")),ai=aston.generic.getValueForSelect(i.find("#cmbManufacturers")),l=aston.generic.getValueForSelect(i.find("#cmbYearOfMake")),c=aston.generic.getValueForSelect(i.find("#cmbYearOfPurchase")),nt=aston.generic.getValueForSelect(i.find("#cmbDealerCountries")),y=aston.generic.getValueForSelect(i.find("#cmbDealers")),si=aston.generic.getValueForSelect(i.find("#cmbPreferredLanguage")),ui=fi.val().strip(),ii=i.find("#chkOne77").is(":checked"),ri=!1,kt=i.find("#chkDB9Coupe").is(":checked")||i.find("#chkDB9Volante").is(":checked"),et=i.find("#chkDBSCoupe").is(":checked")||i.find("#chkDBSVolante").is(":checked"),ot=i.find("#chkRapide").is(":checked"),st=i.find("#chkVirageCoupe").is(":checked")||i.find("#chkVirageVolante").is(":checked"),ht=i.find("#chkV8VantageCoupe").is(":checked")||i.find("#chkV8VantageRoadster").is(":checked"),ut=i.find("#chkV8VantageSCoupe").is(":checked")||i.find("#chkV8VantageSRoadster").is(":checked"),pt=i.find("#chkV12Vantage").is(":checked")||i.find("#chkV12VantageRoadster").is(":checked"),yt=i.find("#chkVanquish").is(":checked"),bt=!1,wt=i.find("#chkEmail").is(":checked"),vt=i.find("#chkPost").is(":checked"),at=i.find("#chkSMS").is(":checked"),ct=i.find("#chkPhone").is(":checked"),ci=aston.generic.getValueForSelect(i.find("#cmbEvents")),lt=function(){return r.addressIsRequired?h.isValid()&&t.isValid()&&f!=0?!0:!1:!0},rt=function(){return r.addressIsRequired?(f=="US"||f=="USA")&&w==0?!1:!0:!0},ft=function(){return nt==0||y==0?!1:!0};a=g.isValid()?a:"",f=="USA"&&(a=w),tt=k.isValid()?tt:"",l=l==0?"":l,c=c==0?"":c,lt()&&rt()&&ft()&&p!=0&&s.isValid()&&e.isValid()&&u.isValid(!0)?(o.attr("value","Submitting..."),it=JSON.stringify({campaignId:r.campaignId,ageRange:ni,profession:ti,interestRapide:ot,interestDbs:et,interestDb9:kt,interestV12:pt,interestV8:ht,interestCygnet:bt,yearOfReg:l,yearOfPurchase:c,notesForDealer:ui,interestPreOwned:!1,interestNew:!0,isApproved:r.leadsAreApproved,canPost:vt,canPhone:ct,canSMS:at,canEmail:wt,purchaseTimeframe:dt,interestVirage:st,interestV8S:ut,interestOne77:ii,interestZagato:ri,interestVanquish:yt,dealer:y}),n.ajax({type:"POST",url:"/Webservices/UserService.asmx/CreateLeadAgainstExisting",contentType:"application/json; charset=utf-8",data:it,dataType:"json",success:d,error:v})):(o.attr("disabled",!1),n("html,body").animate({scrollTop:b.offset().top},500),b.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),p==0?i.find("#cmbTitle").parent().addClass("invalid"):i.find("#cmbTitle").parent().removeClass("invalid"),s.isValid()?s.removeClass("invalid"):s.addClass("invalid"),e.isValid()?e.removeClass("invalid"):e.addClass("invalid"),u.isValid(!0)?u.removeClass("invalid"):u.addClass("invalid"),nt==0?i.find("#cmbDealerCountries").parent().addClass("invalid"):i.find("#cmbDealerCountries").parent().removeClass("invalid"),y==0?i.find("#cmbDealers").parent().addClass("invalid"):i.find("#cmbDealers").parent().removeClass("invalid"),h.isValid()?h.removeClass("invalid"):h.addClass("invalid"),t.isValid()?t.removeClass("invalid"):t.addClass("invalid"),rt()?i.find("#cmbState").parent().removeClass("invalid"):i.find("#cmbState").parent().addClass("invalid"),f==0?i.find("#cmbCountry").parent().addClass("invalid"):i.find("#cmbCountry").parent().removeClass("invalid"))}function d(n){n&&i.fadeOut("slow",function(){it.removeClass("hidden")})}function y(n){var t=e.closest(".jquery-selectbox");n?(i.find("#txtCounty").hide(),t.length>0?t.show():e.show()):(i.find("#txtCounty").show(),aston.windowLoaded?t.hide():t.length>0?t.hide():e.hide())}function et(){if(i.find("#CurrentVehicleDetails").hide(),r.showLegalFooter||i.find(".legal-foot").hide(),r.showAgeAndProfession||(i.find("#cmbAge").hide(),i.find("#cmbProfession").hide()),r.modelsOfInterest.V8VantageSCoupe?n("#chkV8VantageSCoupe").attr("checked",!0).parent().css("background-position","50% -50px"):n("#chkV8VantageSCoupe").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.V8VantageSRoadster?i.find("#chkV8VantageSRoadster").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkV8VantageSRoadster").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.DB9Coupe?i.find("#chkDB9Coupe").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkDB9Coupe").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.V8VantageCoupe?i.find("#chkV8VantageCoupe").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkV8VantageCoupe").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.DB9Volante?i.find("#chkDB9Volante").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkDB9Volante").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.V8VantageRoadster?i.find("#chkV8VantageRoadster").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkV8VantageRoadster").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.Rapide?i.find("#chkRapide").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkRapide").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.V12Vantage?i.find("#chkV12Vantage").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkV12Vantage").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.VanquishCoupe?i.find("#chkVanquishCoupe").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkVanquishCoupe").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.VanquishVolante?i.find("#chkVanquishVolante").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkVanquishVolante").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.V12VantageRoadster?i.find("#chkV12VantageRoadster").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkV12VantageRoadster").removeAttr("checked").parent().css("background-position","50% 0"),!r.showDerivativeDescription){var t=ct.find(".small span");n.each(t,function(n,t){t.innerHTML=t.innerHTML.replace("Coupe","").replace("COUPE","")})}}function c(n,t){t?i.find(n).attr("checked",!0).parent().css("background-position","50% -50px"):i.find(n).removeAttr("checked").parent().css("background-position","50% 0")}function ft(){o.attr("value",aston.generic.getTranslatedText(r.language,"forms","submit")),i.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".address").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".town").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","postcode")),i.find(".email").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".comments").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","comments")),Modernizr.input.placeholder||(i.find(".firstname").attr("value",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("value",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".address").attr("value",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".town").attr("value",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("value",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("value",aston.generic.getTranslatedText(r.language,"forms","postcode")),i.find(".email").attr("value",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("value",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".comments").attr("value",aston.generic.getTranslatedText(r.language,"forms","comments")))}function rt(){i.find(":radio").wrap('<div class="radio"/>'),i.find(".radio").dgStyle(),i.find(":checkbox").wrap('<div class="checkbox"/>'),i.find(".checkbox").dgStyle(),i.find("select").selectbox()}function v(){alert("Sorry an error has occured, please try again later")}var r={},ot={language:"en",campaignId:66,leadsAreApproved:!0,showCurrentVehicleDetails:!1,showDealerDetails:!0,showAgeAndProfession:!0,showVehiclesOfInterest:!0,showLegalFooter:!1,addressIsRequired:!0,modelsOfInterest:{V8VantageSCoupe:!1,V8VantageSRoadster:!1,DB9Coupe:!1,V8VantageCoupe:!1,DB9Volante:!1,V8VantageRoadster:!1,Rapide:!1,V12Vantage:!1,Cygnet:!1,VanquishCoupe:!1,VanquishVolante:!1,V12VantageRoadster:!1}},u={},i=this,it=n("#driveFormComplete"),o=i.find("#btnSubmit"),k=i.find("#cmbTitle"),l=i.find("#cmbCountry"),h=i.find("#cmbDealerCountries"),w=i.find("#dealers"),f,e=i.find("#cmbState"),bt=i.find("#cmbManufacturerSelect"),b=i.find("#requiredFields"),ct=i.find(".vehicle"),a=n(".loading");return r=n.extend(ot,t),lt(),nt(),ft(),et(),n(this).addClass("styled")}}(jQuery),function(n){n.fn.myastonmartincontact=function(t){function nt(){f.unbind("click")}function g(){n.when(p(),o("GetTitles",[],"titles"),o("GetAddressCountries",[],"countries")).then(function(){l(),y()}).then(function(){tt()}).then(function(){w()})}function p(){var t=n.Deferred();return r.prePopulate?n.ajax({type:"POST",url:"/WebServices/UserService.asmx/GetCurrentUserDetails",data:{},contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d){var n=n.d;u={Title:n.Title,FirstName:n.FirstName,LastName:n.LastName,Email:n.Email,Country:n.Country,Telephone:n.Telephone}}t.resolve()}}):t.resolve(),t.promise()}function tt(){if(r.prePopulate){u.FirstName!==""&&typeof u.FirstName!="undefined"&&i.find("#txtFirstName").val(u.FirstName).attr("disabled",!0),u.LastName!==""&&typeof u.LastName!="undefined"&&i.find("#txtLastName").val(u.LastName).attr("disabled",!0),u.Email!==""&&typeof u.Email!="undefined"&&i.find("#txtEmail").val(u.Email),u.Telephone!==""&&typeof u.Telephone!="undefined"&&i.find("#txtTelephone").val(u.Telephone);var t=_.filter(aston.cache.titles.d,function(n){return n.English==u.Title}),n=_.filter(aston.cache.countries.d,function(n){return n.Name==u.Country});c.val(t.length>0?t[0].Id:0),e.val(n.length>0?n[0].Id:0)}}function ut(){f.on("click",function(n){n.preventDefault(),rt()})}function rt(){f.attr("disabled","disabled");var o=aston.generic.getValueForSelect(i.find("#cmbTitle")),c=aston.generic.getValueForSelect(i.find("#cmbCountry")),t=i.find("#txtFirstName"),e=i.find("#txtLastName"),u=i.find("#txtEmail"),w=i.find("#txtTelephone"),p=i.find("#txtComments"),b=t.val(),y=e.val(),l=u.val(),k=w.val(),a=p.val(),v="";o!=0&&c!=0&&t.isValid()&&e.isValid()&&u.isValid(!0)?(f.attr("value","Submitting..."),SitefinityWebApp.ProxyNewsletterWS.ContactUs(r.contactId,o,b+" "+y,c,a,l,v,it,s)):(f.attr("disabled",!1),n("html,body").animate({scrollTop:h.offset().top},500),h.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),o==0?i.find("#cmbTitle").parent().addClass("invalid"):i.find("#cmbTitle").parent().removeClass("invalid"),c==0?i.find("#cmbCountry").parent().addClass("invalid"):i.find("#cmbCountry").parent().removeClass("invalid"),t.isValid()?t.removeClass("invalid"):t.addClass("invalid"),e.isValid()?e.removeClass("invalid"):e.addClass("invalid"),u.isValid(!0)?u.removeClass("invalid"):u.addClass("invalid"))}function it(){i.fadeOut("slow",function(){n("#enquireForm").hide(),d.removeClass("hidden").show()})}function k(){i.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".email").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".comments").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","comments")),Modernizr.input.placeholder||(i.find(".firstname").attr("value",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("value",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".email").attr("value",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("value",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".comments").attr("value",aston.generic.getTranslatedText(r.language,"forms","comments")))}function v(){f.attr("value","Submit"),i.find("#cmbCountry").show(),i.find("#contactTitle").show(),i.find("#txtTelephone").show(),i.find("#txtComments").show(),i.find("#contactCopy").hide(),i.find("#worksServiceOptions").hide(),i.find("#options").hide(),i.find("#contactTitle").hide(),i.find("#cmbFranchise").hide(),i.find("#txtDealerName").hide(),i.find("#txtDealerComments").hide(),i.find("#txtCompany").hide()}function o(t,i,r){var u,f;if(aston.cache[r])return aston.cache[r];if(u="",i.length>0)for(f=0;f<i.length;f+=2)u.length>0&&(u+=","),u+='"'+i[f]+'":"'+i[f+1]+'"';return u="{"+u+"}",n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/"+t,contentType:"application/json; charset=utf-8",data:u,dataType:"json",success:function(n){aston.cache[r]=n},error:s})}function l(){var i=aston.generic.getTranslatedText(r.language,"forms","titleOption"),t='<option value="0">'+i+"</option>";n.each(aston.cache.titles.d,function(n,i){t+='<option value="'+i.Id+'">'+i.English+"</option>"}),c.append(t)}function y(){var f=aston.generic.getTranslatedText(r.language,"forms","countryOption"),i='<option value="0">'+f+"</option>",u=n("#countryTemplate").tmpl(aston.cache.countries.d);i+=b().html(),e.append(i,u)}function b(t){var i,u;switch(r.langauge){case"de":i=[{value:"DE",text:"Germany"},{value:"AT",text:"Austria"},{value:"CH",text:"Switzerland"}];break;default:i=[{value:"DE",text:"Germany"},{value:"GB",text:"United Kingdom"},{value:"US",text:"United States"}]}return r.countryOptions!=!1&&Array.isArray(r.countryOptions)&&(i=r.countryOptions),u=t?n("#dealerGroupTemplate").tmpl(i):n("#countryGroupTemplate").tmpl(i),u.last().addClass("seperator"),n("<optgroup />").attr("label","").append(u)}function w(){i.find("select").selectbox()}function s(){alert("Sorry an error has occured, please try again later")}var r={},a={language:"en",contactId:7,prePopulate:!0},i=this,d=n("#contactFormComplete"),h=i.find("#requiredFields"),f=i.find("#btnSubmit"),c=i.find("#cmbTitle"),e=i.find("#cmbCountry"),u={};r=n.extend(a,t),nt(),ut(),k(),v(),g()}}(jQuery),function(n,t){function f(){aston.w.bind("am.account.open",function(n,t){t.find("input, select").attr("disabled",!1),t.find(".btn").attr("disabled",!1).fadeIn("fast"),t.find(".link-edit").addClass("cancel").text("(Cancel Editing)")}),aston.w.bind("am.account.close",function(n,t){t.find("input, select").attr("disabled","disabled").removeClass("invalid"),t.find(".btn").fadeOut("fast"),t.find(".link-edit").removeClass("cancel").text("(Edit)")})}function e(){n("input.submit").on("click",function(){var t=n(this),f=t.parents("section").first(),o=f.data("type"),r=i[o],u=!1,e;return t.attr("disabled","disabled"),u=r.onValidate(),u?(t.attr("value","Saving..."),e=r.onUpdate(),e.done(function(n){n?toastr.success(r.title+" updated"):toastr.error("Sorry an error has occured, please try again later"),aston.w.trigger("am.account.close",[f]),t.attr("value","Save")})):t.attr("disabled",!1),!1});n(".link-edit").on("click",function(){var i=n(this),t=i.parents("section").first();return i.hasClass("cancel")?aston.w.trigger("am.account.close",[t]):aston.w.trigger("am.account.open",[t]),!1})}var u=this,r={__id:t},o=u.w,i;u.register(r),i={personal:{title:"Personal Details",onValidate:function(){var u=!0,r=n("#Title"),f=r.val(),t=n("#FirstName"),i=n("#LastName");return f!=""&&t.isValid()&&i.isValid()||(u=!1,f==""?r.addClass("invalid"):r.removeClass("invalid"),t.isValid()?t.removeClass("invalid"):t.addClass("invalid"),i.isValid()?i.removeClass("invalid"):i.addClass("invalid")),u},onUpdate:function(){return n.Deferred(function(t){var r={Title:n("#Title").val(),FirstName:n("#FirstName").val(),LastName:n("#LastName").val()},i=JSON.stringify({request:r});n.ajax({type:"POST",url:"/Webservices/UserService.asmx/UpdateName",contentType:"application/json; charset=utf-8",data:i,dataType:"json"}).done(function(n){t.resolve(n.d)})}).promise()}},contact:{title:"Contact Details",onInit:function(){var t=n("#Address_CountryRegionId");t.on("change",function(){var t=n(this).val();t=="USA"?(n("#col-state").show(),n("#col-county").hide()):(n("#col-state").hide(),n("#col-county").show())});t.val()=="USA"?(n("#col-state").show(),n("#col-county").hide()):(n("#col-state").hide(),n("#col-county").show())},onValidate:function(){var s=!0,i=n("#Address_Street"),t=n("#Address_TownCity"),r=n("#Address_Postcode"),e=n("#Address_State"),h=e.val(),f=n("#Address_CountryRegionId"),u=f.val(),o=function(){return u=="USA"&&h==""?!1:!0};return o()&&i.isValid()&&t.isValid()&&r.isValid()&&u!=""||(s=!1,o()?e.removeClass("invalid"):e.addClass("invalid"),i.isValid()?i.removeClass("invalid"):i.addClass("invalid"),t.isValid()?t.removeClass("invalid"):t.addClass("invalid"),r.isValid()?r.removeClass("invalid"):r.addClass("invalid"),u==""?f.addClass("invalid"):f.removeClass("invalid")),s},onUpdate:function(){return n.Deferred(function(t){var s=n("#Address_Street").val(),o=n("#Address_TownCity").val(),c=n("#Address_County").val(),h=n("#Address_State").val(),i=n("#Address_CountryRegionId").val(),r=n("#Address_Postcode").val(),e=n("#Address_Telephone").val(),u=n("#Address_Language").val(),f={Street:s,TownCity:o,CountyState:i=="USA"?h:c,Country:i,Postcode:r,Telephone:e,PreferredLanguage:u};request=JSON.stringify({request:f}),n.ajax({type:"POST",url:"/Webservices/UserService.asmx/UpdateContactDetails",contentType:"application/json; charset=utf-8",data:request,dataType:"json"}).done(function(n){t.resolve(n.d)})}).promise()}},dealer:{title:"Preferred Dealer",onInit:function(){var i=n("#PreferredDealerCountry"),t=n("#PreferredDealerId");i.on("change",function(){var i=n(this).val();i!=""&&n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWS.asmx/GetDealersForCountry",contentType:"application/json; charset=utf-8",data:JSON.stringify({country:i}),dataType:"json",success:function(i){var r='<option value="">Select your dealer...</option>';i.d&&(n.each(i.d,function(n,t){r+='<option value="'+t.Id+'">'+t.Location+"</option>"}),t.empty().append(r))}})})},onValidate:function(){var f=!0,t=n("#PreferredDealerCountry"),i=n("#PreferredDealerId"),u=t.val(),r=i.val();return(u==""||r=="")&&(f=!1,u==""?t.addClass("invalid"):t.removeClass("invalid"),r==""?i.addClass("invalid"):i.removeClass("invalid")),f},onUpdate:function(){return n.Deferred(function(t){var r={BusinessRelationId:n("#BusinessRelationId").val(),ContactId:n("#ContactId").val(),DealerId:n("#PreferredDealerId").val()},i=JSON.stringify({request:r});n.ajax({type:"POST",url:"/Webservices/UserService.asmx/UpdatePreferredDealer",contentType:"application/json; charset=utf-8",data:i,dataType:"json"}).done(function(n){t.resolve(n.d)})}).promise()}},newsletter:{title:"Aston Martin Newsletter",onValidate:function(){return!0},onUpdate:function(){return n.Deferred(function(t){var i=JSON.stringify({contactId:n("#ContactId").val(),subscribe:n("#NewsletterSubscription").is(":checked")});n.ajax({type:"POST",url:"/Webservices/UserService.asmx/AddOrUpdateSubscriptionToNewsletter",contentType:"application/json; charset=utf-8",data:i,dataType:"json"}).done(function(n){t.resolve(n.d)})}).promise()}},marketing:{title:"Marketing Preferences",onValidate:function(){return!0},onUpdate:function(){return n.Deferred(function(t){var f=n("#CanPost").is(":checked"),e=n("#CanEmail").is(":checked"),u=n("#CanSMS").is(":checked"),i=n("#CanPhone").is(":checked"),r={CanPost:f,CanEmail:e,CanSms:u,CanPhone:i};request=JSON.stringify({request:r}),n.ajax({type:"POST",url:"/Webservices/UserService.asmx/UpdateMarketingPreferences",contentType:"application/json; charset=utf-8",data:request,dataType:"json"}).done(function(n){t.resolve(n.d)})}).promise()}},password:{title:"Change Password",onValidate:function(){var e=!0,r=n("#txtCurrentPassword"),t=n("#txtNewPassword"),i=n("#txtConfirmPassword"),s=r.val(),u=t.val(),f=i.val(),o=function(){return s!=""&&u!=""&&u.length>6&&f!=""&&f.length>6?!0:!1};return o()&&r.isValid()&&t.isValid()&&i.isValid()||(e=!1,r.isValid()?r.removeClass("invalid"):r.addClass("invalid"),t.isValid()?t.removeClass("invalid"):t.addClass("invalid"),i.isValid()?i.removeClass("invalid"):i.addClass("invalid"),u!=f?(t.addClass("invalid"),i.addClass("invalid")):t.isValid()&&u.length>6&&i.isValid()&&f.length>6&&(t.removeClass("invalid"),i.removeClass("invalid"))),e&&(r.removeClass("invalid"),t.removeClass("invalid"),i.removeClass("invalid")),e},onUpdate:function(){return n.Deferred(function(t){var u=n("#txtCurrentPassword").val(),f=n("#txtNewPassword").val(),i=n("#txtConfirmPassword").val(),r=JSON.stringify({currentPassword:u,newPassword:f,confirmPassword:i});n.ajax({type:"POST",url:"/Webservices/UserService.asmx/ChangePassword",contentType:"application/json; charset=utf-8",data:r,dataType:"json"}).done(function(i){i.d&&i.d.Success?(n("#txtCurrentPassword").val(""),n("#txtNewPassword").val(""),n("#txtConfirmPassword").val(""),n(".error-text").empty(),t.resolve(!0)):(n(".error-text").html('<p class="invalid">'+i.d.Message+"</p>"),n("#btn-password").text("Update").attr("disabled",!1))})}).promise()}},disable:{title:"Delete Account",onValidate:function(){return confirm("Are you sure you want to delete your online account with us?")},onUpdate:function(){var t=JSON.stringify({username:n("#Email").val()});n.ajax({type:"POST",url:"/Webservices/UserService.asmx/DisableAccount",contentType:"application/json; charset=utf-8",data:t,dataType:"json",success:function(n){n.d&&(window.location=n.d),dfd.resolve()}})}}},r.init=function(){if(!(!n("#my-account").length>0)){for(var t in i)typeof i[t].onInit=="function"&&i[t].onInit();e(),f()}}}.apply(aston,[jQuery,"myaccount"]),function(n,t){function v(){n.validator.addMethod("gmtDate",function(n){return n.match(/^\d\d?\/\d\d?\/\d\d\d\d$/)},"Please enter a date in the format dd/mm/yyyy."),n.validator.addMethod("alphanumeric",function(n,t){return this.optional(t)||/^\w+$/i.test(n)},"Letters, numbers, and underscores only"),n.validator.addMethod("numbersOnly",function(n,t){return this.optional(t)||/^\d+$/.test(n)},"Numbers only"),u.validate({invalidHandler:function(t,r){var f=n(r.currentForm),e=r.numberOfInvalids(),u=f.find(".errorMessage");i.removeErrorClassFromSelects(f),e?(u.html('<p style="color: red;">Please enter all of the required fields</p>'),i.addErrorClassToSelects(r.errorList)):u.hide()},rules:{txtVin:{required:!0,minlength:6,maxlength:17,alphanumeric:!0},cmbVehicleType:{required:!0},txtReg:{required:!0},txtOdometer:{required:!0,numbersOnly:!0},purchasedDatepicker:{required:!0,gmtDate:!0}},errorLabelContainer:u.find(".errorMessage")}),r.validate({invalidHandler:function(t,r){var f=n(r.currentForm),e=r.numberOfInvalids(),u=f.find(".errorMessage");i.removeErrorClassFromSelects(f),e?(u.html('<p style="color: red;">Please enter all of the required fields</p>'),i.addErrorClassToSelects(r.errorList)):u.hide()},rules:{DisposalReason:{required:!0},DisposalDate:{required:!0,gmtDate:!0},Test:{required:!0,email:!0}},errorLabelContainer:r.find(".errorMessage")}),n("#purchasedDatepicker").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",maxDate:new Date,onClose:function(){n(this).valid()}}),n("#disposalDateText").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",maxDate:new Date,onClose:function(){n(this).valid()}})}function a(){aston.w.bind("am.vehicles.get",function(){n.ajax({type:"POST",url:"/WebServices/UserService.asmx/GetOwnedVehicles",data:{},contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(t.d){var r={vehicles:t.d},i=n("#myVehiclesTemplate").tmpl(r);n(".registrations").find("tbody").empty().append(i)}}})})}function y(){c.on("click",function(t){t.preventDefault(),n.fancybox.open(l,{wrapCSS:"add-vehicle-wrapper",padding:0,beforeShow:function(){i.configurePlaceholders(u)},afterShow:function(){i.performStyling(u)},afterClose:function(){n("#add-vehicle-complete").hide(),n("#add-vehicle").show(),i.resetForm(u),aston.w.trigger("am.vehicles.get")}})});h.live("click",function(t){t.preventDefault();var e=n(this),u=e.data("vin");r.data("vin",u),n.fancybox.open(f,{wrapCSS:"remove-vehicle-wrapper",padding:0,beforeShow:function(){i.configurePlaceholders(r)},afterShow:function(){i.performStyling(r)},afterClose:function(){r.data("vin",""),i.resetForm(r),aston.w.trigger("am.vehicles.get")}})});n("#btnRemove").on("click",function(){var u=r.data("vin"),i;r.valid()&&(i=JSON.stringify({vin:u,disposalDate:n("#disposalDateText").val(),disposalReason:n("#cmbDisposalReason").val()}),n.ajax({type:"POST",url:"/WebServices/UserService.asmx/EndVehicleAssociation",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){t.d&&n.fancybox.close(!0)}}))});n("#btnSave").click(function(){if(n("#btnSave").attr("disabled","disabled"),u.valid()){var t=JSON.stringify({request:{Vin:n("#txtVin").val(),VehicleDescription:n("#cmbVehicleType").val(),Registration:n("#txtReg").val(),PurchaseDate:n("#purchasedDatepicker").val(),Odometer:n("#txtOdometer").val()}});n.ajax({type:"POST",url:"/WebServices/UserService.asmx/StartVehicleAssociation",data:t,contentType:"application/json; charset=utf-8",dataType:"json",success:function(){u.fadeOut("fast",function(){e.show()})}})}else n("#btnSave").attr("disabled",!1)})}var o=this,s={__id:t},w=o.w,p,c,l,u,e,h,f,r,i;o.register(s),i={configurePlaceholders:function(t){if(!Modernizr.input.placeholder){var i=t.find("input[type=text]");n.each(i,function(t,i){var r=n(i);r.attr("value",r.attr("placeholder"))})}},performStyling:function(){},resetForm:function(n){n.find(".submit").attr("disabled",!1);var t=n.validate();t.resetForm(),n.find("select").parents(".jquery-selectbox").unselectbox(),n.find("select").val(0),n.find("input[type=text]").val("")},removeErrorClassFromSelects:function(n){$selects=n.find("select"),$selects.length>0&&$selects.removeClass("error")},addErrorClassToSelects:function(t){for(var r=_.filter(t,function(n){return n.element.nodeName=="SELECT"}),i=0;i<r.length;i++)n(r[i].element).removeClass("error").parent(".jquery-selectbox").addClass("error")}},s.init=function(){!n("#add-new-vehicle").length>0||(c=n("#add-new-vehicle"),l=n("#add-vehicle-form"),u=n("#add-vehicle"),e=n("#add-vehicle-complete"),h=n(".remove"),f=n("#remove-vehicle-form"),r=n("#remove-vehicle"),v(),a(),y(),aston.w.trigger("am.vehicles.get"))}}.apply(aston,[jQuery,"myvehicles"]),function(n,t){function f(){aston.w.bind("am.account.open",function(n,t){t.find("input, select").attr("disabled",!1),t.find(".btn").attr("disabled",!1).fadeIn("fast"),t.find(".link-edit").addClass("cancel").text("(Cancel Editing)")}),aston.w.bind("am.account.close",function(n,t){t.find("input, select").attr("disabled","disabled").removeClass("invalid"),t.find(".btn").fadeOut("fast"),t.find(".link-edit").removeClass("cancel").text("(Edit)")})}function e(){n("input.submit").on("click",function(){var t=n(this),f=t.parents("section").first(),o=f.data("type"),r=i[o],u=!1,e;return t.attr("disabled","disabled"),u=r.onValidate(),u?(t.attr("value","Saving..."),e=r.onUpdate(),e.done(function(n){n?toastr.success(r.title+" updated"):toastr.error("Sorry an error has occured, please try again later"),aston.w.trigger("am.account.close",[f]),t.attr("value","Save")})):t.attr("disabled",!1),!1});n(".link-edit").on("click",function(){var i=n(this),t=i.parents("section").first();return i.hasClass("cancel")?aston.w.trigger("am.account.close",[t]):aston.w.trigger("am.account.open",[t]),!1})}var u=this,r={__id:t},o=u.w,i;u.register(r),i={contact:{title:"Contact Details",onInit:function(){var t=n("#Address_CountryRegionId");t.on("change",function(){var t=n(this).val();t=="USA"?(n("#col-state").show(),n("#col-county").hide()):(n("#col-state").hide(),n("#col-county").show())});t.val()=="USA"?(n("#col-state").show(),n("#col-county").hide()):(n("#col-state").hide(),n("#col-county").show())},onValidate:function(){var s=!0,i=n("#Address_Street"),t=n("#Address_TownCity"),r=n("#Address_Postcode"),e=n("#Address_State"),h=e.val(),f=n("#Address_CountryRegionId"),u=f.val(),o=function(){return u=="USA"&&h==""?!1:!0};return o()&&i.isValid()&&t.isValid()&&r.isValid()&&u!=""||(s=!1,o()?e.removeClass("invalid"):e.addClass("invalid"),i.isValid()?i.removeClass("invalid"):i.addClass("invalid"),t.isValid()?t.removeClass("invalid"):t.addClass("invalid"),r.isValid()?r.removeClass("invalid"):r.addClass("invalid"),u==""?f.addClass("invalid"):f.removeClass("invalid")),s},onUpdate:function(){return n.Deferred(function(t){var s=n("#Address_Street").val(),o=n("#Address_TownCity").val(),c=n("#Address_County").val(),h=n("#Address_State").val(),i=n("#Address_CountryRegionId").val(),r=n("#Address_Postcode").val(),e=n("#Address_Telephone").val(),u=n("#Address_Language").val(),f={Street:s,TownCity:o,CountyState:i=="USA"?h:c,Country:i,Postcode:r,Telephone:e,PreferredLanguage:u};request=JSON.stringify({request:f}),n.ajax({type:"POST",url:"/Webservices/UserService.asmx/UpdateContactDetails",contentType:"application/json; charset=utf-8",data:request,dataType:"json"}).done(function(n){t.resolve(n.d)})}).promise()}}},r.init=function(){if(!(!n("#my-account-magazine").length>0)){for(var t in i)typeof i[t].onInit=="function"&&i[t].onInit();e(),f()}}}.apply(aston,[jQuery,"myaccountmagazine"]),function(n,t){function f(){aston.w.bind("am.account.open",function(n,t){t.find("input, select").attr("disabled",!1),t.find(".btn").attr("disabled",!1).fadeIn("fast"),t.find(".link-edit").addClass("cancel").text("(Cancel Editing)")}),aston.w.bind("am.account.close",function(n,t){t.find("input, select").attr("disabled","disabled").removeClass("invalid"),t.find(".btn").fadeOut("fast"),t.find(".link-edit").removeClass("cancel").text("(Edit)")})}function e(){n("input.submit").on("click",function(){var t=n(this),f=t.parents("section").first(),o=f.data("type"),r=i[o],u=!1,e;return t.attr("disabled","disabled"),u=r.onValidate(),u?(t.attr("value","Saving..."),e=r.onUpdate(),e.done(function(n){n?toastr.success(r.title+" updated"):toastr.error("Sorry an error has occured, please try again later"),aston.w.trigger("am.account.close",[f]),t.attr("value","Save")})):t.attr("disabled",!1),!1});n(".link-edit").on("click",function(){var i=n(this),t=i.parents("section").first();return i.hasClass("cancel")?aston.w.trigger("am.account.close",[t]):aston.w.trigger("am.account.open",[t]),!1})}var u=this,r={__id:t},o=u.w,i;u.register(r),i={contact:{title:"Contact Details",onInit:function(){var t=n("#Address_CountryRegionId");t.on("change",function(){var t=n(this).val();t=="USA"?(n("#col-state").show(),n("#col-county").hide()):(n("#col-state").hide(),n("#col-county").show())});t.val()=="USA"?(n("#col-state").show(),n("#col-county").hide()):(n("#col-state").hide(),n("#col-county").show())},onValidate:function(){var s=!0,i=n("#Address_Street"),t=n("#Address_TownCity"),r=n("#Address_Postcode"),e=n("#Address_State"),h=e.val(),f=n("#Address_CountryRegionId"),u=f.val(),o=function(){return u=="USA"&&h==""?!1:!0};return o()&&i.isValid()&&t.isValid()&&r.isValid()&&u!=""||(s=!1,o()?e.removeClass("invalid"):e.addClass("invalid"),i.isValid()?i.removeClass("invalid"):i.addClass("invalid"),t.isValid()?t.removeClass("invalid"):t.addClass("invalid"),r.isValid()?r.removeClass("invalid"):r.addClass("invalid"),u==""?f.addClass("invalid"):f.removeClass("invalid")),s},onUpdate:function(){return n.Deferred(function(t){var o=n("#Address_Street").val(),e=n("#Address_TownCity").val(),h=n("#Address_County").val(),s=n("#Address_State").val(),i=n("#Address_CountryRegionId").val(),u=n("#Address_Postcode").val(),r=n("#vehicle-book-form").data("vehicle"),f={Street:o,Town:e,County:i=="USA"?s:h,CountryRegionId:i,Postcode:u,VehicleId:r};request=JSON.stringify({address:f}),n.ajax({type:"POST",url:"/Webservices/UserService.asmx/AddAlternativeAddress",contentType:"application/json; charset=utf-8",data:request,dataType:"json"}).done(function(n){t.resolve(n.d)})}).promise()}}},r.init=function(){if(!(!n("#vehicle-book-form").length>0)){for(var t in i)typeof i[t].onInit=="function"&&i[t].onInit();e(),f()}}}.apply(aston,[jQuery,"book"]),function(n){n.fn.dealers=function(t){function ft(){tt(),et(),ut()}function ut(){n("#themeholder").removeClass("generic").addClass("dealers home"),n("#main").addClass("dealers home"),Modernizr.geolocation||v.hide(),ot()}function ot(){v.text(aston.generic.getTranslatedText(r.language,"dealers","useLocation")),n("#txtDealers").text(aston.generic.getTranslatedText(r.language,"dealers","dealer")),n("#txtServiceCentres").text(aston.generic.getTranslatedText(r.language,"dealers","service")),p.attr("title",aston.generic.getTranslatedText(r.language,"dealers","search")),k.attr("title",aston.generic.getTranslatedText(r.language,"dealers","clear")),s.find("h2").text(aston.generic.getTranslatedText(r.language,"dealers","nearestDealers")),e.attr("placeholder",aston.generic.getTranslatedText(r.language,"dealers","enterLocation")),Modernizr.input.placeholder||e.attr("title",aston.generic.getTranslatedText(r.language,"dealers","enterLocation"))}function et(){v.on("click",function(){return aston.w.trigger("am.dealers.current.click"),!1});f.on("change",function(){});p.on("click",function(){return aston.w.trigger("am.dealers.search.click"),!1});k.on("click",function(){return aston.w.trigger("am.dealers.clear.click"),!1});e.on("keypress",function(n){if(n.which==13)return p.click(),!1});aston.w.bind("am.theme",function(){aston.w.trigger("am.dealers.resize")})}function tt(){aston.w.bind("am.dealers.current.click",function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){i.setView({center:{latitude:n.coords.latitude,longitude:n.coords.longitude},zoom:5}),l(n.coords.latitude+","+n.coords.longitude)}):typeof google=="object"&&google.loader&&google.loader.ClientLocation&&(i.setView({center:{latitude:google.loader.ClientLocation.latitude,longitude:google.loader.ClientLocation.longitude},zoom:5}),l(google.loader.ClientLocation.latitude+","+google.loader.ClientLocation.longitude))}),aston.w.bind("am.dealers.clear.click",function(){c.is(":checked")||c.attr("checked","checked").parent().click(),h.is(":checked")||h.attr("checked","checked").parent().click(),Modernizr.input.placeholder?e.val(""):e.val(aston.generic.getTranslatedText(r.language,"dealers","enterLocation")),f.parents(".jquery-selectbox").unselectbox().end().val(0).selectbox(),s.fadeOut("fast",function(){o.html("")})}),aston.w.bind("am.dealers.country.change",function(){var t="",n=f.val();n!=""&&n!="Select Country"?(n=="Middle East"&&(n="Arabian Peninsula"),n=="Russia"&&(t="Moscow"),y!=null&&(i.DeleteShape(y),y=null),s.fadeOut("fast",function(){o.html("")}),b(t,n)):i.setView({center:{latitude:0,longitude:0},zoom:3})}),aston.w.bind("am.dealers.search.click",function(){b(e.val(),f.val())}),aston.w.bind("am.dealers.resize",function(){var n=nt();i!=null&&i.setOptions({width:n[0],height:n[1]})})}function nt(){var n={xlarge:[1650,600],large:[1320,550],medium:[1050,500],small:[920,450]};return n[aston.theme]}function b(n,t){t!="0"&&(n=n+","+t,n==""&&t=="Russia"&&(n="Moscow, Russia")),l(n)}function l(n){try{var t={query:n,count:1,callback:it,errorCallback:a};d.search(t)}catch(i){alert(i.message)}}function it(t){var f;if(t.parseResults.length>0){var e=t.parseResults[0].location.location,o=e.latitude,u=e.longitude;i.setView({center:{latitude:o,longitude:u},zoom:9}),f=JSON.stringify({latitude:o,longitude:u,numberOfItems:5,includeDealers:c.is(":checked"),includeServiceCentres:h.is(":checked")}),n.ajax({type:"POST",url:"/Webservices/ProxyLocatorWS.asmx/LocateNearestDealersAsJson",contentType:"application/json; charset=utf-8",data:f,dataType:"json",success:rt,error:a})}}function rt(t){var u,v,l,c,h,e,a,f;if(t){if(u=eval("("+t.d+")"),v={dealers:u},o.empty(),u.length>0){for(l=n("#nearest-dealer-template").tmpl(v),o.append(l),s.fadeIn("fast"),c=[],e=0;e<u.length;e++)h=u[e],c.push(new Microsoft.Maps.Location(h.Latitude,h.Longitude));a=Microsoft.Maps.LocationRect.fromLocations(c),i.setView({bounds:a})}else s.fadeIn("fast",function(){o.append("<p>No results found</p>")});!w&&r.defaultMapView&&(f=r.defaultMapView,i.setView({center:{latitude:f.latitude,longitude:f.longitude},zoom:f.zoom}),w=!0)}}function a(){alert("There was an error. Please try again later.")}var r={},g={language:"en",defaultImageUrl:"http://site.astonmartin.com/content/allsites/images/GAYDON_BUILDING_NIGHT_thumb_7b2be8f9-4815-4ab7-976d-7fa44509841f.jpg",apiKey:"At3NupJLnvXHzeer9oKb726CUH8_nwQcEnNAwPH46v7KqLawBhfgpRNeWLBv7kcn",defaultCountry:!1,defaultMapView:!1},i=null,d,ht,st=null,ct,y=null,u=n(this),p=u.find("#btnSearch"),k=u.find("#btnClear"),v=u.find("#btnUse"),e=u.find("#txtWhere"),s=u.find(".dealer-results"),o=u.find(".relatedInner"),f=u.find("#countryDealer"),c=u.find("#chkDealers"),h=u.find("#chkServiceCentres"),w=!1;return r=n.extend(g,t),aston.templateCallbacks=function(){var t=function(n){return aston.generic.getTranslatedText(r.language,"dealers",n)},n=function(n,t){return i.setView({center:{latitude:n,longitude:t},zoom:9}),!1};return{getTranslatedText:t,moveToDealer:n}}(),ft(),n(this)}}(jQuery),function(n){n.fn.drive=function(t){function et(){ft(),ut(),nt(),rt(),tt(),typeof r.onInitialise=="function"&&r.onInitialise.call(i,r)}function ft(){f.unbind("click")}function ut(){o.on("change",function(){n(this).val()==="US"||n(this).val()==="USA"?h(!0):h(!1)});u.on("change",function(){w()});f.on("click",function(n){n.preventDefault();switch(r.formType){default:ht()}});i.find("#txtEmail").bind("keyup",function(){p("input#chkEmail",n(this).val().length>0)}),i.find("#txtTelephone").bind("keyup",function(){p("input#chkPhone",n(this).val().length>0)}),i.find("#txtAddress").bind("keyup",function(){p("input#chkPost",n(this).val().length>0)})}function ht(){var it;f.attr("disabled","disabled");var s=i.find("#first_name"),o=i.find("#last_name"),h=i.find("#street"),t=i.find("#city"),et=i.find("#zip"),u=i.find("#email"),nt=i.find("#country"),w=i.find("#txtTelephone"),c=i.find("#txtComments"),ei=s.val(),bt=o.val(),fi=h.val(),ui=t.val(),oi=u.val(),a=r.showCounty?nt.val():"",rt=w.val(),tt=n("#salutation").val(),ti=et.val(),e=n("#country").val(),p=aston.generic.getValueForSelect(i.find("#cmbState")),ni=aston.generic.getValueForSelect(i.find("#ageSelect")),ri=aston.generic.getValueForSelect(i.find("#cmbProfession")),ii=aston.generic.getValueForSelect(i.find("#cmbPurchaseTimeframe")),vi=aston.generic.getValueForSelect(i.find("#cmbManufacturerSelect")),y=aston.generic.getValueForSelect(i.find("#cmbYearOfMake")),v=aston.generic.getValueForSelect(i.find("#cmbYearOfPurchase")),g=i.find("#cmbDealerCountries").val(),d=i.find("#00N2400000G8GEe").val(),ai=aston.generic.getValueForSelect(i.find("#cmbPreferredLanguage")),ut=c.val(),pi=i.find("#chkOne77").is(":checked"),yi=!1,hi=i.find("#chkDB9Coupe").is(":checked")||i.find("#chkDB9Volante").is(":checked"),si=i.find("#chkDBSCoupe").is(":checked")||i.find("#chkDBSVolante").is(":checked"),li=i.find("#chkRapide").is(":checked"),ci=i.find("#chkVirageCoupe").is(":checked")||i.find("#chkVirageVolante").is(":checked"),yt=i.find("#chkV8VantageCoupe").is(":checked")||i.find("#chkV8VantageRoadster").is(":checked"),at=i.find("#chkV8VantageSCoupe").is(":checked")||i.find("#chkV8VantageSRoadster").is(":checked"),vt=i.find("#chkV12Vantage").is(":checked")||i.find("#chkV12VantageRoadster").is(":checked"),ct=i.find("#chkVanquishCoupe").is(":checked")||i.find("#chkVanquishVolante").is(":checked"),lt=!1,pt=i.find("#chkEmail").is(":checked"),dt=i.find("#chkPost").is(":checked"),gt=i.find("#chkSMS").is(":checked"),kt=i.find("#chkPhone").is(":checked"),st=aston.generic.getValueForSelect(i.find("#cmbEvents")),wt=function(){return r.addressIsRequired?h.isValid()&&t.isValid()&&e!=0?!0:!1:!0},b=function(){return r.addressIsRequired?(e=="US"||e=="USA")&&p==0?!1:!0:!0},ot=function(){return g==0||d==0?!1:!0},ht=function(){if(r.formType=="euroWatch"){var n=/^([a-zA-Z0-9_-]){6,17}$/;return c.isValid()&&n.test(ut)?!0:!1}return!0},ft=function(){return r.showEvents?st!=0:!0};a=nt.isValid()?a:"",e=="USA"&&(a=p),rt=w.isValid()?rt:"",y=y==0?"":y,v=v==0?"":v,ot()&&b()&&tt!=0&&s.isValid()&&o.isValid()&&u.isValid(!0)?(f.attr("value","Submitting..."),n("#form1").submit(),it="/js/src/configurator.plugin.js",n.ajax({url:it,async:!1,dataType:"script",success:function(){n(document).configurator()},fail:function(){}})):(f.attr("disabled",!1),n("html,body").animate({scrollTop:k.offset().top},500),k.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),tt==0?i.find("#cmbTitle").parent().addClass("invalid"):i.find("#cmbTitle").parent().removeClass("invalid"),s.isValid()?s.removeClass("invalid"):s.addClass("invalid"),o.isValid()?o.removeClass("invalid"):o.addClass("invalid"),u.isValid(!0)?u.removeClass("invalid"):u.addClass("invalid"),g==0?i.find("#cmbDealerCountries").addClass("invalid"):i.find("#cmbDealerCountries").removeClass("invalid"),d==0?i.find("#cmbDealers").addClass("invalid"):i.find("#cmbDealers").removeClass("invalid"),r.addressIsRequired&&(h.isValid()?h.removeClass("invalid"):h.addClass("invalid"),t.isValid()?t.removeClass("invalid"):t.addClass("invalid"),b()?i.find("#cmbState").parent().removeClass("invalid"):i.find("#cmbState").parent().addClass("invalid"),e==0?i.find("#cmbCountry").parent().addClass("invalid"):i.find("#cmbCountry").parent().removeClass("invalid")),r.formType=="euroWatch"&&(ht()?c.removeClass("invalid"):c.addClass("invalid")),r.showEvents&&(ft()?l.parent().removeClass("invalid"):l.parent().addClass("invalid")))}function h(n){var t=e.closest(".jquery-selectbox");n?(i.find("#txtCounty").hide(),t.length>0?t.show():e.show()):(i.find("#txtCounty").show(),aston.windowLoaded?t.hide():t.length>0?t.hide():e.hide())}function st(t){var o=aston.generic.getTranslatedText(r.language,"forms","selectYourDealerText"),e='<option value="0">'+o+"</option>",i,f;t!=null&&typeof t!=undefined&&(f=u.val(),i=r.data.removeDealers&&r.data.removeDealers.length>0?_.chain(t).filter(function(n){return n.Country==f}).reject(function(n){return _.contains(r.data.removeDealers,n.Id)}).sortBy(function(n){return n.Location}).value():_.chain(t).filter(function(n){return n.Country==f}).sortBy(function(n){return n.Location}).value(),n.each(i,function(n,t){e+='<option value="'+t.Id+'">'+t.Location+"</option>"})),y(!1,e)}function y(t,i,u){var f,i;if(u){var f=aston.generic.getTranslatedText(r.language,"forms","preferredDealerLocationOption"),o=n('<option value="0">'+f+"</option>"),e=n("#eventsTemplate").tmpl(r.data.dealers);i=n.merge(o,e)}else t&&(f=aston.generic.getTranslatedText(r.language,"forms","preferredDealerLocationOption"),i='<option value="0">'+f+"</option>");s=null,s=n("<select />").attr({id:"00N2400000G8GEe",name:"00N2400000G8GEe"}).append(i),ot.empty().append(s),!s.hasClass("styled")}function w(){var n=u.val();n!=="0"&&SitefinityWebApp.ProxyNewsletterWS.GetDealersAndCountries(st,d)}function nt(){var t,n;f.attr("value",aston.generic.getTranslatedText(r.language,"forms","submit")),i.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".address").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".town").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","postcode")),i.find(".email").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","email")),t=r.formType=="events"?"Telephone (inc Country Code)":aston.generic.getTranslatedText(r.language,"forms","telephone"),i.find(".telephone").attr("placeholder",t),n=r.formType=="euroWatch"?"vin":"comments",i.find(".comments").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms",n)),Modernizr.input.placeholder||(i.find(".firstname").attr("value",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("value",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".address").attr("value",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".town").attr("value",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("value",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("value",aston.generic.getTranslatedText(r.language,"forms","postcode")),i.find(".email").attr("value",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("value",t),i.find(".comments").attr("value",aston.generic.getTranslatedText(r.language,"forms",n)))}function rt(){if(r.showCurrentVehicleDetails||i.find("#CurrentVehicleDetails").hide(),r.showDealerDetails||i.find("#DealerDetails").hide(),r.showAgeAndProfession||(i.find("#cmbAge").hide(),i.find("#cmbProfession").hide()),r.showLegalFooter||i.find(".legal-foot").hide(),r.showVehiclesOfInterest||i.find("#VehicleOfInterest").hide(),r.showCounty||i.find("#txtCounty").remove(),r.showEvents&&i.find("#EventDetails").show(),r.showComments||i.find("#Comments").hide(),r.modelsOfInterest.V8VantageSCoupe?n("#chkV8VantageSCoupe").attr("checked",!0).parent().css("background-position","50% -50px"):n("#chkV8VantageSCoupe").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.V8VantageSRoadster?i.find("#chkV8VantageSRoadster").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkV8VantageSRoadster").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.DB9Coupe?i.find("#chkDB9Coupe").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkDB9Coupe").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.V8VantageCoupe?i.find("#chkV8VantageCoupe").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkV8VantageCoupe").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.DB9Volante?i.find("#chkDB9Volante").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkDB9Volante").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.V8VantageRoadster?i.find("#chkV8VantageRoadster").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkV8VantageRoadster").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.Rapide?i.find("#chkRapide").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkRapide").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.V12Vantage?i.find("#chkV12Vantage").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkV12Vantage").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.VanquishCoupe?i.find("#chkVanquishCoupe").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkVanquishCoupe").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.VanquishVolante?i.find("#chkVanquishVolante").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkVanquishVolante").removeAttr("checked").parent().css("background-position","50% 0"),r.modelsOfInterest.V12VantageRoadster?i.find("#chkV12VantageRoadster").attr("checked",!0).parent().css("background-position","50% -50px"):i.find("#chkV12VantageRoadster").removeAttr("checked").parent().css("background-position","50% 0"),r.hideModelsOfInterest.V8VantageSCoupe&&i.find("#chkV8VantageSCoupe").parent(".checkboxWrap").hide(),r.hideModelsOfInterest.V8VantageSRoadster&&i.find("#chkV8VantageSRoadster").parent(".checkboxWrap").hide(),r.hideModelsOfInterest.DB9Coupe&&i.find("#chkDB9Coupe").parent(".checkboxWrap").hide(),r.hideModelsOfInterest.V8VantageCoupe&&i.find("#chkV8VantageCoupe").parent(".checkboxWrap").hide(),r.hideModelsOfInterest.DB9Volante&&i.find("#chkDB9Volante").parent(".checkboxWrap").hide(),r.hideModelsOfInterest.V8VantageRoadster&&i.find("#chkV8VantageRoadster").parent(".checkboxWrap").hide(),r.hideModelsOfInterest.Rapide&&i.find("#chkRapide").parent(".checkboxWrap").hide(),r.hideModelsOfInterest.V12Vantage&&i.find("#chkV12Vantage").parent(".checkboxWrap").hide(),r.hideModelsOfInterest.VanquishCoupe&&i.find("#chkVanquishCoupe").parent(".checkboxWrap").hide(),r.hideModelsOfInterest.VanquishVolante&&i.find("#chkVanquishVolante").parent(".checkboxWrap").hide(),r.hideModelsOfInterest.V12VantageRoadster&&i.find("#chkV12VantageRoadster").parent(".checkboxWrap").hide(),!r.showDerivativeDescription){var t=it.find(".small span");n.each(t,function(n,t){t.innerHTML=t.innerHTML.replace("Coupe","").replace("COUPE","")})}r.formType=="euroWatch"&&c.init(),r.showTermsAndConditions||i.find("#termsAndConditions").hide()}function p(n,t){t?i.find(n).attr("checked",!0).parent().css("background-position","50% -50px"):i.find(n).removeAttr("checked").parent().css("background-position","50% 0")}function tt(){i.hasClass("styled")||(i.find(":radio").wrap('<div class="radio"/>'),i.find(".radio").dgStyle(),i.find(":checkbox").wrap('<div class="checkbox"/>'),i.find(".checkbox").dgStyle())}function d(){alert("Sorry an error has occured, please try again later")}var r={},g={formType:"Drive",campaignId:66,showCurrentVehicleDetails:!0,showDealerDetails:!0,showAgeAndProfession:!0,showVehiclesOfInterest:!0,showLegalFooter:!0,showDerivativeDescription:!0,showComments:!0,showCounty:!0,showEvents:!1,showTermsAndConditions:!0,countryOptions:null,eventOptions:null,preferredCountry:!1,preferredDealerCountry:!1,preferredDealer:!1,leadsAreApproved:!0,modelsOfInterest:{V8VantageSCoupe:!1,V8VantageSRoadster:!1,DB9Coupe:!1,V8VantageCoupe:!1,DB9Volante:!1,V8VantageRoadster:!1,Rapide:!1,V12Vantage:!1,Cygnet:!1,VanquishCoupe:!1,VanquishVolante:!1,V12VantageRoadster:!1},hideModelsOfInterest:{V8VantageSCoupe:!1,V8VantageSRoadster:!1,DB9Coupe:!1,V8VantageCoupe:!1,DB9Volante:!1,V8VantageRoadster:!1,Rapide:!1,V12Vantage:!1,Cygnet:!1,VanquishCoupe:!1,VanquishVolante:!1,V12VantageRoadster:!1},formCompleteRedirect:!1,language:"en",addressIsRequired:!0,dealerIsRequired:!0,prePopulate:!1,countryOptions:!1,updateExisting:!1,onInitialise:n.noop,onSubmit:n.noop,configuratorMode:!1,data:{removeDealers:[],dealerCountries:[],dealers:[]}},i=this,b=n("#driveFormComplete"),f=i.find("#btnSubmit"),a=i.find("#cmbTitle"),o=i.find("#cmbCountry"),u=i.find("#cmbDealerCountries"),ot=i.find("#dealers"),s,e=i.find("#cmbState"),v=i.find("#cmbManufacturerSelect"),k=i.find("#requiredFields"),it=i.find(".vehicle"),l=i.find("#cmbEvents"),c;return r=n.extend(g,t),c={showToolTip:function(){var i=n(this);return(text=n(this).next(".show-tooltip-text"),text.attr("class")!="show-tooltip-text")?!1:(text.fadeIn().css("top",i.position().top+15).css("left",i.position().left+i.outerWidth()),!1)},hideToolTip:function(){var i=n(this).next(".show-tooltip-text");if(i.attr("class")!="show-tooltip-text")return!1;i.fadeOut()},init:function(){n(".show-tooltip").each(function(){n(this).after(n("<span/>").attr("class","show-tooltip-text").html(n(this).data("tooltiptext"))).data("tooltiptext","")}).hover(c.showToolTip,c.hideToolTip).show()}},et(),n(this).addClass("styled")}}(jQuery),function(n){n.fn.questionnaire=function(t){function b(){if(h===""){l();return}nt(i,f),tt(),g()}function tt(){n('input[value="Other"]').live("click",function(){var i=n(this),r=i.is(":checked"),u=i.data("show"),t=n(u);r?t.removeClass("hidden"):t.addClass("hidden")})}function nt(t,i){n.each(u.questions,function(i,r){switch(r.questionType){case"radioGroup":n("#radioGroupTemplate").tmpl(r).appendTo(t);break;case"radioGroupCustom":n("#radioGroupCustomTemplate").tmpl(r).appendTo(t);break;case"otherRadioGroup":n("#otherRadioGroupTemplate").tmpl(r).appendTo(t);break;case"multiGroup":n("#multiTemplate").tmpl(r).appendTo(t);break;case"yesNo":n("#yesNoTemplate").tmpl(r).appendTo(t);break;case"longText":n("#longTextTemplate").tmpl(r).appendTo(t);break;case"multiLineText":n("#multiLineTextTemplate").tmpl(r).appendTo(t);break;case"dragAndDrop":n("#dragAndDropTemplate").tmpl(r).appendTo(t)}});i.on("click",function(n){n.preventDefault(),p()});t.append(i);t.find("input[maxlength], textarea[maxlength]").on("keyup",function(){o(n(this))}).on("keydown",function(){o(n(this))}).on("focus",function(){o(n(this))})}function g(){if(i.find(".sortable").sortable({axis:"y"}),aston.ie){var t=i.find('input[type="text"]');t.each(function(){var t=n(this);t.attr("value",t.val()==""?t.attr("placeholder"):t.val())})}}function o(t){var i=t,r=parseInt(i.attr("maxlength"));i.val().length>r&&(i.val(i.val().substr(0,r)),n.proxy(e.onLimitCallback,t)()),n.proxy(e.onEditCallback,t)(r-i.val().length)}function w(t){var h,i,s,c,r,u,o,f,e;t.isValid=!0;switch(t.questionType){case"radioGroup":case"otherRadioGroup":case"yesNo":case"radioGroupCustom":return i=n('input[name="Answer'+t.questionNumber+'"]:checked'),r=i.val(),r=="Other"&&(u=n("#Answer"+t.questionNumber+"Other").val(),aston.generic.isStringNullOrEmpty(u)?t.isValid=!1:r=u),r;case"multiGroup":return h=n(".q"+t.questionNumber+":checked"),i="",h.each(function(t,r){s=n(r).val(),s=="Other"&&(c=!0),i+=s+", "}),r=n.trim(i).replace(/,*$/,""),c&&(u=n("#Answer"+t.questionNumber+"Other").val(),aston.generic.isStringNullOrEmpty(u)?t.isValid=!1:r+=", "+u),r;case"longText":case"multiLineText":return i=n("#Answer"+t.questionNumber),i.val();case"dragAndDrop":for(i=n("#Answer"+t.questionNumber),o=i.sortable("toArray"),f="",e=0;e<o.length;e++)f+=o[e]+",";return f.substring(0,f.length-1)}return""}function s(t,i){var r;switch(t.questionType){case"radioGroup":case"otherRadioGroup":case"yesNo":case"radioGroupCustom":r=n('input[name="Answer'+t.questionNumber+'"]'),i?r.parent().prev("p").addClass("invalid"):r.parent().prev("p").removeClass("invalid");break;case"multiGroup":r=n(".q"+t.questionNumber),i?r.parent().prev("p").addClass("invalid"):r.parent().prev("p").removeClass("invalid");break;case"longText":case"multiLineText":r=n("#Answer"+t.questionNumber),i?r.prev().addClass("invalid"):r.prev().removeClass("invalid")}}function p(){var i,t,o,e;f.attr("disabled","disabled"),i=!0,r.EmailRecId=h,r.AxCampaignId=u.campaignId,n.each(u.questions,function(n,u){t=w(u),u.isRequired&&(!u.isValid||aston.generic.isStringNullOrEmpty(t)?(i=!1,s(u,!0)):s(u,!1)),r.Answers.push(new y(u.questionNumber,t))}),i?(f.attr("value","Submitting..."),e=JSON.stringify({response:r}),n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWS.asmx/AddQuestionnaireAnswers",contentType:"application/json; charset=utf-8",data:e,dataType:"json",success:v,error:a})):(n("html,body").animate({scrollTop:c.offset().top},500),c.empty().html("<p>Please enter all of the required fields</p>"),f.attr("disabled",!1),r.Answers=[])}function y(n,t){this.AnswerNumber=n,this.AnswerText=t}function v(n){n&&l()}function l(){i.fadeOut("slow",function(){k.removeClass("hidden")})}function a(){alert("Sorry an error has occured, please try again later")}var u={},d={campaignId:66},i=this,k=n(".complete"),f=i.find("input.submit"),c=n("#errorMessage"),r={Answers:[]},h=aston.generic.getQueryStringValue("rId",""),e;return u=n.extend(d,t),b(),e={onEditCallback:function(t){n(this).next(".remaining-characters").text(t+" characters remaining"),t>0&&n(this).next(".remaining-characters").css("color","#333")},onLimitCallback:function(){n(this).next(".remaining-characters").css("color","red")}},this}}(jQuery),function(n){n.fn.eventsForm=function(t){function nt(){f.on("change",function(){n(this).val()=="US"||n(this).val()=="USA"?e(!0):e(!1)});tt.parent().on("click",function(){var t=n(this).find("input").val();n("#"+t).toggleClass("hidden"),n("#"+t).find("input").removeClass("checked").removeAttr("checked").parent().css("background-position","50% 0px")});i.find("#txtEmail").bind("keyup",function(){s("input#chkEmail",n(this).val().length>0)}),i.find("#txtTelephone").bind("keyup",function(){s("input#chkPhone",n(this).val().length>0)}),i.find("#txtAddress").bind("keyup",function(){s("input#chkPost",n(this).val().length>0)})}function g(){n.when(h("GetTitles",[],"titles")).then(function(n){it(n)}),n.when(h("GetAddressCountries",[],"countries")).then(function(n){d(n)}),n.when(h("GetStatesForCountry",["country","USA"],"states")).then(function(n){y(n)})}function h(t,i,r){var u,f;if(aston.cache[r])return aston.cache[r];if(u="",i.length>0)for(f=0;f<i.length;f+=2)u.length>0&&(u+=","),u+='"'+i[f]+'":"'+i[f+1]+'"';return u="{"+u+"}",n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/"+t,contentType:"application/json; charset=utf-8",data:u,dataType:"json",success:function(n){aston.cache[r]=n},error:a})}function e(n){n?(i.find("#txtCounty").hide(),aston.windowLoaded?u.closest(".jquery-selectbox").show():u.show()):(i.find("#txtCounty").show(),aston.windowLoaded?u.closest(".jquery-selectbox").hide():u.hide())}function it(t){var u=aston.generic.getTranslatedText(r.language,"forms","titleOption"),i='<option value="0">'+u+"</option>";n.each(t.d,function(n,t){i+='<option value="'+t.Id+'">'+t.English+"</option>"}),o.append(i),o.hasClass("styled")||o.selectbox().addClass("styled")}function d(t){var e=aston.generic.getTranslatedText(r.language,"forms","countryOption"),i='<option value="0">'+e+"</option>",u=n("#countryTemplate").tmpl(t.d);i+=p().html(),f.append(i,u),r.preferredCountry&&f.val(r.preferredCountry),f.hasClass("styled")||f.selectbox().addClass("styled")}function p(t){var i,u;switch(r.langauge){case"de":i=[{value:"DEU",text:"Germany"},{value:"AUT",text:"Austria"},{value:"CHE",text:"Switzerland"}];break;default:i=[{value:"DEU",text:"Germany"},{value:"GBR",text:"United Kingdom"},{value:"USA",text:"United States"}]}return r.countryOptions!=!1&&Array.isArray(r.countryOptions)&&(i=r.countryOptions),u=t?n("#dealerGroupTemplate").tmpl(i):n("#countryGroupTemplate").tmpl(i),u.last().addClass("seperator"),n("<optgroup />").attr("label","").append(u)}function y(t){var f=aston.generic.getTranslatedText(r.language,"forms","stateOption"),i='<option value="0">'+f+"</option>";n.each(t.d,function(n,t){i+='<option value="'+t.StateId+'">'+t.Name+"</option>"}),u.append(i),u.hasClass("styled")||u.selectbox().addClass("styled"),r.preferredCountry==="US"||r.preferredCountry==="USA"?e(!0):e(!1)}function v(){i.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".address").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".town").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","postcode")),i.find(".email").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".comments").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","comments")),i.find(".model").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","model")),Modernizr.input.placeholder||(i.find(".firstname").attr("value",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("value",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".address").attr("value",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".town").attr("value",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("value",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("value",aston.generic.getTranslatedText(r.language,"forms","postcode")),i.find(".email").attr("value",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("value",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".comments").attr("value",aston.generic.getTranslatedText(r.language,"forms","comments")),i.find(".model").attr("value",aston.generic.getTranslatedText(r.language,"forms","model")))}function s(n,t){t?i.find(n).attr("checked",!0).parent().css("background-position","50% -50px"):i.find(n).removeAttr("checked").parent().css("background-position","50% 0")}function b(){i.hasClass("styled")||(i.find(":radio").wrap('<div class="radio"/>'),i.find(".radio").dgStyle(),i.find(":checkbox").wrap('<div class="checkbox"/>'),i.find(".checkbox").dgStyle(),i.find("select.static").selectbox())}function a(){alert("Sorry an error has occured, please try again later")}var r={},w={formType:"Events",campaignId:82,preferredCountry:!1,leadsAreApproved:!1,formCompleteRedirect:!1,language:"en",countryOptions:!1},i=this,k=n("#eventsFormComplete"),ut=i.find("#CountryContent"),rt=i.find("#StateContent"),c=i.find("#btnSubmit"),o=i.find("#cmbTitle"),f=i.find("#cmbCountry"),u=i.find("#cmbState"),tt=i.find(".events").find("input"),l=i.find("#requiredFields");return r=n.extend(w,t),refresh(),nt(),v(),g(),b(),n(this).addClass("styled")}}(jQuery),function(n){n.fn.contactForm=function(t){function ut(){u.unbind("click")}function d(){u.on("click",function(n){n.preventDefault(),r.mode.Newsletter?st():it()})}function tt(){u.attr("value","Submit"),i.find("#cmbCountry").show(),i.find("#contactTitle").show(),i.find("#contactCopy").hide(),i.find("#txtTelephone").show(),i.find("#txtComments").show(),l.hide(),i.find("#options").hide(),i.find("#cmbFranchise").show(),i.find("#txtDealerName").hide(),i.find("#txtDealerComments").hide(),i.find("#txtCompany").hide(),r.mode.Newsletter&&(i.find("#contactTitle").hide(),i.find("#txtTelephone").hide(),i.find("#txtComments").hide(),i.find("#contactCopy").show()),r.mode.Franchising||i.find("#cmbFranchise").hide(),r.mode.WorksService&&(i.find("#options").show(),l.show()),r.mode.DealerFeedback&&(i.find("#txtDealerName").show(),i.find("#txtDealerComments").show(),i.find("#txtComments").hide()),r.mode.Licencees&&i.find("#txtCompany").show()}function it(){var l;u.attr("disabled","disabled");var a=aston.generic.getValueForSelect(i.find("#cmbTitle")),y=aston.generic.getValueForSelect(i.find("#cmbCountry")),o=i.find("#txtFirstName"),f=i.find("#txtLastName"),e=i.find("#txtEmail"),tt=i.find("#txtTelephone"),it=i.find("#txtComments"),h=i.find("#txtDealerName"),nt=i.find("#txtDealerComments"),b=i.find("#txtCompany"),et=o.val(),ut=f.val(),rt=e.val(),g=tt.val(),w=it.val(),p=h.val(),d=nt.val(),k=b.val(),t="";r.mode.WorksService&&(t+="The area(s) of works service I am interested in: ",ft.each(function(){n(this).is(":checked")&&(t+=n(this).val()+", \n")})),r.mode.Franchising&&(t=aston.generic.getValueForSelect(i.find("#cmbFranchise"))),r.mode.DealerFeedback&&(t=p,w=d),r.mode.Licencees&&(t="Company: "+k),l=function(){return r.mode.DealerFeedback?p==""?!1:!0:!0},a!=0&&y!=0&&o.isValid()&&f.isValid()&&e.isValid(!0)&&l()?(u.attr("value","Submitting..."),SitefinityWebApp.ProxyNewsletterWS.ContactUs(ot(),a,et+" "+ut,y,w,rt,t,g,v,c)):(u.attr("disabled",!1),n("html,body").animate({scrollTop:s.offset().top},500),s.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),a==0?i.find("#cmbTitle").parent().addClass("invalid"):i.find("#cmbTitle").parent().removeClass("invalid"),y==0?i.find("#cmbCountry").parent().addClass("invalid"):i.find("#cmbCountry").parent().removeClass("invalid"),o.isValid()?o.removeClass("invalid"):o.addClass("invalid"),f.isValid()?f.removeClass("invalid"):f.addClass("invalid"),e.isValid(!0)?e.removeClass("invalid"):e.addClass("invalid"),l()?h.removeClass("invalid"):h.addClass("invalid"))}function ot(){var t=1;return n.each(r.mode,function(n){if(typeof a[n]!="undefined")return t=a[n],!1}),t}function st(){u.attr("disabled","disabled");var e=aston.generic.getValueForSelect(i.find("#cmbTitle")),r=i.find("#txtFirstName"),t=i.find("#txtLastName"),f=i.find("#txtEmail"),a=r.val(),l=t.val(),h=f.val();e!=0&&r.isValid()&&t.isValid()&&f.isValid(!0)?(u.attr("value","Submitting..."),SitefinityWebApp.ProxyNewsletterWS.AddNewsletterSubscriber(e,a,l,h,v,c)):(u.attr("disabled",!1),n("html,body").animate({scrollTop:s.offset().top},500),s.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),e==0?o.parent().addClass("invalid"):o.parent().removeClass("invalid"),r.isValid()?r.removeClass("invalid"):r.addClass("invalid"),t.isValid()?t.removeClass("invalid"):t.addClass("invalid"),f.isValid(!0)?f.removeClass("invalid"):f.addClass("invalid"))}function v(){if(r.formCompleteRedirect){var u=window.location.protocol+"//"+window.location.hostname+window.location.pathname;window.location.href=u+"/"+r.formCompleteRedirect}else i.fadeOut("slow",function(){n("#enquireForm").hide(),rt.removeClass("hidden").show()})}function et(){n.when(h("GetTitles",[],"titles")).then(function(n){b(n)}),n.when(h("GetAddressCountries",[],"countries")).then(function(n){p(n)}),n.when(h("GetFranchiseOpportunityLocations",[],"franchise")).then(function(n){g(n)})}function h(t,i,r){var u,f;if(aston.cache[r])return aston.cache[r];if(u="",i.length>0)for(f=0;f<i.length;f+=2)u.length>0&&(u+=","),u+='"'+i[f]+'":"'+i[f+1]+'"';return u="{"+u+"}",n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/"+t,contentType:"application/json; charset=utf-8",data:u,dataType:"json",success:function(n){aston.cache[r]=n},error:c})}function b(t){var u=aston.generic.getTranslatedText(r.language,"forms","titleOption"),i='<option value="0">'+u+"</option>";n.each(t.d,function(n,t){i+='<option value="'+t.Id+'">'+t.English+"</option>"}),o.append(i),o.hasClass("styled")||o.selectbox().addClass("styled")}function p(t){var i=f.closest(".jquery-selectbox");if(r.mode.Newsletter)i.length>0?i.hide():f.hide();else{var o=aston.generic.getTranslatedText(r.language,"forms","countryOption"),u='<option value="0">'+o+"</option>",e=n("#countryTemplate").tmpl(t.d);u+=y().html(),f.append(u,e),f.hasClass("styled")||f.selectbox().addClass("styled"),i.length>0?i.show():f.show()}}function y(t){var i,u;switch(r.langauge){case"de":i=[{value:"DE",text:"Germany"},{value:"AT",text:"Austria"},{value:"CH",text:"Switzerland"}];break;default:i=[{value:"DE",text:"Germany"},{value:"GB",text:"United Kingdom"},{value:"US",text:"United States"}]}return r.countryOptions!=!1&&Array.isArray(r.countryOptions)&&(i=r.countryOptions),u=t?n("#dealerGroupTemplate").tmpl(i):n("#countryGroupTemplate").tmpl(i),u.last().addClass("seperator"),n("<optgroup />").attr("label","").append(u)}function g(t){var f=aston.generic.getTranslatedText(r.language,"forms","franchiseOption"),u='<option value="0">'+f+"</option>",i;n.each(t.d,function(n,t){u+='<option value="'+t+'">'+t+"</option>"}),i=e.closest(".jquery-selectbox"),r.mode.Franchising?(e.append(u),e.hasClass("styled")||e.selectbox().addClass("styled"),i.length>0?i.show():e.show()):i.length>0?i.hide():e.hide()}function nt(){i.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".email").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".comments").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","comments")),i.find(".dealername").attr("placeholder","Dealer Name"),i.find(".company").attr("placeholder","Company"),Modernizr.input.placeholder||(i.find(".firstname").attr("value",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("value",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".email").attr("value",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("value",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".comments").attr("value",aston.generic.getTranslatedText(r.language,"forms","comments")),i.find(".dealername").attr("value","Dealer Name"),i.find(".company").attr("value","Company"))}function k(){i.hasClass("styled")||(i.find(":radio").wrap('<div class="radio"/>'),i.find(".radio").dgStyle(),i.find(":checkbox").wrap('<div class="checkbox"/>'),i.find(".checkbox").dgStyle(),i.find("select.static").selectbox())}function c(){alert("Sorry an error has occured, please try again later")}var r={},w={language:"en",mode:{Sales:!0,PublicAffairs:!1,Parts:!1,Heritage:!1,WorksService:!1,CustomerService:!1,WebsiteFeedback:!1,Franchising:!1,Investors:!1,Newsletter:!1,DealerFeedback:!1,Licencees:!1},countryOptions:!1,formCompleteRedirect:!1},a={Sales:1,PublicAffairs:2,Parts:3,Heritage:4,WorksService:5,CustomerService:6,WebsiteFeedback:7,Franchising:9,Investors:10,DealerFeedback:11,Licencees:12},i=this,rt=n("#contactFormComplete"),o=i.find("#cmbTitle"),f=i.find("#cmbCountry"),e=i.find("#cmbFranchise"),u=i.find("#btnSubmit"),l=i.find("#worksServiceOptions"),ft=l.find("input"),s=i.find("#requiredFields");return r=n.extend(w,t),ut(),d(),nt(),tt(),et(),k(),n(this).addClass("styled")}}(jQuery),function(n){n.fn.booking=function(t){function kt(){if(l===""||r.axCampaignId===""||et===""){d();return}aston.generic.isStringNullOrEmpty(ft)||(r.axCampaignId=ft),yt(),dt(),bt(),wt(),at()}function yt(){c.parent().bind("click check",function(){f("#bookingCantMakeIt",!1),f("#bookingHasGuest",!0),p.hasClass("hidden")?(f("#bookingHasGuest",!0),p.removeClass("hidden")):p.hasClass("hidden")}),h.parent().bind("click check",function(){if(!r.showAdditionalGuest&&h.attr("checked")=="checked"){f("#bookingCantMakeIt",!1);return}f("#bookingHasGuest",!1),f("#bookingCantMakeIt",!0),p.addClass("hidden")});o.on("click",function(n){n.preventDefault(),ht()});n("#txtEmail").bind("keyup",function(){f("input#chkEmail",n(this).val().length>0)}),n("#txtHome, #txtMobile").bind("keyup",function(){f("input#chkPhone",n(this).val().length>0)}),i.find("#txtAddress").bind("keyup",function(){UpdateCheckBoxes("input#chkPost",n(this).val().length>0)})}function dt(){o.attr("value",aston.generic.getTranslatedText(r.language,"forms","submit")),i.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".address").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".town").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","postcode")),i.find(".email").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".mobile").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","mobile")),i.find(".comments").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","comments")),i.find(".guestName").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","guestName")),i.find(".guestEmail").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","guestEmail")),Modernizr.input.placeholder||(i.find(".firstname").attr("value",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("value",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".address").attr("value",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".town").attr("value",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("value",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("value",aston.generic.getTranslatedText(r.language,"forms","postcode")),i.find(".email").attr("value",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("value",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".mobile").attr("value",aston.generic.getTranslatedText(r.language,"forms","mobile")),i.find(".comments").attr("value",aston.generic.getTranslatedText(r.language,"forms","comments")),i.find(".guestName").attr("value",aston.generic.getTranslatedText(r.language,"forms","guestName")),i.find(".guestEmail").attr("value",aston.generic.getTranslatedText(r.language,"forms","guestEmail")))}function bt(){r.showAdditionalGuest||c.parent(".checkboxWrap").hide()}function d(){i.empty().hide(),ut.empty().hide(),st.hide(),n(".introCopy").hide();var f=aston.generic.getTranslatedText(r.language,"forms","sorryError"),u=aston.generic.getTranslatedText(r.language,"forms","sorryCopy"),t="<h1><em>"+f+"</em></h1><p>"+u+"</p>";ot.fadeIn("fast",function(){n(this).addClass("errorContent").css("text-align","center").html(t)})}function wt(){SitefinityWebApp.ProxyNewsletterWS.EventCheckAlreadyAttending(l,ii,u)}function ii(t){if(t==!0){var e=aston.generic.getTranslatedText(r.language,"forms","bookingSuccess"),f='<div class="genericForm"><p>'+e+"</p></div>";i.hide(),ot.fadeIn("fast",function(){n(this).html(f)})}else SitefinityWebApp.ProxyNewsletterWS.EventGetAttendeeDetails(l,et,ti,u)}function tt(){SitefinityWebApp.ProxyNewsletterWS.GetAvailableDates(r.axCampaignId,ri,u)}function ri(t){var i,u;s.empty(),t.length==0?(c.hide(),h.hide(),i=aston.generic.getTranslatedText(r.language,"forms","availablePlacesError"),n("p.availableDatesError").empty().html("<p>"+i+"</p>")):(i=aston.generic.getTranslatedText(r.language,"forms","availableDatesOption"),u='<option value="0">'+i+"</option>",n.each(t,function(n,t){u+='<option value="'+t+'">'+t+"</option>"}),s.append(u).selectbox())}function ti(n){n!==null?i.fadeIn("slow",function(){k=n.Title,a=n.CountryRegionId,r.loadDatesFromDatabase&&tt(),SitefinityWebApp.ProxyNewsletterWS.GetTitles(gt,u),SitefinityWebApp.ProxyNewsletterWS.GetAddressCountries(ct,u),SitefinityWebApp.ProxyNewsletterWS.GetStatesForCountry("USA",ni,u),i.find("#bookingContactId").val(n.ContactId),n.FirstName!==""&&i.find("#txtFirstName").val(n.FirstName).attr("disabled",!0),n.LastName!==""&&i.find("#txtLastName").val(n.LastName).attr("disabled",!0),n.Street!==""&&i.find("#txtAddress").val(n.Street),n.City!==""&&i.find("#txtTown").val(n.City),n.State!==""&&i.find("#txtCounty").val(n.State),n.Postcode!==""&&i.find("#txtPostcode").val(n.Postcode),n.Email!==""&&i.find("#txtEmail").val(n.Email),n.HomePhoneNumber!==""&&i.find("#txtHome").val(n.HomePhoneNumber),n.MobilePhoneNumber!==""&&i.find("#txtMobile").val(n.MobilePhoneNumber),n.CanEmail&&i.find("#chkEmail").attr("checked",!0).parent().css("background-position","50% -50px"),n.CanPhone&&i.find("#chkPhone").attr("checked",!0).parent().css("background-position","50% -50px"),n.CanPost&&i.find("#chkPost").attr("checked",!0).parent().css("background-position","50% -50px"),n.CanSMS&&i.find("#chkSMS").attr("checked",!0).parent().css("background-position","50% -50px")}):d()}function gt(t){var u=aston.generic.getTranslatedText(r.language,"forms","titleOption"),i='<option value="0">'+u+"</option>";n.each(t,function(n,t){i+='<option value="'+t.Id+'">'+t.English+"</option>"}),w.append(i),k&&w.val(k),w.hasClass("styled")||w.selectbox().addClass("styled")}function ni(t){var u=aston.generic.getTranslatedText(r.language,"forms","stateOption"),i='<option value="0">'+u+"</option>";n.each(t,function(n,t){i+='<option value="'+t.StateId+'">'+t.Name+"</option>"}),e.append(i),e.hasClass("styled")||e.selectbox().addClass("styled"),a==="US"||a==="USA"?nt(!0):nt(!1)}function ct(t){var f=aston.generic.getTranslatedText(r.language,"forms","countryOption"),i='<option value="0">'+f+"</option>",u=n("#countryTemplate").tmpl(t);i+=lt().html(),y.append(i,u),a&&y.val(a),y.hasClass("styled")||y.selectbox().addClass("styled")}function lt(t){var i,u;switch(r.langauge){case"de":i=[{value:"DEU",text:"Germany"},{value:"AUT",text:"Austria"},{value:"CHE",text:"Switzerland"}];break;default:i=[{value:"DEU",text:"Germany"},{value:"GBR",text:"United Kingdom"},{value:"USA",text:"United States"}]}return r.countryOptions!=!1&&Array.isArray(r.countryOptions)&&(i=r.countryOptions),u=t?n("#dealerGroupTemplate").tmpl(i):n("#countryGroupTemplate").tmpl(i),u.last().addClass("seperator"),n("<optgroup />").attr("label","").append(u)}function ht(){var ft,et;o.attr("disabled","disabled");var at=i.find("#bookingContactId").val(),kt=i.find("#txtFirstName"),bt=i.find("#txtLastName"),gt=i.find("#txtAddress"),dt=i.find("#txtTown"),e=i.find("#txtEmail"),yt=i.find("#txtCounty"),vt=i.find("#txtPostcode"),wt=i.find("#txtHome"),pt=i.find("#txtMobile"),ni=kt.val(),ei=bt.val(),fi=gt.val(),si=dt.val(),tt=e.val(),oi=yt.val(),ii=vt.val(),ti=wt.val(),ui=pt.val(),ri=i.find("#chkEmail").is(":checked"),ot=i.find("#chkPost").is(":checked"),st=i.find("#chkSMS").is(":checked"),ht=i.find("#chkPhone").is(":checked"),p=c.is(":checked"),ut=h.is(":checked"),t=i.find("#bookingGuestName"),f=i.find("#bookingGuestEmail"),w=!1,k=aston.generic.getValueForSelect(i.find("#cmbTitle")),y=aston.generic.getValueForSelect(i.find("#cmbCountry")),a=aston.generic.getValueForSelect(i.find("#cmbAvailableDates"));if(w=function(){return ut?!0:a==0?!1:p&&(t.val()===""||!f.isValid())?!1:!0},w()&&k!=0&&y!=0&&e.isValid(!0))if(o.attr("value","Submitting..."),b={ContactId:at,Title:k,FirstName:ni,LastName:ei,Email:tt,Street:fi,City:si,State:oi,Postcode:ii,CountryregionId:y,CanPost:ot,CanPhone:ht,CanSms:st,CanEmail:ri,HomePhoneNumber:ti,MobilePhoneNumber:ui},ut)rt();else if(et=r.language=="en"?"en-gb":r.language,r.confirmAttendanceAsLead){var ct=aston.generic.getValueForSelect(s),lt=n(aston.dates).filter(function(){return this.id==ct}),nt=lt.get(0),d="Attending {{EventName}} on {{EventDate}}".replace("{{EventName}}",r.eventName).replace("{{EventDate}}",nt.date);d+=c.is(":checked")?"\n1 guest attending, guest name "+t.val()+", guest email "+f.val():"\nNo guest attending",g=nt.date,SitefinityWebApp.ProxyNewsletterWS.EventConfirmAttendenceAsLead(l,r.axCampaignId,nt.brId,d,it,u)}else SitefinityWebApp.ProxyNewsletterWS.EventConfirmAttendance(l,r.axCampaignId,a,p,t.val(),f.val(),tt,et,it,u);else o.attr("disabled",!1),ft=aston.generic.getTranslatedText(r.language,"forms","requiredFields"),n("html,body").animate({scrollTop:v.offset().top},500),v.empty().html('<p style="color: red;">'+ft+"</p>"),k==0?i.find("#cmbTitle").parent().addClass("invalid"):i.find("#cmbTitle").parent().removeClass("invalid"),y==0?i.find("#cmbCountry").parent().addClass("invalid"):i.find("#cmbCountry").parent().removeClass("invalid"),e.isValid(!0)?e.removeClass("invalid"):e.addClass("invalid"),w()||(a==0?s.parent().addClass("invalid"):s.parent().removeClass("invalid"),p&&(t.isValid()?t.removeClass("invalid"):t.addClass("invalid"),f.isValid(!0)?f.removeClass("invalid"):f.addClass("invalid")))}function it(t){if(t==!0)rt();else{var i=aston.generic.getTranslatedText(r.language,"forms","bookingError");n("html,body").animate({scrollTop:v.offset().top},500),v.empty().html('<p style="color: red;">'+i+"</p>"),o.attr("disabled",!1).attr("value","Submit"),tt()}}function rt(){typeof b!==undefined&&SitefinityWebApp.ProxyNewsletterWS.EventUpdateAttendeeDetails(b,vt,u)}function vt(){var u,e=aston.generic.getTranslatedText(r.language,"forms","bookingThanks"),o=aston.generic.getTranslatedText(r.language,"forms","bookingConfirm"),f;h.is(":checked")?u='<div class="genericForm"><p>'+e+"</p></div>":(f=r.loadDatesFromDatabase?s.val():g,u='<div class="genericForm"><p>'+o+f+"</p></div>"),i.hide(),st.hide(),ut.fadeIn("fast",function(){n(this).html(u)})}function nt(n){n?(i.find("#txtCounty").hide(),aston.windowLoaded?e.closest(".jquery-selectbox").show():e.show()):(i.find("#txtCounty").show(),aston.windowLoaded?e.closest(".jquery-selectbox").hide():e.hide())}function f(n,t){t?i.find(n).attr("checked",!0).parent().css("background-position","50% -50px"):i.find(n).removeAttr("checked").parent().css("background-position","50% 0")}function at(){n(":radio").wrap('<div class="radio"/>'),n(".radio").dgStyle(),n(":checkbox").wrap('<div class="checkbox"/>'),n(".checkbox").dgStyle(),n("select.static").selectbox()}function u(){alert("Sorry an error has occured, please try again later")}var r={},pt={language:"en",axCampaignId:123,showAdditionalGuest:!0,confirmAttendanceAsLead:!1,loadDatesFromDatabase:!0,eventName:"Event",countryOptions:!1},i=this,st=n("#formCopy"),ut=n("#bookingFormComplete"),ot=n("#bookingAlreadyEntered"),l=aston.generic.getQueryStringValue("rId",""),et=aston.generic.getQueryStringValue("eId",""),ft=aston.generic.getQueryStringValue("aId",""),c=i.find("#bookingHasGuest"),h=i.find("#bookingCantMakeIt"),p=i.find("#bookingGuestDetails"),w=i.find("#cmbTitle"),e=i.find("#cmbStates"),y=i.find("#cmbCountry"),s=i.find("#cmbAvailableDates"),o=i.find("#btnSubmit"),v=i.find("#requiredFields"),b={},k,a,g;return r=n.extend(pt,t),kt(),this}}(jQuery),function(n){n.fn.mediaRegForm=function(t){function rt(){f.unbind("click")}function nt(t){var f=aston.generic.getTranslatedText(r.language,"forms","stateOption"),i='<option value="0">'+f+"</option>";n.each(t.d,function(n,t){i+='<option value="'+t.StateId+'">'+t.Name+"</option>"}),u.append(i),u.hasClass("styled")||u.selectbox().addClass("styled"),r.preferredCountry==="US"||r.preferredCountry=="USA"?e(!0):e(!1)}function e(n){var t=u.closest(".jquery-selectbox");n?(i.find("#txtCounty").hide(),t.length>0?t.show():u.show()):(i.find("#txtCounty").show(),aston.windowLoaded?t.hide():t.length>0?t.hide():u.hide())}function d(){o.on("change",function(){n(this).val()==="US"||n(this).val()==="USA"?e(!0):e(!1)});f.on("click",function(n){n.preventDefault(),tt()})}function tt(){var tt;f.attr("disabled","disabled");var v=i.find("#txtFirstName"),c=i.find("#txtLastName"),k=i.find("#txtAddress"),ii=i.find("#txtAddress2"),d=i.find("#txtTown"),nt=i.find("#txtCounty"),pt=i.find("#txtPostcode"),h=i.find("#txtTelephone"),bt=i.find("#txtMobile"),o=i.find("#txtEmail"),wt=i.find("#txtJobTitle"),ft=i.find("#txtUrl"),y=i.find("#txtNameOfMedia"),r=i.find("#txtPassword"),u=i.find("#txtRetypePassword"),vt=i.find("#chkAgree").is(":checked"),it=i.find("#chkConfirm").is(":checked"),g=aston.generic.getValueForSelect(i.find("#cmbTitle")),w=aston.generic.getValueForSelect(i.find("#cmbCountry")),yt=aston.generic.getValueForSelect(i.find("#cmbEmployment")),ni=aston.generic.getValueForSelect(i.find("#cmbMediaType")),ti=v.val().strip(),kt=c.val().strip(),dt=k.val().strip(),gt=d.val().strip(),b=nt.val().strip(),at=aston.generic.getValueForSelect(i.find("#cmbState")),et=pt.val().strip(),rt=h.val().strip(),ut=bt.val().strip(),ot=o.val().strip(),ct=wt.val().strip(),lt=ft.val().strip(),ht=y.val().strip(),t=r.val().strip(),e=u.val().strip(),st=function(){return t!=""&&t.length>6&&e!=""&&e.length>6&&t==e?!0:!1};b=nt.isValid()?b:"",w=="USA"&&(b=at),st()&&s()&&g!=0&&w!=0&&v.isValid()&&c.isValid()&&h.isValid()&&o.isValid(!0)&&y.isValid()&&it?(f.attr("value","Submitting..."),tt=JSON.stringify({request:{Title:g,FirstName:ti,LastName:kt,Street:dt,TownCity:gt,CountyState:b,PostCode:et,Country:w,Telephone:rt,Mobile:ut,EmailAddress:ot,EmploymentStatus:yt,JobTitle:ct,MediaType:ni,Url:lt,MediaPublications:ht,Password:t,CanContact:vt}}),n.ajax({type:"POST",url:"/Webservices/UserService.asmx/CreateMediaRegistration",contentType:"application/json; charset=utf-8",data:tt,dataType:"json",success:function(n){p(n)},error:function(n,t,i){l(i)}})):(f.attr("disabled",!1),n("html,body").animate({scrollTop:a.offset().top},500),a.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),s()?i.find("#cmbState").parent().removeClass("invalid"):i.find("#cmbState").parent().addClass("invalid"),g==0?i.find("#cmbTitle").parent().addClass("invalid"):i.find("#cmbTitle").parent().removeClass("invalid"),v.isValid()?v.removeClass("invalid"):v.addClass("invalid"),c.isValid()?c.removeClass("invalid"):c.addClass("invalid"),o.isValid(!0)?o.removeClass("invalid"):o.addClass("invalid"),k.isValid()?k.removeClass("invalid"):k.addClass("invalid"),d.isValid()?d.removeClass("invalid"):d.addClass("invalid"),h.isValid()?h.removeClass("invalid"):h.addClass("invalid"),w==0?i.find("#cmbCountry").parent().addClass("invalid"):i.find("#cmbCountry").parent().removeClass("invalid"),y.isValid()?y.removeClass("invalid"):y.addClass("invalid"),it?i.find("#chkConfirm").parent().next(".boxMessage").removeClass("invalid"):i.find("#chkConfirm").parent().next(".boxMessage").addClass("invalid"),!r.isValid()||t.length<7?r.addClass("invalid"):r.removeClass("invalid"),!u.isValid()||e.length<7?u.addClass("invalid"):u.removeClass("invalid"),t!=e?(r.addClass("invalid"),u.addClass("invalid")):r.isValid()&&t.length>6&&u.isValid()&&e.length>6&&(r.removeClass("invalid"),u.removeClass("invalid")))}function p(){i.fadeOut("slow",function(){ut.removeClass("hidden").show()})}function it(){n.when(h("GetTitles",[],"titles")).then(function(n){y(n)}),n.when(h("GetAddressCountries",[],"countries")).then(function(n){v(n)}),n.when(h("GetStatesForCountry",["country","USA"],"states")).then(function(n){nt(n)})}function h(t,i,r){var u,f;if(aston.cache[r])return aston.cache[r];if(u="",i.length>0)for(f=0;f<i.length;f+=2)u.length>0&&(u+=","),u+='"'+i[f]+'":"'+i[f+1]+'"';return u="{"+u+"}",n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/"+t,contentType:"application/json; charset=utf-8",data:u,dataType:"json",success:function(n){aston.cache[r]=n},error:l})}function y(t){var u=aston.generic.getTranslatedText(r.language,"forms","titleOption"),i='<option value="0">'+u+"</option>";n.each(t.d,function(n,t){i+='<option value="'+t.English+'">'+t.English+"</option>"}),c.append(i),c.hasClass("styled")||c.selectbox().addClass("styled")}function v(t){var f=aston.generic.getTranslatedText(r.language,"forms","countryOption"),i='<option value="0">'+f+"</option>",u=n("#countryTemplate").tmpl(t.d);i+=k().html(),o.append(i,u),o.hasClass("styled")||o.selectbox().addClass("styled")}function k(){var u,i;switch(r.langauge){case"de":u=[{value:"DEU",text:"Germany"},{value:"AUT",text:"Austria"},{value:"CHE",text:"Switzerland"}];break;default:u=[{value:"DEU",text:"Germany"},{value:"GBR",text:"United Kingdom"},{value:"USA",text:"United States"}]}return i=n("#countryGroupTemplate").tmpl(u),i.last().addClass("seperator"),n("<optgroup />").attr("label","").append(i)}function b(){f.attr("value",aston.generic.getTranslatedText(r.language,"forms","submit")),i.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".address").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".address2").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","address2")),i.find(".town").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","postcode")),i.find(".email").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".mobile").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","mobile")),i.find(".fax").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","fax")),i.find(".username").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","username")),i.find(".job").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","jobTitle")),i.find(".other").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","other")),i.find(".url").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","url")),i.find(".nameOfMedia").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","nameOfMedia")),i.find(".password").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","password")),i.find(".passwordConfirm").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","retypePassword")),Modernizr.input.placeholder||(i.find(".firstname").attr("value",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("value",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".address").attr("value",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".address2").attr("value",aston.generic.getTranslatedText(r.language,"forms","address2")),i.find(".town").attr("value",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("value",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("value",aston.generic.getTranslatedText(r.language,"forms","postcode")),i.find(".email").attr("value",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("value",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".mobile").attr("value",aston.generic.getTranslatedText(r.language,"forms","mobile")),i.find(".fax").attr("value",aston.generic.getTranslatedText(r.language,"forms","fax")),i.find(".username").attr("value",aston.generic.getTranslatedText(r.language,"forms","username")),i.find(".job").attr("value",aston.generic.getTranslatedText(r.language,"forms","jobTitle")),i.find(".other").attr("value",aston.generic.getTranslatedText(r.language,"forms","other")),i.find(".url").attr("value",aston.generic.getTranslatedText(r.language,"forms","url")),i.find(".nameOfMedia").attr("value",aston.generic.getTranslatedText(r.language,"forms","nameOfMedia")),i.find(".password").attr("value",aston.generic.getTranslatedText(r.language,"forms","password")),i.find(".passwordConfirm").attr("value",aston.generic.getTranslatedText(r.language,"forms","retypePassword")))}function w(){i.hasClass("styled")||(i.find(":radio").wrap('<div class="radio"/>'),i.find(".radio").dgStyle(),i.find(":checkbox").wrap('<div class="checkbox"/>'),i.find(".checkbox").dgStyle(),i.find("select.static").selectbox())}function l(){alert("Sorry an error has occured, please try again later")}var r={},g={language:"en"},i=this,ut=n("#mediaFormComplete"),c=i.find("#cmbTitle"),u=i.find("#cmbState"),o=i.find("#cmbCountry"),f=i.find("#btnSubmit"),a=i.find("#requiredFields"),s;return r=n.extend(g,t),rt(),d(),b(),it(),w(),s=function(){return r.addressIsRequired?(countryValue=="US"||countryValue=="USA")&&stateValue==0?!1:!0:!0},n(this).addClass("styled")}}(jQuery),function(n){n.fn.approvalsForm=function(t){function p(){u.on("change",function(){f()});s.on("change",function(){f()});n("#btn-close").on("click",function(t){t.preventDefault(),e(n(this))});nt.live("click",function(t){t.preventDefault(),e(n(this))}),d.live("click",function(t){t.preventDefault();var i=n(this),r=i.data("regid");h(i,r)}),g.live("click",function(t){t.preventDefault();var i=n(this),r=i.data("regid");o(i,r)}),rt.live("click",function(t){t.preventDefault();var r=n(this),i=r.data("regid");a(i)}),ot.live("click",function(t){t.preventDefault();var i=n(this),r=i.data("regid");h(i,r)}),st.live("click",function(t){t.preventDefault();var i=n(this),r=i.data("regid");o(i,r)}),et.live("click",function(t){t.preventDefault();var r=n(this),i=r.data("regid");a(i)})}function y(){n.when(k("GetMediaRegions",[],"regions")).then(function(n){w(n)})}function w(t){var e="Select Region",i='<option value="">'+e+"</option>",r;n.each(t.d,function(n,t){i+='<option value="'+t.ContinentCode+'">'+t.Continent+"</option>"}),u.append(i),u.hasClass("styled")||(r=aston.generic.getQueryStringValue("cId","0"),u.val(r).selectbox().addClass("styled"),f())}function k(t,i,r){var u,f;if(aston.cache[r])return aston.cache[r];if(u="",i.length>0)for(f=0;f<i.length;f+=2)u.length>0&&(u+=","),u+='"'+i[f]+'":"'+i[f+1]+'"';return u="{"+u+"}",n.ajax({type:"POST",url:"/Webservices/UserService.asmx/"+t,contentType:"application/json; charset=utf-8",data:u,dataType:"json",success:function(n){aston.cache[r]=n},error:function(){alert("Sorry an error has occured, please try again later")}})}function h(n,t){var i=confirm("Are you sure you want to accept this registration?");i&&(e(null,!0),v(n,t,"Approved"))}function o(n,t){var i=confirm("Are you sure you want to reject this registration?");i&&(e(null,!0),v(n,t,"Rejected"))}function a(t){e(null,!0);var i=JSON.stringify({mediaRegistrationId:t});n.ajax({type:"POST",url:"/Webservices/UserService.asmx/RemoveMediaRegistration",contentType:"application/json; charset=utf-8",data:i,dataType:"json",success:f,error:function(){alert("Sorry an error has occured..")}})}function v(t,i,r){var u=t.text(),e;t.attr("disabled","disabled"),t.text(u+"ing..."),e=JSON.stringify({mediaRegistrationId:i,status:r}),n.ajax({type:"POST",url:"/Webservices/UserService.asmx/UpdateMediaRegistration",contentType:"application/json; charset=utf-8",data:e,dataType:"json",success:function(n){var i=JSON.parse(n.d);i.Success==!0?f():(alert(i.UserMessage),t.attr("disabled",!1),t.text(u),window.console&&console.log(i.ErrorMessage))},error:function(n){alert("Sorry an error has occured."),t.attr("disabled",!1),t.text(u),n.responseText&&window.console&&console.log(JSON.parse(n.responseText).Message)}})}function f(){var e=aston.generic.getValueForSelect(s),f=aston.generic.getValueForSelect(u),r=JSON.stringify({status:e,region:f});n.ajax({type:"POST",url:"/Webservices/UserService.asmx/GetMediaRegistrations",contentType:"application/json; charset=utf-8",data:r,dataType:"json",success:function(t){l.fadeOut("fast",function(){c.empty(),ut.tmpl(t.d).appendTo(c),n(this).fadeIn("fast")})},error:function(){alert("Sorry an error has occured, please try again later")}})}function e(t,u){if(r.is(":visible")||u)r.find(".content").empty(),r.hide(),i.css("opacity","1");else{var f=JSON.stringify({mediaRegistrationId:t.data("regid")});n.ajax({type:"POST",url:"/Webservices/UserService.asmx/GetMediaRegistrationById",contentType:"application/json; charset=utf-8",data:f,dataType:"json",success:function(u){var e;i.css("opacity","0.3"),ft.tmpl(u.d).appendTo(r.find(".content")),r.css("top","").css("bottom","");var h=n(".page").width(),s=n(".registrations"),c=s.height(),a=s.position().top,l=t.position().top,o=700,f=l-o/2;f=f<30?30:f,r.css("top",f).css("bottom",""),c<f+o&&r.css("top","").css("bottom",30),e=h/2-r.width()/2,r.css("left",e),r.show()},error:function(){alert("Sorry an error has occured, please try again later")}})}}function b(){n("#themeholder").addClass("approvals"),i.hasClass("styled")||(i.find(":radio").wrap('<div class="radio"/>'),i.find(".radio").dgStyle(),i.find(":checkbox").wrap('<div class="checkbox"/>'),i.find(".checkbox").dgStyle(),i.find("select.static").selectbox())}var tt={},it={language:"en"},i=this,l=i.find(".registrations"),c=l.find("tbody"),nt=i.find(".view"),d=i.find(".accept"),g=i.find(".reject"),rt=i.find(".remove"),s=i.find("#cmbStatus"),u=i.find("#cmbRegion"),r=n("#modal"),ot=r.find(".accept"),st=r.find(".reject"),et=r.find(".remove"),ut=n("#listTemplate"),ft=n("#singleTemplate");return tt=n.extend(it,t),p(),y(),b(),n(this).addClass("styled")}}(jQuery),function(n){n.fn.investorRegForm=function(t){function it(){u.unbind("click")}function nt(){u.on("click",function(n){n.preventDefault(),k()});i.find("input[maxlength], textarea[maxlength]").on("keyup",function(){e(n(this))}).on("keydown",function(){e(n(this))}).on("focus",function(){e(n(this))})}function e(t){var i=t,r=parseInt(i.attr("maxlength"));i.val().length>r&&(i.val(i.val().substr(0,r)),n.proxy(f.onLimitCallback,t)()),n.proxy(f.onEditCallback,t)(r-i.val().length)}function k(){var d;u.attr("disabled","disabled");var f=i.find("#txtFirstName"),r=i.find("#txtLastName"),nt=i.find("#txtCompany"),tt=i.find("#txtAddress"),g=i.find("#txtTown"),k=i.find("#txtCounty"),ut=i.find("#txtPostcode"),it=i.find("#txtTelephone"),t=i.find("#txtEmail"),ft=i.find("#txtReason"),rt=i.find("#chkAgree").is(":checked"),et=i.find("#emailalert").is(":checked"),s=aston.generic.getValueForSelect(i.find("#cmbTitle")),c=aston.generic.getValueForSelect(i.find("#cmbCountry")),st=f.val().strip(),ht=r.val().strip(),o=nt.val().strip(),e=tt.val().strip(),w=g.val().strip(),b=k.val().strip(),y=ut.val().strip(),a=it.val().strip(),ot=t.val().strip(),v=ft.val().strip();o=nt.isValid()?o:"",a=it.isValid()?a:"",e=tt.isValid()?e:"",w=g.isValid()?w:"",b=k.isValid()?b:"",y=ut.isValid()?y:"",v=ft.isValid()?v:"",s!=0&&c!=0&&f.isValid()&&r.isValid()&&t.isValid(!0)&&rt?(u.attr("value","Submitting..."),d=JSON.stringify({request:{Title:s,FirstName:st,LastName:ht,CompanyName:o,Telephone:a,EmailAddress:ot,Street:e,TownCity:w,CountyState:b,Postcode:y,Country:c,AlertEmail:et,Reason:v}}),n.ajax({type:"POST",url:"/Webservices/UserService.asmx/SubmitInvestorRegistrationForApproval",contentType:"application/json; charset=utf-8",data:d,dataType:"json",success:function(n){p(n)},error:function(n,t,i){h(i)}})):(u.attr("disabled",!1),n("html,body").animate({scrollTop:l.offset().top},500),l.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),s==0?i.find("#cmbTitle").parent().addClass("invalid"):i.find("#cmbTitle").parent().removeClass("invalid"),f.isValid()?f.removeClass("invalid"):f.addClass("invalid"),r.isValid()?r.removeClass("invalid"):r.addClass("invalid"),t.isValid(!0)?t.removeClass("invalid"):t.addClass("invalid"),c==0?i.find("#cmbCountry").parent().addClass("invalid"):i.find("#cmbCountry").parent().removeClass("invalid"),rt?i.find("#chkAgree").parent().next(".boxMessage").removeClass("invalid"):i.find("#chkAgree").parent().next(".boxMessage").addClass("invalid"))}function p(){i.fadeOut("slow",function(){g.removeClass("hidden").show()})}function tt(){n.when(c("GetTitles",[],"titles")).then(function(n){y(n)}),n.when(c("GetAddressCountries",[],"countries")).then(function(n){v(n)})}function c(t,i,r){var u,f;if(aston.cache[r])return aston.cache[r];if(u="",i.length>0)for(f=0;f<i.length;f+=2)u.length>0&&(u+=","),u+='"'+i[f]+'":"'+i[f+1]+'"';return u="{"+u+"}",n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/"+t,contentType:"application/json; charset=utf-8",data:u,dataType:"json",success:function(n){aston.cache[r]=n},error:h})}function y(t){var u=aston.generic.getTranslatedText(r.language,"forms","titleOption"),i='<option value="0">'+u+"</option>";n.each(t.d,function(n,t){i+='<option value="'+t.English+'">'+t.English+"</option>"}),s.append(i),s.hasClass("styled")||s.selectbox().addClass("styled")}function v(t){var f=aston.generic.getTranslatedText(r.language,"forms","countryOption"),i='<option value="0">'+f+"</option>",u=n("#countryTemplate").tmpl(t.d);i+=a().html(),o.append(i,u),o.hasClass("styled")||o.selectbox().addClass("styled")}function a(){var u,i;switch(r.langauge){case"de":u=[{value:"DEU",text:"Germany"},{value:"AUT",text:"Austria"},{value:"CHE",text:"Switzerland"}];break;default:u=[{value:"DEU",text:"Germany"},{value:"GBR",text:"United Kingdom"},{value:"USA",text:"United States"}]}return i=n("#countryGroupTemplate").tmpl(u),i.last().addClass("seperator"),n("<optgroup />").attr("label","").append(i)}function b(){u.attr("value",aston.generic.getTranslatedText(r.language,"forms","submit")),i.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".companyname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","companyname")),i.find(".email").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".address").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".town").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","postcode")),Modernizr.input.placeholder||(i.find(".firstname").attr("value",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("value",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".companyname").attr("value",aston.generic.getTranslatedText(r.language,"forms","companyname")),i.find(".email").attr("value",aston.generic.getTranslatedText(r.language,"forms","email")),i.find(".telephone").attr("value",aston.generic.getTranslatedText(r.language,"forms","telephone")),i.find(".address").attr("value",aston.generic.getTranslatedText(r.language,"forms","address")),i.find(".town").attr("value",aston.generic.getTranslatedText(r.language,"forms","town")),i.find(".county").attr("value",aston.generic.getTranslatedText(r.language,"forms","county")),i.find(".postcode").attr("value",aston.generic.getTranslatedText(r.language,"forms","postcode")))}function w(){i.hasClass("styled")||(i.find(":radio").wrap('<div class="radio"/>'),i.find(".radio").dgStyle(),i.find(":checkbox").wrap('<div class="checkbox"/>'),i.find(".checkbox").dgStyle(),i.find("select.static").selectbox())}function h(){alert("Sorry an error has occured, please try again later")}var r={},d={language:"en"},i=this,g=n("#investorFormComplete"),s=i.find("#cmbTitle"),o=i.find("#cmbCountry"),u=i.find("#btnSubmit"),l=i.find("#requiredFields"),f;return r=n.extend(d,t),it(),nt(),b(),tt(),w(),f={onEditCallback:function(t){n(this).next(".remaining-characters").text(t+" characters remaining"),t>0&&n(this).next(".remaining-characters").css("color","#333")},onLimitCallback:function(){n(this).next(".remaining-characters").css("color","red")}},n(this).addClass("styled")}}(jQuery),function(n){n.fn.imageGallery=function(t){function f(){aston.w.bind("am.gallery.resize",function(){n.each(r,function(t,i){var r=n(i).find("li");r.removeClass("last"),n.each(r,function(t){(t+1)%(aston.theme=="xlarge"?5:4)==0&&n(this).addClass("last")})})})}function e(){u.addClass("gallery-controls"),aston.w.trigger("am.gallery.resize"),s.fancybox({openEffect:"none",padding:0,helpers:{title:null},afterLoad:function(){var t="";i.showDownload&&(t+='<a href="'+this.href+'" class="download" target="_blank">Download</a>'),i.showCaption&&(t+='<p class="caption">'+n(this.element).data("title")+"</p>"),t.length>0&&this.inner.append(t)}})}var i={},o={showCaption:!1,showDownload:!0},u=this,r=u.find(".image-gallery"),s=r.find("a");i=n.extend(o,t),f(),e()}}(jQuery),function(n){n.fn.eventsConfirmationForm=function(t){function et(){y.css("top",r.position().top+10).show(),n.when(ot(),e("GetTitles",[],"titles"),e("GetAddressCountries",[],"countries"),e("GetStatesForCountry",["country","USA"],"states"),e("GetCountries",[],"dealerCountries"),e("GetDealersAndCountries",[],"dealers")).then(function(){pt(),at(),nt()}).then(function(){yt()}).then(function(){tt(),y.hide()}).then(function(){typeof u.onInitialise=="function"&&u.onInitialise()})}function ot(){if(p!=""||s!=""){var t=JSON.stringify({emailRecId:p,fullName:s});return n.ajax({type:"POST",url:"/WebServices/ProxyNewsletterWS.asmx/EventGetAttendeeDetails",data:t,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d){var n=n.d;i={ContactId:n.ContactId,Title:n.Title,FirstName:n.FirstName,LastName:n.LastName,Email:n.Email,Street:n.Street,TownCity:n.City,CountyState:n.State,Country:n.CountryRegionId,Postcode:n.Postcode,Telephone:n.HomePhoneNumber,CanEmail:n.CanEmail,CanPhone:n.CanPhone,CanPost:n.CanPost,CanSMS:n.CanSMS}}}})}}function yt(){i.FirstName!==""&&typeof i.FirstName!="undefined"&&r.find("#txtFirstName").val(i.FirstName).attr("disabled",!0),i.LastName!==""&&typeof i.LastName!="undefined"&&r.find("#txtLastName").val(i.LastName).attr("disabled",!0),i.Street!==""&&typeof i.Street!="undefined"&&r.find("#txtAddress").val(i.Street),i.TownCity!==""&&typeof i.TownCity!="undefined"&&r.find("#txtTown").val(i.TownCity),i.CountyState!==""&&typeof i.CountyState!="undefined"&&r.find("#txtCounty").val(i.CountyState),i.Postcode!==""&&typeof i.Postcode!="undefined"&&r.find("#txtPostcode").val(i.Postcode),i.Email!==""&&typeof i.Email!="undefined"&&r.find("#txtEmail").val(i.Email),i.Telephone!=""&&typeof i.Telephone!="undefined"&&r.find("#txtTelephone").val(i.Telephone),i.CanEmail&&r.find("#chkEmail").attr("checked",!0).parent().css("background-position","50% -50px"),i.CanPhone&&r.find("#chkPhone").attr("checked",!0).parent().css("background-position","50% -50px"),i.CanPost&&r.find("#chkPost").attr("checked",!0).parent().css("background-position","50% -50px"),i.CanSMS&&r.find("#chkSMS").attr("checked",!0).parent().css("background-position","50% -50px");var t=_.filter(aston.cache.titles.d,function(n){return n.English==i.Title});n("#cmbTitle").val(t.length>0?t[0].Id:0),n("#cmbCountry").val(typeof i.Country!="undefined"?i.Country:0)}function pt(){var e=n("#sectionTemplate"),t,r,i;for(section in u.sections)if(u.sections[section]&&(t=f[section],e.tmpl(t).appendTo(v),t.externalContent&&lt(t.externalContent.contentUrl,t.externalContent.contentId,t.externalContent.contentSelector),t.data))for(i=0;i<t.data.length;i++)r=t.data[i],wt(r.id,r.cacheName,r.template);if(u.custom&&u.custom.length>0)for(i=0;i<u.custom.length;i++)e.tmpl(u.custom[i]).appendTo(v)}function wt(t,i,r){var e=n("#"+t),o=n("#"+r),u=o.tmpl(aston.cache[i].d),f;switch(i){case"countries":f=l(!1).add(u),u=f;break;case"dealerCountries":f=l(!0).add(u),u=f}u.insertAfter(e.find("option").first())}function l(t){var i,r;switch(u.langauge){case"de":i=[{value:"DEU",text:"Germany"},{value:"AUT",text:"Austria"},{value:"CHE",text:"Switzerland"}];break;default:i=[{value:"DEU",text:"Germany"},{value:"GBR",text:"United Kingdom"},{value:"USA",text:"United States"}]}return r=t?n("#dealerGroupTemplate").tmpl(i):n("#countryGroupTemplate").tmpl(i),r.last().addClass("seperator"),n("<optgroup />").attr("label","").append(r)}function lt(t,i,r){var u=t+" "+r;n("#"+i).empty().load(u)}function at(){n(".radio").live("click",function(){var i=n(this).find("input:radio"),r=i.val(),t=n(i.parents(".radioGroup").data("toggle"));r=="Yes"?(t.show(),t.hasClass("built")||t.find("select").selectbox().end().addClass("built")):t.hide()}),n("#cmbDealerCountry").live("change",function(){var f=aston.generic.getValueForSelect(n(this)),u=n("#cmbDealers"),t=_.filter(aston.cache.dealers.d,function(n){return n.Country==f}),i,r;t.length>0&&(t=_.sortBy(t,"Location")),i=n('<option value="0">Select your Dealer...</option>'),r=n("#dealerTemplate").tmpl(t),u.parents(".jquery-selectbox").unselectbox(),u.empty().append(i,r).selectbox()});ct.on("click",function(){var y=!0,v,b,t,p,e,l,s,o;for(section in u.sections)u.sections[section]&&!n("#"+f[section].id).is(":hidden")&&(v=f[section].fields,b=_.filter(v,function(n){return n.required==!0}),n.each(b,function(n,t){var r=c(t.id,t.name,t.element),u=h(r,t.element),i=!0;if(!r.is(":hidden"))switch(t.element){case"email":i=ut(u);break;case"check":i=it(r);break;case"select":u=aston.generic.getValueForSelect(r),i=rt(u);break;case"radio":i=g(u);break;default:i=w(u,t.placeholder)}i?d(r,t.element):(y=!1,k(r,t.element))}));if(y){t={Event:{}};for(section in u.sections)u.sections[section]&&!n("#"+f[section].id).is(":hidden")&&(p=f[section].fields,n.each(p,function(n,i){var f=c(i.id,i.name,i.element),u=h(f,i.element),r=i.name;t.Event[r]=u}));if(n.each(ft,function(){var u=n(this),e=u.attr("name"),f=u.is(":checked");t.Event[e]=f}),u.custom)for(e=0;e<u.custom.length;e++)l=u.custom[e].fields,n.each(l,function(i,r){var e=n("#"+r.id),f=e.val(),u=r.name;t.Event[u]=f});s={ContactId:i.ContactId,Title:t.Event.Title,FirstName:t.Event.FirstName,LastName:t.Event.LastName,Email:t.Event.Email,Street:t.Event.Address,City:t.Event.Town,State:t.Event.County,Postcode:t.Event.Postcode,CountryRegionId:t.Event.Country,CanPost:t.Event.CanPost,CanPhone:t.Event.CanPhone,CanSms:t.Event.CanSMS,CanEmail:t.Event.CanEmail,HomePhoneNumber:t.Event.Telephone},delete t.Event.Title,delete t.Event.FirstName,delete t.Event.LastName,delete t.Event.Email,delete t.Event.Address,delete t.Event.Town,delete t.Event.County,delete t.Event.Postcode,delete t.Event.Country,delete t.Event.CanPost,delete t.Event.CanPhone,delete t.Event.CanSMS,delete t.Event.CanEmail,delete t.Event.Telephone,o=JSON.stringify({attendee:s,recId:aston.generic.getQueryStringValue("rId",""),confirmationString:vt(t)}),n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/EventBookingConfirmation",contentType:"application/json; charset=utf-8",data:o,dataType:"json",success:function(){r.fadeOut("slow",function(){ht.find("p").text(u.thanksText).show()})},error:function(n){window.console&&console.log(JSON.parse(n))}})}else n("html,body").animate({scrollTop:a.offset().top},500),a.empty().html("<p>PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>")});r.find("#txtEmail").bind("keyup",function(){o("input#chkEmail",n(this).val().length>0)}),r.find("#txtTelephone").bind("keyup",function(){o("input#chkPhone",n(this).val().length>0)}),r.find("#txtAddress").bind("keyup",function(){o("input#chkPost",n(this).val().length>0)})}function vt(n,t){var u=function(n,t,i){var f="",o,s,e,r;if(n instanceof Array)for(o=0,s=n.length;o<s;o++)f+=i+u(n[o],t,i+"\t")+"\n";else if(typeof n=="object"){e=!1,f+=i+"<"+t;for(r in n)r.charAt(0)=="@"?f+=" "+r.substr(1)+'="'+n[r].toString()+'"':e=!0;if(f+=e?">":"/>",e){for(r in n)r=="#text"?f+=n[r]:r=="#cdata"?f+="<![CDATA["+n[r]+"]\]>":r.charAt(0)!="@"&&(f+=u(n[r],r,i+"\t"));f+=(f.charAt(f.length-1)=="\n"?i:"")+"</"+t+">"}}else f+=i+"<"+t+">"+n.toString()+"</"+t+">";return f},r="",i;for(i in n)r+=u(n[i],i,"");return t?r.replace(/\t/g,t):r.replace(/\t|\n/g,"")}function c(t,i,r){var u;switch(r){case"radio":u=n("input:radio[name="+i+"]").parents(".radioWrap");break;default:u=n("#"+t)}return u}function h(n,t){var i;switch(t){case"radio":i=n.find("input:radio").filter(":checked").val();break;default:i=n.val()}return i}function k(n,t){switch(t){case"select":n.parent().addClass("invalid");break;case"check":n.next(".long-text").addClass("invalid");break;case"radio":n.addClass("invalid");break;default:n.addClass("invalid")}}function d(n,t){switch(t){case"select":n.parent().removeClass("invalid");break;case"check":n.parent().next(".long-text").removeClass("invalid");break;case"radio":n.removeClass("invalid");break;default:n.removeClass("invalid")}}function w(n,t){return n.length>0&&n!=""&&n!=t}function it(n){return n.is(":checked")}function rt(n){return n!=0&&n!="0"}function ut(t){var r=n.trim(t),i=new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);return i.test(r)}function g(n){return n!=undefined&&n!=""}function nt(){if(!Modernizr.input.placeholder){var t=r.find("input[type=text]");n.each(t,function(){var r=n(this);n(this).attr("value",r.attr("title"))})}}function tt(){r.find(":radio").wrap('<div class="radio"/>'),r.find(".radio").dgStyle(),r.find("select").selectbox(),r.find(".datepicker").datepicker({dateFormat:"dd/mm/yy",minDate:"-10Y",maxDate:"+10Y",changeMonth:!0,changeYear:!0})}function o(n,t){t?r.find(n).attr("checked",!0).parent().css("background-position","50% -50px"):r.find(n).removeAttr("checked").parent().css("background-position","50% 0")}function e(t,i,r){var u,f;if(aston.cache[r])return aston.cache[r];if(u="",i.length>0)for(f=0;f<i.length;f+=2)u.length>0&&(u+=","),u+='"'+i[f]+'":"'+i[f+1]+'"';return u="{"+u+"}",n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/"+t,contentType:"application/json; charset=utf-8",data:u,dataType:"json",success:function(n){aston.cache[r]=n},error:b})}function b(){alert("Sorry an error has occured, please try again later")}var u={},st={campaignId:66,custom:[],onInitialise:n.noop,sections:{personalDetails:!0,requireGuest:!0,guestDetails:!1,passportInformation:!1,guestPassportInformation:!1,emergencyContactDetails:!1,travelDetails:!1,breakdownCover:!1,dietaryRequirements:!1,guestDietaryRequirements:!1,yourCarDetails:!1,hireCarDetails:!1,drivingLicense:!1,termsAndConditions:!1},config:{termsAndConditionsText:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Nam nibh. Nunc varius facilisis eros",termsAndConditionsUrl:"/test-terms-and-conditions",termsAndConditionsSelector:"#terms-and-conditions",thanksText:"Thanks for your submission"}},r=this,ht=n("#confirmationComplete"),ct=r.find("#btnSubmit"),a=r.find("#requiredFields"),v=r.find("#dynamic"),ft=r.find("#chkEmail, #chkPost, #chkSMS, #chkPhone"),y=n(".loading"),p=aston.generic.getQueryStringValue("rId",""),s=aston.generic.getQueryStringValue("eId",""),i={},f;return u=n.extend(!0,st,t),f={personalDetails:{title:"Personal Details",id:"personal-details",fields:[{id:"cmbTitle",element:"select",placeholder:"Title",name:"Title",required:!0},{id:"txtFirstName",element:"text",placeholder:"First Name",name:"FirstName",required:!0},{id:"txtLastName",element:"text",placeholder:"Last Name",name:"LastName",required:!0},{id:"txtAddress",element:"text",placeholder:"Address",name:"Address",required:!0},{id:"txtTown",element:"text",placeholder:"Town / City",name:"Town",required:!0},{id:"txtCounty",element:"text",placeholder:"County / State",name:"County",required:!0},{id:"cmbCountry",element:"select",placeholder:"Country",name:"Country",required:!0},{id:"txtPostcode",element:"text",placeholder:"Postcode / Zipcode",name:"Postcode"},{id:"txtEmail",element:"email",placeholder:"Email address",name:"Email",required:!0},{id:"txtTelephone",element:"text",placeholder:"Telephone",name:"Telephone"}],data:[{id:"cmbTitle",template:"titlesTemplate",cacheName:"titles"},{id:"cmbCountry",template:"optionTemplate",cacheName:"countries"}]},requireGuest:{title:"Guest Required",id:"require-guest",fields:[{id:"chkRequireGuest",element:"radio",name:"GuestRequired",required:!0,toggle:"#guest-details, #guest-passport-information, #guest-dietary-requirements"}]},guestDetails:{title:"Guest Details",id:"guest-details",hideElement:!0,fields:[{id:"cmbGuestTitle",element:"select",placeholder:"Title",name:"GuestTitle",required:!0},{id:"txtGuestFirstName",element:"text",placeholder:"First Name",name:"GuestFirstName",required:!0},{id:"txtGuestLastName",element:"text",placeholder:"Last Name",name:"GuestLastName",required:!0},{id:"txtGuestAddress",element:"text",placeholder:"Address",name:"GuestAddress",required:!0},{id:"txtGuestTown",element:"text",placeholder:"Town / City",name:"GuestTown",required:!0},{id:"txtGuestCounty",element:"text",placeholder:"County / State",name:"GuestCounty",required:!0},{id:"cmbGuestCountry",element:"select",placeholder:"Country",name:"GuestCountry",required:!0},{id:"txtGuestPostcode",element:"text",placeholder:"Postcode / Zipcode",name:"GuestPostcode"},{id:"txtGuestEmail",element:"email",placeholder:"Email address",name:"GuestEmail",required:!0},{id:"txtGuestTelephone",element:"text",placeholder:"Telephone",name:"GuestTelephone"}],data:[{id:"cmbGuestTitle",template:"titlesTemplate",cacheName:"titles"},{id:"cmbGuestCountry",template:"optionTemplate",cacheName:"countries"}]},passportInformation:{title:"Passport Information",id:"passport-information",fields:[{id:"txtPassportNumber",element:"text",placeholder:"Passport Number",name:"PassportNumber",required:!0},{id:"cmbVisa",element:"select",placeholder:"Visa",name:"Visa",required:!0,data:[{value:"Yes",text:"Yes"},{value:"No",text:"No"}]},{id:"txtPassportStartDate",element:"date",placeholder:"Start Date",name:"PassportStartDate",required:!0},{id:"txtPassportExpireDate",element:"date",placeholder:"Expiry Date",name:"PassportExpireDate",required:!0},{id:"txtBirthNationality",element:"text",placeholder:"Birth Nationality",name:"BirthNationality"},{id:"txtPassportNationality",element:"text",placeholder:"Passport Nationality",name:"PassportNationality"},{id:"txtPassportFullName",element:"text",placeholder:"Full Name",name:"FullName"}]},travelDetails:{title:"Travel Details",id:"travel-details",fields:[{id:"txtPreferredAirport",element:"text",placeholder:"Preferred Airport",name:"PreferredAirport",required:!0},{id:"txtPreferredAirline",element:"text",placeholder:"Preferred Airline",name:"PreferredAirline",required:!0}]},guestPassportInformation:{title:"Guest Passport Information",id:"guest-passport-information",hideElement:!0,fields:[{id:"txtGuestPassportNumber",element:"text",placeholder:"Passport Number",name:"GuestPassportNumber",required:!0},{id:"cmbGuestVisa",element:"select",placeholder:"Visa",name:"GuestVisa",required:!0,data:[{value:"Yes",text:"Yes"},{value:"No",text:"No"}]},{id:"txtGuestPassportStartDate",element:"date",placeholder:"Start Date",name:"GuestPassportStartDate",required:!0},{id:"txtGuestPassportExpireDate",element:"date",placeholder:"Expiry Date",name:"GuestPassportExpireDate",required:!0},{id:"txtGuestBirthNationality",element:"text",placeholder:"Birth Nationality",name:"GuestBirthNationality"},{id:"txtGuestPassportNationality",element:"text",placeholder:"Passport Nationality",name:"GuestPassportNationality"},{id:"txtGuestPassportFullName",element:"text",placeholder:"Full Name",name:"GuestFullName"}]},emergencyContactDetails:{title:"Emergency Contact Details (separate to attendees)",id:"emergency-contact-details",fields:[{id:"txtEmergencyName",element:"text",placeholder:"Name",name:"EmergencyContact",required:!0},{id:"txtEmergencyPhone",element:"text",placeholder:"Telephone",name:"EmergencyContactTelephone",required:!0}]},breakdownCover:{title:"Breakdown Cover",id:"breakdown-cover-details",fields:[{id:"cmbBreakdown",element:"select",placeholder:"Breakdown Assitance",name:"BreakdownAssistance",required:!0,data:[{value:"Yes",text:"Yes"},{value:"No",text:"No"}]},{id:"txtBreakdownPolicyNumber",element:"text",placeholder:"Policy Number",name:"BreakdownPolicyNumber"},{id:"txtBreakdownPolicyProvider",element:"text",placeholder:"Provider",name:"BreakdownPolicyProvider"},{id:"txtBreakdownPolicyTelephone",element:"text",placeholder:"Telephone",name:"BreakdownPolicyTelephone"}]},dietaryRequirements:{title:"Dietary Requirements",id:"dietary-requirements",fields:[{id:"chkDietaryRequirements",element:"radio",name:"DietaryRequirements",placeholder:"Dietary Requirements",required:!0,toggle:"#txtDietaryDetails"},{id:"txtDietaryDetails",element:"text",placeholder:"Details",name:"DietaryDetails",cssclass:"long",required:!0,hideElement:!0}]},guestDietaryRequirements:{title:"Guest Dietary Requirements",id:"guest-dietary-requirements",hideElement:!0,fields:[{id:"chkGuestDietaryRequirements",element:"radio",name:"GuestDietaryRequirements",placeholder:"Dietary Requirements",required:!0,toggle:"#txtGuestDietaryDetails"},{id:"txtGuestDietaryDetails",element:"text",placeholder:"Details",name:"GuestDietaryDetails",cssclass:"long",required:!0,hideElement:!0}]},yourCarDetails:{title:"Your Car Details",id:"your-car-details",fields:[{id:"cmbAstonMartinModel",element:"select",placeholder:"Model",name:"YourAstonMartinModel",data:[{value:"One77",text:"One 77"},{value:"V12Zagato",text:"V12 Zagato"},{value:"V8Vantage",text:"V8 Vantage"},{value:"V8VantageS",text:"V8 Vantage S"},{value:"V12Vantage",text:"V12 Vantage"},{value:"DB9",text:"DB9"},{value:"Rapide",text:"Rapide"},{value:"Vanquish",text:"Vanquish"},{value:"Cygnet",text:"Cygnet"},{value:"DBS",text:"DBS"},{value:"DB7",text:"DB7"},{value:"Other",text:"Other"}]},{id:"cmbDealerCountry",element:"select",placeholder:"Preferred Dealer",name:"YourDealerCountry",required:!0},{id:"cmbDealers",element:"select",placeholder:"Dealer Location",name:"YourDealer",required:!0},{id:"txtChassis",element:"text",placeholder:"Chassis",name:"YourChassis"},{id:"txtRegistration",element:"text",placeholder:"Registration Number",name:"YourRegistrationNumber"}],data:[{id:"cmbDealerCountry",template:"dealerCountryTemplate",cacheName:"dealerCountries"}]},hireCarDetails:{title:"Aston Martin Car Hire",id:"your-car-details",fields:[{id:"cmbCarHire",element:"select",placeholder:"Required",name:"CarHireRequired",required:!0,data:[{value:"Yes",text:"Yes"},{value:"No",text:"No"}]},{id:"cmbCarHireModel",element:"select",placeholder:"Model *",name:"CarHireModel",data:[{value:"Vanquish",text:"Vanquish"},{value:"Other",text:"Other"}]}]},drivingLicense:{title:"Driving License Number",id:"driving-license-number",fields:[{id:"txtDrivingLicenseNumber",element:"text",placeholder:"Driving License Number",name:"DrivingLicenseNumber",required:!0}]},termsAndConditions:{title:"Terms And Conditions",id:"terms-and-conditions",fields:[{id:"chkTermsAndConditions",element:"check",placeholder:u.config.termsAndConditionsText,name:"TermsAndConditions",required:!0}],externalContent:{contentId:"terms-content",contentUrl:u.config.termsAndConditionsUrl,contentSelector:u.config.termsAndConditionsSelector}}},aston.templateCallbacks=function(){var n=function(n){return n&&n.hideElement?"display: none;":""};return{isVisible:n}}(),et(),this}}(jQuery),function(n){n.fn.videoGallery=function(t){function g(){d(),a(),y(),p()}function d(){u=!0;var n=c(e.defaultVideo);n.done(function(n){r.children().not(".video-loading").remove().end().end().append(n),o.hide(),s(),u=!1})}function c(t){var i=n.Deferred(),r=JSON.stringify({videoId:t});return n.ajax({type:"POST",url:"/Webservices/VideoGalleryService.asmx/GetVideoById",contentType:"application/json; charset=utf-8",data:r,dataType:"json",success:function(t){i.resolve(n("#mainVideoTemplate").tmpl(t.d))}}),i.promise()}function a(){f.hide(),i.find(".jcarousel").jcarousel({wrap:"circular"}),f.slice(0,e.showNumberOfCategories).show(),e.showNumberOfCategories<=f.length&&h.hide()}function l(){var n={xlarge:[1450,730],large:[1163,568],medium:[1053,465],small:[922,408]};return n[aston.theme]}function s(){var t=r.find("iframe"),n=l();t.attr("width",n[0]).attr("height",n[1])}function p(){w.live("click",function(){return aston.w.trigger("am.gallery.video.click",[n(this)]),!1}),k.live("click",function(){return aston.w.trigger("am.gallery.carousel.click",[n(this),!0]),!1}),b.live("click",function(){return aston.w.trigger("am.gallery.carousel.click",[n(this),!1]),!1});h.on("click",function(){return aston.w.trigger("am.gallery.loadmore.click",[n(this)]),!1});n(".download").live("click",function(n){return aston.isLoggedIn?!0:(n.preventDefault(),aston.generic.showLoginPopup(),!1)}),n("#facebook").live("click",function(){return aston.w.trigger("am.share.video.click",[n(this),"facebook"]),!1}),n("#twitter").live("click",function(){return aston.w.trigger("am.share.video.click",[n(this),"twitter"]),!1}),n("#linkedin").live("click",function(){return aston.w.trigger("am.share.video.click",[n(this),"linkedin"]),!1}),n("#googleplus").live("click",function(){return aston.w.trigger("am.share.video.click",[n(this),"googleplus"]),!1})}function y(){aston.w.bind("am.gallery.video.click",function(t,i){if(!u){var f=i.data("id");u=!0,r.children().not(".video-loading").remove(),o.show(),n("html,body").animate({scrollTop:r.offset().top},500,function(){if(this.nodeName!="BODY"){var n=c(f);n.done(function(n){r.append(n),s(),o.hide(),u=!1})}})}}),aston.w.bind("am.gallery.carousel.click",function(n,t,i){var u=t.parent(".jcarousel-skin-default").find(".jcarousel"),r=i?"+=1":"-=1";u.jcarousel("scroll",r)}),aston.w.bind("am.gallery.loadmore.click",function(n,t){var r=f.filter(":hidden").slice(0,e.loadNumberOfCategories);(function i(n){n.eq(0).fadeIn("fast",function(){(n=n.slice(1)).length&&i(n)})})(r),f.filter(":hidden").length==0&&t.hide()}),aston.w.bind("am.theme",function(){s()}),aston.w.bind("am.share.video.click",function(n,t,i){var u,r,s=encodeURIComponent(window.location.href),o=encodeURIComponent("//az9255.vo.msecnd.net/icons/2d-wings.jpg"),f=t.data("sharetitle"),e;switch(i){case"facebook":u=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=548,height=325");break;case"twitter":u=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=575,height=440");break;case"linkedin":u=window.open("about:blank",aston.ie?"":"Aston Martin","toolbar=0,status=0,width=520,height=570");break;case"googleplus":u=window.open("about:blank",aston.ie?"":"Aston Martin","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")}e=aston.getBitlyUrl.getBitlyUrl(s),e.done(function(n){switch(i){case"facebook":r="http://www.facebook.com/sharer.php?s=100&p[title]=Aston%20Martin%20Configurator&p[url]="+n+"&p[images][0]="+o+"&p[summary]="+f,u.location.replace(r);break;case"twitter":r="http://twitter.com/?status="+n+" via @astonmartin",u.location.replace(r);break;case"linkedin":r="http://www.linkedin.com/shareArticle?mini=true&url="+n+"&title=Aston%20Martin%20Configurator&summary="+f+"&source=Aston%20Martin",u.location.replace(r);break;case"googleplus":r="https://plus.google.com/share?url="+n,u.location.replace(r)}})})}var e={},v={showNumberOfCategories:3,loadNumberOfCategories:3,defaultVideo:"7854bf56-6a94-41e5-a0fd-077ae4da4c72"},i=this,f=i.find(".video-category"),w=i.find(".video-item"),r=i.find(".video-hero-wrap"),o=r.find(".video-loading"),k=i.find(".next"),b=i.find(".previous"),h=i.find("#load-more"),u=!1,nt={bitly:{login:"o_58beie1q12",apiKey:"R_aab2b8474edc0bc88efc35e9b1510cdf"}};return e=n.extend(v,t),aston.templateCallbacks=function(){var t=function(t){var u={youtube:{matcher:/(youtube\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed)?([\w-]{11}|\?listType=(.*)&list=(.*)).*/i,params:{autoplay:1,autohide:1,fs:1,rel:0,hd:1,wmode:"opaque",enablejsapi:1},url:"//www.youtube.com/embed/$3"},vimeo:{matcher:/(?:vimeo(?:pro)?.com)\/(?:[^\d]+)?(\d+)(?:.*)/,params:{autoplay:1,hd:1,show_title:1,show_byline:1,show_portrait:0,color:"",fullscreen:1},url:"//player.vimeo.com/video/$1"}},f,i,r,e=function(t,i,r){return r=r||"",n.type(r)==="object"&&(r=n.param(r,!0)),n.each(i,function(n,i){t=t.replace("$"+n,i||"")}),r.length&&(t+=(t.indexOf("?")>0?"&":"?")+r),t};for(f in u)if(i=u[f],r=t.match(i.matcher),r){t=e(i.url,r,i.params);break}return t};return{getVideoUrl:t}}(),g(),this}}(jQuery),function(n,t,i,r){function u(t,i){this.element=t,this.$element=n(t),this.$img=this.$element.find("#image"),this.$loading=this.$element.find("#loading"),this.$colours,this.options=n.extend({},e,i),this._defaults=e,this._name=f,this.init()}var f="threeSixtySpin",e={defaultColour:"red",imageUrl:"//az9255.vo.msecnd.net/zagato-360/",defaultFrame:32,colours:[],colourWidth:110,showHelperText:!1,helperText:!1,hideThumbnails:!1,onChange:n.noop},o={xlarge:[1490,590],large:[1163,461],medium:[1050,418],small:[920,366]};u.prototype.init=function(){this._buildColourOptions(),this._listeners(),this._triggers(),this.changeColour(this.options.defaultColour)},u.prototype.changeColour=function(t){var i=this,r;i._resizeContent(),r=i.$colours.filter(function(){return n(this).data("colour")==t}),i._displayImages(r)},u.prototype._buildColourOptions=function(){var t=this,u=n("#menuTemplate").tmpl(t.options.colours),f=t.$element.find("ul"),i=(t.options.colours.length+1)*t.options.colourWidth/2-20,r="-"+i+"px";f.append(u).attr("style","margin-left:"+r),t.$colours=t.$element.find(".colour-selector"),t.options.hideThumbnails&&t.$element.find("ul").hide(),t.options.showHelperText&&t.$element.find(".helper").show(),t.options.helperText&&t.$element.find(".helper").html(t.options.helperText+'<span class="rule"></span>')},u.prototype._resizeContent=function(){var t=this,n=o[aston.theme];t.$img.attr({width:n[0],height:n[1]}).siblings("img").attr({width:n[0],height:n[1]})},u.prototype._displayImages=function(t){var i=this,r=t.data("colour"),u;n.each(i.$colours,function(t,i){var u=n(i);u.data("colour")!=r&&(u.removeClass("on"),u.parent().removeClass("on"))}),t.addClass("on").parent().addClass("on"),u=i._loadImages(r),u.done(function(){setTimeout(function(){i._resizeContent(),i.$element.find("#image-reel").show(),typeof i.options.onChange=="function"&&i.options.onChange.call(i,r)},500)})},u.prototype._loadImages=function(t){var i=this;return n.Deferred(function(n){var r=i.options.imageUrl+t+"/";i.$img.bind("loaded",function(t){t.type=="loaded"&&n.resolve()}).reel({frames:94,frame:i.options.defaultFrame,footage:4,sensitivity:70,saves:!0,cursor:"hand",path:r,images:["00001.jpg","00002.jpg","00003.jpg","00004.jpg","00005.jpg","00006.jpg","00007.jpg","00008.jpg","00009.jpg","00010.jpg","00011.jpg","00012.jpg","00013.jpg","00014.jpg","00015.jpg","00016.jpg","00017.jpg","00018.jpg","00019.jpg","00020.jpg","00021.jpg","00022.jpg","00023.jpg","00024.jpg","00025.jpg","00026.jpg","00027.jpg","00028.jpg","00029.jpg","00030.jpg","00031.jpg","00032.jpg","00033.jpg","00034.jpg","00035.jpg","00036.jpg","00037.jpg","00038.jpg","00039.jpg","00040.jpg","00041.jpg","00042.jpg","00043.jpg","00044.jpg","00045.jpg","00046.jpg","00047.jpg","00048.jpg","00049.jpg","00050.jpg","00051.jpg","00052.jpg","00053.jpg","00054.jpg","00055.jpg","00056.jpg","00057.jpg","00058.jpg","00059.jpg","00060.jpg","00061.jpg","00062.jpg","00063.jpg","00064.jpg","00065.jpg","00066.jpg","00067.jpg","00068.jpg","00069.jpg","00070.jpg","00071.jpg","00072.jpg","00073.jpg","00074.jpg","00075.jpg","00076.jpg","00077.jpg","00078.jpg","00079.jpg","00080.jpg","00081.jpg","00082.jpg","00083.jpg","00084.jpg","00085.jpg","00086.jpg","00087.jpg","00088.jpg","00089.jpg","00090.jpg",]})}).promise()},u.prototype._listeners=function(){var t=this;t.$colours.on("click",function(){var i=n(this);return i.hasClass("on")||t._displayImages(i),!1})},u.prototype._triggers=function(){var n=this;aston.w.bind("am.theme",function(){n._resizeContent()})},n.fn[f]=function(t){var e=arguments,i;return t===r||typeof t=="object"?this.each(function(){n.data(this,"plugin_"+f)||n.data(this,"plugin_"+f,new u(this,t))}):typeof t=="string"&&t[0]!=="_"&&t!=="init"?(this.each(function(){var r=n.data(this,"plugin_"+f);r instanceof u&&typeof r[t]=="function"&&(i=r[t].apply(r,Array.prototype.slice.call(e,1))),t==="destroy"&&n.data(this,"plugin_"+f,null)}),i!==r?i:this):void 0}}(jQuery,window,document),function(n){n.fn.hotspots=function(t){function y(){aston.w.bind("am.hotspots.spot.click",function(t,i){var f=i.data("category"),u={xlarge:[925,415],large:[756,335],medium:[680,305],small:[611,275]},r=c.filter("[data-id="+f+"]").clone();n.fancybox.open(r,{padding:20,autoSize:!1,beforeLoad:function(){this.width=parseInt(u[aston.theme][0]),this.height=parseInt(u[aston.theme][1]),r.find("#hotspot-tabs").tabs({active:0,activate:function(t,i){var r=n(i.newPanel),u,e,f;if(r.hasClass("carousel")){if(r.find(".halfCarousel").length==0){var l=r.parents(".hotspot-content").data("id"),s=r.find(".carousel-wrap"),c=JSON.stringify({itemId:l});n.ajax({type:"POST",url:"/Webservices/CarouselService.asmx/GetCarouselHtml",contentType:"application/json; charset=utf-8",data:c,dataType:"json",success:function(n){n.d&&(s.empty().html(n.d),aston.plugins.carousel.init(s))}})}}else r.hasClass("video")&&(u=r.find("iframe"),u.attr("src")==""&&(e=u.data("url"),f=o(),u.attr({src:h(e),width:f[0],height:f[1]})))}})},afterClose:function(){r.remove()}})}),aston.w.bind("am.hotspots.draw",function(){var u,t;for(r.find(".hotspot").remove(),u="",t=0;t<i.hotspots.length;t++){var n=i.hotspots[t],s=n.cssClass!=undefined&&n.cssClass!=""?n.cssClass:i.cssClass,o='<a href="#" class="hotspot '+s+'" style="top:'+e(n.top)+"px; left: "+f(n.left)+'px;" data-category="'+n.category+'" title="'+n.title+'"><span>'+n.title+"</span></a>";u+=o}r.append(u)})}function v(){l.live("click",function(){return aston.w.trigger("am.hotspots.spot.click",[n(this)]),!1}),aston.w.bind("am.theme",function(){aston.w.trigger("am.hotspots.draw")})}function e(n){return n/u[aston.theme][0]}function f(n){return n/u[aston.theme][1]}function o(){var n={xlarge:[745,365],large:[581,285],medium:[526,258],small:[461,226]};return n[aston.theme]}function h(t){var u={youtube:{matcher:/(youtube\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed)?([\w-]{11}|\?listType=(.*)&list=(.*)).*/i,params:{autoplay:1,autohide:1,fs:1,rel:0,hd:1,wmode:"opaque",enablejsapi:1},url:"//www.youtube.com/embed/$3"},vimeo:{matcher:/(?:vimeo(?:pro)?.com)\/(?:[^\d]+)?(\d+)(?:.*)/,params:{autoplay:1,hd:1,show_title:1,show_byline:1,show_portrait:0,color:"",fullscreen:1},url:"//player.vimeo.com/video/$1"}},f,i,r,e=function(t,i,r){return r=r||"",n.type(r)==="object"&&(r=n.param(r,!0)),n.each(i,function(n,i){t=t.replace("$"+n,i||"")}),r.length&&(t+=(t.indexOf("?")>0?"&":"?")+r),t};for(f in u)if(i=u[f],r=t.match(i.matcher),r){t=e(i.url,r,i.params);break}return t}function s(){aston.w.trigger("am.hotspots.draw")}var i={},a={hotspots:[],cssClass:"default-hotspot"},r=this,l=r.find(".hotspot"),c=n(".hotspot-content"),u={xlarge:[1,1],large:[1.25,1.25],medium:[1.57,1.57],small:[1.79,1.79]};i=n.extend(a,t),y(),v(),s()}}(jQuery),function(n){n.fn.gallery=function(t){function it(){a(),p(),b()}function b(){aston.generic.isStringNullOrEmpty(o)?v():n.ajax({type:"POST",url:"/WebServices/ImageService.asmx/GetCategoryTree",data:"{'categoryId': '"+o+"', 'language': '"+aston.language+"'  }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){n&&(l(n),i.find("a[data-itemid="+o+"]").click())}})}function l(n){k.tmpl(n.d).appendTo(i.find("ul").first())}function c(n){rt.html(n+" Gallery")}function a(){aston.w.bind("am.gallery.onLoadingStart",function(){}),aston.w.bind("am.gallery.onLoadingComplete",function(){})}function p(){u.find(".download").live("click",function(n){return aston.isLoggedIn?!0:(n.preventDefault(),aston.generic.showLoginPopup(),!1)}),ut.live("click",function(){if(aston.isLoggedIn){var i=n(this),u={Url:i.data("url"),ThumbnailUrl:i.data("thumb"),Description:i.data("description"),SizeInBytes:i.data("size")},r=JSON.stringify({item:u});n.ajax({type:"POST",url:"/Webservices/DownloadOrderService.asmx/AddDownloadItemToBasket",contentType:"application/json; charset=utf-8",data:r,dataType:"json",success:function(n){n.d?(toastr.success("Image added"),y()):toastr.error("Image is already in your portfolio")},error:function(){toastr.error("Error adding image")}})}else aston.generic.showLoginPopup();return!1}),n(".view").live("click",function(t){t.preventDefault();var u=n(this),r=u.parents(".item").data("itemid");i.find("a[data-itemid="+r+"]").click()}),d.find("a").live("click",function(t){var l;aston.w.trigger("am.gallery.onLoadingStart"),t.preventDefault();var u=n(this),o=u.data("itemid"),a=u.data("haschildren"),v=u.parents("ul").first();u.parents("ul").first().find("ul").remove(),a?(e.hide(),l=w(o),l.done(function(t){var e,o;t&&(e=n("<ul/>").attr("style","margin-left: "+f.indent+"px !important;"),h.tmpl(t.d).appendTo(e),e.insertAfter(u.parent()),u.data("loaded",!0),i.find("li").removeClass("on").find("a").removeClass("on"),u.addClass("on").parent().addClass("on"),o=n("#categoryTemplate").tmpl(t.d),r.not(".loader").empty().append(o),c(u.text()),aston.w.trigger("am.gallery.onLoadingComplete"))})):u.hasClass("on")?(u.removeClass("on").data("loaded",!1).parent().removeClass("on").next("ul").remove(),s(o,1,!0)):(i.find("li").removeClass("on").find("a").removeClass("on"),u.addClass("on").parent().addClass("on"),u.parents("ul").prev("li").find("a").addClass("on"),s(o,1,!0),c(u.text()))})}function w(t){return n.ajax({type:"POST",url:"/WebServices/ImageService.asmx/GetCategories",data:"{'categoryId': '"+t+"', 'language': '"+aston.language+"'  }",contentType:"application/json; charset=utf-8",dataType:"json"})}function y(){tt.fadeOut("fast",function(){var t=parseInt(n(this).text().match(/\d+/g).toString(),10);t++,n(this).text("Media Basket ("+t+")").fadeIn("fast")})}function s(t,i,u){r.fadeOut("fast",function(){var c=[t],h={categories:c,language:aston.language,pageSize:f.pageSize,page:i},o=JSON.stringify(h);n.ajax({type:"POST",url:"/WebServices/ImageService.asmx/GetImages",data:o,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var i,o;r.not(".loader").empty(),i=nt.tmpl(n.d),f.hideAddToBasket&&i.find(".add").hide(),i.appendTo(r),r.show(),u&&(o=n.d.ImageGalleryItems.length*n.d.LastPage,e.show().pagination({items:o,itemsOnPage:f.pageSize,onPageClick:function(n){s(t,n,!1)}})),n.d.LastPage==1?e.hide():e.show(),aston.w.trigger("am.gallery.onLoadingComplete")}})})}function v(){n.ajax({type:"POST",url:"/WebServices/ImageService.asmx/GetCategories",data:"{'categoryId': '"+f.rootCategory+"', 'language': '"+aston.language+"'  }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){r.empty(),h.tmpl(n.d).appendTo(i.find("ul").first())}})}var f={},g={rootCategory:"303BA935-7666-45C8-8957-AB7EF951F7A7",mode:"image",pageSize:15,hideAddToBasket:!1,indent:10},u=this,nt=n("#imageTemplate"),h=n("#menuTemplate"),k=n("#nestedMenuTemplate"),r=u.find("ul.gallery"),i=u.find("nav.categories"),d=i.find("li"),rt=u.find(".galleryTitle"),o=aston.generic.getQueryStringValue("cId",""),ut=u.find(".add"),tt=n(".basket"),e=u.find(".numbers");return f=n.extend(g,t),it(),this}}(jQuery),function(n){n.fn.socialFeed=function(t){function ht(){switch(i.mode){case"myastonmartin":new o(c);break;default:new e(c)}}function et(){for(var t=[],r,u,n,f,e=0;e<i.twitterAccounts.length;e++){var n=i.twitterAccounts[e],o=n.username?n.username:"",h=n.search?n.search:"",c=n.hasTag;o&&t.push(new l(o,c)),h&&t.push(new y(h))}for(r=0;r<i.youtubeAccounts.length;r++){var n=i.youtubeAccounts[r],o=n.username,d=n.apiKey;t.push(new a(o,d))}for(u=0;u<i.instagramAccounts.length;u++)n=i.instagramAccounts[u],n.user_id&&i.instagram.client_id!==""&&i.instagram.access_token!==""&&t.push(new v(n.user_id,i.instagram.client_id,i.instagram.access_token,n.hasTag)),n.tag&&i.instagram.client_id!==""&&i.instagram.access_token!==""&&t.push(new s(i.instagram.client_id,i.instagram.access_token,n.tag));for(f=0;f<i.facebookAccounts.length;f++)t.push(new ft(i.facebookAccounts[f].user_id));return i.news.showNews&&t.push(new w(i.news.categories,i.news.tags)),i.magazine.showMagazine&&t.push(new p(i.magazine.category)),i.reviews.showReviews&&t.push(new k(i.reviews.category)),i.blog.showBlog&&t.push(new b(i.blog.category)),i.mam.showMam&&t.push(new nt(i.mam.category)),i.events.showEvents&&t.push(new g(i.events.category)),t}function rt(t){return n.Deferred(function(i){for(var u=[],f=[],r=0;r<t.length;r++)u.push(t[r].getPosts());n.when.apply(n,u).then(function(){for(var s=arguments,u,o=[],t,n,e,r=0;r<s.length;r++)for(u=s[r],t=0;t<u.length;t++)n=u[t],f.push(n),n.preloadImage&&n.imageUrl!==""&&o.push(n.imageUrl);e=ut(o),e.done(function(){i.resolve(f)})})}).promise()}function o(t){this.el=t,this.$feed=n(t),this.$loading=this.$feed.find("#loading"),this.$template=n("#feedTemplate"),this.feeds=et(),this.canLoad=!0,this.numberOfRequests=0,this.init()}function e(t){this.el=t,this.$feed=n(t),this.$loading=this.$feed.find("#loading"),this.$template=n("#feedTemplate"),this.feeds=et(),this.canLoad=!0,this.numberOfRequests=0,this.init()}function ot(t,i,r,u){return n.Deferred(function(n){var e,f,s,o;i?(r.attr({width:aston.w.width()-85,height:aston.w.height()-80}),e=r[0],f=e.document,e.contentDocument?f=e.contentDocument:e.contentWindow&&(f=e.contentWindow.document),f.open(),f.writeln(t.d),f.close(),n.resolve()):(u.append(t.d),u.css({height:aston.w.height()-80,width:aston.w.width()-85}),s=u.find("figure").find("img").attr("src"),o=ut([s]),o.done(function(){it(u.find("img"),!0,!0),it(u.find("article"),!0,!1),setTimeout(function(){n.resolve()},500)}))}).promise()}function it(n,t,i){var u=n.height(),f=n.width(),r={};t&&(r.marginTop=Math.abs(u/2)*-1),i&&(r.marginLeft=Math.abs(f/2)*-1),n.css(r)}function tt(){return c.data("isotope").options.filter||"*"}function ut(t){var f=n.Deferred(),r,u,i;for(t.length===0&&f.resolve(),u=t.length,i=0;i<t.length;i++)r=new Image,r.onload=function(){--u,u===0&&f.resolve()},r.src=t[i];return f.promise()}function h(n){this.post=n,this.init()}function l(n,t){this.username=n,this.max_id=null,this.tag=t}function y(n){this.search=n,this.max_id=null}function v(n,t,i,r){this.user_id=n,this.client_id=t,this.access_token=i,this.max_id="",this.tag=r}function s(n,t,i){this.client_id=n,this.access_token=t,this.next_url="",this.min_Id="",this.tag=i,this.noNextUrl=!1}function ft(n){this.user_id=n,this.posts=[]}function a(n,t){this.username=n,this.apiKey=t,this.playlistId=null,this.posts=[]}function g(n){this.category=n,this.loadOnce=!1}function nt(n){this.categories=n,this.loadOnce=!1}function w(n,t){this.currentPage=1,this.categories=n,this.tags=t}function b(n){this.category=n,this.lastPage=1}function k(n){this.category=n,this.lastPage=1}function p(n){this.category=n,this.lastPage=1}function u(n,t,i,r,u,f,e,o,s,h,c){this.id=n,this.title=t,this.content=i,this.imageUrl=r,this.publishedDate=u,this.url=f,this.type=e,this.index=o,this.preloadImage=s,this.extra=h,this.categories=c}var i={},st={numberOfItems:10,defaultFilter:"*",twitterAccounts:[{username:"astonmartin"}],youtubeAccounts:[{username:"astonmartin",apiKey:"AIzaSyDenQ-ZGtecWcRefv0oXqgD42YQcZdF3_E"}],instagramAccounts:[{user_id:"1410669"}],facebookAccounts:[{user_id:15678718354}],news:{showNews:!0,categories:["99de450d-de1b-4f3e-beff-708d096a3fd0","57ac91a6-44b9-4e82-b076-757a0e7f2874"],tags:[]},magazine:{showMagazine:!0,category:["F6D58533-81BA-6CEB-9402-FF00007A0A98"]},reviews:{showReviews:!1,category:["3f899d33-81ba-6ceb-9402-ff00007a0a98"]},blog:{showBlog:!1,category:"D8482FEA-E248-479F-A492-7BDCD236DD24"},mam:{showMam:!1,category:""},instagram:{client_id:"c9f96ef97a64403387374c63425f54a0",access_token:"1410669.c9f96ef.94a0f468590b4415ab6a5f36f6075312"},events:{showEvents:!1,category:""},remove:{twitter:[],youtube:[],instagram:[],news:[]},maxNumberOfRequests:3,mode:"live"},c=this,f=[],r,d;i=n.extend(st,t),o.prototype.init=function(){this.triggers(),this.writePosts()},o.prototype.triggers=function(){var t=this;t.$feed.find("a").live("click",function(){var u=n(this),r=u.parents(".post").first(),e=r.data("id"),t=r.data("type"),i,o;return t=="news"||t=="mam"||t=="events"?!0:(i=_.find(f,function(n){return n.id==e}),i&&new h(i),!1)})},o.prototype.writePosts=function(n){var t=this,r;t.canLoad&&(t.canLoad=!1,t.onLoadingStart(),r=rt(this.feeds),r.done(function(r){var e=_.sortBy(r,function(n){return n.publishedDate}).reverse(),u=t.$template.tmpl(e),f;n?(f=tt(),setTimeout(function(){t.$feed.isotope("insert",u).isotope({filter:f})},500)):setTimeout(function(){t.$feed.isotope({itemSelector:".post",masonry:{columnWidth:0},filter:i.defaultFilter,layoutMode:"straightDown"}).isotope("insert",u)},500),t.numberOfRequests++,t.canLoad=!0,t.onLoadingComplete()}))},o.prototype.onLoadingStart=function(n){!n&&this.$loading.show()},o.prototype.onLoadingComplete=function(){this.$loading.hide(),this.$feed.find(".loading-wrap").remove()},e.prototype.init=function(){this.triggers(),this.writePosts()},e.prototype.triggers=function(){var t=this;t.$feed.find(".external").live("click",function(){var s=n(this),u=s.data("content"),r=u.indexOf("http")!==-1;if(r&&aston.ie&&aston.ie<10){window.open(u,"","");return}var f=_.uniqueId("full-screen_"),h={Id:f},c=n("#fullScreenTemplate").tmpl(h);t.$feed.append(c);var i=n("#"+f),o=aston.w.height(),e=aston.w.width();return n.fancybox.open(i,{padding:[38,0,0,20],wrapCSS:"full-screen-content",openMethod:"changeIn",openSpeed:"slow",autoSize:!1,beforeLoad:function(){this.width=e,this.height=o},afterShow:function(){n.ajax({type:"POST",url:"/Webservices/SocialFeedWS.asmx/GetMagazineContent",contentType:"application/json; charset=utf-8",data:JSON.stringify({url:u}),dataType:"json",success:function(n){var u=i.find("iframe"),t=i.find("#container"),f=ot(n,r,u,t);f.done(function(){i.find("#loader").fadeOut("fast",function(){r?u.fadeIn("slow"):t.fadeTo(1,"slow")})})}})},afterClose:function(){i.remove()}}),!1}),t.$feed.find("a").live("click",function(){var u=n(this),r=u.parents(".post").first(),e=r.data("id"),t=r.data("type"),i,o;return t=="news"||t=="mam"||t=="events"?!0:(i=_.find(f,function(n){return n.id==e}),i&&new h(i),!1)}),aston.w.bind("scroll",function(){if(n("body").height()<=aston.w.height()+aston.w.scrollTop()&&t.canLoad&&t.numberOfRequests<i.maxNumberOfRequests){var r=c.outerHeight(),u=r+200;t.$feed.append('<div class="loading-wrap" style="top: '+r+'px"><div class="loading-icon"></div>').css("height",u),t.writePosts(!0)}})},e.prototype.writePosts=function(n){var t=this,r;t.canLoad&&(t.canLoad=!1,t.onLoadingStart(),r=rt(this.feeds),r.done(function(r){var e=r.sort(function(){return.5-Math.random()}),u=t.$template.tmpl(e),f;n?(f=tt(),setTimeout(function(){t.$feed.isotope("insert",u).isotope({filter:f})},500)):setTimeout(function(){t.$feed.isotope({itemSelector:".post",masonry:{columnWidth:10},filter:i.defaultFilter}).isotope("insert",u)},500),t.numberOfRequests++,t.canLoad=!0,t.onLoadingComplete()}))},e.prototype.onLoadingStart=function(n){!n&&this.$loading.show()},e.prototype.onLoadingComplete=function(){this.$loading.hide(),this.$feed.find(".loading-wrap").remove()},h.prototype.init=function(){var t=this;n("#overlayTemplate").tmpl(t.post).appendTo(n("body")),n("html").addClass("has-overlay"),t.$element=n("#"+t.post.id);t.$element.on("click",function(n){return n.target&&(n.target.className=="inner"||n.target.className=="btn-close")?(t.close(),!1):!0});t.post.type=="youtube"&&aston.plugins.youtubeplayer.createPlayer(t.$element.find(".video-wrapper"))},h.prototype.close=function(){n("html").removeClass("has-overlay").removeClass("fullscreen-video"),this.$element.remove()},l.prototype.updateMaxId=function(n){this.max_id=n},l.prototype.getPosts=function(){var o=n.Deferred(),t=this,e=[],s=JSON.stringify({username:t.username,max_id:t.max_id,count:i.numberOfItems});return n.ajax({type:"POST",url:"/Webservices/SocialFeedWS.asmx/GetTimelineTweets",contentType:"application/json; charset=utf-8",data:s,dataType:"json"}).always(function(n){var n,l,h,s,c,a;if(n&&n.d&&(n=JSON.parse(n.d),n&&(h=JSON.parse(n.tweets),h)))for(t.updateMaxId(h[h.length-1].id),c=0;c<h.length;c++)(s=h[c],_.contains(i.remove.twitter,s.id_str))||t.tag&&s.entities.hashtags&&(a=_.findWhere(s.entities.hashtags,{text:t.tag}),!a)||(l=new u(s.id_str,s.user.screen_name,r.formatTweetText(s.text),r.getTwitterImage(s.entities),r.formatTweetDate(s.created_at),r.getTwitterUrl(t.username,s.id_str),"twitter",c,!0,"",""),e.push(l),f.push(l));o.resolve(e)}),o.promise()},y.prototype.updateMaxId=function(n){this.max_id=n},y.prototype.getPosts=function(){var o=n.Deferred(),e=this,t=[],s=JSON.stringify({search:this.search,max_id:this.max_id,count:i.numberOfItems});return n.ajax({type:"POST",url:"/Webservices/SocialFeedWS.asmx/GetSearchTweets",contentType:"application/json; charset=utf-8",data:s,dataType:"json"}).always(function(n){var n,h,s,l,c;if(n&&n.d&&(n=JSON.parse(n.d),n&&(h=JSON.parse(n.tweets),h&&h.statuses&&h.statuses.length>0)))for(e.updateMaxId(h.statuses[h.statuses.length-1].id),c=0;c<h.statuses.length;c++)(s=h.statuses[c],_.contains(i.remove.twitter,s.id_str))||(l=new u(s.id_str,s.user.screen_name,r.formatTweetText(s.text),r.getTwitterImage(s.entities),r.formatTweetDate(s.created_at),r.getTwitterUrl(e.username,s.id_str),"twitter",c,!0,"",""),t.push(l),f.push(l));o.resolve(t)}),o.promise()},v.prototype.updateMaxId=function(n){this.max_id=n},v.prototype.getPosts=function(){var o=n.Deferred(),t=this,e=[];return n.ajax({url:"https://api.instagram.com/v1/users/"+t.user_id+"/media/recent?client_id="+t.client_id+"&access_token="+t.access_token+"&max_id="+t.max_id+"&count="+i.numberOfItems,type:"GET",dataType:"jsonp",success:function(n){var s,v,l,a,c,h;if(n&&n.data.length>0)for(t.updateMaxId(n.data[n.data.length-1].id),h=0;h<n.data.length;h++)(s=n.data[h],_.contains(i.remove.instagram,s.id))||t.tag&&s.tags&&!_.contains(s.tags,t.tag)||(l=s.images.standard_resolution.url,a=r.formatInstagramDate(s.created_time),c=new u(s.id,s.caption&&s.caption.text,"",l,a,s.link,"instagram",h,!0,"",""),e.push(c),f.push(c));o.resolve(e)}}),o.promise()},s.prototype.updateNextUrl=function(n){n?this.next_url=n:this.noNextUrl=!0},s.prototype.getAjaxUrl=function(){return this.next_url===""?"https://api.instagram.com/v1/tags/"+this.tag+"/media/recent?client_id="+this.client_id+"&access_token="+this.access_token+"&count="+i.numberOfItems+"&min_tag_id="+this.min_Id:this.next_url},s.prototype.getPosts=function(){var o=n.Deferred(),t=this,e=[];return t.noNextUrl&&o.resolve(e),n.ajax({url:t.getAjaxUrl(),type:"GET",dataType:"jsonp",success:function(n){var s,l,a,c,h;if(n&&n.data.length>0)for(t.min_Id=n.pagination.next_min_id,t.updateNextUrl(n.pagination.next_url),h=0;h<n.data.length;h++)(s=n.data[h],_.contains(i.remove.instagram,s.id))||(l=s.images.standard_resolution.url,a=r.formatInstagramDate(s.created_time),c=new u(s.id,s.caption&&s.caption.text,"",l,a,s.link,"instagram",h,!0,"",""),e.push(c),f.push(c));else t.noNextUrl=!0;o.resolve(e)}}),o.promise()},ft.prototype.getPosts=function(){var r=n.Deferred(),t=this;if(t.posts.length>0)r.resolve(t.posts.splice(0,i.numberOfItems));else{var s="https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+i.numberOfItems*i.maxNumberOfRequests+"&q=",o=encodeURIComponent("https://www.facebook.com/feeds/page.php?id="+t.user_id+"&format=rss20"),e=s+o;n.ajax({url:e,data:{},dataType:"jsonp",success:function(n){if(n&&n.responseStatus==200)for(var h=n.responseData.feed.entries,o,c,s,e=0;e<h.length;e++)(o=h[e],o.title!="")&&(s=new u(_.uniqueId("f"),o.title,"","",o.publishedDate,o.link,"facebook",e,!1,"",""),t.posts.push(s),f.push(s));r.resolve(t.posts.splice(0,i.numberOfItems))}})}return r.promise()},a.prototype.getPlaylistId=function(){var t=this;return n.Deferred(function(i){if(t.playlistId!=null)i.resolve();else{var r="https://www.googleapis.com/youtube/v3/channels?forUsername="+t.username+"&key="+t.apiKey+"&part=snippet,statistics,contentDetails";n.ajax({url:r,type:"GET",dataType:"jsonp",success:function(n){n&&(t.playlistId=n.items[0].contentDetails.relatedPlaylists.uploads,i.resolve())}})}}).promise()},a.prototype.getPosts=function(){var r=n.Deferred(),t=this,e;return t.posts.length>0?r.resolve(t.posts.splice(0,i.numberOfItems)):(e=t.getPlaylistId(),e.done(function(){var e="https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId="+t.playlistId+"&key="+t.apiKey+"&maxResults="+i.numberOfItems*i.maxNumberOfRequests;n.ajax({url:e,type:"GET",dataType:"jsonp",success:function(n){var e,l,c,h,s,o;if(n&&n.items)for(o=0;o<n.items.length;o++)(e=n.items[o],_.contains(i.remove.youtube,e.id))||(l=e.snippet.thumbnails.default.url,c=e.snippet.publishedAt,h="http://www.youtube.com/watch?v="+e.snippet.resourceId.videoId,s=new u(e.id,e.snippet.title,e.snippet.description,l,c,h,"youtube",o,!0,h,""),t.posts.push(s),f.push(s));r.resolve(t.posts.splice(0,i.numberOfItems))}})})),r.promise()},g.prototype.getPosts=function(){var t=this,i=[];return n.Deferred(function(f){t.loadOnce&&f.resolve([]);var e={category:t.category,language:aston.language,country:"",type:"",month:"",getFilters:!1,showUpcomingEvents:!0};n.ajax({type:"get",url:"/json/EventsWidget/GetEvents",data:e,contentType:"application/json; charset=utf-8",dataType:"json"}).always(function(n){var e,o;if(n){for(o=0;o<n.Events.length;o++)e=n.Events[o],i.push(new u(e.ItemId,e.Title,e.Summary,r.getFacebookImage(e.ImageUrl),"",r.getEventUrl(e.Title),"events",o,!0,"",""));t.loadOnce=!0}f.resolve(i)})}).promise()},nt.prototype.getPosts=function(){var i=n.Deferred(),t=this,f=[],r;return t.loadOnce&&i.resolve([]),r={category:t.categories,language:"en",type:"",populateFilters:!1},n.ajax({type:"GET",url:"/json/Tiles/GetTiles",contentType:"application/json; charset=utf-8",data:r,dataType:"json"}).always(function(n){var e,o,r;if(n)for(r=0;r<n.Tiles.length;r++)e=n.Tiles[r],o=new u("","",e.Content,e.ImageUrl,"",e.Url,"mam",r,!0,"",""),f.push(o);t.loadOnce=!0,i.resolve(f)}),i.promise()},w.prototype.updateCurrentPage=function(){this.currentPage=this.currentPage+1},w.prototype.getPosts=function(){var e=n.Deferred(),t=this,f=[],o=JSON.stringify({language:"en",tag:"",pageSize:i.numberOfItems,page:t.currentPage,categories:t.categories});return n.ajax({type:"POST",url:"/WebServices/NewsService.asmx/GetNewsItems",contentType:"application/json; charset=utf-8",data:o,dataType:"json"}).always(function(n){var o,s;if(n&&n.d)for(t.updateCurrentPage(),s=0;s<n.d.NewsRecords.length;s++)(o=n.d.NewsRecords[s],_.contains(i.remove.news,o.ItemId))||f.push(new u(o.ItemId,o.Title,"",o.ThumbnailUrl,r.formatNewsDate(o.PublishedDate),r.getNewsUrl(o.Url),"news",s,!0,"",""));e.resolve(f)}),e.promise()},b.prototype.updateLastPage=function(){this.lastPage=this.lastPage+1},b.prototype.getPosts=function(){var o=n.Deferred(),t=this,e=[],s=JSON.stringify({blogId:t.category,numberOfItems:i.numberOfItems,page:t.lastPage});return n.ajax({type:"POST",url:"/WebServices/SocialFeedWS.asmx/GetBlogItems",contentType:"application/json; charset=utf-8",data:s,dataType:"json"}).always(function(n){var i,h,s;if(n&&n.d)for(t.updateLastPage(),s=0;s<n.d.length;s++)i=n.d[s],h=new u(i.Id,i.Title,i.Content,i.ThumbnailUrl,i.PublishedDate,r.getBlogUrl(i.Url),"blog",s,!0,"",""),e.push(h),f.push(h);o.resolve(e)}),o.promise()},k.prototype.updateLastPage=function(){this.lastPage=this.lastPage+1},k.prototype.getPosts=function(){var e=n.Deferred(),t=this,r=[],o=JSON.stringify({numberOfItems:i.numberOfItems,page:t.lastPage,categories:t.category});return n.ajax({type:"POST",url:"/WebServices/SocialFeedWS.asmx/GetMagazineItems",contentType:"application/json; charset=utf-8",data:o,dataType:"json"}).always(function(n){var i,s,o;if(n&&n.d)for(t.updateLastPage(),o=0;o<n.d.length;o++)i=n.d[o],s=new u(i.ContentId,i.Title,i.Overview,i.ImageUrl,i.PublishedDate,i.ContentUrl,"review",o,!0,"",i.Categories),r.push(s),f.push(s);e.resolve(r)}),e.promise()},p.prototype.updateLastPage=function(){this.lastPage=this.lastPage+1},p.prototype.getPosts=function(){var f=n.Deferred(),t=this,r=[],e=JSON.stringify({numberOfItems:i.numberOfItems,page:t.lastPage,categories:t.category});return n.ajax({type:"POST",url:"/WebServices/SocialFeedWS.asmx/GetMagazineItems",contentType:"application/json; charset=utf-8",data:e,dataType:"json"}).always(function(n){var i,e;if(n&&n.d)for(t.updateLastPage(),e=0;e<n.d.length;e++)i=n.d[e],r.push(new u(i.ContentId,i.Title,i.Overview,i.ImageUrl,i.PublishedDate,i.ContentUrl===""?i.ContentId:i.ContentUrl,"magazine",e,!0,"",i.Categories));f.resolve(r)}),f.promise()},r={formatTweetText:function(n){return d.clean(n)},formatTweetDate:function(t){var i=new Date(t);return n.browser.msie&&(i=Date.parse(t.replace(/( \+)/," UTC$1"))),i},formatNewsDate:function(n){var t=moment(n);return t?t._d:""},formatYoutubeDate:function(n){var t=moment(n);return t?t._d:""},formatInstagramDate:function(n){return new Date(parseInt(n*1e3,10))},getEventUrl:function(n){return"/events#event="+n},getTwitterUrl:function(n,t){return"http://www.twitter.com/"+n+"/status/"+t},getTwitterImage:function(n){var t="";return n.media&&(t=n.media[0].media_url),t},getYouTubeImage:function(n,t){var i=_.filter(n,function(n){return n.yt$name==t});return i&&i.length?i[0].url:""},getNewsUrl:function(n){return"/live/news"+n},getBlogUrl:function(n){return"/live/blog"+n},getFacebookImage:function(n){var t="",i=new RegExp(/<img.+?src=[\"'](.+?)[\"'].+?>/);return images=i.exec(n),length,images&&(t=images[images.length-1],t=t.replace("_s.","_n.")),t}},d={link:function(n){return n.replace(/\b(((https*\:\/\/)|www\.)[^\"\']+?)(([!?,.\)]+)?(\s|$))/g,function(n,t,i,r,u){var f=i.match(/w/)?"http://":"";return'<a class="twtr-hyperlink" target="_blank" href="'+f+t+'">'+(t.length>25?t.substr(0,24)+"...":t)+"</a>"+u})},at:function(n){return n.replace(/\B[@@]([a-zA-Z0-9_]{1,20})/g,function(n,t){return'<a target="_blank" class="twtr-atreply" href="http://twitter.com/intent/user?screen_name='+t+'">@'+t+"</a>"})},list:function(n){return n.replace(/\B[@@]([a-zA-Z0-9_]{1,20}\/\w+)/g,function(n,t){return'<a target="_blank" class="twtr-atreply" href="http://twitter.com/'+t+'">@'+t+"</a>"})},hash:function(n){return n.replace(/(^|\s+)#(\w+)/gi,function(n,t,i){return t+'<a target="_blank" class="twtr-hashtag" href="http://twitter.com/search?q=%23'+i+'">#'+i+"</a>"})},clean:function(n){return this.hash(this.at(this.list(this.link(n))))}},aston.templateCallbacks=function(){var i=function(n){return n%2==0?"small":""},r=function(n){return"Posted "+moment(n).fromNow()},n=function(n){return n=="review"?"Read More":"View on "+n.charAt(0).toUpperCase()+n.substr(1,n.length)},t=function(n){return n.substr(0,100)+"..."};return{getCssClass:i,getFriendlyDate:r,getViewText:n,getContentSnippet:t}}(),ht()}}(jQuery),function(n){n.fn.drag=function(t){function p(){w(),s(),b()}function b(){u.find(".helper").text(r.introText)}function w(){aston.w.bind("am.drag.figure.click",function(n,t){t.find(".content").fadeToggle("fast")}),aston.w.bind("am.drag.figures.remove",function(){f.find(".figpoint").remove()}),aston.w.bind("am.drag.figures.draw",function(){for(var u="",n,i,t=0;t<r.hotspots.length;t++)n=r.hotspots[t],i='<a href="#" class="figpoint" style="top:'+n.top+"px; left: "+n.left+"px; background-color:"+r.cssColor+';"><div class="content" style="'+a(n.css)+';"><p class="title">'+n.title+"</p><p>"+n.text+"</p></div></a>",u+=i;f.append(u)})}function a(n){var i="border-color:"+r.cssColor+";",t;for(t in n)i+=t+":"+n[t]+";";return i}function s(){v.live("click",function(){return aston.w.trigger("am.drag.figure.click",[n(this)]),!1});u.on("click",function(){return u.fadeOut("fast",function(){aston.w.trigger("am.drag.figures.remove");var n=i.find(".dragger"),t=n.data("img");l(t,function(){var t=this;n.css({background:h(t.src),top:"-450px",left:o(t.width),width:t.width,height:t.height}).draggable({drag:c}),i.fadeIn("fast",function(){aston.w.trigger("am.drag.figures.draw")})})}),!1});i.find("a").on("click",function(){return i.fadeOut("fast",function(){u.fadeIn("fast")}),!1})}function o(n){return aston.theme=="xlarge"?-200:Math.abs(n/4)*-1}function h(n){return"url("+n+")"}function l(n,t){var i=new Image;i.onload=function(){typeof t=="function"&&t.call(this)},i.src=n}function c(n,t){var r,i;t.position.top>0&&(t.position.top=0),r=t.helper.parents(".drag-content").height()-t.helper.height(),t.position.top<r&&(t.position.top=r),t.position.left>0&&(t.position.left=0),i=t.helper.parents(".drag-content").width()-t.helper.width(),t.position.left<i&&(t.position.left=i)}var r={},y={hotspots:[],cssClass:"default-hotspot",cssColor:"#ff33ff",introText:"Click here to explore the features of the Rapide S"},e=this,u=e.find(".hero-wrapper"),i=e.find(".drag-wrapper"),f=i.find(".dragger"),v=i.find(".figpoint");return r=n.extend(y,t),p(),this}}(jQuery),function(n){n.fn.regForm=function(t){function nt(){g(),p(),b(),y(),v(),w()}function g(){f.unbind("click"),c.unbind("click"),u.unbind("focusout")}function p(){f.on("click",function(n){n.preventDefault(),ut()});c.on("click",function(n){n.preventDefault(),h()});u.on("focusout",function(){h()})}function h(){var t=i.find("#txtNickname"),u=t.val().strip(),r;u!=""&&(r=JSON.stringify({screenName:u}),n.ajax({type:"POST",url:"/Webservices/UserService.asmx/IsScreenNameUsed",contentType:"application/json; charset=utf-8",data:r,dataType:"json",success:function(n){n.d?t.addClass("invalid"):t.removeClass("invalid")}}))}function ut(){var y,p;f.attr("disabled","disabled");var c=i.find("#txtFirstName"),l=i.find("#txtLastName"),a=i.find("#txtEmail"),ft=i.find("#txtCounty"),ut=i.find("#txtTelephone"),e=i.find("#txtPassword"),t=i.find("#txtConfirmPassword"),g=i.find("#chkNewsletter"),w=i.find("#chkConfirm").is(":checked"),b=c.val().strip(),nt=l.val().strip(),it=a.val().strip(),tt=u.val().strip(),v=aston.generic.getValueForSelect(i.find("#cmbTitle")),o=e.val().strip(),h=t.val().strip(),k=g.is(":checked"),d=function(){return o!=""&&o.length>6&&h!=""&&h.length>6&&o==h?!0:!1};d()&&v!=0&&c.isValid()&&l.isValid()&&u.isValid()&&w?(f.attr("value","Submitting..."),y={Title:v,FirstName:b,LastName:nt,NickName:tt,AgeRange:0,Email:it,Password:o,NewsletterSubscribe:k,OnlineStoreRegistration:r.config.mode=="OnlineStore"},p=JSON.stringify({request:y}),n.ajax({type:"POST",url:"/WebServices/UserService.asmx/CreateUser",data:p,contentType:"application/json; charset=utf-8",dataType:"json",success:rt})):(f.attr("disabled",!1),n("html,body").animate({scrollTop:s.offset().top},500),s.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),v==0?i.find("#cmbTitle").parent().addClass("invalid"):i.find("#cmbTitle").parent().removeClass("invalid"),c.isValid()?c.removeClass("invalid"):c.addClass("invalid"),l.isValid()?l.removeClass("invalid"):l.addClass("invalid"),!e.isValid()||o.length<7?e.addClass("invalid"):e.removeClass("invalid"),!t.isValid()||h.length<7?t.addClass("invalid"):t.removeClass("invalid"),o!=h?(e.addClass("invalid"),t.addClass("invalid")):e.isValid()&&o.length>6&&t.isValid()&&h.length>6&&(e.removeClass("invalid"),t.removeClass("invalid")),a.isValid(!0)?a.removeClass("invalid"):a.addClass("invalid"),u.isValid(!0)?u.removeClass("invalid"):u.addClass("invalid"),w?i.find("#chkConfirm").parent().next(".boxMessage").removeClass("invalid"):i.find("#chkConfirm").parent().next(".boxMessage").addClass("invalid"))}function rt(n){r.config.mode=="OnlineStore"?n.d&&it(n.d.LoginUrl,r.config.checkoutPage):i.fadeOut("slow",function(){d.removeClass("hidden")})}function it(n,t){var i=k("store-registration-iframe");i.load(function(){window.location.href=t}),i.attr("src",n)}function k(t){var i='<iframe id="'+t+'" name="'+t+'" style="position:absolute; top:-9999px; left:-9999px"';return window.ActiveXObject&&(i+=' src="javascript:false"'),i+=" />",n(i).appendTo(document.body),n("#"+t)}function v(){n.when(a("GetTitles",[],"titles")).then(function(n){l(n)})}function a(t,i,r){var u,f;if(aston.cache[r])return aston.cache[r];if(u="",i.length>0)for(f=0;f<i.length;f+=2)u.length>0&&(u+=","),u+='"'+i[f]+'":"'+i[f+1]+'"';return u="{"+u+"}",n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/"+t,contentType:"application/json; charset=utf-8",data:u,dataType:"json",success:function(n){aston.cache[r]=n},error:o})}function l(t){var u=aston.generic.getTranslatedText(r.language,"forms","titleOption"),i='<option value="0">'+u+"</option>";n.each(t.d,function(n,t){i+='<option value="'+t.English+'">'+t.English+"</option>"}),e.append(i),e.hasClass("styled")||e.selectbox().addClass("styled")}function y(){r.config.mode=="OnlineStore"&&(i.find("h1").text(r.config.ui.titleText),i.find("p").first().text(r.config.ui.introText),i.find("#chkConfirm").next(".boxMessage").html(r.config.ui.termsText)),r.config.ui.hideNewsletterSignup&&i.find("#newsletterSignup").hide()}function b(){f.attr("value",aston.generic.getTranslatedText(r.language,"forms","submit")),i.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".nickname").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","nickname"));var t=aston.generic.getTranslatedText(r.language,"forms","password"),n=aston.generic.getTranslatedText(r.language,"forms","retypePassword");i.find("#txtPassword").attr("placeholder",t).attr("title",t),i.find("#txtConfirmPassword").attr("placeholder",n).attr("title",n),r.config.mode=="OnlineStore"&&i.find(".email").attr("placeholder",aston.generic.getTranslatedText(r.language,"forms","username")),Modernizr.input.placeholder||(i.find(".firstname").attr("value",aston.generic.getTranslatedText(r.language,"forms","firstname")),i.find(".lastname").attr("value",aston.generic.getTranslatedText(r.language,"forms","lastname")),i.find(".nickname").attr("value",aston.generic.getTranslatedText(r.language,"forms","nickname")),i.find("#txtPassword").attr("value",t),i.find("#txtConfirmPassword").attr("value",n),r.config.mode=="OnlineStore"&&i.find(".email").attr("value",aston.generic.getTranslatedText(r.language,"forms","username")))}function w(){i.hasClass("styled")||(i.find(":radio").wrap('<div class="radio"/>'),i.find(".radio").dgStyle(),i.find(":checkbox").wrap('<div class="checkbox"/>'),i.find(".checkbox").dgStyle(),i.find("select.static").selectbox())}function o(){alert("Sorry an error has occured, please try again later")}var r={},tt={language:"en",config:{mode:"MyAstonMartin",checkoutPage:"/shop/cart/checkout",ui:{titleText:"Online Store Registration",introText:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Nam nibh. Nunc varius facilisis eros",termsText:"<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Nam nibh. Nunc varius facilisis eros</p>",hideNewsletterSignup:!0}}},i=this,d=n("#registerFormComplete"),e=i.find("#cmbTitle"),f=i.find("#btnSubmit"),c=n("#btnNickNameCheck"),u=i.find("#txtNickname"),s=i.find("#requiredFields");return r=n.extend(!0,tt,t),nt(),n(this)}}(jQuery),function(n,t,i,r){function u(t,i){this.element=t,this.$elements={},this.$elements.$form=n(this.element),this.$elements.$formComplete=n("#"+this.element.id+"Complete"),this.$elements.$required=this.$elements.$form.find("#requiredFields"),this.$elements.$title=this.$elements.$form.find("#cmbTitle"),this.$elements.$country=this.$elements.$form.find("#cmbCountry"),this.$elements.$dealerCountry=this.$elements.$form.find("#cmbDealerCountries"),this.$elements.$dealers=this.$elements.$form.find("#divDealers"),this.$elements.$events=this.$elements.$form.find("#cmbEvents"),this.$elements.$submit=this.$elements.$form.find("#btnSubmit"),this.options=n.extend({},s,i),this._defaults=s,this._name=f,this.init()}function e(t,i,r,u){return n.Deferred(function(f){o[u]?f.resolve(o[u]):n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/"+t,contentType:"application/json; charset=utf-8",data:i,dataType:"json",success:function(n){n&&(r&&(o[u]=n.d),f.resolve(n.d))},error:function(){f.reject()}})}).promise()}var f="bespokeDataCollection",s={language:"en",leadsAreApproved:!1,events:[{Id:66,Name:"Online"},{Id:123,Name:"Online 2"},{Id:234,Name:"Online 3"}],preferredCountry:!1,onSubmit:n.noop},o={};u.prototype.init=function(){this._triggers(),this._populateScreen(),this._styleForm()},u.prototype._populateScreen=function(){var t=this,i;t.options.events&&(i=n("#eventsTemplate").tmpl(t.options.events),t.$elements.$events.append(i).selectbox()),n.when(e("GetTitles",{},!0,"titles")).then(function(i){if(i){var u=n('<option value="0">'+aston.generic.getTranslatedText(t.options.language,"forms","titleOption")+"</option>"),r=n.merge(u,n("#titleTemplate").tmpl(i));t.$elements.$title.append(r).selectbox()}}),n.when(e("GetAddressCountries",{},!0,"addressCountries")).then(function(i){if(i){var u=n('<option value="0">'+aston.generic.getTranslatedText(t.options.language,"forms","countryOption")+"</option>"),r=n.merge(u,n("#countryTemplate").tmpl(i));t.$elements.$country.append(r),t.options.preferredCountry&&t.$elements.$country.val(t.options.preferredCountry),t.$elements.$country.selectbox()}}),n.when(e("GetCountries",{},!0,"countries")).then(function(i){if(i){var u=n('<option value="0">'+aston.generic.getTranslatedText(t.options.language,"forms","preferredDealerCountryOption")+"</option>"),r=n.merge(u,n("#dealerCountryTemplate").tmpl(i));t.$elements.$dealerCountry.append(r).selectbox()}})},u.prototype._triggers=function(){var t=this;t.$elements.$dealerCountry.on("change",function(){n.when(e("GetDealersAndCountries",{},!0,"dealersAndCountries")).then(function(i){if(i){var f=_.filter(i,function(n){return n.Country==t.$elements.$dealerCountry.val()}),e=n('<option value="0">'+aston.generic.getTranslatedText(t.options.language,"forms","selectYourDealerText")+"</option>"),r=n.merge(e,n("#dealerTemplate").tmpl(f)),u=n("<select />").attr({id:"cmbDealers"}).append(r);t.$elements.$dealers.empty().append(u).find("#cmbDealers").selectbox()}})});t.$elements.$submit.on("click",function(){return t._submitForm(),!1});t.$elements.$form.find("#txtEmail").on("keyup",function(){t._updateMarketingPrefs("#chkEmail",n(this).val().length>0)});t.$elements.$form.find("#txtTelephone").on("keyup",function(){t._updateMarketingPrefs("#chkPhone",n(this).val().length>0)});t.$elements.$form.find("#txtAddress").on("keyup",function(){t._updateMarketingPrefs("#chkPost",n(this).val().length>0)})},u.prototype._styleForm=function(){var n=this;n.$elements.$form.find(":radio").wrap('<div class="radio"/>'),n.$elements.$form.find(".radio").dgStyle(),n.$elements.$form.find(":checkbox").wrap('<div class="checkbox"/>'),n.$elements.$form.find(".checkbox").dgStyle(),n.$elements.$form.find("select.static").selectbox(),n.$elements.$submit.attr("value",aston.generic.getTranslatedText(n.options.language,"forms","submit")),n.$elements.$form.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","firstname")),n.$elements.$form.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","lastname")),n.$elements.$form.find(".address").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","address")),n.$elements.$form.find(".town").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","town")),n.$elements.$form.find(".county").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","county")),n.$elements.$form.find(".postcode").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","postcode")),n.$elements.$form.find(".email").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","email")),n.$elements.$form.find(".telephone").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","telephone")),n.$elements.$form.find(".comments").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","comments")),n.$elements.$form.find(".mileage").attr("placeholder","Mileage"),n.$elements.$form.find(".vin").attr("placeholder","Vin"),n.$elements.$form.find(".registration").attr("placeholder","Registration"),n.$elements.$form.find(".purchaseDate").attr("placeholder","Purchase Date"),Modernizr.input.placeholder||(n.$elements.$form.find(".firstname").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","firstname")),n.$elements.$form.find(".lastname").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","lastname")),n.$elements.$form.find(".address").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","address")),n.$elements.$form.find(".town").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","town")),n.$elements.$form.find(".county").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","county")),n.$elements.$form.find(".postcode").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","postcode")),n.$elements.$form.find(".email").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","email")),n.$elements.$form.find(".telephone").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","telephone")),n.$elements.$form.find(".comments").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","comments")),n.$elements.$form.find(".mileage").attr("value","Mileage"),n.$elements.$form.find(".vin").attr("value","Vin"),n.$elements.$form.find(".registration").attr("value","Registration"),n.$elements.$form.find(".purchaseDate").attr("value","Purchase Date")),n.$elements.$form.find(".datepicker").datepicker({dateFormat:"dd/mm/yy",minDate:"-10Y",maxDate:"+10Y",changeMonth:!0,changeYear:!0})},u.prototype._updateMarketingPrefs=function(n,t){var i=this;t?i.$elements.$form.find(n).attr("checked",!0).parent().css("background-position","50% -50px"):i.$elements.$form.find(n).removeAttr("checked").parent().css("background-position","50% 0")},u.prototype._submitForm=function(){var t=this,i,ot;t.$elements.$submit.attr("disabled","disabled");var o=t.$elements.$form.find("#txtFirstName"),s=t.$elements.$form.find("#txtLastName"),h=t.$elements.$form.find("#txtAddress"),c=t.$elements.$form.find("#txtTown"),at=t.$elements.$form.find("#txtCounty"),pt=t.$elements.$form.find("#txtPostcode"),u=t.$elements.$form.find("#txtEmail"),yt=t.$elements.$form.find("#txtTelephone"),w=t.$elements.$form.find("#txtMileage"),r=t.$elements.$form.find("#txtVin"),b=t.$elements.$form.find("#txtReg"),p=t.$elements.$form.find("#txtPurchaseDate"),ht=t.$elements.$form.find("#txtComments"),st=o.val().strip(),lt=s.val().strip(),ct=h.val().strip(),ni=c.val().strip(),gt=pt.val().strip(),ii=u.val().strip(),ti=yt.val().strip(),vt=at.val().strip(),a=w.val(),f=r.val(),y=b.val(),v=p.val(),nt=ht.val().strip(),kt=t.$elements.$form.find("#chkEmail").is(":checked"),dt=t.$elements.$form.find("#chkPost").is(":checked"),wt=t.$elements.$form.find("#chkSMS").is(":checked"),bt=t.$elements.$form.find("#chkPhone").is(":checked"),k=aston.generic.getValueForSelect(t.$elements.$events),ft=aston.generic.getValueForSelect(t.$elements.$title),et=aston.generic.getValueForSelect(t.$elements.$country),ut=aston.generic.getValueForSelect(t.$elements.$dealerCountry),d=aston.generic.getValueForSelect(t.$elements.$form.find("#cmbDealers")),l=aston.generic.getValueForSelect(t.$elements.$form.find("#cmbCurrentModel")),it=aston.generic.getValueForSelect(t.$elements.$form.find("#cmbInterestedInModel")),rt=function(){var n=/^([a-zA-Z0-9_-]){6,17}$/;return r.isValid()&&n.test(f)?!0:!1},tt=function(){return l!="0"||a!=""||f!=""||y!=""||v!=""},g=function(){return tt()?l=="0"?!1:a==""?!1:f==""||!rt()?!1:y==""?!1:v==""?!1:!0:!0};k!=0&&o.isValid()&&s.isValid()&&u.isValid(!0)&&h.isValid()&&c.isValid()&&g()&&ut!=0&&d!=0?(t.$elements.$submit.attr("value","Submitting..."),i="",tt()&&(i+="Current Model: "+l+"\n",i+="Mileage: "+a+"\n",i+="Vin: "+f+"\n",i+="Vehicle Registration: "+y+"\n",i+="Purchase Date: "+v+"\n"),it!="0"&&(i+="Intersted In Model: "+it+"\n"),nt!=""&&(i+="\n"+nt),ot={campaignId:k,title:ft,firstName:st,lastName:lt,address1:ct,address2:"",address3:"",townCity:ni,countyState:vt,country:et,postCode:gt,dealerId:d,currentCarMake:0,currentCarModel:"",emailAddress:ii,telephone:ti,ageRange:0,profession:0,interestRapide:!1,interestDbs:!1,interestDb9:!1,interestV12:!1,interestV8:!1,interestCygnet:!1,yearOfReg:"",yearOfPurchase:"",notesForDealer:i,interestPreOwned:!1,interestNew:!0,isApproved:t.options.leadsAreApproved,customerTypeId:5,canPost:dt,canPhone:bt,canSMS:wt,canEmail:kt,drivingExperienceXml:"",purchaseTimeframe:0,interestVirage:!1,interestV8S:!1,interestOne77:!1,gender:"",preferredLanguage:"",interestZagato:!1,interestVanquish:!1},n.when(e("CreateDealerLead10",JSON.stringify(ot))).then(function(n){n&&(t.$elements.$form.fadeOut("slow",function(){t.$elements.$formComplete.removeClass("hidden")}),typeof t.options.onSubmit=="function"&&t.options.onSubmit.call(t))})):(t.$elements.$submit.attr("disabled",!1),n("html,body").animate({scrollTop:t.$elements.$required.offset().top},500),t.$elements.$required.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),k==0?t.$elements.$events.parent().addClass("invalid"):t.$elements.$events.parent().removeClass("invalid"),ft==0?t.$elements.$title.parent().addClass("invalid"):t.$elements.$title.parent().removeClass("invalid"),o.isValid()?o.removeClass("invalid"):o.addClass("invalid"),s.isValid()?s.removeClass("invalid"):s.addClass("invalid"),h.isValid()?h.removeClass("invalid"):h.addClass("invalid"),c.isValid()?c.removeClass("invalid"):c.addClass("invalid"),et==0?t.$elements.$country.parent().addClass("invalid"):t.$elements.$country.parent().removeClass("invalid"),u.isValid(!0)?u.removeClass("invalid"):u.addClass("invalid"),ut==0?t.$elements.$dealerCountry.parent().addClass("invalid"):t.$elements.$dealerCountry.parent().removeClass("invalid"),d==0?t.$elements.$form.find("#cmbDealers").parent().addClass("invalid"):t.$elements.$form.find("#cmbDealers").parent().removeClass("invalid"),g()?(t.$elements.$form.find("#cmbCurrentModel").parent().removeClass("invalid"),w.removeClass("invalid"),r.removeClass("invalid"),b.removeClass("invalid"),p.removeClass("invalid")):(l=="0"?t.$elements.$form.find("#cmbCurrentModel").parent().addClass("invalid"):t.$elements.$form.find("#cmbCurrentModel").parent().removeClass("invalid"),a==""?w.addClass("invalid"):w.removeClass("invalid"),f!=""&&rt()?r.removeClass("invalid"):r.addClass("invalid"),y==""?b.addClass("invalid"):b.removeClass("invalid"),v==""?p.addClass("invalid"):p.removeClass("invalid")))},n.fn[f]=function(t){var e=arguments,i;return t===r||typeof t=="object"?this.each(function(){n.data(this,"plugin_"+f)||n.data(this,"plugin_"+f,new u(this,t))}):typeof t=="string"&&t[0]!=="_"&&t!=="init"?(this.each(function(){var r=n.data(this,"plugin_"+f);r instanceof u&&typeof r[t]=="function"&&(i=r[t].apply(r,Array.prototype.slice.call(e,1))),t==="destroy"&&n.data(this,"plugin_"+f,null)}),i!==r?i:this):void 0}}(jQuery,window,document),function(n,t,i,r){function u(t,i){this.element=t,this.elements={},this.elements.$wrapper=n(this.element),this.elements.$loading=this.elements.$wrapper.find(".loading"),this.options=n.extend({},o,i),this._defaults=o,this._name=f,this.init()}function s(n,t,i,r,u,f,e){this.title=n,this.role=t,this.category=i,this.department=r,this.postedDate=u,this.description=f,this.pdfUrl=e}var f="careers",o={jobs:[],deparments:[]},e={xlarge:[925,415],large:[756,335],medium:[680,305],small:[611,275]};u.prototype.init=function(){var n=this,t;n._triggers(),t=n._getJobs(),t.done(function(){n._buildTable()})},u.prototype._getJobs=function(){var t=this;return n.Deferred(function(i){n.ajax({type:"POST",url:"/Webservices/JobsService.asmx/GetJobs",contentType:"application/json; charset=utf-8",data:{},dataType:"json",success:function(n){var r,u;if(n.d){for(u=0;u<n.d.length;u++)r=n.d[u],r&&t.options.jobs.push(new s(r.Title,r.Role,r.Category,r.Department,r.PostedDateString,r.Description,r.PdfUrl));i.resolve()}}})}).promise()},u.prototype._buildTable=function(){var i=this,f=_.indexBy(i.options.jobs,"role"),e=_.indexBy(i.options.jobs,"category"),r=_.indexBy(i.options.jobs,"department"),u={roles:_.keys(f).sort(),category:_.keys(e).sort(),department:_.keys(r).sort(),jobs:i.options.jobs};i.elements.$wrapper.append(n("#jobTableTemplate").tmpl(u)),i.elements.$loading.hide()},u.prototype._triggers=function(){var t=this;t.elements.$wrapper.find(".more").live("click",function(){var t=n(this),i=t.parents(".job").first().find(".job-description");return t.hasClass("on")?(t.removeClass("on").text("More +"),i.slideUp("fast")):(t.addClass("on").text("Less -"),i.slideDown("fast")),!1}),t.elements.$wrapper.find(".department").live("click",function(){var s=n(this),o=s.data("category"),i,r,f,u;return o&&(i=_.find(t.options.departments,function(n){return n.department==o}),i&&(r=_.uniqueId("department-"),f={id:r,title:i.title,content:i.content},n("#departmentTemplate").tmpl(f).appendTo(n("body")),u=n("#"+r),n.fancybox.open(u,{padding:20,autoSize:!1,beforeLoad:function(){this.width=parseInt(e[aston.theme][0]),this.height=parseInt(e[aston.theme][1])},afterClose:function(){u.remove()}}))),!1}),t.elements.$wrapper.find("select").live("change",function(){var u;t.elements.$loading.show();var i=t.options.jobs,f=n("#role").val(),e=n("#category").val(),r=n("#department").val();f!="0"&&(i=_.filter(i,function(n){return n.role==f})),e!="0"&&(i=_.filter(i,function(n){return n.category==e})),r!="0"&&(i=_.filter(i,function(n){return n.department==r})),u={jobs:i},setTimeout(function(){n("#jobs").empty().append(n("#jobTemplate").tmpl(u)),t.elements.$loading.hide()},500)})},n.fn[f]=function(t){var e=arguments,i;return t===r||typeof t=="object"?this.each(function(){n.data(this,"plugin_"+f)||n.data(this,"plugin_"+f,new u(this,t))}):typeof t=="string"&&t[0]!=="_"&&t!=="init"?(this.each(function(){var r=n.data(this,"plugin_"+f);r instanceof u&&typeof r[t]=="function"&&(i=r[t].apply(r,Array.prototype.slice.call(e,1))),t==="destroy"&&n.data(this,"plugin_"+f,null)}),i!==r?i:this):void 0}}(jQuery,window,document),function(n,t,i,r){function u(t,i){this.element=t,this.$elements={},this.$elements.$form=n(this.element),this.$elements.$formComplete=n("#"+this.element.id+"Complete"),this.$elements.$intro=this.$elements.$form.find("#intro"),this.$elements.$required=this.$elements.$form.find("#requiredFields"),this.$elements.$title=this.$elements.$form.find("#cmbTitle"),this.$elements.$country=this.$elements.$form.find("#cmbCountry"),this.$elements.$state=this.$elements.$form.find("#cmbStates"),this.$elements.$county=this.$elements.$form.find("#txtCounty"),this.$elements.$submit=this.$elements.$form.find("#btnSubmit"),this.options=n.extend({},s,i),this._defaults=s,this._name=f,this.init()}function e(t,i,r,u){return n.Deferred(function(f){o[u]?f.resolve(o[u]):n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/"+t,contentType:"application/json; charset=utf-8",data:i,dataType:"json",success:function(n){n&&(r&&(o[u]=n.d),f.resolve(n.d))},error:function(){f.reject()}})}).promise()}var f="magazineSubscription",s={language:"en",isOwner:!1,onSubmit:n.noop,onInit:n.noop,config:{enthusiastIntro:"<p>If you have purchased an annual print subscription (four issues) to the <a href=\"http://www.astonmartin.com/magazine-subscribe\">Aston Martin Magazine</a> we require you to activate your subscription by completing the form below. Please note you need to enter the precise Delivery Name and Delivery Address you wish your copies of 'AM' to be delivered to, this may - if you require - differ to the Name and Billing Address used when purchasing the magazine through our online shop.</p>",enthusiastComplete:"<p>E. Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</p>",ownerComplete:"<p>O. Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</p>",ownerIntro:"<p>If you are an Aston Martin car owner you are entitled to receive the Aston Martin Magazine for free in both print and app format.</p><p>To register to receive the magazine in print format (if you don’t currently) or to register to download the AM magazine app please complete the form below.  The form includes the creation of a 'My Aston Martin' account, after checking and approving your credentials against the details we currently have stored for you, you will then begin to receive the Aston Martin magazine in print format and be able to use your 'My Aston Martin' account details to download free issue(s).</p><p>Please note if you currently receive the magazine in print format and do not wish to download the magazine app then you do not need to complete this form, your postal subscription will continue without interruption.</p>"}},o={};u.prototype.init=function(){var n=this;n._triggers(),n._populateScreen(),n._styleForm(),typeof n.options.onInit=="function"&&n.options.onInit.call(n)},u.prototype.changeMode=function(n){var t=this;switch(n){case"owner":t.options.isOwner=!0,t.$elements.$form.find("#sectionOwners").show(),t.$elements.$form.find("#sectionCode").hide(),t.$elements.$intro.empty().html(t.options.config.ownerIntro);break;default:t.options.isOwner=!1,t.$elements.$form.find("#sectionOwners").hide(),t.$elements.$form.find("#sectionCode").show(),t.$elements.$intro.empty().html(t.options.config.enthusiastIntro)}},u.prototype._populateScreen=function(){var t=this;n.when(e("GetTitles",{},!0,"titles")).then(function(i){if(i){var u=n('<option value="0">'+aston.generic.getTranslatedText(t.options.language,"forms","titleOption")+"</option>"),r=n.merge(u,n("#titleTemplate").tmpl(i));t.$elements.$title.append(r).selectbox()}}),n.when(e("GetAddressCountries",{},!0,"addressCountries")).then(function(i){if(i){var u=n('<option value="0">'+aston.generic.getTranslatedText(t.options.language,"forms","countryOption")+"</option>"),r=n.merge(u,n("#countryTemplate").tmpl(i));t.$elements.$country.append(r),t.$elements.$country.selectbox()}}),e("GetStatesForCountry",JSON.stringify({country:"USA"}),!0,"states")},u.prototype._triggers=function(){var t=this;t.$elements.$submit.on("click",function(){return t._submitForm(),!1});t.$elements.$country.on("change",function(){var u=aston.generic.getValueForSelect(t.$elements.$country),r,i;return u=="USA"?(r=n('<option value="0">'+aston.generic.getTranslatedText(t.options.language,"forms","stateOption")+"</option>"),i=n.merge(r,n("#stateTemplate").tmpl(o.states)),t.$elements.$state.empty().show().append(i).selectbox(),t.$elements.$county.hide()):(t.$elements.$state.parents(".jquery-selectbox").length&&t.$elements.$state.parents(".jquery-selectbox").unselectbox(),t.$elements.$state.hide(),t.$elements.$county.show()),!1});t.$elements.$form.find("#txtEmail").on("keyup",function(){t._updateMarketingPrefs("#chkEmail",n(this).val().length>0)});t.$elements.$form.find("#txtTelephone").on("keyup",function(){t._updateMarketingPrefs("#chkPhone",n(this).val().length>0)});t.$elements.$form.find("#txtAddress").on("keyup",function(){t._updateMarketingPrefs("#chkPost",n(this).val().length>0)})},u.prototype._styleForm=function(){var n=this;n.$elements.$intro.empty().html(n.options.isOwner?n.options.config.ownerIntro:n.options.config.enthusiastIntro),n.$elements.$form.find(":radio").wrap('<div class="radio"/>'),n.$elements.$form.find(".radio").dgStyle(),n.$elements.$form.find(":checkbox").wrap('<div class="checkbox"/>'),n.$elements.$form.find(".checkbox").dgStyle(),n.$elements.$form.find("select.static").selectbox(),n.$elements.$submit.attr("value",aston.generic.getTranslatedText(n.options.language,"forms","submit")),n.$elements.$form.find(".firstname").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","firstname")),n.$elements.$form.find(".lastname").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","lastname")),n.$elements.$form.find(".address").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","address")),n.$elements.$form.find(".town").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","town")),n.$elements.$form.find(".county").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","county")),n.$elements.$form.find(".postcode").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","postcode")),n.$elements.$form.find(".telephone").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","telephone")),n.$elements.$form.find(".comments").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","comments")),n.$elements.$form.find(".username").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","username")),n.$elements.$form.find(".password").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","password")).attr("title",aston.generic.getTranslatedText(n.options.language,"forms","password")),n.$elements.$form.find(".retypePassword").attr("placeholder",aston.generic.getTranslatedText(n.options.language,"forms","retypePassword")).attr("title",aston.generic.getTranslatedText(n.options.language,"forms","retypePassword")),n.$elements.$form.find(".code").attr("placeholder","Activation Code"),n.$elements.$form.find(".mileage").attr("placeholder","Mileage"),n.$elements.$form.find(".vin").attr("placeholder","Vin"),n.$elements.$form.find(".registration").attr("placeholder","Registration"),n.$elements.$form.find(".registrationDate").attr("placeholder","Registration Date"),n.$elements.$form.find(".purchaseDate").attr("placeholder","Purchase Date"),Modernizr.input.placeholder||(n.$elements.$form.find(".firstname").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","firstname")),n.$elements.$form.find(".lastname").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","lastname")),n.$elements.$form.find(".address").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","address")),n.$elements.$form.find(".town").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","town")),n.$elements.$form.find(".county").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","county")),n.$elements.$form.find(".postcode").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","postcode")),n.$elements.$form.find(".telephone").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","telephone")),n.$elements.$form.find(".comments").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","comments")),n.$elements.$form.find(".username").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","username")),n.$elements.$form.find(".password").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","password")).attr("title",aston.generic.getTranslatedText(n.options.language,"forms","password")),n.$elements.$form.find(".retypePassword").attr("value",aston.generic.getTranslatedText(n.options.language,"forms","retypePassword")).attr("title",aston.generic.getTranslatedText(n.options.language,"forms","retypePassword")),n.$elements.$form.find(".code").attr("value","Activation Code"),n.$elements.$form.find(".mileage").attr("value","Mileage"),n.$elements.$form.find(".vin").attr("value","Vin"),n.$elements.$form.find(".registration").attr("value","Registration"),n.$elements.$form.find(".registrationDate").attr("value","Registration Date"),n.$elements.$form.find(".purchaseDate").attr("value","Purchase Date")),n.$elements.$form.find(".datepicker").datepicker({dateFormat:"dd/mm/yy",minDate:"-10Y",maxDate:"+10Y",changeMonth:!0,changeYear:!0}),n.options.isOwner?(n.$elements.$form.find("#sectionOwners").show(),n.$elements.$form.find("#sectionCode").hide()):(n.$elements.$form.find("#sectionOwners").hide(),n.$elements.$form.find("#sectionCode").show())},u.prototype._updateMarketingPrefs=function(n,t){var i=this;t?i.$elements.$form.find(n).attr("checked",!0).parent().css("background-position","50% -50px"):i.$elements.$form.find(n).removeAttr("checked").parent().css("background-position","50% 0")},u.prototype._submitForm=function(){var t=this,at;t.$elements.$submit.attr("disabled","disabled");var l=t.$elements.$form.find("#txtFirstName"),c=t.$elements.$form.find("#txtLastName"),h=t.$elements.$form.find("#txtAddress"),v=t.$elements.$form.find("#txtTown"),bt=t.$elements.$form.find("#txtCounty"),kt=t.$elements.$form.find("#txtPostcode"),f=t.$elements.$form.find("#txtEmail"),pt=t.$elements.$form.find("#txtTelephone"),r=t.$elements.$form.find("#txtPassword"),i=t.$elements.$form.find("#txtConfirmPassword"),o=t.$elements.$form.find("#txtCode"),b=t.$elements.$form.find("#txtMileage"),s=t.$elements.$form.find("#txtVin"),k=t.$elements.$form.find("#txtReg"),y=t.$elements.$form.find("#txtRegDate"),w=t.$elements.$form.find("#txtPurchaseDate"),p=t.$elements.$form.find('input[name="chkGroupSituation"]'),yt=l.val().strip(),dt=c.val().strip(),ii=h.val().strip(),ri=v.val().strip(),wt=kt.val().strip(),ui=f.val().strip(),ni=pt.val().strip(),ti=bt.val().strip(),nt=b.val(),g=s.val(),rt=k.val(),it=w.val(),tt=y.val(),u=r.val().strip(),a=i.val().strip(),gt=o.val().strip(),ut=p.filter(":checked").val(),ft=aston.generic.getValueForSelect(t.$elements.$title),d=aston.generic.getValueForSelect(t.$elements.$country),lt=aston.generic.getValueForSelect(t.$elements.$state),et=aston.generic.getValueForSelect(t.$elements.$form.find("#cmbCurrentModel")),vt=function(){return u!=""&&u.length>6&&a!=""&&a.length>6&&u==a?!0:!1},st=function(){if(t.options.isOwner){var n=/^([a-zA-Z0-9_-]){6,17}$/;return s.isValid()&&n.test(g)?!0:!1}return!0},ot=function(){return t.options.isOwner?et=="0"?!1:nt==""?!1:g==""||!st()?!1:rt==""?!1:tt==""?!1:it==""?!1:ut?!0:!1:!0},ht=function(){return t.options.isOwner?!0:o.isValid()},ct=function(){return d=="USA"&&lt==0?!1:!0};vt()&&ot()&&ht()&&ct()&&ft!=0&&l.isValid()&&c.isValid()&&f.isValid(!0)&&h.isValid()&&v.isValid()&&d!=0?(t.$elements.$title.parent().removeClass("invalid"),l.removeClass("invalid"),c.removeClass("invalid"),h.removeClass("invalid"),v.removeClass("invalid"),t.$elements.$country.parent().removeClass("invalid"),t.$elements.$state.parent().removeClass("invalid"),f.removeClass("invalid"),o.removeClass("invalid"),t.$elements.$form.find("#cmbCurrentModel").parent().removeClass("invalid"),b.removeClass("invalid"),s.removeClass("invalid"),k.removeClass("invalid"),w.removeClass("invalid"),y.removeClass("invalid"),r.removeClass("invalid"),i.removeClass("invalid"),p.parent().parent().prev("p").removeClass("invalid"),t.$elements.$submit.attr("value","Submitting..."),at={Title:ft,FirstName:yt,LastName:dt,Street:ii,Town:ri,County:ti,State:lt,Country:d,Postcode:wt,Telephone:ni,EmailAddress:ui,Password:u,ActivationCode:gt,IsOwner:t.options.isOwner,CurrentModel:et,Mileage:nt,Vin:g,Registration:rt,RegistrationDate:tt,PurchaseDate:it,Situation:ut},n.when(e("AuthenticateMagazineSubscription",JSON.stringify({reg:at}))).then(function(i){i&&i.Success?(t.$elements.$form.fadeOut("slow",function(){var n=t.options.isOwner?t.options.config.ownerComplete:t.options.config.enthusiastComplete;t.$elements.$formComplete.find(".content").html(n).end().removeClass("hidden")}),typeof t.options.onSubmit=="function"&&t.options.onSubmit.call(t)):(t.$elements.$submit.attr("disabled",!1).attr("value","Submit"),n("html,body").animate({scrollTop:t.$elements.$required.offset().top},500),t.$elements.$required.empty().html('<p style="color: red;">'+i.ErrorMessage+"</p>"))})):(t.$elements.$submit.attr("disabled",!1),n("html,body").animate({scrollTop:t.$elements.$required.offset().top},500),t.$elements.$required.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),ft==0?t.$elements.$title.parent().addClass("invalid"):t.$elements.$title.parent().removeClass("invalid"),l.isValid()?l.removeClass("invalid"):l.addClass("invalid"),c.isValid()?c.removeClass("invalid"):c.addClass("invalid"),h.isValid()?h.removeClass("invalid"):h.addClass("invalid"),v.isValid()?v.removeClass("invalid"):v.addClass("invalid"),d==0?t.$elements.$country.parent().addClass("invalid"):t.$elements.$country.parent().removeClass("invalid"),ct()?t.$elements.$state.parent().removeClass("invalid"):t.$elements.$state.parent().addClass("invalid"),f.isValid(!0)?f.removeClass("invalid"):f.addClass("invalid"),ht()||(o.isValid()?o.removeClass("invalid"):o.addClass("invalid")),!r.isValid()||u.length<7?r.addClass("invalid"):r.removeClass("invalid"),!i.isValid()||a.length<7?i.addClass("invalid"):i.removeClass("invalid"),u!=a?(r.addClass("invalid"),i.addClass("invalid")):r.isValid()&&u.length>6&&i.isValid()&&a.length>6&&(r.removeClass("invalid"),i.removeClass("invalid")),t.options.isOwner&&(ot()?(t.$elements.$form.find("#cmbCurrentModel").parent().removeClass("invalid"),b.removeClass("invalid"),s.removeClass("invalid"),k.removeClass("invalid"),w.removeClass("invalid"),y.removeClass("invalid"),p.parent().parent().prev("p").removeClass("invalid")):(et=="0"?t.$elements.$form.find("#cmbCurrentModel").parent().addClass("invalid"):t.$elements.$form.find("#cmbCurrentModel").parent().removeClass("invalid"),nt==""?b.addClass("invalid"):b.removeClass("invalid"),g!=""&&st()?s.removeClass("invalid"):s.addClass("invalid"),rt==""?k.addClass("invalid"):k.removeClass("invalid"),it==""?w.addClass("invalid"):w.removeClass("invalid"),tt==""?y.addClass("invalid"):y.removeClass("invalid"),ut?p.parent().parent().prev("p").removeClass("invalid"):p.parent().parent().prev("p").addClass("invalid"))))},n.fn[f]=function(t){var e=arguments,i;return t===r||typeof t=="object"?this.each(function(){n.data(this,"plugin_"+f)||n.data(this,"plugin_"+f,new u(this,t))}):typeof t=="string"&&t[0]!=="_"&&t!=="init"?(this.each(function(){var r=n.data(this,"plugin_"+f);r instanceof u&&typeof r[t]=="function"&&(i=r[t].apply(r,Array.prototype.slice.call(e,1))),t==="destroy"&&n.data(this,"plugin_"+f,null)}),i!==r?i:this):void 0}}(jQuery,window,document),function(n,t,i,r){function f(t,i){this.element=t,this.$elements={},this.$elements.$form=n(this.element),this.$elements.$formComplete=n("#"+this.element.id+"Complete"),this.$elements.$required=this.$elements.$form.find("#requiredFields"),this.$elements.$title=this.$elements.$form.find("#Title"),this.$elements.$country=this.$elements.$form.find("#Address_CountryRegionId"),this.$elements.$submit=this.$elements.$form.find("#btnSubmit"),this.options=n.extend({},e,i),this._defaults=e,this._name=u,this.init()}var u="updateDetails",e={language:"en",onSubmit:n.noop};f.prototype.init=function(){this._triggers()},f.prototype._triggers=function(){var t=this;t.$elements.$country.on("change",function(){n(this).val()=="USA"?(t.$elements.$form.find("#colState").show(),t.$elements.$form.find("#colCounty").hide()):(t.$elements.$form.find("#colState").hide(),t.$elements.$form.find("#colCounty").show())});t.$elements.$form.find("#chkCreateAccount").on("click",function(){var r=n(this),i=r.is(":checked");i?(t.$elements.$form.find("#create-account").removeClass("hidden"),t.$elements.$form.find("#create-account-email").html(t.$elements.$form.find("#Email").val())):t.$elements.$form.find("#create-account").addClass("hidden")});t.$elements.$form.find("#Email").on("keyup focusout",function(){var r=n(this),i=t.$elements.$form.find("#create-account-email");i.html(r.val())});t.$elements.$submit.on("click",function(){return t._submitForm(),!1})},f.prototype._submitForm=function(){var t=this,w;t.$elements.$submit.attr("disabled","disabled");var c=t.$elements.$form.find("#FirstName"),h=t.$elements.$form.find("#LastName"),l=t.$elements.$form.find("#Address_Street"),o=t.$elements.$form.find("#Address_TownCity"),d=t.$elements.$form.find("#Address_County"),k=t.$elements.$form.find("#Address_Postcode"),i=t.$elements.$form.find("#Email"),f=t.$elements.$form.find("#txtPassword"),u=t.$elements.$form.find("#txtConfirmPassword"),s=n("#chkCreateAccount").is(":checked"),b=c.val().strip(),ft=h.val().strip(),g=l.val().strip(),ot=o.val().strip(),ut=k.val().strip(),rt=i.val()?i.val().strip():i.val(),it=d.val().strip(),r=s?f.val().strip():"",e=s?u.val().strip():"",et=n("#ContactId").val(),a=t.$elements.$title.val(),v=t.$elements.$country.val(),p=n("#Address_State").val(),y=function(){return!(v=="USA"&&p==0)},tt=function(){return r!=""&&r.length>6&&e!=""&&e.length>6&&r==e?!0:!1},nt=function(){return s?i.isValid(!0)&&tt():!0};a!=0&&c.isValid()&&h.isValid()&&l.isValid()&&o.isValid()&&y()&&nt()&&i.isValid(!0)?(t.$elements.$submit.attr("value","Submitting..."),w=JSON.stringify({contactId:et,title:a,firstName:b,lastName:ft,street:g,town:ot,county:it,state:p,postcode:ut,country:v,email:rt,password:r,createWebLogin:s}),n.ajax({type:"POST",url:"/json/CheckDetailsWidget/Update",data:w,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){n&&(t.$elements.$form.fadeOut("slow",function(){t.$elements.$formComplete.removeClass("hidden")}),typeof t.options.onSubmit=="function"&&t.options.onSubmit.call(t))},error:function(n){console.log(n)}})):(t.$elements.$submit.attr("disabled",!1),n("html,body").animate({scrollTop:t.$elements.$required.offset().top},500),t.$elements.$required.empty().html('<p style="color: red;">PLEASE ENTER ALL OF THE REQUIRED FIELDS</p>'),a==0?t.$elements.$title.addClass("invalid"):t.$elements.$title.removeClass("invalid"),c.isValid()?c.removeClass("invalid"):c.addClass("invalid"),h.isValid()?h.removeClass("invalid"):h.addClass("invalid"),l.isValid()?l.removeClass("invalid"):l.addClass("invalid"),o.isValid()?o.removeClass("invalid"):o.addClass("invalid"),v==0?t.$elements.$country.addClass("invalid"):t.$elements.$country.removeClass("invalid"),y()?t.$elements.$form.find("#Address_State").removeClass("invalid"):t.$elements.$form.find("#Address_State").addClass("invalid"),i.isValid()?i.removeClass("invalid"):i.addClass("invalid"),s&&(!f.isValid()||r.length<7?f.addClass("invalid"):f.removeClass("invalid"),!u.isValid()||e.length<7?u.addClass("invalid"):u.removeClass("invalid"),r!=e?(f.addClass("invalid"),u.addClass("invalid")):f.isValid()&&r.length>6&&u.isValid()&&e.length>6&&(f.removeClass("invalid"),u.removeClass("invalid"))))},n.fn[u]=function(t){var e=arguments,i;return t===r||typeof t=="object"?this.each(function(){n.data(this,"plugin_"+u)||n.data(this,"plugin_"+u,new f(this,t))}):typeof t=="string"&&t[0]!=="_"&&t!=="init"?(this.each(function(){var r=n.data(this,"plugin_"+u);r instanceof f&&typeof r[t]=="function"&&(i=r[t].apply(r,Array.prototype.slice.call(e,1))),t==="destroy"&&n.data(this,"plugin_"+u,null)}),i!==r?i:this):void 0}}(jQuery,window,document),function(n,t){function e(){i.find(".submit").on("click",function(){var f;var u=n(this),t=i.find("#txtActivationCode"),e=t.val().strip();return u.attr("disabled","disabled"),t.isValid()?(t.removeClass("invalid"),u.attr("value","Activating..."),f={code:e},n.ajax({type:"POST",url:"/json/MagazineWidget/ActivateSubscription",data:JSON.stringify(f),contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){n&&n.Success?i.fadeOut("slow",function(){r.removeClass("hidden")}):u.attr("disabled",!1).attr("value","Activate")}})):(u.attr("disabled",!1),t.addClass("invalid")),!1})}var u=this,f={__id:t},o=u.w,i,r;u.register(f),i=n("#activate-subscription"),r=n("#activate-subscription-complete"),f.init=function(){i.length!=0&&e()}}.apply(aston,[jQuery,"activate"]),function(n,t,i,r){function f(t,i){this.element=t,this.elements={},this.elements.$form=n(this.element),this.elements.$formComplete=n("#"+this.element.id+"Complete"),this.elements.$required=this.elements.$form.find("#requiredFields"),this.elements.$submit=this.elements.$form.find("#btnSubmit"),this.options=n.extend({},e,i),this._defaults=e,this._name=u,this.init()}var u="driveChina",e={campaignId:66,leadsAreApproved:!0,language:"zh",leadCountry:"CHN"};f.prototype.init=function(){this._triggers()},f.prototype._triggers=function(){var n=this;n.elements.$submit.on("click",function(t){t.preventDefault(),n._submitForm()})},f.prototype._submitForm=function(){var t=this;t.elements.$submit.attr("disabled","disabled");var f=t.elements.$form.find("#Name"),e=t.elements.$form.find("#City"),u=t.elements.$form.find("#MobileNumber"),i=t.elements.$form.find("#Industry"),r=t.elements.$form.find("#CurrentCar"),a=t.elements.$form.find("#Gender"),c=t.elements.$form.find("#cmbTimeframe"),l=t.elements.$form.find("#cmbDealers"),g=f.val().strip(),d=e.val().strip(),nt=u.val().strip(),it=i.val().strip(),tt=r.val().strip(),o=a.val(),s=c.val(),h=l.val(),k=t.elements.$form.find("#chkVanquishCoupe").is(":checked")||t.elements.$form.find("#chkVanquishVolante").is(":checked"),y=t.elements.$form.find("#chkRapideS").is(":checked"),b=t.elements.$form.find("#chkDb9Coupe").is(":checked")||t.elements.$form.find("#chkDb9Volante").is(":checked"),w=t.elements.$form.find("#chkV12VantageS").is(":checked"),p=t.elements.$form.find("#chkV8VantageCoupe").is(":checked")||t.elements.$form.find("#chkV8VantageRoadster").is(":checked"),v=t.elements.$form.find("#chkV8VantageSCoupe").is(":checked")||t.elements.$form.find("#chkV8VantageSRoadster").is(":checked");o!=""&&s!=""&&h!=""&&f.isValid()&&e.isValid()&&u.isValid()&&i.isValid()&&r.isValid()?(t.elements.$submit.attr("value",aston.generic.getTranslatedText(t.options.language,"forms","submitting")),n.ajax({type:"POST",url:"/Webservices/ProxyNewsletterWs.asmx/CreateDealerLead10",contentType:"application/json; charset=utf-8",data:JSON.stringify({campaignId:t.options.campaignId,title:0,firstName:"",lastName:g,address1:"",address2:"",address3:"",townCity:d,countyState:"",country:t.options.leadCountry,postCode:"",dealerId:h,currentCarMake:0,currentCarModel:tt,emailAddress:"",telephone:nt,ageRange:0,profession:0,interestRapide:y,interestDbs:!1,interestDb9:b,interestV12:w,interestV8:p,interestCygnet:!1,yearOfReg:"",yearOfPurchase:"",notesForDealer:"",interestPreOwned:!1,interestNew:!0,isApproved:t.options.leadsAreApproved,customerTypeId:5,canPost:!1,canPhone:!1,canSMS:!1,canEmail:!1,drivingExperienceXml:"",purchaseTimeframe:s,interestVirage:!1,interestV8S:v,interestOne77:!1,gender:o,preferredLanguage:t.options.language,interestZagato:!1,interestVanquish:k}),dataType:"json",success:function(n){n.d&&t.elements.$form.fadeOut("slow",function(){t.elements.$formComplete.removeClass("hidden")})}})):(t.elements.$submit.attr("disabled",!1),t.elements.$required.empty().html('<p style="color: red;">'+aston.generic.getTranslatedText(t.options.language,"forms","requiredFields")+"</p>"),n("html,body").animate({scrollTop:t.elements.$required.offset().top},500),o==""?a.addClass("invalid"):a.removeClass("invalid"),s==""?c.addClass("invalid"):c.removeClass("invalid"),h==""?l.addClass("invalid"):l.removeClass("invalid"),f.isValid()?f.removeClass("invalid"):f.addClass("invalid"),e.isValid()?e.removeClass("invalid"):e.addClass("invalid"),u.isValid()?u.removeClass("invalid"):u.addClass("invalid"),i.isValid()?i.removeClass("invalid"):i.addClass("invalid"),r.isValid()?r.removeClass("invalid"):r.addClass("invalid"))},n.fn[u]=function(t){var e=arguments,i;return t===r||typeof t=="object"?this.each(function(){n.data(this,"plugin_"+u)||n.data(this,"plugin_"+u,new f(this,t))}):typeof t=="string"&&t[0]!=="_"&&t!=="init"?(this.each(function(){var r=n.data(this,"plugin_"+u);r instanceof f&&typeof r[t]=="function"&&(i=r[t].apply(r,Array.prototype.slice.call(e,1))),t==="destroy"&&n.data(this,"plugin_"+u,null)}),i!==r?i:this):void 0}}(jQuery,window,document),jQuery.fn.findClosest=function(n){var t=jQuery(this),i=t.find(n);return i.length?i:t.parent().length?jQuery.fn.findClosest.call(t.parent(),n):$(0)},jQuery.fn.isValid=function(n){var r=$(this),t=$.trim(r.val()),u=r.attr("placeholder"),i=!0;return n?t!==u&&t!==""&&aston.generic.isValidEmailAddress(t)||(i=!1):(t===u||t==="")&&(i=!1),i},aston.ready(),$(window).load(function(){aston.plugins.videoplayer&&aston.plugins.videoplayer.buildSoundOverlay(),aston.windowLoaded=!0})